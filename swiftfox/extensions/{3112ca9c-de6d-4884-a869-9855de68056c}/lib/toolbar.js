var a;var GTB_version="7.1.20100830";if(GTB_version.length>3&&"VERSION"==GTB_version.substring(3))GTB_version="7.99.20111231.DEV";var GTB_AF_FieldType={NO_SERVER_DATA:0,UNKNOWN_TYPE:1,EMPTY_TYPE:2,NAME_FIRST:3,NAME_MIDDLE:4,NAME_LAST:5,NAME_MIDDLE_INITIAL:6,NAME_FULL:7,NAME_SUFFIX:8,EMAIL_ADDRESS:9,PHONE_HOME_NUMBER:10,PHONE_HOME_CITY_CODE:11,PHONE_HOME_COUNTRY_CODE:12,PHONE_HOME_CITY_AND_NUMBER:13,PHONE_HOME_WHOLE_NUMBER:14,PHONE_FAX_NUMBER:20,PHONE_FAX_CITY_CODE:21,PHONE_FAX_COUNTRY_CODE:22,PHONE_FAX_CITY_AND_NUMBER:23,PHONE_FAX_WHOLE_NUMBER:24,ADDRESS_HOME_LINE1:30,ADDRESS_HOME_LINE2:31,ADDRESS_HOME_APPT_NUM:32,ADDRESS_HOME_CITY:33,
ADDRESS_HOME_STATE:34,ADDRESS_HOME_ZIP:35,ADDRESS_HOME_COUNTRY:36,ADDRESS_BILLING_LINE1:37,ADDRESS_BILLING_LINE2:38,ADDRESS_BILLING_APPT_NUM:39,ADDRESS_BILLING_CITY:40,ADDRESS_BILLING_STATE:41,ADDRESS_BILLING_ZIP:42,ADDRESS_BILLING_COUNTRY:43,CREDIT_CARD_NAME:51,CREDIT_CARD_NUMBER:52,CREDIT_CARD_EXP_MONTH:53,CREDIT_CARD_EXP_2_DIGIT_YEAR:54,CREDIT_CARD_EXP_4_DIGIT_YEAR:55,CREDIT_CARD_EXP_DATE_2_DIGIT_YEAR:56,CREDIT_CARD_EXP_DATE_4_DIGIT_YEAR:57,CREDIT_CARD_TYPE:58,CREDIT_CARD_VERIFICATION_CODE:59,
COMPANY_NAME:60,MAX_VALID_FIELD_TYPE:61};GTB_AF_FieldType.isInformational=function(b){return b&&!goog.isFunction(b)&&b!=GTB_AF_FieldType.NO_SERVER_DATA&&b!=GTB_AF_FieldType.UNKNOWN_TYPE&&b!=GTB_AF_FieldType.EMPTY_TYPE};GTB_AF_FieldType.convertToBilling=function(b){var c=GTB_AF_FieldType.ADDRESS_BILLING_LINE1,d=GTB_AF_FieldType.ADDRESS_HOME_LINE1,e=GTB_AF_FieldType.ADDRESS_HOME_COUNTRY;c=d-c;return b>=d&&b<=e?b-c:b};
GTB_AF_FieldType.convertToShipping=function(b){var c=GTB_AF_FieldType.ADDRESS_BILLING_LINE1,d=GTB_AF_FieldType.ADDRESS_HOME_LINE1,e=GTB_AF_FieldType.ADDRESS_BILLING_COUNTRY;d=d-c;return b>=c&&b<=e?b+d:b};function G_Preferences(b,c,d){if(!G_Preferences.getterMap_&&Ci.nsIPrefBranch.PREF_STRING){G_Preferences.getterMap_={};G_Preferences.getterMap_[Ci.nsIPrefBranch.PREF_STRING]="getCharPref";G_Preferences.getterMap_[Ci.nsIPrefBranch.PREF_BOOL]="getBoolPref";G_Preferences.getterMap_[Ci.nsIPrefBranch.PREF_INT]="getIntPref"}this.observers_={};b=b||null;var e=Cc["@mozilla.org/preferences-service;1"].getService(Ci.nsIPrefService);this.prefs_=c?e.getDefaultBranch(b):e.getBranch(b);this.prefs_.QueryInterface(Ci.nsIPrefBranchInternal);
this.noUnicode_=!!d}G_Preferences.prototype.debugZone="prefs";G_Preferences.setterMap_={string:"setCharPref","boolean":"setBoolPref",number:"setIntPref"};a=G_Preferences.prototype;
a.setPref=function(b,c){var d=typeof c;if(d=="number"&&c%1!=0)throw Error("Cannot store non-integer numbers in preferences.");if(d=="string"&&!this.noUnicode_)return this.setUnicodePref(b,c);var e=G_Preferences.setterMap_[d];if(!e)throw Error("Pref datatype {"+d+"} not supported, key: "+b+", val: "+c);return this.prefs_[e](b,c)};
a.getPref=function(b,c){var d=this.prefs_.getPrefType(b);if(d==Ci.nsIPrefBranch.PREF_INVALID)return c;if(d==Ci.nsIPrefBranch.PREF_STRING&&!this.noUnicode_)return this.getUnicodePref(b,c);var e=G_Preferences.getterMap_[d];if(!e)throw Error("Pref datatype {"+d+"} not supported, key: "+b);try{return this.prefs_[e](b)}catch(f){return c}};
a.setUnicodePref=function(b,c){var d=Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);d.data=c;return this.prefs_.setComplexValue(b,Ci.nsISupportsString,d)};a.getUnicodePref=function(b,c){try{return this.prefs_.getComplexValue(b,Ci.nsISupportsString).data}catch(d){return c}};a.setBoolPref=function(b,c){return this.setPref(b,c)};a.getBoolPref=function(b){return this.prefs_.getBoolPref(b)};a.getBoolPrefOrDefault=function(b,c){return this.getPref(b,c)};
a.getBoolPrefOrDefaultAndSet=function(b,c){try{return this.prefs_.getBoolPref(b)}catch(d){this.prefs_.setBoolPref(b,!!c);return c}};a.clearPref=function(b){try{this.prefs_.clearUserPref(b)}catch(c){}};a.hasUserValue=function(b){return this.prefs_.prefHasUserValue(b)};a.addObserver=function(b,c){var d=new G_PreferenceObserver(c);this.observers_[b]||(this.observers_[b]=new G_ObjectSafeMap);this.observers_[b].insert(c,d);this.prefs_.addObserver(b,d,false)};
a.removeObserver=function(b,c){var d=this.observers_[b].find(c);this.prefs_.removeObserver(b,d);this.observers_[b].erase(c)};a.removeAllObservers=function(){for(var b in this.observers_){var c=this.observers_[b];c=c.getAllValues();for(var d=0;d<c.length;d++){var e=c[d];this.prefs_.removeObserver(b,e)}}this.observers_={}};a.getChildNames=function(b){b||(b="");return this.prefs_.getChildList(b,{})};
G_Preferences.savePrefFile=function(){var b=Cc["@mozilla.org/preferences;1"].getService(Ci.nsIPrefService);try{b.savePrefFile(null)}catch(c){}};function G_PreferenceObserver(b){this.debugZone="prefobserver";this.callback_=b}G_PreferenceObserver.prototype.observe=function(b,c,d){this.callback_(d)};
G_PreferenceObserver.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIObserver)||b.equals(Ci.nsISupportsWeakReference))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};function G_Debug(){}function G_Assert(){}function G_DebugZone(){}a=G_DebugZone.prototype;a.zoneIsEnabled=function(){};a.enableZone=function(){};a.disableZone=function(){};a.debug=function(){};a.error=function(){};a.assert=function(){};function G_DebugService(){}G_DebugService.ERROR_LEVEL_INFO="INFO";G_DebugService.ERROR_LEVEL_WARNING="WARNING";G_DebugService.ERROR_LEVEL_EXCEPTION="EXCEPTION";G_DebugService.TIMESTAMP_INTERVAL=3E5;a=G_DebugService.prototype;
a.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsITimerCallback))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};a.alsoDumpToShell=function(){};a.alsoDumpToConsole=function(){};a.logFileIsEnabled=function(){};a.enableLogFile=function(){};a.disableLogFile=function(){};a.getLogFile=function(){};a.setLogFile=function(){};a.closeLogFile=function(){this.logWriter_.close();this.logWriter_=null};a.enableDumpToShell=function(){};a.disableDumpToShell=function(){};
a.enableDumpToConsole=function(){};a.disableDumpToConsole=function(){};a.getZone=function(){};a.enableZone=function(){};a.disableZone=function(){};a.allZonesEnabled=function(){};a.enableAllZones=function(){};a.disableAllZones=function(){};a.callTracingEnabled=function(){};a.enableCallTracing=function(){};a.disableCallTracing=function(){};a.getLogFileErrorLevel=function(){};a.setLogFileErrorLevel=function(){};
a.notify=function(){if(this.activeSinceLastTimestamp_){this.dump(G_File.LINE_END_CHAR+"=========== Date: "+(new Date).toLocaleString()+" ============"+G_File.LINE_END_CHAR+G_File.LINE_END_CHAR);this.activeSinceLastTimestamp_=false}};a.dump=function(){};a.maybeDumpToFile=function(b){if(this.logFileIsEnabled()&&this.logFile_){if(!this.logWriter_)this.logWriter_=new G_FileWriter(this.logFile_,true);this.logWriter_.write(b)}};a.observe=function(){};
a.reportScriptError_=function(b,c,d,e){if(c.indexOf("http")!=0){b=["","------------------------------------------------------------",e+": "+b,"location: "+c+", line: "+d,"------------------------------------------------------------","",""].join(G_File.LINE_END_CHAR);this.alsoDumpToShell()&&dump(b);this.maybeDumpToFile(b)}};function G_Loggifier(){}G_Loggifier.prototype.mark_=function(){};G_Loggifier.prototype.isLoggified=function(){};G_Loggifier.prototype.getFunctionName_=function(){};
G_Loggifier.prototype.loggify=function(){};function G_DebugSettings(){this.defaults_={};this.prefs_=new G_Preferences}G_DebugSettings.prototype.getSetting=function(b,c){var d=this.prefs_.getPref(b,null);return d!==null?d:b in this.defaults_?this.defaults_[b]:c};G_DebugSettings.prototype.setDefault=function(b,c){this.defaults_[b]=c};new G_DebugService;var G_File={};G_File.getHomeFile=function(b){return G_File.getSpecialFile("Home",b)};G_File.getProfileFile=function(b){return G_File.getSpecialFile("ProfD",b)};G_File.getTempFile=function(b){return G_File.getSpecialFile("TmpD",b)};G_File.getSpecialFile=function(b,c){var d=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties).get(b,Ci.nsILocalFile);c&&d.append(c);return d};
G_File.createUniqueTempFile=function(b){b=(b||(new Date).getTime())+".tmp";b=G_File.getSpecialFile("TmpD",b);b.createUnique(b.NORMAL_FILE_TYPE,420);return b};G_File.createUniqueTempDir=function(b){b=(b||(new Date).getTime())+".tmp";b=G_File.getSpecialFile("TmpD",b);b.createUnique(b.DIRECTORY_TYPE,484);return b};
G_File.fromFileURI=function(b){if(b.indexOf("file://")!=0)throw Error("File path must be a file:// URL");var c=Cc["@mozilla.org/network/protocol;1?name=file"].getService(Ci.nsIFileProtocolHandler);return c.getFileFromURLSpec(b)};G_File.PR_RDONLY=1;G_File.PR_WRONLY=2;G_File.PR_RDWR=4;G_File.PR_CREATE_FILE=8;G_File.PR_APPEND=16;G_File.PR_TRUNCATE=32;G_File.PR_SYNC=64;G_File.PR_EXCL=128;
G_File.__defineGetter__("LINE_END_CHAR",function(){var b;b="@mozilla.org/xre/app-info;1"in Cc?Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULRuntime).OS=="WINNT"?"\r\n":"\n":Cc["@mozilla.org/network/protocol;1?name=http"].getService(Ci.nsIHttpProtocolHandler).platform.toLowerCase().indexOf("win")==0?"\r\n":"\n";G_File.__defineGetter__("LINE_END_CHAR",function(){return b});return b});function G_FileReader(b){this.file_=typeof b=="string"?G_File.fromFileURI(b):b}
G_FileReader.readAll=function(b){b=new G_FileReader(b);try{return b.read()}finally{b.close()}};G_FileReader.prototype.read=function(b){if(!this.stream_){var c=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream);c.init(this.file_,G_File.PR_RDONLY,292,0);this.stream_=Cc["@mozilla.org/scriptableinputstream;1"].createInstance(Ci.nsIScriptableInputStream);this.stream_.init(c)}if(typeof b=="undefined")b=this.stream_.available();return this.stream_.read(b)};
G_FileReader.prototype.close=function(){if(this.stream_){this.stream_.close();this.stream_=null}};function G_FileWriter(b,c){this.file_=typeof b=="string"?G_File.fromFileURI(b):b;this.append_=!!c}G_FileWriter.writeAll=function(b,c,d){b=new G_FileWriter(b,d);try{return b.write(c)}finally{b.close();return 0}};
G_FileWriter.prototype.write=function(b){if(!this.stream_){this.stream_=Cc["@mozilla.org/network/file-output-stream;1"].createInstance(Ci.nsIFileOutputStream);var c=G_File.PR_WRONLY|G_File.PR_CREATE_FILE|(this.append_?G_File.PR_APPEND:G_File.PR_TRUNCATE);this.stream_.init(this.file_,c,-1,0)}return this.stream_.write(b,b.length)};G_FileWriter.prototype.writeLine=function(b){this.write(b+G_File.LINE_END_CHAR)};
G_FileWriter.prototype.close=function(){if(this.stream_){this.stream_.close();this.stream_=null}};function G_ObjectSafeMap(b){this.debugZone="objectsafemap";this.name_=b?b:"noname";this.keys_=[];this.values_=[]}a=G_ObjectSafeMap.prototype;a.indexOfKey_=function(b){for(var c=0;c<this.keys_.length;c++)if(this.keys_[c]===b)return c;return-1};
a.insert=function(b,c){if(b===null)throw Error("Can't use null as a key");if(c===undefined)throw Error("Can't store undefined values in this map");var d=this.indexOfKey_(b);if(d==-1){this.keys_.push(b);this.values_.push(c)}else{this.keys_[d]=b;this.values_[d]=c}};a.erase=function(b){b=this.indexOfKey_(b);var c=b!=-1;if(c){this.keys_.splice(b,1);this.values_.splice(b,1)}return c};a.find=function(b){b=this.indexOfKey_(b);return b==-1?undefined:this.values_[b]};
a.replace=function(b){this.keys_=[];this.values_=[];for(var c=0;c<b.keys_.length;c++){this.keys_.push(b.keys_[c]);this.values_.push(b.values_[c])}};a.forEach=function(b){if(typeof b!="function")throw Error("argument to forEach is not a function, it's a(n) "+typeof b);for(var c=0;c<this.keys_.length;c++)b(this.keys_[c],this.values_[c])};a.getAllKeys=function(){return this.keys_};a.getAllValues=function(){return this.values_};a.size=function(){return this.keys_.length};var goog=goog||{};goog.global=this;goog.DEBUG=false;goog.LOCALE="en";goog.evalWorksForGlobals_=null;goog.provide=function(b){goog.exportPath_(b)};goog.exportPath_=function(b,c,d){b=b.split(".");d=d||goog.global;!(b[0]in d)&&d.execScript&&d.execScript("var "+b[0]);for(var e;b.length&&(e=b.shift());)if(!b.length&&goog.isDef(c))d[e]=c;else d=d[e]?d[e]:(d[e]={})};goog.getObjectByName=function(b,c){for(var d=b.split("."),e=c||goog.global,f;f=d.shift();)if(e[f])e=e[f];else return null;return e};
goog.globalize=function(b,c){var d=c||goog.global;for(var e in b)d[e]=b[e]};goog.addDependency=function(){};goog.useStrictRequires=false;goog.require=function(){};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(){return arguments[0]};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(b){b.getInstance=function(){return b.instance_||(b.instance_=new b)}};
goog.typeOf=function(b){var c=typeof b;if(c=="object")if(b){if(b instanceof Array||!(b instanceof Object)&&Object.prototype.toString.call(b)=="[object Array]"||typeof b.length=="number"&&typeof b.splice!="undefined"&&typeof b.propertyIsEnumerable!="undefined"&&!b.propertyIsEnumerable("splice"))return"array";if(!(b instanceof Object)&&(Object.prototype.toString.call(b)=="[object Function]"||typeof b.call!="undefined"&&typeof b.propertyIsEnumerable!="undefined"&&!b.propertyIsEnumerable("call")))return"function"}else return"null";
else if(c=="function"&&typeof b.call=="undefined")return"object";return c};goog.propertyIsEnumerableCustom_=function(b,c){if(c in b)for(var d in b)if(d==c&&Object.prototype.hasOwnProperty.call(b,c))return true;return false};goog.propertyIsEnumerable_=function(b,c){return b instanceof Object?Object.prototype.propertyIsEnumerable.call(b,c):goog.propertyIsEnumerableCustom_(b,c)};goog.isDef=function(b){return b!==undefined};goog.isNull=function(b){return b===null};
goog.isDefAndNotNull=function(b){return b!=null};goog.isArray=function(b){return goog.typeOf(b)=="array"};goog.isArrayLike=function(b){var c=goog.typeOf(b);return c=="array"||c=="object"&&typeof b.length=="number"};goog.isDateLike=function(b){return goog.isObject(b)&&typeof b.getFullYear=="function"};goog.isString=function(b){return typeof b=="string"};goog.isBoolean=function(b){return typeof b=="boolean"};goog.isNumber=function(b){return typeof b=="number"};
goog.isFunction=function(b){return goog.typeOf(b)=="function"};goog.isObject=function(b){b=goog.typeOf(b);return b=="object"||b=="array"||b=="function"};goog.getUid=function(b){if(b.hasOwnProperty&&b.hasOwnProperty(goog.UID_PROPERTY_))return b[goog.UID_PROPERTY_];b[goog.UID_PROPERTY_]||(b[goog.UID_PROPERTY_]=++goog.uidCounter_);return b[goog.UID_PROPERTY_]};goog.removeUid=function(b){"removeAttribute"in b&&b.removeAttribute(goog.UID_PROPERTY_);try{delete b[goog.UID_PROPERTY_]}catch(c){}};
goog.UID_PROPERTY_="closure_uid_"+Math.floor(Math.random()*2147483648).toString(36);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(b){var c=goog.typeOf(b);if(c=="object"||c=="array"){if(b.clone)return b.clone();c=c=="array"?[]:{};for(var d in b)c[d]=goog.cloneObject(b[d]);return c}return b};
goog.bind=function(b,c){var d=c||goog.global;if(arguments.length>2){var e=Array.prototype.slice.call(arguments,2);return function(){var f=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(f,e);return b.apply(d,f)}}else return function(){return b.apply(d,arguments)}};goog.partial=function(b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=Array.prototype.slice.call(arguments);d.unshift.apply(d,c);return b.apply(this,d)}};
goog.mixin=function(b,c){for(var d in c)b[d]=c[d]};goog.now=Date.now||function(){return+new Date};
goog.globalEval=function(b){if(goog.global.execScript)goog.global.execScript(b,"JavaScript");else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _et_ = 1;");if(typeof goog.global._et_!="undefined"){delete goog.global._et_;goog.evalWorksForGlobals_=true}else goog.evalWorksForGlobals_=false}if(goog.evalWorksForGlobals_)goog.global.eval(b);else{var c=goog.global.document,d=c.createElement("script");d.type="text/javascript";d.defer=false;d.appendChild(c.createTextNode(b));
c.body.appendChild(d);c.body.removeChild(d)}}else throw Error("goog.globalEval not available");};goog.typedef=true;goog.getCssName=function(b,c){var d=b+(c?"-"+c:"");return goog.cssNameMapping_&&d in goog.cssNameMapping_?goog.cssNameMapping_[d]:d};goog.setCssNameMapping=function(b){goog.cssNameMapping_=b};goog.getMsg=function(b,c){var d=c||{};for(var e in d)b=b.replace(RegExp("\\{\\$"+e+"\\}","gi"),d[e]);return b};goog.exportSymbol=function(b,c,d){goog.exportPath_(b,c,d)};
goog.exportProperty=function(b,c,d){b[c]=d};goog.inherits=function(b,c){function d(){}d.prototype=c.prototype;b.superClass_=c.prototype;b.prototype=new d;b.prototype.constructor=b};
goog.base=function(b,c){var d=arguments.callee.caller;if(d.superClass_)return d.superClass_.constructor.apply(b,Array.prototype.slice.call(arguments,1));for(var e=Array.prototype.slice.call(arguments,2),f=false,g=b.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[c]===d)f=true;else if(f)return g.prototype[c].apply(b,e);if(b[c]===d)return b.constructor.prototype[c].apply(b,e);else throw Error("goog.base called from a method of one name to a method of a different name");};
goog.scope=function(b){b.call(goog.global)};goog.MODIFY_FUNCTION_PROTOTYPES=true;
if(goog.MODIFY_FUNCTION_PROTOTYPES){Function.prototype.bind=function(b){if(arguments.length>1){var c=Array.prototype.slice.call(arguments,1);c.unshift(this,b);return goog.bind.apply(null,c)}else return goog.bind(this,b)};Function.prototype.partial=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this,null);return goog.bind.apply(null,b)};Function.prototype.inherits=function(b){goog.inherits(this,b)};Function.prototype.mixin=function(b){goog.mixin(this.prototype,b)}};function alert(b,c){c=c||"message";Cc["@mozilla.org/embedcomp/prompt-service;1"].getService(Ci.nsIPromptService).alert(null,c,b.toString())}function BindToObject(b){var c=Array.prototype.splice.call(arguments,1,arguments.length);return Function.prototype.bind.apply(b,c)};var G_FirefoxXMLUtils={};G_FirefoxXMLUtils.XSI_NAMESPACE="http://www.w3.org/2001/XMLSchema-instance";G_FirefoxXMLUtils.XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/";G_FirefoxXMLUtils.XUL_NAMESPACE="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";
G_FirefoxXMLUtils.newXML=function(b,c,d){if(!G_FirefoxXMLUtils.domImpl_)G_FirefoxXMLUtils.domImpl_=Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromString("<foo/>","text/xml").implementation;if(typeof b=="undefined")b=null;if(typeof c=="undefined")c=null;b=G_FirefoxXMLUtils.domImpl_.createDocument(c,b,null);if(d){c=b.documentElement;for(var e in d)c.setAttributeNS(this.XMLNS_NAMESPACE,"xmlns:"+e,d[e])}return b};G_FirefoxXMLUtils.getXMLString=function(b){return Cc["@mozilla.org/xmlextras/xmlserializer;1"].createInstance(Ci.nsIDOMSerializer).serializeToString(b)};
G_FirefoxXMLUtils.loadXML=function(b){var c=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream);c.init(b,1,0,0);b=Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromStream(c,null,c.available(),"text/xml");c.close();if(b.documentElement.nodeName=="parsererror")throw Error(b.documentElement.firstChild.nodeValue);return b};
G_FirefoxXMLUtils.parseString=function(b){b=Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromString(b,"text/xml");if(G_FirefoxXMLUtils.isParserError(b))throw Error(b.documentElement.firstChild.nodeValue);return b};G_FirefoxXMLUtils.isParserError=function(b){b=b.documentElement;return b.namespaceURI=="http://www.mozilla.org/newlayout/xml/parsererror.xml"&&b.nodeName=="parsererror"};G_FirefoxXMLUtils.saveXML=function(b,c){G_FileWriter.writeAll(c,this.getXMLString(b))};
G_FirefoxXMLUtils.selectNodes=function(b,c,d,e){var f=b.nodeType==b.DOCUMENT_NODE?b:b.ownerDocument;if(typeof d=="undefined")d=null;e=e?Ci.nsIDOMXPathResult.ORDERED_NODE_SNAPSHOT_TYPE:Ci.nsIDOMXPathResult.ORDERED_NODE_ITERATOR_TYPE;return f.evaluate(c,b,d,e,null)};G_FirefoxXMLUtils.selectSingleNode=function(b,c,d){var e=b.nodeType==b.DOCUMENT_NODE?b:b.ownerDocument;if(typeof d=="undefined")d=null;return e.evaluate(c,b,d,Ci.nsIDOMXPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue};
G_FirefoxXMLUtils.isNil=function(b){return b.getAttributeNS(this.XSI_NAMESPACE,"nil")=="true"};G_FirefoxXMLUtils.setNil=function(b){b.setAttributeNS(this.XSI_NAMESPACE,"xsi:nil","true")};function G_Alarm(b,c,d,e){this.debugZone="alarm";this.callback_=b;this.repeating_=!!d;b=Components.classes;var f=Components.interfaces;this.timer_=b["@mozilla.org/timer;1"].createInstance(f.nsITimer);d=d?this.timer_.TYPE_REPEATING_SLACK:this.timer_.TYPE_ONE_SHOT;this.maxTimes_=e?e:null;this.nTimes_=0;c=Math.max(c,0);c=Math.min(c,G_Alarm.MAX_DELAY_MILLISEC);this.timer_.initWithCallback(this,c,d)}G_Alarm.MAX_DELAY_MILLISEC=Math.pow(2,32)-1;
G_Alarm.prototype.cancel=function(){if(this.timer_){this.timer_.cancel();this.callback_=this.timer_=null}};G_Alarm.prototype.notify=function(){var b=this.callback_();this.nTimes_++;if(this.repeating_&&typeof this.maxTimes_=="number"&&this.nTimes_>=this.maxTimes_)this.cancel();else this.repeating_||this.cancel();return b};
G_Alarm.prototype.QueryInterface=function(b){if(b.equals(Components.interfaces.nsISupports)||b.equals(Components.interfaces.nsIObserver)||b.equals(Components.interfaces.nsITimerCallback))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};function G_ConditionalAlarm(b,c,d,e){G_Alarm.call(this,b,c,d,e);this.debugZone="conditionalalarm"}G_ConditionalAlarm.inherits(G_Alarm);G_ConditionalAlarm.prototype.notify=function(b){b=G_Alarm.prototype.notify.call(this,b);this.repeating_&&b&&this.cancel()};function G_NewXMLHttpRequest(){var b=Cc["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance(Ci.nsIXMLHttpRequest);b.QueryInterface(Ci.nsIJSXMLHttpRequest);return b}function G_XMLFetcher(b){this.debugZone="xmlfetcher";this.request_=G_NewXMLHttpRequest();this.stripCookies_=!!b;this.callback_=null;this.headers_={};this.expectBinary_=false}a=G_XMLFetcher.prototype;a.setRequestHeader=function(b,c){this.headers_[b]=c};
a.initRequest_=function(b,c,d){this.request_.abort();this.request_=G_NewXMLHttpRequest();this.callback_=d;this.request_.open(b,c,true);this.expectBinary_&&this.request_.overrideMimeType("text/plain; charset=x-user-defined");for(var e in this.headers_)this.request_.setRequestHeader(e,this.headers_[e]);this.stripCookies_&&new G_CookieStripper(this.request_.channel);this.request_.onreadystatechange=BindToObject(this.readyStateChange,this)};a.head=function(b,c){this.initRequest_("HEAD",b,c);this.request_.send(null)};
a.get=function(b,c){this.initRequest_("GET",b,c);this.request_.send(null)};a.post=function(b,c,d){this.initRequest_("POST",b,d);"Content-Type"in this.headers_||this.request_.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.request_.send(c)};
a.readyStateChange=function(){if(this.request_.readyState==4){var b=null,c=null,d=null;try{b=this.request_.responseText;c=this.request_.responseXML;d=this.request_.status}catch(e){}if(this.callback_){var f=this.request_.getResponseHeader("Set-Cookie");this.callback_({responseText:b,responseXML:c,status:d,cookieSet:f});this.callback_=this.request_.onreadystatechange=null}}};a.getResponseHeader=function(b){if(this.request_&&this.request_.readyState==4)return this.request_.getResponseHeader(b)};
a.expectBinaryData=function(){this.expectBinary_=true};function G_CookieStripper(b){this.debugZone="cookiestripper";this.topic_="http-on-modify-request";this.channel_=b;this.observerService_=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);this.observerService_.addObserver(this,this.topic_,false);b=2E4;this.alarm_=new G_Alarm(BindToObject(this.stopObserving,this),b)}
G_CookieStripper.prototype.observe=function(b,c){if(!(c!=this.topic_||b!=this.channel_)){this.channel_.QueryInterface(Ci.nsIHttpChannel);this.channel_.setRequestHeader("Cookie","",false);this.alarm_.cancel();this.stopObserving()}};G_CookieStripper.prototype.stopObserving=function(){this.observerService_.removeObserver(this,this.topic_);this.channel_=this.alarm_=this.observerService_=null};
G_CookieStripper.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIObserver))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};function G_NoAuthXMLFetcher(b){G_XMLFetcher.call(this,b);this.debugZone="noauth-xmlfetcher"}G_NoAuthXMLFetcher.inherits(G_XMLFetcher);G_NoAuthXMLFetcher.prototype.initRequest_=function(b,c,d){G_XMLFetcher.prototype.initRequest_.call(this,b,c,d);b=this.request_.channel;b.QueryInterface(Ci.nsIChannel);b.notificationCallbacks=new G_NoAuthInterfaceReqestor};
function G_NoAuthInterfaceReqestor(){this.debugZone="noauth-interface-requestor"}G_NoAuthInterfaceReqestor.prototype.getInterface=function(b){if(b.equals(Ci.nsIAuthPrompt))return new G_NoAuthPrompt;return null};G_NoAuthInterfaceReqestor.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIInterfaceRequestor))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};function G_NoAuthPrompt(){}G_NoAuthPrompt.prototype.prompt=function(){return false};
G_NoAuthPrompt.prototype.promptPassword=function(){return false};G_NoAuthPrompt.prototype.promptUsernameAndPassword=function(){return false};G_NoAuthPrompt.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIAuthPrompt))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};goog.json={};goog.json.isValid_=function(b){if(/^\s*$/.test(b))return false;var c=/\\["\\\/bfnrtu]/g,d=/"[^"\\\n\r\u2028\u2029\x00-\x08\x10-\x1f\x80-\x9f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,e=/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,f=/^[\],:{}\s\u2028\u2029]*$/;return f.test(b.replace(c,"@").replace(d,"]").replace(e,""))};goog.json.parse=function(b){b=String(b);if(goog.json.isValid_(b))try{return eval("("+b+")")}catch(c){}throw Error("Invalid JSON string: "+b);};
goog.json.unsafeParse=function(b){return eval("("+b+")")};goog.json.serialize=function(b){return(new goog.json.Serializer).serialize(b)};goog.json.Serializer=function(){};goog.json.Serializer.prototype.serialize=function(b){var c=[];this.serialize_(b,c);return c.join("")};
goog.json.Serializer.prototype.serialize_=function(b,c){switch(typeof b){case "string":this.serializeString_(b,c);break;case "number":this.serializeNumber_(b,c);break;case "boolean":c.push(b);break;case "undefined":c.push("null");break;case "object":if(b==null){c.push("null");break}if(goog.isArray(b)){this.serializeArray_(b,c);break}this.serializeObject_(b,c);break;case "function":break;default:throw Error("Unknown type: "+typeof b);}};
goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\u0008":"\\b","\u000c":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\u000b":"\\u000b"};goog.json.Serializer.charsToReplace_=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;
goog.json.Serializer.prototype.serializeString_=function(b,c){c.push('"',b.replace(goog.json.Serializer.charsToReplace_,function(d){if(d in goog.json.Serializer.charToJsonCharCache_)return goog.json.Serializer.charToJsonCharCache_[d];var e=d.charCodeAt(0),f="\\u";if(e<16)f+="000";else if(e<256)f+="00";else if(e<4096)f+="0";return goog.json.Serializer.charToJsonCharCache_[d]=f+e.toString(16)}),'"')};goog.json.Serializer.prototype.serializeNumber_=function(b,c){c.push(isFinite(b)&&!isNaN(b)?b:"null")};
goog.json.Serializer.prototype.serializeArray_=function(b,c){var d=b.length;c.push("[");for(var e="",f=0;f<d;f++){c.push(e);this.serialize_(b[f],c);e=","}c.push("]")};goog.json.Serializer.prototype.serializeObject_=function(b,c){c.push("{");var d="";for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];if(typeof f!="function"){c.push(d);this.serializeString_(e,c);c.push(":");this.serialize_(f,c);d=","}}c.push("}")};function G_MozVersionNumber(b){this.debugZone="mozversion";this.version_=b;this.comparator_=null}G_MozVersionNumber.prototype.compareToString=function(b){if(!this.comparator)this.comparator_=Cc["@mozilla.org/xpcom/version-comparator;1"].getService(Ci.nsIVersionComparator);return this.comparator_.compare(this.getVersion(),b)};
G_MozVersionNumber.prototype.isVersionOf=function(b){if(this.getVersion().indexOf("+")!=-1||b.indexOf("+")!=-1)return this.compareToString(b)==0;if(this.compareToString(b)==0)return true;b=b.split(".");var c=this.getVersion().split(".");if(b.length>c.length)return false;for(var d=0;d<b.length;d++)if(b[d]!=c[d])return false;return true};G_MozVersionNumber.prototype.getVersion=function(){return this.version_};
function G_ThisFirefoxVersion(){var b;try{var c=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULAppInfo);b=c.version}catch(d){b=(new G_Preferences).getPref("app.version")}if(!b)throw Error("Couldn't get application version!");G_MozVersionNumber.call(this,b);this.debugZone="firefoxversion"}G_ThisFirefoxVersion.inherits(G_MozVersionNumber);function G_GeckoVersion(){G_MozVersionNumber.call(this,null)}G_GeckoVersion.inherits(G_MozVersionNumber);
G_GeckoVersion.prototype.getVersion=function(){if(!this.version_){var b=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULAppInfo);this.version_=b.platformVersion}return this.version_};G_GeckoVersion.prototype.isFirefox3=function(){return this.isVersionOf("1.9")};G_GeckoVersion.prototype.isFirefox2=function(){return this.isVersionOf("1.8.1")};var GTB_GeckoVersion=new G_GeckoVersion,GTBCachedPlatform=null;function GetPlatform(){if(GTBCachedPlatform)return GTBCachedPlatform;var b=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULRuntime).OS.toUpperCase();GTBCachedPlatform=0;switch(b){case "WINNT":case "WINME":case "WIN98":GTBCachedPlatform=1;break;case "DARWIN":GTBCachedPlatform=2;break;case "LINUX":case "LINUX-GNU":case "FREEBSD":case "SUNOS":GTBCachedPlatform=3;break}return GTBCachedPlatform}
function GetPlatformStr(){switch(GetPlatform()){case 1:return"win";case 2:return"mac";case 3:return"linux";default:return"unknown"}}goog.exportSymbol("GetPlatformStr",GetPlatformStr);function IsPlatformWin(){return GetPlatform()==1}goog.exportSymbol("IsPlatformWin",IsPlatformWin);
function IsPlatformVista(){var b=Cc["@mozilla.org/appshell/appShellService;1"].getService(Ci.nsIAppShellService).hiddenDOMWindow;return(b=b.navigator)&&b.platform.substring(0,3)=="Win"&&b.userAgent.indexOf("Windows NT 6")>=0}goog.exportSymbol("IsPlatformVista",IsPlatformVista);function GetFocusedWindow(b){var c=b.GTB_getToolbar();c=c._getCurrentWindow();if(c.frames.length==0)b=c;else{b=b.document;b=b.commandDispatcher.focusedWindow;if(b==null)b=c}return b}
function GTB_GetCurrentWeekNum(){var b=1044230400,c=604800,d=Date.now()/1E3;return Math.max(0,Math.floor((d-b)/c))}
function GTB_OverrideUserAgent(b,c){c||(c=" GoogleToolbarFF");var d=Cc["@mozilla.org/network/protocol;1?name=http"].getService(Ci.nsIHttpProtocolHandler),e=d.userAgent;d=new G_Preferences;var f=d.getPref("general.useragent.override",null);d.setPref("general.useragent.override",e+c);e=b();f!=null?d.setPref("general.useragent.override",f):d.clearPref("general.useragent.override");return e}function GTB_truncateWithElipsis(b,c){if(b.length>c)b=b.slice(0,c-3)+"...";return b}
function GTB_GetMapValuesArray(b){var c=[];for(var d in b)c.push(b[d]);return c}function GTB_IsEmptyMap(b){for(var c in b)return false;return true}function GTB_LocaleCompare(b,c){var d=b.localeCompare(c);if(d!=0)return d;if(b==c)return 0;return b<c?-1:+1}
function GTB_NoToolbarVisible(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);for(b=b.getEnumerator("navigator:browser");b.hasMoreElements();){var c=b.getNext();if(GTB_isGoogleToolbarVisibleInDoc(c.document))return false}return true}function GTB_isGoogleToolbarVisibleInDoc(b){return GTB_isToolbarVisible(b.getElementById("gtbToolbar"))}goog.exportSymbol("GTB_isGoogleToolbarVisibleInDoc",GTB_isGoogleToolbarVisibleInDoc);
function GTB_isToolbarVisible(b){b=b.ownerDocument.defaultView.getComputedStyle(b,null);return b.visibility=="visible"&&b.display!="none"}function GTB_findToolbar(b){b=b;do b=b.parentNode;while(b&&b.nodeName!="toolbar"&&b.nodeName!="toolbarpalette");return b&&b.nodeName=="toolbar"?b:null}
function GTB_isGoogleToolbarActive(b,c){if(!b){var d=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=(d=d.getMostRecentWindow("navigator:browser"))&&d.document;if(!b)return false}return((d=c&&b.getElementById(c))?GTB_isToolbarVisible(d.parentNode):GTB_isGoogleToolbarVisibleInDoc(b))||GTB_GlobalPrefs.getPref("google.toolbar.work_when_invisible",false)}
function GTB_ListenersBinding(b,c){this.debugZone="GTB_ListenersBinding";this.target_=b;this.listenerObject_=c;this.eventAndListener_=[]}GTB_ListenersBinding.prototype.addEventListener=function(b,c){var d=BindToObject(c,this.listenerObject_);this.target_.addEventListener(b,d,true);this.eventAndListener_.push({event:b,listener:d})};
GTB_ListenersBinding.prototype.removeAllListeners=function(){for(var b=this.eventAndListener_.length-1;b>=0;b--){var c=this.eventAndListener_[b];this.target_.removeEventListener(c.event,c.listener,true)}};function GTB_getChromeWindow(b){b=b.QueryInterface(Ci.nsIInterfaceRequestor);b=b.getInterface(Ci.nsIWebNavigation);b=b.QueryInterface(Ci.nsIDocShellTreeItem);b=b.rootTreeItem.QueryInterface(Ci.nsIInterfaceRequestor);return b=b.getInterface(Ci.nsIDOMWindow)}
function GTB_getTabbrowserForDoc(b){b=b&&b.defaultView;if(!b)return null;return(b=GTB_getChromeWindow(b).wrappedJSObject)&&b.document.getElementById("content")||null}function GTB_httpGetBinary(b,c){try{var d=Cc["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance(Ci.nsIXMLHttpRequest);d.open("GET",b,true);d.overrideMimeType("text/plain; charset=x-user-defined")}catch(e){return}d.onreadystatechange=function(){try{d.readyState==4&&d.status==200&&c(d)}catch(g){}};try{d.send(null)}catch(f){}}
function GTB_saveBinaryFile(b,c){b.exists()||b.create(Ci.nsIFile.NORMAL_FILE_TYPE,420);var d=Cc["@mozilla.org/network/safe-file-output-stream;1"].createInstance(Ci.nsIFileOutputStream);d.init(b,-1,384,0);d.write(c,c.length);d instanceof Ci.nsISafeOutputStream?d.finish():d.close()}function GTB_BindListener(b,c,d){return GTB_EventProfiler.enabled()?GTB_EventProfiler.bind(b,c,d):BindToObject(b,c)}function GTB_RegisterListener(b,c,d,e){d=GTB_BindListener(d,e,c);b.registerListener(c,d);return d}
function GTB_AddEventListener(b,c,d,e){d=GTB_BindListener(d,e,c);b.addEventListener(c,d,true);return d}function GTB_StringToUTF8(b){var c=Ci.nsIScriptableUnicodeConverter;c=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(c);c.charset="UTF-8";var d={};return c.convertToByteArray(b,d)}function GTB_IsPrivateBrowsing(){try{var b=Cc["@mozilla.org/privatebrowsing;1"].getService(Ci.nsIPrivateBrowsingService);return b.privateBrowsingEnabled}catch(c){return false}}
function GTB_getDataDir(){return G_File.getProfileFile("GoogleToolbarData")}function GTB_ensureDirectoryExists(b){b.exists()&&!b.isDirectory()&&b.remove(true);b.exists()||b.create(1,parseInt("0700",8))}function GTB_getInstallFile(){for(var b=Cc["@mozilla.org/extensions/manager;1"].getService(Ci.nsIExtensionManager).getInstallLocation("{3112ca9c-de6d-4884-a869-9855de68056c}").getItemLocation("{3112ca9c-de6d-4884-a869-9855de68056c}").clone(),c=0,d;d=arguments[c];c++)b.append(d);return b}
function GTB_logTargetId(b){var c=b.ownerDocument.createEvent("UIEvents");c.initUIEvent("command",true,true,null,0);b.dispatchEvent(c)}function GTB_getFirefoxSearchBar(b){var c=b.getElementById("searchbar");if(c)return c;b=b.getElementById("navigator-toolbox").palette;for(b=b.firstChild;b;b=b.nextSibling)if(b.id=="search-container")return b.firstChild;return null}goog.exportSymbol("GTB_getFirefoxSearchBar",GTB_getFirefoxSearchBar);
function GTB_getWindowZoom(b,c){var d=b.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);if(d.screenPixelsPerCSSPixel)return d.screenPixelsPerCSSPixel;d=c.ZoomManager;if(d.prototype)d=d.prototype;return d.zoom||1}goog.exportSymbol("GTB_getWindowZoom",GTB_getWindowZoom);function GTB_parseJson(b){var c=new Components.utils.Sandbox("about:blank");return Components.utils.evalInSandbox("("+b+")",c)}var GTB_unparseJson=null;try{GTB_unparseJson=JSON&&JSON.stringify}catch(err){}
GTB_unparseJson=GTB_unparseJson||Cc["@mozilla.org/dom/json;1"]&&Cc["@mozilla.org/dom/json;1"].createInstance(Ci.nsIJSON).encode||goog.json.serialize;function GTB_isLocalIP(b){function c(e,f,g,h){return e<<24|f<<16|g<<8|h}function d(e,f,g){g=~(2147483647>>g-1);return(e&g)==(f&g)}b=b.match(/^\s*(\d+)\.(\d+)\.(\d+)\.(\d+)\s*$/);b=c(Number(b[1]),Number(b[2]),Number(b[3]),Number(b[4]));return d(b,c(0,0,0,0),8)||d(b,c(10,0,0,0),8)||d(b,c(127,0,0,0),8)||d(b,c(169,254,0,0),16)||d(b,c(172,16,0,0),12)||d(b,c(192,0,2,0),24)||d(b,c(192,88,99,0),24)||d(b,c(192,168,0,16),16)||d(b,c(198,18,0,0),15)||d(b,c(224,0,0,0),4)}
function GTB_isIP(b){return/^(\d{1,3}\.){3}\d{1,3}$/.test(b)}goog.exportSymbol("GTB_isIP",GTB_isIP);function GTB_parseQueryString(b,c){var d={};if(b)for(var e=b.split("&"),f=0;f<e.length;++f){var g=e[f];if(g=g?g.split("="):null){var h=decodeURIComponent(g.shift().replace(/[+]/g," "));if(c)h=h.toLowerCase();d[h]=decodeURIComponent(g.join("=").replace(/[+]/g," "))}}return d}
function GTB_isGoogleDomain(b){b=b.toLowerCase().split(".");for(var c=b.length-1;c>=0;--c){var d=b[c];if(".com.edu.net.org.gov.mil.jp.de.au.in.uk.fr.ca.dk.it.kr.int.arpa.nato.biz.name.museum.pro.aero.coop.info.ac.ad.ae.af.ag.ai.al.am.an.ao.aq.ar.as.at.au.aw.az.ba.bb.bd.be.bf.bg.bh.bi.bj.bm.bn.bo.br.bs.bt.bv.bw.by.bz.ca.cc.cd.cf.cg.ch.ci.ck.cl.cm.co.cr.cu.cv.cx.cy.cz.de.dj.dk.dm.do.dz.ec.ee.eg.eh.er.es.et.fi.fj.fk.fm.fo.fr.ga.gd.ge.gf.gg.gh.gi.gl.gm.gn.gp.gq.gr.gs.gt.gu.gw.gy.hk.hm.hn.hr.ht.hu.id.ie.il.im.in.io.iq.ir.is.it.je.jm.jo.jp.ke.kg.kh.ki.km.kn.kp.kr.kw.ky.kz.la.lb.lc.li.lk.lr.ls.lt.lu.lv.ly.ma.mc.md.mg.mh.mk.ml.mm.mn.mo.mp.mq.mr.ms.mt.mu.mv.mw.mx.my.mz.na.nc.ne.nf.ng.ni.nl.no.np.nr.nu.nz.om.pa.pe.pf.pg.ph.pk.pl.pm.pn.pr.ps.pt.pw.py.qa.re.ro.ru.rw.sa.sb.sc.sd.se.sg.sh.si.sj.sk.sl.sm.sn.so.sr.st.sv.sy.sz.tc.td.tf.tg.th.tj.tk.tm.tn.to.tp.tr.tt.tv.tw.tz.ua.ug.uk.um.us.uy.uz.va.vc.ve.vg.vi.vn.vu.wf.ws.ye.yt.yu.za.zm.zw.".indexOf("."+d+
".")==-1)return d=="google"||d=="google-analytics"||d=="writely"}return false}function GTB_convertToUrl(b){if(typeof b!="string")return b;else{var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService),d=null;try{d=c.newURI(b,null,null)}catch(e){}return d}}goog.exportSymbol("GTB_convertToUrl",GTB_convertToUrl);
function GTB_isGoogleUrl(b){b=GTB_convertToUrl(b);var c;if(c=b!=null){if(c=b.scheme=="http"){c=b;c=GTB_convertToUrl(c);var d;if(d=c!=null){if(d=c.scheme=="http"){if(d=c.host=="127.0.0.1"||c.host=="localhost"){c=c;d=Cc["@google.com/toolbar/application;1"].getService().wrappedJSObject;d=d.GetPlatform()==1?c.port==4664:c.port&&c.path.startsWith("/search?")}d=d}d=d}c=d;if(!(c=c)){if(!(c=GTB_isGoogleDomain(b.host))){b=b.spec.match(/q=cache:\S*/);if(b==null)c=false;else c=(b=b[0].match(/http:\S*/))?GTB_isGoogleUrl(b[0]):
false}c=c}c=c}c=c}return c}
function GTB_LooksLikeUrl(b){b=b.trim();if(b.search(/\s/)!=-1)return false;if(b.indexOf("http://")==0||b.indexOf("https://")==0||b.indexOf("ftp://")==0)return true;var c=b.indexOf("/");if(c==-1)c=b.length;b=b.substr(0,c);if(b.search(/[^_a-zA-Z0-9\*\-\.]/)!=-1)return false;c=b.lastIndexOf(".");if(c<=0)return false;b=b.substring(c+1,b.length);if(".com.edu.net.org.gov.mil.jp.de.au.in.uk.fr.ca.dk.it.kr.int.arpa.nato.biz.name.museum.pro.aero.coop.info.ac.ad.ae.af.ag.ai.al.am.an.ao.aq.ar.as.at.au.aw.az.ba.bb.bd.be.bf.bg.bh.bi.bj.bm.bn.bo.br.bs.bt.bv.bw.by.bz.ca.cc.cd.cf.cg.ch.ci.ck.cl.cm.co.cr.cu.cv.cx.cy.cz.de.dj.dk.dm.do.dz.ec.ee.eg.eh.er.es.et.fi.fj.fk.fm.fo.fr.ga.gd.ge.gf.gg.gh.gi.gl.gm.gn.gp.gq.gr.gs.gt.gu.gw.gy.hk.hm.hn.hr.ht.hu.id.ie.il.im.in.io.iq.ir.is.it.je.jm.jo.jp.ke.kg.kh.ki.km.kn.kp.kr.kw.ky.kz.la.lb.lc.li.lk.lr.ls.lt.lu.lv.ly.ma.mc.md.mg.mh.mk.ml.mm.mn.mo.mp.mq.mr.ms.mt.mu.mv.mw.mx.my.mz.na.nc.ne.nf.ng.ni.nl.no.np.nr.nu.nz.om.pa.pe.pf.pg.ph.pk.pl.pm.pn.pr.ps.pt.pw.py.qa.re.ro.ru.rw.sa.sb.sc.sd.se.sg.sh.si.sj.sk.sl.sm.sn.so.sr.st.sv.sy.sz.tc.td.tf.tg.th.tj.tk.tm.tn.to.tp.tr.tt.tv.tw.tz.ua.ug.uk.um.us.uy.uz.va.vc.ve.vg.vi.vn.vu.wf.ws.ye.yt.yu.za.zm.zw.".indexOf("."+b+
".")==-1)return false;return true}
function GTB_getCookie(b,c,d){var e=new G_Preferences;e=e.getPref("network.cookie.cookieBehavior");if(e==1){e=GTB_convertToUrl("http://google.com");var f=Cc["@mozilla.org/cookie/permission;1"].getService(Ci.nsICookiePermission),g=f.canAccess(e,null);g==Ci.nsICookiePermission.ACCESS_DEFAULT&&f.setAccess(e,Ci.nsICookiePermission.ACCESS_ALLOW)}b=GTB_convertToUrl(b);e=Cc["@mozilla.org/cookieService;1"].getService(Ci.nsICookieService);f=null;f=d?e.getCookieStringFromHttp(b,b,null):e.getCookieString(b,
null);if(!f)return null;d=f.split(/;[\s]+/);for(b=0;b<d.length;b++){e=d[b].split("=");if(e[0].toLowerCase()==c.toLowerCase())return e[1]}return null}
function GTB_resolveIp(b,c){if(!b){c("");return null}try{var d=Cc["@mozilla.org/network/dns-service;1"].getService(Ci.nsIDNSService),e=Cc["@mozilla.org/thread-manager;1"]?Cc["@mozilla.org/thread-manager;1"].getService().mainThread:Cc["@mozilla.org/event-queue-service;1"].getService(Ci.nsIEventQueueService).getSpecialEventQueue(Ci.nsIEventQueueService.UI_THREAD_EVENT_QUEUE);if(!e){c("");return null}var f=new GTB_resolveIp.DNSLookUpHandler(c);return d.asyncResolve(b,0,f,e)}catch(g){c("");return null}}
goog.exportSymbol("GTB_resolveIp",GTB_resolveIp);GTB_resolveIp.DNSLookUpHandler=function(b){this.callback_=b};GTB_resolveIp.DNSLookUpHandler.prototype.QueryInterface=function(b){if(b.equals(Components.interfaces.nsISupports)||b.equals(Components.interfaces.nsIDNSListener))return this;throw Components.results.NS_NOINTERFACE;};GTB_resolveIp.DNSLookUpHandler.prototype.onLookupComplete=function(b,c){var d=c&&c.getNextAddrAsString();this.callback_(d)};
function GTB_createPostDataStream(b){var c=Cc["@mozilla.org/io/string-input-stream;1"].createInstance(Ci.nsIStringInputStream);if("data"in c)c.data=b;else c.setData(b,b.length);b=Cc["@mozilla.org/network/mime-input-stream;1"].createInstance(Ci.nsIMIMEInputStream);b.addHeader("Content-Type","application/x-www-form-urlencoded");b.addContentLength=true;b.setData(c);return b};function StripHTML(b){var c=Cc["@mozilla.org/feed-unescapehtml;1"].getService(Ci.nsIScriptableUnescapeHTML);return c.unescape(b)}function GetFavicon(b){b=GTB_convertToUrl(b);if(!(b instanceof Ci.nsIURI))return null;if("http"!=b.scheme&&"https"!=b.scheme)return null;return b.scheme+"://"+b.hostPort+"/favicon.ico"}
function gtbRecurseFrames(b,c,d,e){e=(e||0)+1;if(!(e>16)){for(var f=b.getElementsByTagName("frame"),g=f.length,h=0;h<g;++h)gtbRecurseFrames(f[h].contentDocument,c,f[h],e);f=b.getElementsByTagName("iframe");g=f.length;for(h=0;h<g;++h)gtbRecurseFrames(f[h].contentDocument,c,f[h],e);try{c(b,d)}catch(i){}}}
function gtbCopyFormContentsForTag(b,c,d){b=GTB_getElementsByTagName(b,d);c=GTB_getElementsByTagName(c,d);if(b.length==c.length)for(d=0;d!=b.length;++d){var e=c[d],f=b[d],g=e.tagName.toLowerCase(),h=f.tagName.toLowerCase();if(g==h)if(g=="input"){if(e.type==f.type)if(e.name==f.name)if(e.type=="text")f.setAttribute("value",e.value);else if(e.type=="checkbox"||e.type=="radio")e.checked?f.setAttribute("checked",true):f.removeAttribute("checked")}else if(g=="option")if(e.value==f.value)e.selected?f.setAttribute("selected",
true):f.removeAttribute("selected")}}
function GTB_getElementsByTagName(b,c){if(b.getElementsByTagName)return b.getElementsByTagName(c);var d=[],e=b.startContainer;if(e.hasChildNodes())e=e.childNodes.item(b.startOffset);var f=b.endContainer,g=false;if(f.hasChildNodes()){var h=f.childNodes.item(b.endOffset);if(h!=null)f=h;else g=true}for(e=e;;){if(e==f&&!g)break;e.nodeType==e.ELEMENT_NODE&&e.tagName.toLowerCase()==c&&d.push(e);if(e.firstChild)e=e.firstChild;else if(e==f)break;else if(e.nextSibling)e=e.nextSibling;else{for(;;){e=e.parentNode;
if(e==f)break;if(e.nextSibling){e=e.nextSibling;break}}if(e==f)break}}d.item=function(i){return d[i]};return d}
function GTB_getBoxObjectFor(b,c){if(!b)return null;c||(c=1);var d=null;try{var e=b.ownerDocument,f=e&&e.defaultView;if(!f)return null;var g=f.scrollX||0,h=f.scrollY||0;if("getBoxObjectFor"in e){var i=e.getBoxObjectFor(b);d={};d.width=c*i.width;d.height=c*i.height;d.x=i.x;d.y=i.y;d.screenX=i.screenX;d.screenY=i.screenY;d.left=d.x-g;d.right=d.left+d.width;d.top=d.y-h;d.bottom=d.top+d.height}else{var j=c*(f.mozInnerScreenX||0),k=c*(f.mozInnerScreenY||0);i=b.getBoundingClientRect();d={};d.left=c*i.left;
d.right=c*i.right;d.top=c*i.top;d.bottom=c*i.bottom;d.width=d.right-d.left;d.height=d.bottom-d.top;d.x=d.left+g;d.y=d.top+h;d.screenX=d.left+j;d.screenY=d.top+k}}catch(l){}return d}
function GTB_getScrollbarWidth(){try{var b=Cc["@mozilla.org/appshell/appShellService;1"].getService(Ci.nsIAppShellService).hiddenDOMWindow}catch(c){return 17}var d=b.document;b=d.createElementNS("http://www.w3.org/1999/xhtml","div");b.style.position="absolute";b.style.width="100px";b.style.height="50px";b.style.overflow="hidden";var e=d.createElementNS("http://www.w3.org/1999/xhtml","div");e.style.width="100%";e.style.height="200px";d=d.body||d.documentElement;b.appendChild(e);d.appendChild(b);var f=
e.offsetWidth;b.style.overflow="auto";e=f-e.offsetWidth;d.removeChild(b);return e};function G_ObserverWrapper(b,c){this.debugZone="observer";this.topic_=b;this.observeFunction_=c}G_ObserverWrapper.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIObserver))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};G_ObserverWrapper.prototype.observe=function(b,c,d){c==this.topic_&&this.observeFunction_(b,c,d)};
function G_ObserverServiceObserver(b,c,d){this.debugZone="observerserviceobserver";this.topic_=b;this.observeFunction_=c;this.onlyOnce_=!!d;this.observer_=new G_ObserverWrapper(this.topic_,BindToObject(this.observe_,this));this.observerService_=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);this.observerService_.addObserver(this.observer_,this.topic_,false)}
G_ObserverServiceObserver.prototype.unregister=function(){this.observerService_.removeObserver(this.observer_,this.topic_);this.observerService_=null};G_ObserverServiceObserver.prototype.observe_=function(b,c,d){this.observeFunction_(b,c,d);this.onlyOnce_&&this.unregister()};var GTB_Directionality={};GTB_Directionality.CODE_LRE="\u202a";GTB_Directionality.CODE_RLE="\u202b";GTB_Directionality.CODE_PDF="\u202c";GTB_Directionality.toLTR=function(b){return GTB_Directionality.CODE_LRE+b+GTB_Directionality.CODE_PDF};GTB_Directionality.toRTL=function(b){return GTB_Directionality.CODE_RLE+b+GTB_Directionality.CODE_PDF};GTB_Directionality.isLanguageRTL=function(b){return b=="ar"||b=="iw"};
GTB_Directionality.isCharCodeRTL=function(b){return 1424<=b&&b<1536||1536<=b&&b<1792||1872<=b&&b<1920||64336<=b&&b<65024||65136<=b&&b<65280};GTB_Directionality.containsRTL=function(b){for(var c=0;c!=b.length;c++)if(GTB_Directionality.isCharCodeRTL(b.charCodeAt(c)))return true;return false};
GTB_Directionality.adaptToCurrentLocale=function(b,c){var d=c?GTB_Directionality.isLanguageRTL(c):GTB_Directionality.containsRTL(b),e=GTB_Directionality.isLanguageRTL(GTB_getLangCode());return d==e?b:d?GTB_Directionality.toRTL(b):GTB_Directionality.toLTR(b)};GTB_Directionality.setNodeDirection=function(b,c){if(c.endsWith(GTB_Directionality.CODE_PDF))if(c.startsWith(GTB_Directionality.CODE_LRE))b.style.direction="ltr";else if(c.startsWith(GTB_Directionality.CODE_RLE))b.style.direction="rtl"};
goog.exportSymbol("GTB_Directionality.setNodeDirection",GTB_Directionality.setNodeDirection);function GTB_HtmlLocalization(){var b='<?xml version="1.0"?><!DOCTYPE locale [<!ENTITY % g SYSTEM  "chrome://global/locale/global.dtd"> %g;]><locale>&locale.dir;</locale>',c=Components.classes["@mozilla.org/xmlextras/domparser;1"].createInstance(Components.interfaces.nsIDOMParser);b=c.parseFromString(b,"text/xml");this.dir_=b.documentElement.textContent;this.localizedStrings_=Components.classes["@mozilla.org/intl/stringbundle;1"].getService(Components.interfaces.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties")}
goog.exportSymbol("GTB_HtmlLocalization",GTB_HtmlLocalization);GTB_HtmlLocalization.HTML_ESCAPE={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;"};GTB_HtmlLocalization.prototype.getTextDirection=function(){return this.dir_};goog.exportProperty(GTB_HtmlLocalization.prototype,"getTextDirection",GTB_HtmlLocalization.prototype.getTextDirection);
GTB_HtmlLocalization.prototype.getLocalized=function(b,c,d){try{var e=this.localizedStrings_.GetStringFromName(b);b=function(g,h,i){return h?GTB_HtmlLocalization.HTML_ESCAPE[h]:c&&c[i]};d=d?/()\$([\w-]+);/g:/([\&\"<>])|\$([\w-]+);/g;return e=e.replace(d,b)}catch(f){throw f;}};goog.exportProperty(GTB_HtmlLocalization.prototype,"getLocalized",GTB_HtmlLocalization.prototype.getLocalized);GTB_HtmlLocalization.prototype.writeLocalized=function(b,c,d){b.write(this.getLocalized(c,d))};
goog.exportProperty(GTB_HtmlLocalization.prototype,"writeLocalized",GTB_HtmlLocalization.prototype.writeLocalized);GTB_HtmlLocalization.prototype.setupLogo=function(b){return GTB_localizeLogo(b)};goog.exportProperty(GTB_HtmlLocalization.prototype,"setupLogo",GTB_HtmlLocalization.prototype.setupLogo);function GTB_WebProgress(){this.debugZone="WebProgress";this.wrappedJSObject=this;this.browserListeners=[];this.windowListeners=[];var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_LOCATION|Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT);new G_ObserverServiceObserver("xpcom-shutdown",BindToObject(this.shutdown_,this),true)}
GTB_WebProgress.prototype.shutdown_=function(){var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.removeProgressListener(this)};GTB_WebProgress.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsIInterfaceRequestor)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};
GTB_WebProgress.prototype.addBrowserListener=function(b,c,d){this.browserListeners.push({browser:b,callback:c,flags:d})};GTB_WebProgress.prototype.addWindowListener=function(b,c,d){this.windowListeners.push({window:b,callback:c,flags:d})};goog.exportSymbol("GTB_WebProgress.prototype.addWindowListener",GTB_WebProgress.prototype.addWindowListener);
GTB_WebProgress.prototype.removeBrowserListener=function(b,c){for(var d=this.browserListeners.length-1;d>=0;d--)this.browserListeners[d].browser==b&&this.browserListeners[d].callback==c&&this.browserListeners.splice(d,1)};GTB_WebProgress.prototype.removeWindowListener=function(b,c){for(var d=this.windowListeners.length-1;d>=0;d--)this.windowListeners[d].window==b&&this.windowListeners[d].callback==c&&this.windowListeners.splice(d,1)};
goog.exportSymbol("GTB_WebProgress.prototype.removeWindowListener",GTB_WebProgress.prototype.removeWindowListener);
GTB_WebProgress.prototype.notifyListeners_=function(b,c,d){var e=c?c.QueryInterface(Ci.nsIChannel):null;if(e){try{if(!e.URI.scheme.startsWith("http")||!e.URI.host)return}catch(f){return}if(b=GTB_getBrowserAndWindowFromDocShell(b.QueryInterface(Ci.nsIDocShell))){var g=0;for(g=0;g<this.browserListeners.length;g++)this.browserListeners[g].browser==b.browser&&this.browserListeners[g].callback(b.browser,d,e.URI,c);for(g=0;g<this.windowListeners.length;g++)this.windowListeners[g].window==b.window&&this.windowListeners[g].callback(b.browser,
d,e.URI,c)}}};GTB_WebProgress.prototype.onLocationChange=function(b,c){this.notifyListeners_(b,c,Ci.nsIWebProgressListener.NOTIFY_LOCATION)};GTB_WebProgress.prototype.onStateChange=function(b,c,d){d&Ci.nsIWebProgressListener.STATE_TRANSFERRING&&this.notifyListeners_(b,c,Ci.nsIWebProgressListener.NOTIFY_STATE_DOCUMENT|d)};function GTB_getBrowserAndWindowFromDocShell(b){b=b.QueryInterface(Ci.nsIDocShellTreeItem);return GTB_getBrowserAndWindowFromDocShellTreeItem(b)}
function GTB_getBrowserAndWindowFromDocShellTreeItem(b){if(!b||!b.parent)return null;var c=b.parent.QueryInterface(Ci.nsIDocShell);c=c.contentViewer.DOMDocument;if(!c.defaultView.GTB_getToolbar)return null;var d=c.getElementById("content");if(!d||!d.browsers)return null;var e=null;if(d.browsers.length>b.childOffset)e=d.browsers[b.childOffset];else for(var f=d.browsers.length-1;f>=0;f--)if(d.browsers[f].docShell==b){e=d.browsers[f];break}if(e==null)return null;return{window:c.defaultView,browser:e}}
;var GTB_MORE_URLS={searchbox:"http://www.google.com/tools/service/npredir?r=ff_tb_searchbox&hl={LANG}&v={VERSION}",ld:"http://www.google.com/tools/service/npredir?r=ff_tb_linkdoctor&hl={LANG}&v={VERSION}",mail:"http://www.google.com/tools/service/npredir?r=ff_tb_mail&hl={LANG}&v={VERSION}",pagerank:"http://www.google.com/tools/service/npredir?r=ff_tb_pagerank&hl={LANG}&v={VERSION}",bookmarks:"http://www.google.com/tools/service/npredir?r=ff_tb_bookmarks&hl={LANG}&v={VERSION}",sendto:"http://www.google.com/tools/service/npredir?r=ff_tb_sendto&hl={LANG}&v={VERSION}",
docsspreadsheets:"http://www.google.com/tools/service/npredir?r=ff_tb_docs&hl={LANG}&v={VERSION}",spellcheck:"http://www.google.com/tools/service/npredir?r=ff_tb_spellcheck&hl={LANG}&v={VERSION}",translate:"http://www.google.com/tools/service/npredir?r=ff_tb_translate&hl={LANG}&v={VERSION}",translatebar:"http://www.google.com/tools/service/npredir?r=ff_tb_translatebar&hl={LANG}&v={VERSION}",translate_faq:"http://www.google.com/tools/service/npredir?r=ff_tb_translatebar_faq&hl={LANG}&v={VERSION}",
autofill:"http://www.google.com/tools/service/npredir?r=ff_tb_autofill&hl={LANG}&v={VERSION}",tbsync:"http://www.google.com/tools/service/npredir?r=ff_tb_tbsync&hl={LANG}&v={VERSION}",newtab:"http://www.google.com/tools/service/npredir?r=ff_tb_newtab&hl={LANG}&v={VERSION}",dnsprefetch:"http://www.google.com/tools/service/npredir?r=ff_tb_dnsprefetch&hl={LANG}&v={VERSION}",sidewiki:"http://www.google.com/tools/service/npredir?r=ff_tb_sidewiki&hl={LANG}&v={VERSION}",usage:"http://www.google.com/tools/service/npredir?r=tb_hc_usage&hl={LANG}&v={VERSION}",
layout:"http://www.google.com/tools/service/npredir?r=tb_hc_layout&hl={LANG}&v={VERSION}",share:"http://www.google.com/tools/service/npredir?r=tb_hc_share&hl={LANG}&v={VERSION}"},GTB_PRIVACY_URLS={spellcheck:"http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}",translate:"http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}",pagerank:"http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}",tbsync:"http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}",
sidewiki:"http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}",usage:"http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}",history:"http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}"},GTB_Links={};GTB_Links.showMore=function(b,c){GTB_Links.show(b,GTB_MORE_URLS[c],true,false)};GTB_Links.moreLink=function(b){b=GTB_MORE_URLS[b];return b.replace("{LANG}",GTB_getLangCode()).replace("{VERSION}",GTB_version)};
goog.exportSymbol("GTB_Links.moreLink",GTB_Links.moreLink);GTB_Links.showPrivacy=function(b,c){GTB_Links.show(b,GTB_PRIVACY_URLS[c],true,false)};
GTB_Links.show=function(b,c,d,e){c=c.replace("{LANG}",GTB_getLangCode()).replace("{VERSION}",GTB_version);if(b){d=d?"dependent=no,width=800,height=600,scrollbars=yes,resizable=yes,personalbar=no,location=no":"dependent=no,width=600,height=420,scrollbars=yes,resizable=yes,personalbar=no,location=no";if(e)d+=",modal=yes";e?b.openDialog(c,"gtbMoreDialog",d):b.open(c,"gtbMore",d)}else GTB_Links.openHelpWindow(c,"gtbOptionsHelp")};
GTB_Links.openHelpWindow=function(b,c){var d=Cc["@mozilla.org/supports-array;1"].createInstance(Ci.nsISupportsArray),e=Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);e.data=b;d.AppendElement(e);e=Cc["@mozilla.org/embedcomp/window-watcher;1"].getService(Ci.nsIWindowWatcher);e.openWindow(null,"chrome://google-toolbar/content/help.xul",c,"chrome,all,dialog=no,centerscreen,alwaysRaised",d)};if(!String.prototype.startsWith)String.prototype.startsWith=function(b){return this.indexOf(b)==0};if(!String.prototype.endsWith)String.prototype.endsWith=function(b){var c=this.length-b.length;return c>=0&&this.lastIndexOf(b,c)==c};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};if(!String.prototype.subs)String.prototype.subs=function(){for(var b=this,c=0;c<arguments.length;c++)b=b.replace(/\%s/,String(arguments[c]));return b};function uri_parse(b){b=b.match(URI_RE_);if(!b)return null;return new URI(uri_nullIfAbsent_(b[1]),uri_nullIfAbsent_(b[2]),uri_nullIfAbsent_(b[3]),uri_nullIfAbsent_(b[4]),uri_nullIfAbsent_(b[5]),uri_nullIfAbsent_(b[6]),uri_nullIfAbsent_(b[7]))}
function uri_create(b,c,d,e,f,g,h){b=new URI(uri_encodeIfExists2_(b,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),uri_encodeIfExists2_(c,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),uri_encodeIfExists_(d),e>0?e.toString():null,uri_encodeIfExists2_(f,URI_DISALLOWED_IN_PATH_),null,uri_encodeIfExists_(h));g&&b.SetAllCgiParameters(g);return b}function uri_encodeIfExists_(b){if("string"==typeof b)return encodeURIComponent(b);return null}
function uri_encodeIfExists2_(b,c){if("string"==typeof b)return encodeURI(b).replace(c,uri_encodeOne_);return null}function uri_encodeOne_(b){b=b.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(b>>4&15)+"0123456789ABCDEF".charAt(b&15)}function URI(b,c,d,e,f,g,h){this.scheme_=b;this.credentials_=c;this.domain_=d;this.port_=e;this.path_=f;this.query_=g;this.fragment_=h;this.paramCache_=null}a=URI.prototype;
a.toString=function(){var b=[];null!==this.scheme_&&b.push(this.scheme_,":");if(null!==this.domain_){b.push("//");null!==this.credentials_&&b.push(this.credentials_,"@");b.push(this.domain_);null!==this.port_&&b.push(":",this.port_.toString())}null!==this.path_&&b.push(this.path_);null!==this.query_&&b.push("?",this.query_);null!==this.fragment_&&b.push("#",this.fragment_);return b.join("")};
a.Clone=function(){return new URI(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)};a.GetScheme=function(){return this.scheme_&&uri_decodeThatWorks_(this.scheme_)};a.GetRawScheme=function(){return this.scheme_};a.SetScheme=function(b){this.scheme_=uri_encodeIfExists2_(b,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this};a.SetRawScheme=function(b){this.scheme_=b?b:null;return this};a.HasScheme=function(){return null!==this.scheme_};
a.GetCredentials=function(){return this.credentials_&&uri_decodeThatWorks_(this.credentials_)};a.GetRawCredentials=function(){return this.credentials_};a.SetCredentials=function(b){this.credentials_=uri_encodeIfExists2_(b,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this};a.SetRawCredentials=function(b){this.credentials_=b?b:null;return this};a.HasCredentials=function(){return null!==this.credentials_};a.GetDomain=function(){return this.domain_&&uri_decodeThatWorks_(this.domain_)};
a.GetRawDomain=function(){return this.domain_};a.SetDomain=function(b){this.domain_=b?encodeURIComponent(b):null;return this};a.SetRawDomain=function(b){this.domain_=b?b:null;return this};a.HasDomain=function(){return null!==this.domain_};a.GetPort=function(){return this.port_&&uri_decodeThatWorks_(this.port_)};a.SetPort=function(b){if(b){if("number"!==typeof b){b=parseInt(b,10);if(b<0||isNaN(b))throw Error("Bad port number "+b);}this.port_=b.toString()}else this.port_=null;return this};
a.HasPort=function(){return null!==this.port_};a.GetPath=function(){return this.path_&&uri_decodeThatWorks_(this.path_)};a.GetRawPath=function(){return this.path_};a.SetPath=function(b){this.path_=uri_encodeIfExists2_(b,URI_DISALLOWED_IN_PATH_);return this};a.SetRawPath=function(b){this.path_=b?b:null;return this};a.HasPath=function(){return null!==this.path_};a.GetQuery=function(){return this.query_&&uri_decodeThatWorks_(this.query_)};a.GetRawQuery=function(){return this.query_};
a.SetQuery=function(b){this.paramCache_=null;this.query_=uri_encodeIfExists_(b);return this};a.SetRawQuery=function(b){this.paramCache_=null;this.query_=b?b:null;return this};a.HasQuery=function(){return null!==this.query_};a.SetAllCgiParameters=function(b){this.paramCache_=null;for(var c=[],d="",e=0;e<b.length;){var f=b[e++],g=b[e++];c.push(d,encodeURIComponent(f.toString()));d="&";g&&c.push("=",encodeURIComponent(g.toString()))}this.query_=c.join("");return this};
a.CheckParameterCache_=function(){if(!this.paramCache_)if(this.query_){for(var b=this.query_.split(/[&\?]/),c=[],d=0;d<b.length;++d){var e=b[d].match(/^([^=]*)(?:=(.*))?$/);c.push(uri_decodeThatWorks_(e[1]),uri_decodeThatWorks_(e[2]||""))}this.paramCache_=c}else this.paramCache_=[]};
a.SetCgiParameterValues=function(b,c){if(typeof c==="string")c=[c];this.CheckParameterCache_();for(var d=0,e=this.paramCache_,f=[],g=0;g<e.length;g+=2)if(b===e[g])d<c.length&&f.push(b,c[d++]);else f.push(e[g],e[g+1]);for(;d<c.length;)f.push(b,c[d++]);this.SetAllCgiParameters(f);return this};a.GetAllCgiParameters=function(){this.CheckParameterCache_();return this.paramCache_.slice(0,this.paramCache_.length)};
a.GetCgiParameterValues=function(b){this.CheckParameterCache_();for(var c=[],d=0;d<this.paramCache_.length;d+=2)b===this.paramCache_[d]&&c.push(this.paramCache_[d+1]);return c};a.GetCgiParameterMap=function(){this.CheckParameterCache_();for(var b={},c=0;c<this.paramCache_.length;c+=2){var d=this.paramCache_[c++],e=this.paramCache_[c++];if(d in b)b[d].push(e);else b[d]=[e]}return b};
a.GetCgiParameterValue=function(b){this.CheckParameterCache_();for(var c=0;c<this.paramCache_.length;c+=2)if(b===this.paramCache_[c])return this.paramCache_[c+1];return null};a.GetFragment=function(){return this.fragment_&&uri_decodeThatWorks_(this.fragment_)};a.GetRawFragment=function(){return this.fragment_};a.SetFragment=function(b){this.fragment_=b?encodeURIComponent(b):null;return this};a.SetRawFragment=function(b){this.fragment_=b?b:null;return this};a.HasFragment=function(){return null!==this.fragment_};
function uri_decodeThatWorks_(b){return decodeURIComponent(b).replace(/\+/g," ")}function uri_nullIfAbsent_(b){return"string"==typeof b&&b.length>0?b:null}var URI_RE_=/^(?:([^:\/?#]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_=/[#\/\?@]/g,URI_DISALLOWED_IN_PATH_=/[\#\?]/g;function GTB_AF_Autofill(){this.wrappedJSObject=this;this.client_=new GTB_AF_Client("http://toolbarqueries.clients.google.com/tbproxy/af/")}goog.exportSymbol("GTB_AF_Autofill",GTB_AF_Autofill);a=GTB_AF_Autofill.prototype;a.getDocStructure=function(b){return b.GTB_AF_formStructure};a.setDocStructure=function(b,c){b.GTB_AF_formStructure=c};a.cleanDoc=function(b){if(b&&b.GTB_AF_formStructure)b.GTB_AF_formStructure=null};a.getFormStructure=function(b){return b.GTB_AF_form};
a.setFormStructure=function(b,c){b.GTB_AF_form=c};a.getDataContainer=function(b){return this.getContainer(b.ownerDocument)};a.getContainer=function(b){if(!b.defaultView)return null;var c=b.defaultView.top;b=c.document;var d=null;c=null;var e=GTB_LayoutUtil.getBrowserWindows(),f=0;a:for(;d=e[f];++f)for(var g=d.gBrowser.browsers,h=0;h<g.length;++h)if(g[h].contentDocument==b){c=h;break a}if(!d||goog.isNull(c))return null;b=d.GTB_GoogleToolbarOverlay.perTabData;return b.getContainers("auto_fill")[c]};
a.getFieldsInfo=function(b){return(b=this.getContainer(b))&&b.fieldsInfo};a.getFieldInfo=function(b){var c=b.getAttribute("gtbFieldId");if(!c)return null;b=(b=this.getDataContainer(b))&&b.fieldsInfo;if(!b)return null;return b[c]};a.setFieldInfo=function(b,c){var d=this.getDataContainer(b);if(d){var e=d.fieldsInfo;if(!e)e=d.fieldsInfo={};var f=b.getAttribute("gtbFieldId");if(!f){f=(f=d.fieldsCount)?++d.fieldsCount:(d.fieldsCount=1);b.setAttribute("gtbFieldId",f=""+f)}e[f]=c}};
a.getFieldType=function(b){return(b=this.getFieldInfo(b))&&b.fillType};a.setFieldType=function(b,c){var d=this.getFieldInfo(b);if(!d)return false;d.fillType=c;return true};a.isInformational=function(b){return GTB_AF_FieldType.isInformational(b)};a.buildStructure=function(b){if(this.getDocStructure(b))return this.getDocStructure(b);var c=b.forms,d=[];if(c)for(var e=c.length,f=0;f<e;++f){var g=this.buildForm(c[f]);g&&d.push(g)}this.setDocStructure(b,d);return d};
a.queryTypes=function(b,c){this.client_.start(b,c)};a.formSubmit=function(b,c,d){(b=this.getFormStructure(b))&&this.client_.formSubmit(b,c,d)};var GTB_AF_sharedHash=new GTB_AF_Hash;
GTB_AF_Autofill.prototype.buildForm=function(b){if(typeof b.action!="string")return null;var c=b.getAttribute("autocomplete");if(c&&c.trim().toLowerCase()=="off")return null;c=[];for(var d=b.elements,e,f=0,g=d.length;f<g;++f){e=d[f];if(this.isFieldAutofillable(e)){var h=new GTB_AF_FormField(e,GTB_AF_sharedHash);this.setFieldInfo(e,h);c.push(h)}}if(c.length<=1)return null;d=uri_parse(b.action);d=GTB_AF_replaceNull(d.GetScheme())+"://"+GTB_AF_replaceNull(d.GetDomain())+GTB_AF_replaceNull(d.GetPort(),
":");c=new GTB_AF_FormStructure(d,b.name,c,GTB_AF_sharedHash);this.setFormStructure(b,c);return c};GTB_AF_Autofill.prototype.isFieldAutofillable=function(b){if("text"!=b.type&&"select-one"!=b.type||!b.name)return false;b=b.getAttribute("autocomplete");return!b||b.trim().toLowerCase()!="off"};function GTB_AF_replaceNull(b,c){var d=c||"";return b?d+b:""};function GTB_AF_Button(b,c,d,e){this.debugZone="GTB_AF_Button";this.mainWindow_=d;this.tabbrowser_=e;this.fillController_=b;this.prefs_=c;this.delayedPreviewTimer_=null;this.lastFillEffect_=0;this.lastPreviewEffect_={fillable:0,filled:0};this.observer_=new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.onMouseOut,this,null))}
GTB_AF_Button.prototype.onCommand=function(b){if(!(b.target.id!="gtbAutoFill"||b.button)){var c=this.prefs_.getDefaultProfile(),d=this.prefs_.getDefaultCreditCard();if(c==null&&d==null)this.showPrefs_();else{this.showWarningTooltip_(b.target);if(typeof c=="number"||typeof d=="number"){b=this.tabbrowser_.selectedBrowser.contentDocument;c=BindToObject(this.fillWholePage_,this,c,d,GTB_AF_Util.getDocHost(b));this.lastFillEffect_=0;gtbRecurseFrames(b,c)}new G_Alarm(BindToObject(this.onMouseOut,this,null),
10)}}};goog.exportProperty(GTB_AF_Button.prototype,"onCommand",GTB_AF_Button.prototype.onCommand);
GTB_AF_Button.prototype.onMouseOver=function(b){var c=b.target.id;if(!(c=="gtbAutoFillProfilesPlaceholder"||c=="gtbAutoFillPreferences"||c=="gtbAutoFillPopup"||c=="gtbChevronMenugtbAutoFill")){var d=b.target.ownerDocument.getElementById("gtbAutoFillPopup");if(!(c=="gtbAutoFill"&&d.getAttribute("gtbPopupOpen"))){if(this.delayedPreviewTimer_){this.mainWindow_.clearTimeout(this.delayedPreviewTimer_);this.delayedPreviewTimer_=null}if(c=this.tabbrowser_.selectedBrowser.contentDocument){var e=null;d=this.prefs_.getDefaultCreditCard();
if(b.target.id=="gtbAutoFill"||b.target.id=="gtbChevronMenugtbAutoFill")e=this.prefs_.getDefaultProfile();if(this.isDynamicItem_(b.target)){e=b.target.id.indexOf("gtbAutoFillProfile-");e=Number(b.target.id.substring(e+19))}b=BindToObject(this.delayedPreview_,this,c,e,d);this.delayedPreviewTimer_=this.mainWindow_.setTimeout(b,200)}}}};goog.exportProperty(GTB_AF_Button.prototype,"onMouseOver",GTB_AF_Button.prototype.onMouseOver);
GTB_AF_Button.prototype.onMouseOut=function(){if(this.delayedPreviewTimer_){this.mainWindow_.clearTimeout(this.delayedPreviewTimer_);this.delayedPreviewTimer_=null}else{var b=this.tabbrowser_.selectedBrowser;if(b=b&&b.contentDocument){var c=BindToObject(this.fillPagePreview_,this,null,null,GTB_AF_Util.getDocHost(b),null);gtbRecurseFrames(b,c)}}};goog.exportProperty(GTB_AF_Button.prototype,"onMouseOut",GTB_AF_Button.prototype.onMouseOut);
GTB_AF_Button.prototype.onPopupShowing=function(b){this.onMouseOut(null);for(var c=b.target,d=c.getElementsByTagName("menuitem"),e=0;e<d.length;)if(this.isDynamicItem_(d[e]))c.removeChild(d[e]);else++e;d=c.getElementsByTagName("menuseparator");d.length&&c.removeChild(d[0]);d=this.prefs_.getProfileLabels();e=c.ownerDocument;var f=e.defaultView,g=f.getComputedStyle(c,null);f=g.listStyleImage;g=g.MozImageRegion;var h=e.getElementById("gtbAutoFillPreferences");if(d.length){var i=e.createElement("menuseparator");
i.id="gtbAutoFillProfilesPlaceholder";c.insertBefore(i,h);h=Math.min(20,d.length);for(var j=0;j<h;++j){var k=e.createElement("menuitem"),l=d[j];k.setAttribute("label",l);k.id="gtbAutoFillProfile-"+j;k.setAttribute("class","menuitem-iconic");k.style.listStyleImage=f;k.style.MozImageRegion=g;c.insertBefore(k,i)}}b.target.setAttribute("gtbPopupOpen","open")};goog.exportProperty(GTB_AF_Button.prototype,"onPopupShowing",GTB_AF_Button.prototype.onPopupShowing);
GTB_AF_Button.prototype.onPopupHidden=function(b){this.onMouseOut(null);b.target.setAttribute("gtbPopupOpen","")};goog.exportProperty(GTB_AF_Button.prototype,"onPopupHidden",GTB_AF_Button.prototype.onPopupHidden);GTB_AF_Button.prototype.isDynamicItem_=function(b){return!!b.id&&b.id.indexOf("gtbAutoFillProfile-")>=0};
GTB_AF_Button.prototype.onPopupCommand=function(b){var c=b.target;if(this.isDynamicItem_(c)){this.showWarningTooltip_(c);var d=c.id.indexOf("gtbAutoFillProfile-");d=Number(c.id.substring(d+19));var e=this.prefs_.getDefaultCreditCard();if(!isNaN(d)||!isNaN(e)){c=this.tabbrowser_.selectedBrowser.contentDocument;d=BindToObject(this.fillWholePage_,this,d,e,GTB_AF_Util.getDocHost(c));this.lastFillEffect_=0;gtbRecurseFrames(c,d)}new G_Alarm(BindToObject(this.onMouseOut,this,null),10);b.stopPropagation()}};
goog.exportProperty(GTB_AF_Button.prototype,"onPopupCommand",GTB_AF_Button.prototype.onPopupCommand);GTB_AF_Button.prototype.onPopupClick=function(){};goog.exportProperty(GTB_AF_Button.prototype,"onPopupClick",GTB_AF_Button.prototype.onPopupClick);GTB_AF_Button.prototype.onPrefs=function(b){this.showPrefs_();b.stopPropagation()};goog.exportProperty(GTB_AF_Button.prototype,"onPrefs",GTB_AF_Button.prototype.onPrefs);a=GTB_AF_Button.prototype;
a.showPrefs_=function(){this.fillController_.showPrefs_(this.mainWindow_,null)};a.showWarningTooltip_=function(b){if(!this.lastPreviewEffect_.fillable||this.lastPreviewEffect_.filled<this.lastPreviewEffect_.fillable){var c=!this.lastPreviewEffect_.fillable?"gtbAutoFillNoFieldsTooltip":"gtbAutoFillNoDataTooltip";c=b.ownerDocument.getElementById(c);c.showPopup(b,-1,-1,"tooltip","bottomleft","topleft");new G_Alarm(BindToObject(c.hidePopup,c),4E3)}};
a.delayedPreview_=function(b,c,d){this.delayedPreviewTimer_=null;var e={fillable:0,filled:0};c=BindToObject(this.fillPagePreview_,this,c,d,GTB_AF_Util.getDocHost(b),e);gtbRecurseFrames(b,c);this.lastPreviewEffect_=e};a.fillWholePage_=function(b,c,d,e,f){if(!(typeof b!="number"&&typeof c!="number"))if(!(f&&this.fillController_.isSuspiciousFrame(d,f))){d=e.forms;for(e=0;e<d.length;++e)this.lastFillEffect_+=this.fillController_.fillFormFields_(d[e],b,c)}};
a.fillPagePreview_=function(b,c,d,e,f,g){if(!(g&&this.fillController_.isSuspiciousFrame(d,g))){b=this.fillController_.fillPreview_(b,c,f.forms,this.tabbrowser_,g);if(e){e.fillable+=b.fillable;e.filled+=b.filled}}};function GTB_AF_Client(b){this.debugZone="GTB_AF_Client";this.queryURL_=b+"query";this.uploadURL_=b+"upload";this.factory_=G_FirefoxXMLUtils;this.uploadRequested_=GTB_AF_Upload.USE_UPLOAD_RATES;this.prefs_=new G_Preferences("google.toolbar.autofill.");this.positiveUploadRate_=this.negativeUploadRate_=NaN}a=GTB_AF_Client.prototype;
a.start=function(b,c){if(b.length==0||!this.hasProfiles_()||!GTB_IsOnline())c();else{var d=this.factory_.newXML();GTB_AF_FormStructure.encodeListQuery(d,b);var e=GTB_BackoffedFetcher.createFetcherForAutofill(),f=BindToObject(this.handleQueryResponse,this,b,c),g=this.prefs_.getPref("queryURL",this.queryURL_);e.post(g,d,f)}};a.hasProfiles_=function(){return this.prefs_.getChildNames("profile.").length>0||this.prefs_.getChildNames("card.").length>0};
a.handleQueryResponse=function(b,c,d){if(!(!d||d.status!=200||!d.responseXML)){d=d.responseXML.documentElement;GTB_AF_FormStructure.decodeListQueryResponse(d,b);this.uploadRequested_=GTB_AF_FormStructure.getUploadRequested(d)}c()};
a.formSubmit=function(b,c,d){if(isNaN(this.negativeUploadRate_)){this.negativeUploadRate_=Number(this.prefs_.getPref("negativeRate","0.0"));this.positiveUploadRate_=Number(this.prefs_.getPref("positiveRate","1.0"))}if(this.uploadRequested_!=GTB_AF_Upload.UPLOAD_NOT_REQUIRED){if(this.uploadRequested_==GTB_AF_Upload.USE_UPLOAD_RATES)if(Math.random()>=(c?this.positiveUploadRate_:this.negativeUploadRate_))return;if(GTB_IsOnline()){c=this.factory_.newXML();var e=GTB_BackoffedFetcher.createFetcherForAutofill();
b.encodeUpload(c,d);b=BindToObject(this.handleUploadResponse,this);d=new G_Preferences("google.toolbar.autofill.");d=d.getPref("uploadURL",this.uploadURL_);e.post(d,c,b)}}};
a.handleUploadResponse=function(b){if(!(!b||b.status!=200||!b.responseXML)){b=b.responseXML.documentElement;var c={negativeUploadRate:this.negativeUploadRate_,positiveUploadRate:this.positiveUploadRate_};GTB_AF_FormStructure.decodeUploadResponse(b,c);this.negativeUploadRate_=c.negativeUploadRate;this.positiveUploadRate_=c.positiveUploadRate;this.prefs_.setPref("negativeRate",this.negativeUploadRate_.toString());this.prefs_.setPref("positiveRate",this.positiveUploadRate_.toString())}};function GTB_AF_ControllerAttachment(b,c,d,e,f,g){this.controller_=b;this.docShell=c;this.popup=d;this.tabbrowser=e;this.window=f;this.browser=g;this.buttonVisibilityTracker_=null;this.eventListeners_={focus:BindToObject(b.onFocus_,b,this),blur:BindToObject(b.onBlur_,b,this),mouseDown:BindToObject(b.onMouseDown_,b,this),click:BindToObject(b.onClick_,b,this),input:BindToObject(b.onInput_,b,this),submit:BindToObject(b.onSubmit_,b,this),unload:BindToObject(b.onUnload_,b,this),compositionstart:BindToObject(b.onCompositionStart_,
b,this),compositionend:BindToObject(b.onCompositionEnd_,b,this),contextmenu:BindToObject(b.onContextMenu_,b,this)}}GTB_AF_ControllerAttachment.prototype.addWindowListeners=function(){for(var b in this.eventListeners_){var c=this.eventListeners_[b];this.window.addEventListener(b,c,true)}};GTB_AF_ControllerAttachment.prototype.removeWindowListeners=function(){for(var b in this.eventListeners_){var c=this.eventListeners_[b];this.window.removeEventListener(b,c,true)}};
function GTB_AF_FormController(b){this.debugZone="GTB_AF_FormFillController";this.wrappedJSObject=this;this.typeService_=b;this.prefs_=new GTB_AF_PrefConverter;b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);this.stringBundle_=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.passKeyToController_=GTB_GeckoVersion.isFirefox3();this.isMac_=2==GetPlatform();this.attachments_=[];this.buttonVisibilityTrackers_=[];this.controller_=Cc["@mozilla.org/autocomplete/controller;1"].createInstance(Ci.nsIAutoCompleteController);
this.autoProfile_=this.promoteInBrowser_=this.focusedInput_=this.activeAttachment_=this.focusedPopup_=null;this.heuristics_=new GTB_AF_Heuristics(this.typeService_);this.preview_=GTB_GeckoVersion.isFirefox3()?new GTB_AF_PreviewIFrame(this.typeService_):new GTB_AF_PreviewOverlay(this.typeService_);this.forceComplete=this.completeSelectedIndex=this.completeDefaultIndex=this.disableAutoComplete=false;this.minResultsForPopup=1;this.maxRows=0;this.timeout=50;this.searchNames_=null;this.suppressOnInput_=
this.cardType_=this.showCommentColumn_=this.ignoreClick_=false;this.recursionDepth_=0;this.boundPageLoad_=null;this.boundKeyPress_=BindToObject(this.onKeyPress_,this);this.boundPopupSelect_=BindToObject(this.onPopupSelect_,this);this.boundPopupHiding_=BindToObject(this.onPopupHiding_,this)}goog.exportSymbol("GTB_AF_FormController",GTB_AF_FormController);
GTB_AF_FormController.prototype.QueryInterface=function(b){for(var c=[Ci.nsIFormFillController,Ci.nsIAutoCompleteInput,Ci.nsIAutoCompleteInput_MOZILLA_1_8_BRANCH,Ci.nsISupports],d=0;d<c.length;++d)if(b.equals(c[d]))return this;throw Components.results.NS_NOINTERFACE;};goog.exportProperty(GTB_AF_FormController.prototype,"QueryInterface",GTB_AF_FormController.prototype.QueryInterface);GTB_AF_FormController.tooltiptext_=null;
GTB_AF_FormController.prototype.getToolTipText_=function(){if(GTB_AF_FormController.tooltiptext_==null)GTB_AF_FormController.tooltiptext_=this.stringBundle_.GetStringFromName("google-autofill.input.tooltiptext");return GTB_AF_FormController.tooltiptext_};
GTB_AF_FormController.prototype.getTooltipBody=function(b){var c=GTB_getTabbrowserForDoc(b.ownerDocument);if(!c)return null;c=c.ownerDocument;if(!this.isEnabledInDoc_(c))return null;var d=Ci.nsIDOMNode;if(b.nodeType==d.ELEMENT_NODE){var e=b.parentNode;if(b.tagName=="div"&&e)if(e.nodeType==d.ELEMENT_NODE&&e.tagName=="INPUT")if(b=(b=this.typeService_.getFieldType(e))&&this.prefs_.isDefined(b)){b=c.createElement("description");b.appendChild(c.createTextNode(this.getToolTipText_()));return[b]}}return null};
goog.exportProperty(GTB_AF_FormController.prototype,"getTooltipBody",GTB_AF_FormController.prototype.getTooltipBody);GTB_AF_FormController.prototype.createButtonHandler=function(b,c){return new GTB_AF_Button(this,this.prefs_,b,c)};goog.exportProperty(GTB_AF_FormController.prototype,"createButtonHandler",GTB_AF_FormController.prototype.createButtonHandler);
GTB_AF_FormController.prototype.attachToBrowser=function(b,c){var d=GTB_AF_Util.browserForDocShell(b),e=d.ownerDocument.getElementById("content"),f=GTB_AF_Util.windowForDocShell(b),g=!this.isAttachedToTabBrowser_(e),h=!this.isAttachedToWindow_(f);d=new GTB_AF_ControllerAttachment(this,b,c,e,f,d);this.attachments_.push(d);h&&d.addWindowListeners();if(g){this.boundPageLoad_=GTB_AddEventListener(e.mTabBox,"load",this.onPageLoad,this);this.startTrackingButtonVisibility_(e.ownerDocument)}};
goog.exportProperty(GTB_AF_FormController.prototype,"attachToBrowser",GTB_AF_FormController.prototype.attachToBrowser);GTB_AF_FormController.prototype.startTrackingButtonVisibility_=function(b){b=new GTB_ToolbarItemVisiblityTracker(b,"gtbAutoFill",BindToObject(this.onButtonVisibilityChanged_,this,b));this.buttonVisibilityTrackers_.push(b)};
GTB_AF_FormController.prototype.detachFromBrowser=function(b){b=GTB_AF_Util.browserForDocShell(b);b=this.indexOfBrowser_(b);if(!(b<0)){var c=this.attachments_[b].tabbrowser,d=this.attachments_[b];this.attachments_.splice(b,1);d.removeWindowListeners();if(!this.isAttachedToTabBrowser_(c)){c.mTabBox&&c.mTabBox.removeEventListener("load",this.boundPageLoad_,true);this.boundPageLoad_=null;this.stopTrackingButtonVisibility_(c.ownerDocument)}}};
goog.exportProperty(GTB_AF_FormController.prototype,"detachFromBrowser",GTB_AF_FormController.prototype.detachFromBrowser);GTB_AF_FormController.prototype.stopTrackingButtonVisibility_=function(b){for(var c=this.buttonVisibilityTrackers_.length-1;c>=0;c--)if(this.buttonVisibilityTrackers_[c].doc_==b){this.buttonVisibilityTrackers_[c].shutdown();this.buttonVisibilityTrackers_.splice(c,1)}};
GTB_AF_FormController.prototype.onButtonVisibilityChanged_=function(b){if(this.isButtonVisible_(b))for(var c=0;c<this.attachments_.length;++c)if(this.attachments_[c].tabbrowser.ownerDocument==b){var d=this.attachments_[c].window.document,e=BindToObject(this.onDocLoad_,this,GTB_AF_Util.getDocHost(d));gtbRecurseFrames(d,e)}};GTB_AF_FormController.prototype.isButtonVisible_=function(b){for(var c=0;c!=this.buttonVisibilityTrackers_.length;++c)if(this.buttonVisibilityTrackers_[c].doc_==b)return this.buttonVisibilityTrackers_[c].isButtonVisible()};
GTB_AF_FormController.prototype.markAsLoginManagerField=function(){};goog.exportProperty(GTB_AF_FormController.prototype,"markAsLoginManagerField",GTB_AF_FormController.prototype.markAsLoginManagerField);GTB_AF_FormController.prototype.isAttachedToTabBrowser_=function(b){for(var c=0;c<this.attachments_.length;++c)if(b==this.attachments_[c].tabbrowser)return true;return false};
GTB_AF_FormController.prototype.isAttachedToWindow_=function(b){for(var c=0;c<this.attachments_.length;++c)if(b==this.attachments_[c].window)return true;return false};GTB_AF_FormController.prototype.__defineGetter__("popup",function(){return this.focusedPopup_});GTB_AF_FormController.prototype.__defineGetter__("controller",function(){return this.controller_});
GTB_AF_FormController.prototype.__defineSetter__("popupOpen",function(b){if(b){if(!this.popup.popupOpen){if(this.popup.openAutocompletePopup)this.popup.openAutocompletePopup(this,this.focusedInput_);else{b=GTB_getBoxObjectFor(this.focusedInput_);var c=this.showCommentColumn?Math.max(b.width,250):b.width;this.popup.openPopup(this,b.screenX,b.screenY+b.height,c)}this.popup.addEventListener("select",this.boundPopupSelect_,true);this.popup.addEventListener("popuphiding",this.boundPopupHiding_,true);GTB_AF_FormController.setupZoomListeners_(this.popup.ownerDocument,
BindToObject(this.closeOpenPopup_,this))}}else this.popup.closePopup()});GTB_AF_FormController.getWindowZoomManager=function(b){return(b=b.ZoomManager)&&b.prototype||b};
GTB_AF_FormController.setupZoomListeners_=function(b,c){var d=GTB_AF_FormController.getWindowZoomManager(b.defaultView);if(!(!d||d.GTB_enlarge_)){d.GTB_enlarge_=d.enlarge;d.GTB_reduce_=d.reduce;d.GTB_reset_=d.reset;d.enlarge=BindToObject(GTB_AF_FormController.changeZoom,null,d,d.enlarge,c);d.reduce=BindToObject(GTB_AF_FormController.changeZoom,null,d,d.reduce,c);d.reset=BindToObject(GTB_AF_FormController.changeZoom,null,d,d.reset,c)}};
GTB_AF_FormController.cleanZoomListeners_=function(b){if((b=GTB_AF_FormController.getWindowZoomManager(b.defaultView))&&b.GTB_enlarge_){b.enlarge=b.GTB_enlarge_;delete b.GTB_enlarge_;b.reduce=b.GTB_reduce_;delete b.GTB_reduce_;b.reset=b.GTB_reset_;delete b.GTB_reset_}};GTB_AF_FormController.changeZoom=function(b,c,d){c.call(b);d()};GTB_AF_FormController.prototype.closeOpenPopup_=function(){if(this.popupOpen)this.popupOpen=false};GTB_AF_FormController.prototype.__defineGetter__("popupOpen",function(){return this.popup.popupOpen});
GTB_AF_FormController.prototype.__defineGetter__("showCommentColumn",function(){return this.showCommentColumn_});GTB_AF_FormController.prototype.__defineSetter__("showCommentColumn",function(){});GTB_AF_FormController.prototype.__defineGetter__("showImageColumn",function(){return false});GTB_AF_FormController.prototype.__defineSetter__("showImageColumn",function(){});
GTB_AF_FormController.prototype.__defineGetter__("searchParam",function(){if(!this.focusedInput_)throw Cr.NS_ERROR_FAILURE;return this.focusedInput_.name||this.focusedInput_.id});GTB_AF_FormController.prototype.__defineSetter__("searchParam",function(){throw Cr.NS_ERROR_NOT_IMPLEMENTED;});GTB_AF_FormController.prototype.__defineGetter__("searchCount",function(){this.initSearchNames_();return this.searchNames_.length});
GTB_AF_FormController.prototype.getSearchAt=function(b){this.initSearchNames_();return this.searchNames_[b]};goog.exportProperty(GTB_AF_FormController.prototype,"getSearchAt",GTB_AF_FormController.prototype.getSearchAt);GTB_AF_FormController.prototype.__defineGetter__("textValue",function(){return this.focusedInput_.value});
GTB_AF_FormController.prototype.__defineSetter__("textValue",function(b){if(this.focusedInput_){var c=this.tabPressed_;this.tabPressed_=false;this.suppressOnInput_=true;var d=this.popup.selectedIndex;d=this.getProfileIndexAt_(d);if(d>=0){this.focusedInput_.value="";this.cardType_?this.fillCurrentForm_(this.prefs_.getDefaultProfile(),d,c):this.fillCurrentForm_(d,this.prefs_.getDefaultCreditCard(),c)}else this.focusedInput_.value=b;this.suppressOnInput_=false}});
GTB_AF_FormController.prototype.__defineGetter__("selectionStart",function(){return this.focusedInput_&&this.focusedInput_.selectionStart});GTB_AF_FormController.prototype.__defineGetter__("selectionEnd",function(){return this.focusedInput_&&this.focusedInput_.selectionEnd});GTB_AF_FormController.prototype.selectTextRange=function(b,c){this.focusedInput_&&this.focusedInput_.setSelectionRange(b,c)};goog.exportProperty(GTB_AF_FormController.prototype,"selectTextRange",GTB_AF_FormController.prototype.selectTextRange);
GTB_AF_FormController.prototype.onSearchBegin=function(){};goog.exportProperty(GTB_AF_FormController.prototype,"onSearchBegin",GTB_AF_FormController.prototype.onSearchBegin);GTB_AF_FormController.prototype.onSearchComplete=function(){this.controller_.matchCount==0?this.popup.setAttribute("nomatch","true"):this.popup.removeAttribute("nomatch")};goog.exportProperty(GTB_AF_FormController.prototype,"onSearchComplete",GTB_AF_FormController.prototype.onSearchComplete);
GTB_AF_FormController.prototype.onTextEntered=function(){return this.fireEvent_("DOMAutoComplete")};goog.exportProperty(GTB_AF_FormController.prototype,"onTextEntered",GTB_AF_FormController.prototype.onTextEntered);GTB_AF_FormController.prototype.onTextReverted=function(){};goog.exportProperty(GTB_AF_FormController.prototype,"onTextReverted",GTB_AF_FormController.prototype.onTextReverted);GTB_AF_FormController.prototype.__defineGetter__("consumeRollupEvent",function(){return false});a=GTB_AF_FormController.prototype;
a.initSearchNames_=function(){if(!this.searchNames_){var b=this.typeService_.getFieldType(this.focusedInput_),c=b&&this.prefs_.isDefined(b),d=this.activeAttachment_.tabbrowser;if(this.isEnabledInDoc_(d.ownerDocument)&&c){this.searchNames_=["google-autofill-"+b];this.showCommentColumn_=true;this.cardType_=this.prefs_.isCardType(b)}else{this.searchNames_=["form-history"];this.cardType_=this.showCommentColumn_=false}}};a.resetSearchNames_=function(){this.searchNames_=null};
a.fireEvent_=function(b){if(!this.focusedInput_)return false;var c=this.focusedInput_.ownerDocument;c=c.createEvent("Events");c.initEvent(b,true,true);b=this.focusedInput_.QueryInterface(Ci.nsIDOMEventTarget);return b.dispatchEvent(c)};a.indexOfBrowser_=function(b){for(var c=0;c<this.attachments_.length;++c)if(this.attachments_[c].browser==b)return c;return-1};
a.onFocus_=function(b,c){var d=c.originalTarget;if(!(!d||!d.getAttribute||!goog.isFunction(d.getAttribute))){var e=d.type,f=d.readOnly,g=d.getAttribute("autocomplete");if(!("text"!=e||f||g&&"off"==g.toLowerCase()))if(e=d.form)(g=e.getAttribute("autocomplete"))&&"off"==g.toLowerCase()||this.startControllingInput_(b,d)}};a.onBlur_=function(){this.focusedInput_&&this.stopControllingInput_()};
a.onKeyPress_=function(b){if(!(!this.focusedInput_||!this.controller_||!b)){var c=false,d=Ci.nsIDOMKeyEvent,e=Ci.nsIAutoCompleteController,f=b.keyCode;this.tabPressed_=false;try{switch(f){case d.DOM_VK_DELETE:var g=b.shiftKey;if(!this.isMac_||g)c=this.controller_.handleDelete();else this.controller_.handleText(false);break;case d.DOM_VK_BACK_SPACE:g=b.shiftKey;if(this.isMac_&&g)c=this.controller_.handleDelete();else this.controller_.handleText(false);break;case d.DOM_VK_UP:c=this.controller_.handleKeyNavigation(this.passKeyToController_?
f:e.KEY_UP);break;case d.DOM_VK_DOWN:c=this.controller_.handleKeyNavigation(this.passKeyToController_?f:e.KEY_DOWN);break;case d.DOM_VK_LEFT:c=this.controller_.handleKeyNavigation(this.passKeyToController_?f:e.KEY_LEFT);break;case d.DOM_VK_RIGHT:c=this.controller_.handleKeyNavigation(this.passKeyToController_?f:e.KEY_RIGHT);break;case d.DOM_VK_PAGE_UP:c=this.controller_.handleKeyNavigation(this.passKeyToController_?f:e.KEY_PAGE_UP);break;case d.DOM_VK_PAGE_DOWN:c=this.controller_.handleKeyNavigation(this.passKeyToController_?
f:e.KEY_PAGE_DOWN);break;case d.DOM_VK_ESCAPE:c=this.controller_.handleEscape();break;case d.DOM_VK_TAB:this.tabPressed_=true;this.controller_.handleTab();c=false;break;case d.DOM_VK_RETURN:d=false;c=this.controller_.handleEnter(d);break}}catch(h){}if(c){b.stopPropagation();b.preventDefault()}}};a.onCompositionStart_=function(){this.controller_&&this.focusedInput_&&this.controller_.handleStartComposition()};a.onCompositionEnd_=function(){this.controller_&&this.focusedInput_&&this.controller_.handleEndComposition()};
a.onSubmit_=function(b,c){var d=c.originalTarget;if(d&&this.prefs_.needPromotion()){var e=this.collectProfile_(d);if(e){var f=c.originalTarget.ownerDocument;this.promoteInBrowser_=f=GTB_AF_Util.findBrowserForDoc(b.tabbrowser,f);this.autoProfile_=e}}this.stopControllingInput_();if((e=d&&this.typeService_.getFormStructure(d))&&this.isFillableForm_(d)){e=this.prefs_.collectPossibleTypes(e);(f=this.prefs_.collectDataPresence())&&f!="0"&&this.typeService_.formSubmit(d,e,f)}};
a.isFillableForm_=function(b){var c=this.typeService_.getFormStructure(b);if(!c)return false;if(c.fields.length==0)return false;if(b.action.toLowerCase()=="/search")return false;if(c.fields.length==1&&c.fields[0].name.toLowerCase()=="q")return false;if(b.method&&b.method.toLowerCase()=="get")return false;return true};
a.collectProfile_=function(b){b=b.elements;if(!b)return null;for(var c={gtbAutofillAutoProfile:true},d=0;d<b.length;++d){var e=b[d],f=this.typeService_.getFieldType(e);f&&this.typeService_.isInformational(f)&&e.value&&this.prefs_.appendPref(f,e.value,c)}if(this.prefs_.prepareProfile(c))return c;return null};a.onInput_=function(){this.suppressOnInput_||!this.controller_||!this.focusedInput_||this.controller_.handleText(false)};
a.onMouseDown_=function(b,c){this.ignoreClick_=false;var d=c.target;if(d!=this.focusedInput_)this.ignoreClick_=true};
a.onClick_=function(b,c){if(this.ignoreClick_)this.ignoreClick_=false;else if(!(!this.focusedInput_||c.target!=this.focusedInput_))if(c.button==0)if(!this.popupOpen){var d=this.controller_.input;if(d){d=d.textValue;if(d.length>0){if(this.controller_.setSearchString)this.controller_.setSearchString("");else this.controller_.searchString="";this.controller_.handleText(true)}else{d=Ci.nsIAutoCompleteController;this.controller_.handleKeyNavigation(this.passKeyToController_?Ci.nsIDOMKeyEvent.DOM_VK_DOWN:
d.KEY_DOWN)}}}};a.onPageLoad=function(b){var c=b.currentTarget;c=c.ownerDocument;GTB_EventProfiler.timestamp(null);if(this.isEnabledInDoc_(c)){b=b.target;this.preview_.hideAll(c,b);this.onDocLoad_(null,b)}GTB_EventProfiler.timestamp(this.debugZone+":load-delayed")};a.isSuspiciousFrame=function(b,c){return b!=GTB_AF_Util.getDocHost(c.contentDocument)};
a.onDocLoad_=function(b,c,d){if(c&&c.forms)if(!(d&&this.isSuspiciousFrame(b,d))){b=this.typeService_.buildStructure(c);this.heuristics_.parsePage(c);this.typeService_.queryTypes(b,BindToObject(this.updateFromServer_,this,c,b));if(this.promoteInBrowser_){c=this.promoteInBrowser_;var e=this.autoProfile_;this.autoProfile_=this.promoteInBrowser_=null;b=c.ownerDocument.getElementById("content");b=b.getNotificationBox(c);d=this.stringBundle_.GetStringFromName("prop.gtb.autofill2.promo.text");e={label:this.stringBundle_.GetStringFromName("prop.gtb.autofill2.promo.btnEdit.label"),
accessKey:this.stringBundle_.GetStringFromName("prop.gtb.autofill2.promo.btnEdit.accessKey"),browser:c,callback:BindToObject(this.editAutoProfile_,this,e)};c={label:this.stringBundle_.GetStringFromName("prop.gtb.autofill2.promo.btnHelp.label"),accessKey:this.stringBundle_.GetStringFromName("prop.gtb.autofill2.promo.btnHelp.accessKey"),browser:c,callback:BindToObject(this.helpAutoProfile_,this)};c=b.appendNotification(d,"GoogleToolbarAutofillMessage",GTB_LayoutUtil.getGoogleSearchIconUrl(),b.PRIORITY_INFO_HIGH,
[e,c]);b=(b=c.getAttribute("class"))?b+" gtb-af-promo":"gtb-af-promo";c.setAttribute("class",b)}}};a.isEnabledInDoc_=function(b){var c=new G_Preferences("google.toolbar.");return this.isButtonVisible_(b)||c.getPref("work_when_invisible",false)};a.editAutoProfile_=function(b,c){var d=c.ownerDocument.defaultView;this.showPrefs_(d,b)};a.showPrefs_=function(b,c){GTB_OpenOptionsWindow(b,"gtbOptionsAutoFillPane",c)};a.helpAutoProfile_=function(b){b=b.ownerDocument.defaultView;this.showIntro_(b);return true};
a.showIntro_=function(b){GTB_Links.showMore(b,"autofill")};a.updateFromServer_=function(b,c){for(var d=0;d<c.length;++d)if(c[d].hasServerData())return};a.onUnload_=function(b,c){this.typeService_.cleanDoc(c.target);if(this.focusedInput_){var d=c.target,e=this.focusedInput_.ownerDocument;d==e&&this.stopControllingInput_()}};a.onContextMenu_=function(){this.focusedPopup_&&this.focusedPopup_.closePopup()};
a.onPopupSelect_=function(){if(this.focusedPopup_){var b=this.focusedInput_.ownerDocument.defaultView.frameElement,c=this.popup.selectedIndex;c=this.getProfileIndexAt_(c);if(c>=0)this.cardType_?this.fillPreview_(this.prefs_.getDefaultProfile(),c,[this.focusedInput_.form],this.activeAttachment_.tabbrowser,b):this.fillPreview_(c,this.prefs_.getDefaultCreditCard(),[this.focusedInput_.form],this.activeAttachment_.tabbrowser,b);else this.fillPreview_(null,null,[this.focusedInput_.form],this.activeAttachment_.tabbrowser,
b)}};a.onPopupHiding_=function(){this.popup.removeEventListener("select",this.boundPopupSelect_,true);this.popup.removeEventListener("popuphiding",this.boundPopupHiding_,true);this.removePreview_();GTB_AF_FormController.cleanZoomListeners_(this.popup.ownerDocument)};a.startControllingInput_=function(b,c){this.stopControllingInput_();this.tabPressed_=false;this.focusedPopup_=b.popup;this.activeAttachment_=b;this.addKeyListener_(c);this.focusedInput_=c;this.controller_.input=this};
a.stopControllingInput_=function(){if(this.focusedInput_){this.resetSearchNames_();this.removeKeyListener_(this.focusedInput_);if(this.controller_.input&&(this==this.controller_.input||this==this.controller_.input.wrappedJSObject))this.controller_.input=null;this.removePreview_();this.focusedPopup_=this.focusedInput_=this.activeAttachment_=null}};a.addKeyListener_=function(b){b&&b.addEventListener("keypress",this.boundKeyPress_,true)};
a.removeKeyListener_=function(b){b&&b.removeEventListener("keypress",this.boundKeyPress_,true)};a.fillCurrentForm_=function(b,c,d){new G_Alarm(BindToObject(this.fillFormFields_,this,d?this.focusedInput_:this.focusedInput_.form,b,c),0)};
a.fillFormFields_=function(b,c,d){if(!this.prefs_.isEnabled())return 0;this.tabPressed_=false;this.prefs_.setDocument(b.ownerDocument);var e=0;b=b.tagName.toLowerCase()=="form"?b.elements:[b];for(var f=0;f<b.length;++f)if(this.isFillable_(b[f])){var g=this.typeService_.getFieldType(b[f]),h=this.prefs_.isCardType(g)?this.prefs_.getValue(d,g,false):this.prefs_.getValue(c,g,false);h&&this.warnOnFirstUse_();e+=this.setField_(b[f],h,g)}return e};
a.warnOnFirstUse_=function(){var b=new G_Preferences("google.toolbar."),c=b.getPref("autofill.used",false);if(!c){b.setPref("autofill.used",true);c=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");b=c.GetStringFromName("prop.gtb.autofill2.caption");c=c.GetStringFromName("prop.gtb.autofill2.first-use-warning");alert(c,b)}};
a.getParentForm_=function(b){for(b=b.parentNode;b&&!(b.tagName&&b.tagName.toLowerCase()=="form");)b=b.parentNode;return b};a.setAutofillUsedFlag_=function(b){if(b=(b=this.getParentForm_(b))&&this.typeService_.getFormStructure(b))b.autofillUsed=true};
a.setField_=function(b,c,d){var e=this.typeService_.getFieldInfo(b);if(!e)return 0;if(b.type=="text"&&b.value&&(e.value!=b.value||b==this.focusedInput_||!c))return 0;switch(b.type){case "text":if(b.maxLength>0&&c)c=c.substring(0,b.maxLength);b.value=c;e.value=c;this.setAutofillUsedFlag_(b);return 1;case "select-one":c&&this.heuristics_.setSelectField(b,c,d);this.setAutofillUsedFlag_(b);return 1;default:return 0}};
a.getProfileIndexAt_=function(b){if(b<0)return-1;var c=null;try{c=this.controller.getStyleAt(b)}catch(d){}if(c&&c.indexOf("gtb-af-profile-")>=0){b=c.indexOf("gtb-af-profile-")+15;c=parseInt(c.substring(b),10);if(!isNaN(c))return c}return-1};a.isFillable_=function(b){if(b.type!="text"&&b.type!="select-one")return false;if(b.disabled||b.readOnly)return false;var c=b.ownerDocument.defaultView;return b=(b=c&&c.getComputedStyle(b,null))&&parseInt(b.width,10)>0&&b.visibility!="hidden"};
a.removePreview_=function(){if(this.focusedInput_){var b=this.focusedInput_.ownerDocument;this.preview_.hideAll(this.activeAttachment_.tabbrowser.ownerDocument,b)}};
a.fillPreview_=function(b,c,d,e,f){var g=0,h=0;this.prefs_.setDocument(d.ownerDocument);var i=[],j=Date.now(),k=null,l=0;a:for(;l<d.length;++l){var m=d[l];if(!k)k=m.ownerDocument;m=m.elements;for(var n=0;n<m.length;++n){if(Date.now()-j>200)break a;var o=m[n];if(this.isFillable_(o)){var p=this.typeService_.getFieldInfo(o);if(p){var r=p.fillType;r&&++g;var q=this.prefs_.isCardType(r)?c:b;if(typeof q!="number")q=null;(q=this.prefs_.getValue(q,r,true))&&++h;if(o==this.focusedInput_&&o.value)q=null;if(o.value&&
(this.prefs_.isEncrypted(r)||p.value!=o.value||q==o.value))q=null;i.push({input:o,value:q})}}}}this.preview_.show(i,e,f);if(typeof b=="number"||typeof c=="number"){b=e.ownerDocument;GTB_AF_FormController.setupZoomListeners_(b,BindToObject(this.preview_.hideAll,this.preview_,b,k))}return{fillable:g,filled:h}};function GTB_AF_registerSearches(b){var c=Cc["@mozilla.org/autocomplete/search;1?name=form-history"].getService(Ci.nsIAutoCompleteSearch),d=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);d=d.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");d=d.GetStringFromName("prop.gtb.autofill2.formHistoryComment");for(var e in GTB_AF_FieldType){var f=GTB_AF_FieldType[e];if(GTB_AF_FieldType.isInformational(f)){var g=new GTB_AF_FormFillSearch(c,f,d),h=43036;
b.registerObject("{5bf3ab04-6d5e-4385-b770-d5123aad"+(h+f).toString(16)+"}","@mozilla.org/autocomplete/search;1?name=google-autofill-"+f,"Google Toolbar Autofill Search for "+f,g)}}}goog.exportSymbol("GTB_AF_registerSearches",GTB_AF_registerSearches);function GTB_AF_ChainObserver(b,c,d,e,f){this.debugZone="GTB_AF_FormFillSearch";this.original_=b;this.search_=c;this.searchString_=d;this.searchParam_=e;this.prevResult_=f}goog.exportSymbol("GTB_AF_ChainObserver",GTB_AF_ChainObserver);
GTB_AF_ChainObserver.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIAutoCompleteObserver)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};goog.exportProperty(GTB_AF_ChainObserver.prototype,"QueryInterface",GTB_AF_ChainObserver.prototype.QueryInterface);GTB_AF_ChainObserver.prototype.onSearchResult=function(b,c){this.search_.chainSearch(b,c,this.searchString_,this.searchParam_,this.prevResult_,this.original_)};
goog.exportProperty(GTB_AF_ChainObserver.prototype,"onSearchResult",GTB_AF_ChainObserver.prototype.onSearchResult);function GTB_AF_FormFillSearch(b,c,d){this.debugZone="GTB_AF_FormFillSearch";this.chain_=b;this.fieldType_=c;this.prefs_=new GTB_AF_PrefConverter;this.formHistoryComment_=d}goog.exportSymbol("GTB_AF_FormFillSearch",GTB_AF_FormFillSearch);
GTB_AF_FormFillSearch.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIAutoCompleteSearch)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};goog.exportProperty(GTB_AF_FormFillSearch.prototype,"QueryInterface",GTB_AF_FormFillSearch.prototype.QueryInterface);GTB_AF_FormFillSearch.prototype.startSearch=function(b,c,d,e){e=new GTB_AF_ChainObserver(e,this,b,c,d);this.chain_.startSearch(b,c,d,e)};goog.exportProperty(GTB_AF_FormFillSearch.prototype,"startSearch",GTB_AF_FormFillSearch.prototype.startSearch);
GTB_AF_FormFillSearch.prototype.stopSearch=function(){this.chain_.stopSearch()};goog.exportProperty(GTB_AF_FormFillSearch.prototype,"stopSearch",GTB_AF_FormFillSearch.prototype.stopSearch);
GTB_AF_FormFillSearch.prototype.chainSearch=function(b,c,d,e,f,g){b=this.prefs_.getChoices(this.fieldType_);e=[];if(f=c.wrappedJSObject&&c.wrappedJSObject.entries){for(var h=0;h<b.length;++h)for(var i=b[h].value.toLowerCase(),j=f.length-1;j>=0;--j)f[j].textLowerCase==i&&f[j].comment==this.formHistoryComment_&&f.splice(j,1);c.wrappedJSObject.entries=f}for(h=0;h<b.length;++h){i=b[h].value.toLowerCase();if(this.prefs_.isEncrypted(this.fieldType_)||i.indexOf(d.toLowerCase())==0)e.push(b[h])}c=new GTB_AF_ChainSearchResult(c,
e,this.formHistoryComment_);g.onSearchResult(this,c)};function GTB_AF_ChainSearchResult(b,c,d){this.debugZone="GTB_AF_FormFillSearch";this.prevResult_=b;this.afResult_=c;this.prevResultComment_=d;this.wrappedJSObject=this}goog.exportSymbol("GTB_AF_ChainSearchResult",GTB_AF_ChainSearchResult);GTB_AF_ChainSearchResult.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIAutoCompleteResult)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};
goog.exportProperty(GTB_AF_ChainSearchResult.prototype,"QueryInterface",GTB_AF_ChainSearchResult.prototype.QueryInterface);GTB_AF_ChainSearchResult.prototype.__defineGetter__("defaultIndex",function(){return 0});GTB_AF_ChainSearchResult.prototype.__defineGetter__("errorDescription",function(){return""});GTB_AF_ChainSearchResult.prototype.__defineGetter__("matchCount",function(){return this.prevResult_.matchCount+this.afResult_.length});
GTB_AF_ChainSearchResult.prototype.__defineGetter__("searchResult",function(){var b=this.prevResult_.searchResult;if(b!=Ci.nsIAutoCompleteResult.RESULT_NOMATCH||this.afResult_.length==0)return b;return Ci.nsIAutoCompleteResult.RESULT_SUCCESS});GTB_AF_ChainSearchResult.prototype.__defineGetter__("searchString",function(){return this.prevResult_.searchString});GTB_AF_ChainSearchResult.prototype.__defineSetter__("searchString",function(b){this.prevResult_.searchString=b});
GTB_AF_ChainSearchResult.prototype.__defineGetter__("entries",function(){for(var b=this.prevResult_.wrappedJSObject.entries,c=this.afResult_,d=0;d<c.length;++d)b.push({text:c[d].value,textLowerCase:c[d].value.toLowerCase(),frecency:0,comment:this.prevResultComment_});return b});
GTB_AF_ChainSearchResult.prototype.__defineSetter__("entries",function(b){var c=this.afResult_,d=c.length-1;a:for(;d>=0;--d){for(var e=0;e<b.length;++e)if(b[e].text==c[d].value&&b[e].comment==this.prevResultComment_)continue a;c.splice(d,1)}for(e=b.length-1;e>=0;--e)b[e].comment==this.prevResultComment_&&b.splice(e,1);this.prevResult_.wrappedJSObject.entries=b});
GTB_AF_ChainSearchResult.prototype.getCommentAt=function(b){try{if(b<this.prevResult_.matchCount)return this.prevResult_.getCommentAt(b)||this.prevResultComment_}catch(c){return this.prevResultComment_}return this.afResult_[b-this.prevResult_.matchCount].profile};goog.exportProperty(GTB_AF_ChainSearchResult.prototype,"getCommentAt",GTB_AF_ChainSearchResult.prototype.getCommentAt);
GTB_AF_ChainSearchResult.prototype.getStyleAt=function(b){try{if(b<this.prevResult_.matchCount)return this.prevResult_.getStyleAt(b)}catch(c){return""}b=this.afResult_[b-this.prevResult_.matchCount].profileIndex;return"gtb-af-profile-"+b+", gtb-af-result"};goog.exportProperty(GTB_AF_ChainSearchResult.prototype,"getStyleAt",GTB_AF_ChainSearchResult.prototype.getStyleAt);GTB_AF_ChainSearchResult.prototype.getImageAt=function(b){try{if(b<this.prevResult_.matchCount)return this.prevResult_.getImageAt(b)}catch(c){return""}return null};
goog.exportProperty(GTB_AF_ChainSearchResult.prototype,"getImageAt",GTB_AF_ChainSearchResult.prototype.getImageAt);GTB_AF_ChainSearchResult.prototype.getValueAt=function(b){if(b<this.prevResult_.matchCount)return this.prevResult_.getValueAt(b);return this.afResult_[b-this.prevResult_.matchCount].value};goog.exportProperty(GTB_AF_ChainSearchResult.prototype,"getValueAt",GTB_AF_ChainSearchResult.prototype.getValueAt);
GTB_AF_ChainSearchResult.prototype.removeValueAt=function(b,c){b<this.prevResult_.matchCount&&this.prevResult_.removeValueAt(b,c)};goog.exportProperty(GTB_AF_ChainSearchResult.prototype,"removeValueAt",GTB_AF_ChainSearchResult.prototype.removeValueAt);var GTB_AF_Upload={UPLOAD_NOT_REQUIRED:0,USE_UPLOAD_RATES:1,UPLOAD_REQUIRED:2};function GTB_AF_FormField(b,c){this.debugZone="GTB_AF_FormField";this.input=b;this.name=b.name;this.htmlType=b.type;this.value=b.value;this.fillType=null;this.possibleFillTypes=[];this.preview=this.previewFrame=null;this.hash_=c}function GTB_AF_FormStructure(b,c,d,e){this.debugZone="GTB_AF_FormStructure";this.targetDomain=b;this.name=c;this.autofillUsed=false;this.fields=d;this.hash_=e||new GTB_AF_Hash}
GTB_AF_FormStructure.VERSION=GTB_version+"-ff";function GTB_AF_Hash(){this.debugZone="GTB_Autofill_Hash"}GTB_AF_Hash.prototype.fullHash_=function(b){var c=GTB_StringToUTF8(b);b=Cc["@mozilla.org/security/hash;1"].createInstance(Ci.nsICryptoHash);b.init(Ci.nsICryptoHash.SHA1);b.update(c,c.length);c=true;return b.finish(!c)};GTB_AF_Hash.prototype.partialHash=function(b,c){for(var d=this.fullHash_(b),e="0x",f=c>>3,g=0;g<f;++g)e+=("0"+d.charCodeAt(g).toString(16)).slice(-2);return e};
function GTB_AF_ownerDocument(b){return b.DOCUMENT_NODE==b.nodeType?b:b.ownerDocument}a=GTB_AF_FormField.prototype;a.signature_=function(){return this.hash_.partialHash(this.name+"&"+this.htmlType,32)};a.encodeQuery=function(b){var c=GTB_AF_ownerDocument(b);c=c.createElement("field");c.setAttribute("signature",this.signature_());b.appendChild(c)};
a.findQueryResponse=function(b){if(!b)return null;if(b.tagName=="field")return b;for(b=b.nextSibling;b&&(b.nodeType!=b.ELEMENT_NODE||b.tagName!="field");)b=b.nextSibling;return b=b};a.decodeQueryResponse=function(b){b=Number(b.getAttribute("autofilltype"));b=b>=0&&b<GTB_AF_FieldType.MAX_VALID_FIELD_TYPE?b:GTB_AF_FieldType.NO_SERVER_DATA;if(this.fillType==null&&GTB_AF_FieldType.isInformational(b))this.fillType=b};
a.encodeUpload=function(b){for(var c=GTB_AF_ownerDocument(b),d=this.signature_(),e=0;e<this.possibleFillTypes.length;++e){var f=c.createElement("field");f.setAttribute("signature",d);f.setAttribute("autofilltype",String(this.possibleFillTypes[e]));b.appendChild(f)}};a.hasServerData=function(){return!!(this.fillType&&this.fillType!=GTB_AF_FieldType.NO_SERVER_DATA)};a=GTB_AF_FormStructure.prototype;
a.signature_=function(){for(var b=this.targetDomain+"&"+this.name,c=0;c<this.fields.length;++c)b+="&"+this.fields[c].name;return this.hash_.partialHash(b,64)};a.encodeQuery=function(b){var c=GTB_AF_ownerDocument(b);c=c.createElement("form");c.setAttribute("signature",this.signature_());for(var d=0;d<this.fields.length;++d)this.fields[d].encodeQuery(c);b.appendChild(c)};
a.decodeQueryResponse=function(b){var c=0;for(b=b;c<this.fields.length;++c,b=b.nextSibling){b=this.fields[c].findQueryResponse(b);if(!b)throw Error("Not enough response fields");this.fields[c].decodeQueryResponse(b)}return b};
a.encodeUpload=function(b,c){var d=GTB_AF_ownerDocument(b);d=d.createElement("autofillupload");d.setAttribute("clientversion",GTB_AF_FormStructure.VERSION);d.setAttribute("formsignature",this.signature_());d.setAttribute("autofillused",this.autofillUsed?"true":"false");d.setAttribute("datapresent",c);for(var e=0;e<this.fields.length;++e)this.fields[e].encodeUpload(d);b.appendChild(d)};a.hasServerData=function(){for(var b=0;b<this.fields.length;++b)if(this.fields[b].hasServerData())return true;return false};
GTB_AF_FormStructure.encodeListQuery=function(b,c){var d=GTB_AF_ownerDocument(b);d=d.createElement("autofillquery");d.setAttribute("clientversion",GTB_AF_FormStructure.VERSION);for(var e=0;e<c.length;++e)c[e].encodeQuery(d);b.appendChild(d)};var GTB_AF_endTester=new GTB_AF_FormField({name:"",type:"",value:""},null);
GTB_AF_FormStructure.decodeListQueryResponse=function(b,c){if("autofillqueryresponse"==b.tagName){for(var d=b.firstChild,e=0;e<c.length;++e)d=c[e].decodeQueryResponse(d);if(GTB_AF_endTester.findQueryResponse(d))throw Error("Too many fields in response");}};
GTB_AF_FormStructure.getUploadRequested=function(b){if("autofillqueryresponse"!=b.tagName)return GTB_AF_Upload.USE_UPLOAD_RATES;b=b.getAttribute("uploadrequired");if(!b)return GTB_AF_Upload.USE_UPLOAD_RATES;return"true"==b.toLowerCase()?GTB_AF_Upload.UPLOAD_REQUIRED:GTB_AF_Upload.UPLOAD_NOT_REQUIRED};
GTB_AF_FormStructure.decodeUploadResponse=function(b,c){if("autofilluploadresponse"==b.tagName){var d=b.getAttribute("positiveuploadrate"),e=b.getAttribute("negativeuploadrate");if(d){d=parseFloat(d);if(!isNaN(d))c.positiveUploadRate=d}if(e){e=parseFloat(e);if(!isNaN(e))c.negativeUploadRate=e}}};function GTB_AF_Heuristics(b){this.debugZone="GTB_AF_Heuristics";this.typeAccess_=b;b=false;for(var c in GTB_AF_Heuristics.states){b=GTB_AF_Heuristics.states[c];b=GTB_AF_Heuristics.states[b]==c;break}if(!b)for(c in GTB_AF_Heuristics.states){b=GTB_AF_Heuristics.states[c];GTB_AF_Heuristics.states[b]=c}}GTB_AF_Heuristics._MAX_RUNTIME=1E3;a=GTB_AF_Heuristics.prototype;
a.getRegexps_=function(){if(GTB_AF_Heuristics.regexpsCreated_)return GTB_AF_Heuristics.fieldRegexps_;GTB_AF_Heuristics.regexpsCreated_=true;for(var b=GTB_AF_Heuristics.fieldRegexps_,c=0;c<b.length;++c)if(!b[c].disable&&!b[c].regexp){for(var d="",e=0;e<b[c].reg.length;++e){if(e!=0)d+="|";d+="(\\b"+b[c].reg[e]+"\\b)"}b[c].regexp=null;if(d.length>0)b[c].regexp=RegExp(d,"i")}return GTB_AF_Heuristics.fieldRegexps_};
a.stringTrim_=function(b,c){var d=b;d=d.replace(/\n/g," ");c||(d=d.replace(/\&nbsp\;/g," ").replace(/[^\w\s\d#\/-]/g," "));d=d.replace(/^\s+|\s+$/g,"").replace(/\s\s+/g," ");c||(d=d.replace(/^[\/-]$/g,""));return d};
a.parsePage=function(b){this.startTime_=(new Date).getTime();this.autofillFields_=[];b=this.findFormInfo_(b);for(var c,d=0;c=b[d];++d){var e=(new Date).getTime()-this.startTime_;if(e>GTB_AF_Heuristics._MAX_RUNTIME)break;if(!(c.input.offsetHeight==0||c.input.offsetWidth==0))if(!this.extractServer_(c))if(!(c.input.name=="address"&&this.matchECML_(c.input.id,c)))if(!this.matchECML_(c.input.name,c))if(!this.matchRegexp_(c.input.name,null,c,"generic")){if(c.input.type=="select-one"){e=this.findOptionsText_(c.input,
4);if(e.length>0){e=e.join(" ");if(this.matchRegexp_(e,null,c,"option"))continue}}if(e=this.findLabelSimple_(c.input))if(this.matchRegexp_(e.text,e.node,c,"generic"))continue;e=this.findLabelFromTable_(c.input);if(!(e.rowResults.text&&this.matchRegexp_(e.rowResults.text,e.rowResults.node,c,"row")))if(!(e.columnResults.text&&this.matchRegexp_(e.columnResults.text,e.columnResults.node,c,"column")))(e=this.findLabelGeneric_(c.input))&&this.matchRegexp_(e.text,e.node,c,"generic")}}this.assignTypes_()};
a.assignTypes_=function(){for(var b=this.autofillFields_.length,c=0;c<b;++c){var d=this.autofillFields_[c];if(!d.fillFieldDataType)if(d.inputLabelNode==null){d.fillFieldDataType=d.regexpEntry.fillData[0][0];this.checkForAddressType_(d)}else{for(var e=d.inputLabelNode,f=d.match,g=[],h=0;h<b;++h){d=this.autofillFields_[h];if(e==d.inputLabelNode&&(f=="generic"||d.match==f||d.match=="generic"))g.push(d)}e=g.length-1;for(h=0;h<g.length;++h){d=g[h];f=d.regexpEntry;var i=h;if(f&&f.fillData.length>e&&f.fillData[e].length>
i){d.fillFieldDataType=f.fillData[e][i];this.checkForAddressType_(d)}}}}for(c=0;c<b;++c){d=this.autofillFields_[c];this.typeAccess_.isInformational(d.fillFieldDataType)&&this.typeAccess_.setFieldType(d.input,d.fillFieldDataType)}};a.checkForAddressType_=function(b){if(b.addrType=="shipping")b.fillFieldDataType=GTB_AF_FieldType.convertToShipping(b.fillFieldDataType);else if(b.addrType=="billing")b.fillFieldDataType=GTB_AF_FieldType.convertToBilling(b.fillFieldDataType)};
a.matchRegexp_=function(b,c,d,e){for(var f=this.getRegexps_(),g=0;g<f.length;++g)if(!f[g].disable){var h=f[g].regexp;if(h)if((!f[g].type||f[g].type==d.type)&&h.test(b)){b={input:d.input,inputLabelNode:c,match:e,matchText:b,regexpEntry:f[g],addrType:d.addrType};this.autofillFields_.push(b);return true}}return false};
a.matchECML_=function(b,c){var d=b.toLowerCase();if(d.indexOf("ecom_")!=0)return false;for(var e in GTB_AF_Heuristics.ecmlMap_)if(d.lastIndexOf(e)!=-1){e=GTB_AF_Heuristics.ecmlMap_[e];if(d.indexOf("_shipto_")>0)e=GTB_AF_FieldType.convertToShipping(e);d={input:c.input,inputLabelNode:null,match:"ecml",matchText:b,regexpEntry:null,fillFieldDataType:e};this.autofillFields_.push(d);return true}return false};
a.extractServer_=function(b){var c=this.typeAccess_.getFieldType(b.input);if(!this.typeAccess_.isInformational(c))return false;b={input:b.input,inputLabelNode:null,match:"server",matchText:null,regexpEntry:null,fillFieldDataType:c};this.autofillFields_.push(b);return true};
a.decorateInputTags_=function(b,c,d,e){var f=b&&b.ownerDocument;if(!f)return false;f=f.evaluate(".//input[@type='text'] | .//select[@type='select-one']",b,null,Ci.nsIDOMXPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);var g=f.iterateNext();for(b=g;b;b=f.iterateNext())b.GTB_AUTOFILL_tableInfo={tableHead:c,row:d,column:e};return g!=null};
a.lookForText_=function(b,c){if(b.nodeName=="SCRIPT"||!c&&b.nodeName=="OPTION")return null;var d="";if(b.nodeType==Ci.nsIDOMNode.TEXT_NODE){d=this.stringTrim_(b.nodeValue,c);if(d.length)return{node:b,text:d}}else if(b.tagName=="img"){d=this.stringTrim_(b.getAttribute("alt"),c);if(d.length)return{node:b,text:d}}d="";for(var e=null,f=b.childNodes,g=0;g<f.length;++g){var h=this.lookForText_(f[g],c);if(h){if(d.length)d=d+" "+h.text;else{e=h.node;d=h.text}if(d.length>100)return{node:e,text:d}}}return d.length?
{node:e,text:d}:null};a.findOptionsText_=function(b,c){for(var d=[],e=0,f=0;f<b.options.length;++f){var g=this.lookForText_(b.options[f],true);++e;d.push(g?g.text:"");if(e>c)break}return d};a.findLabelFromSibling_=function(b){for(b=b;b;){var c=this.lookForText_(b,false);if(c)return c;b=b.previousSibling}return null};a.findLabelSimple_=function(b){if(b&&b.nodeName!="BODY")return this.findLabelFromSibling_(b.previousSibling);return null};
a.findLabelGeneric_=function(b){for(b=b;b&&b.nodeName!="BODY";){var c=this.findLabelFromSibling_(b.previousSibling);if(c)return c;b=b.parentNode}return null};
a.constructTableInMemory_=function(b){for(var c=[],d=0,e=b.rows,f=0;f<e.length;++f){var g=(new Date).getTime()-this.startTime_;if(g>GTB_AF_Heuristics._MAX_RUNTIME)break;g=0;for(var h=e[f].cells,i=0;i<h.length;++i){var j=h[i],k=1;if(j.getAttribute("colspan"))k=parseInt(j.getAttribute("colspan"),10);if(!(j.getAttribute("rowspan")&&parseInt(j.getAttribute("rowspan"),10)!=1)){var l=this.decorateInputTags_(j,b,d,g),m=null;l||(m=this.lookForText_(j,false));if(m||l)for(j=0;j<k;++j){c[d+","+g]={textData:m,
hasInputTags:l};++g}else g+=k}}++d}return c};a.findTableHead_=function(b){for(b=b;b!=null&&b.nodeName!="BODY"&&b.nodeName!="TABLE"&&b.nodeName!="TBODY";)b=b.parentNode;if(b.nodeName!="TABLE"&&b.nodeName!="TBODY")return null;return b};
a.findInputNodeInTable_=function(b){var c=this.findTableHead_(b);if(c==null)return null;var d=null;if(c.GTB_AUTOFILL_tableMatrix!=null)d=c.GTB_AUTOFILL_tableMatrix;else{d=this.constructTableInMemory_(c);if(d==null)return null;c.GTB_AUTOFILL_tableMatrix=d}if(b.GTB_AUTOFILL_tableInfo!=null){c=b.GTB_AUTOFILL_tableInfo.row;b=b.GTB_AUTOFILL_tableInfo.column;return{table:d,row:c,column:b}}return null};a.lookupTableElement_=function(b,c,d){return b[c+","+d]};
a.findLabelsInSameColumn_=function(b){var c=null,d=b.row-2;if(d<0)d=0;for(d=d;d<b.row;++d){var e=this.lookupTableElement_(b.table,d,b.column);if(e)if(e.hasInputTags)c=null;else if(e.textData)c=e.textData}return c};a.findLabelsInSameRow_=function(b){var c=null;if(b.column==0)return null;for(var d=b.column-1;d>=0;--d){var e=this.lookupTableElement_(b.table,b.row,d);if(e)if(e.hasInputTags)return c;else if(e.textData)c=e.textData}return c};
a.findLabelFromTable_=function(b){var c={text:null,node:null},d={text:null,node:null};b=this.findInputNodeInTable_(b);if(b==null)return{rowResults:d,columnResults:c};var e=this.findLabelsInSameRow_(b);if(e)d=e;if(e=this.findLabelsInSameColumn_(b))c=e;return{rowResults:d,columnResults:c}};
a.findFormInfo_=function(b){var c=[];if(!b||!b.forms)return c;b=b.forms;for(var d=b.length,e=null,f=0;f<d;++f)for(var g=b[f],h=g.length,i=0;i<h;++i){var j=g[i];if(j.name!=null&&j.name!=""&&j.getAttribute("onclick")==null){var k=j.type;if(k=="text"||k=="select-one"){j={input:j,type:k,addrType:e};c.push(j)}else if(k=="hidden")if(this.checkInputFields_(j,["billing","billto"]))e="billing";else if(this.checkInputFields_(j,["shipping","shipto"]))e="shipping"}}return c};
a.checkInputFields_=function(b,c){for(var d=0;d<c.length;++d){var e=c[d];if(b.value.toLowerCase().indexOf(e)==0||b.name.toLowerCase().indexOf(e)==0||b.id.toLowerCase().indexOf(e)==0)return true}return false};a.setSelectField=function(b,c,d){var e=this.findOptionsText_(b,1E3);if(e.length==0)return null;if(c=this.findOption_(e,c,d)){b.selectedIndex=-1;b.selectedIndex=c;if(b.selectedIndex==-1)b.value=e[c]}};
GTB_AF_Heuristics.states={alabama:"al",alaska:"ak",arizona:"az",arkansas:"ar",california:"ca",colorado:"co",connecticut:"ct",delaware:"de","district of columbia":"dc",florida:"fl",georgia:"ga",hawaii:"hi",idaho:"id",illinois:"il",indiana:"in",iowa:"ia",kansas:"ks",kentucky:"ky",louisiana:"la",maine:"me",maryland:"md",massachusetts:"ma",michigan:"mi",minnesota:"mn",mississippi:"ms",missouri:"mo",montana:"mt",nebraska:"ne",nevada:"nv","new hampshire":"nh","new jersey":"nj","new mexico":"nm","new york":"ny",
"north carolina":"nc","north dakota":"nd",ohio:"oh",oklahoma:"ok",oregon:"or",pennsylvania:"pa","puerto rico":"pr","rhode island":"ri","south carolina":"sc","south dakota":"sd",tennessee:"tn",texas:"tx",utah:"ut",vermont:"vt",virginia:"va",washington:"wa","west virginia":"wv",wisconsin:"wi",wyoming:"wy",alberta:"ab","british columbia":"bc",manitoba:"mb","new brunswick":"nb",newfoundland:"nf","northwest territories":"nt","nova scotia":"ns",nunavut:"nu",ontario:"on","prince edward island":"pe",quebec:"qc",
saskatchewan:"sk",yukon:"yt"};GTB_AF_Heuristics.unitedStates={"united states":"us",usa:"us",us:"us"};GTB_AF_Heuristics.MONTHS=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];
GTB_AF_Heuristics.prototype.findOption_=function(b,c,d){for(var e=c.toLowerCase(),f=-1,g=RegExp("\\b"+e+"\\b"),h=[],i=0;i<b.length;++i){var j=b[i].toLowerCase();h[j]=i;if(j==e)return i;if(f==-1&&g.test(j))f=i}if(GTB_AF_FieldType.ADDRESS_BILLING_STATE==d||GTB_AF_FieldType.ADDRESS_HOME_STATE==d){if(c=GTB_AF_Heuristics.states[e]){b=h[c];if(b!=null)return b}}else if((GTB_AF_FieldType.ADDRESS_BILLING_COUNTRY==d||GTB_AF_FieldType.ADDRESS_HOME_COUNTRY==d)&&GTB_AF_Heuristics.unitedStates[e])for(var k in GTB_AF_Heuristics.unitedStates){b=
h[k];if(b!=null)return b}else if(GTB_AF_FieldType.CREDIT_CARD_EXP_MONTH==d){if(c.indexOf("0")==0){b=h[c.substring(1)];if(b!=null)return b}if(c.length==1){b=h["0"+c];if(b!=null)return b}i=parseInt(l,10)-1;var l=GTB_AF_Heuristics.MONTHS[i];for(var m in h)if(m.indexOf(l)>-1)return h[m]}else if(GTB_AF_FieldType.CREDIT_CARD_EXP_2_DIGIT_YEAR==d||GTB_AF_FieldType.CREDIT_CARD_EXP_4_DIGIT_YEAR==d){c=c.substr(2);b=h[c];if(b!=null)return b}if(f!=-1)return f;return null};
GTB_AF_Heuristics.ecmlMap_={name_first:GTB_AF_FieldType.NAME_FIRST,name_middle:GTB_AF_FieldType.NAME_MIDDLE,name_last:GTB_AF_FieldType.NAME_LAST,name_combined:GTB_AF_FieldType.NAME_FULL,online_email:GTB_AF_FieldType.EMAIL_ADDRESS,billto_postal_city:GTB_AF_FieldType.ADDRESS_BILLING_CITY,city:GTB_AF_FieldType.ADDRESS_HOME_CITY,billto_postal_stateprov:GTB_AF_FieldType.ADDRESS_BILLING_STATE,stateprov:GTB_AF_FieldType.ADDRESS_HOME_STATE,billto_postal_postalcode:GTB_AF_FieldType.ADDRESS_BILLING_ZIP,postalcode:GTB_AF_FieldType.ADDRESS_HOME_ZIP,
billto_postal_street_line1:GTB_AF_FieldType.ADDRESS_BILLING_LINE1,billto_postal_street_line2:GTB_AF_FieldType.ADDRESS_BILLING_LINE2,street_line1:GTB_AF_FieldType.ADDRESS_HOME_LINE1,street_line2:GTB_AF_FieldType.ADDRESS_HOME_LINE2,billto_postal_city:GTB_AF_FieldType.ADDRESS_BILLING_CITY,city:GTB_AF_FieldType.ADDRESS_HOME_CITY,billto_postal_countrycode:GTB_AF_FieldType.ADDRESS_BILLING_COUNTRY,countrycode:GTB_AF_FieldType.ADDRESS_HOME_COUNTRY,company:GTB_AF_FieldType.COMPANY_NAME,phone_number:GTB_AF_FieldType.PHONE_HOME_WHOLE_NUMBER,
fax_number:GTB_AF_FieldType.PHONE_FAX_WHOLE_NUMBER,card_name:GTB_AF_FieldType.CREDIT_CARD_NAME,card_type:GTB_AF_FieldType.CREDIT_CARD_TYPE,card_number:GTB_AF_FieldType.CREDIT_CARD_NUMBER,card_verification:GTB_AF_FieldType.CREDIT_CARD_VERIFICATION_CODE,card_expdate_month:GTB_AF_FieldType.CREDIT_CARD_EXP_MONTH,card_expdate_year:GTB_AF_FieldType.CREDIT_CARD_EXP_4_DIGIT_YEAR};
GTB_AF_Heuristics.fieldRegexps_=[{fillData:[["title"]],disable:true,reg:["title"]},{fillData:[[GTB_AF_FieldType.NAME_FIRST],[GTB_AF_FieldType.NAME_FIRST,GTB_AF_FieldType.NAME_LAST]],reg:["first[ -_]?name","name[ -_]?first","fname","initials"],type:"text"},{fillData:[[GTB_AF_FieldType.NAME_MIDDLE_INITIAL]],reg:["m[ _]?i","initial"],type:"text"},{fillData:[[GTB_AF_FieldType.NAME_MIDDLE]],reg:["middle"],type:"text"},{fillData:[[GTB_AF_FieldType.NAME_LAST]],reg:["last[ -_]?name","name[ -_]?last","lname",
"surname"],ecml:"name_last",type:"text"},{fillData:[[GTB_AF_FieldType.NAME_FULL]],reg:["full[ -_]?name","name[ -_]?full","recipient[ -]?s?[ -_]?name","attention","attn","to name","my name","author"],type:"text"},{fillData:[[GTB_AF_FieldType.EMAIL_ADDRESS]],reg:["e[ -]?mail"],type:"text"},{fillData:[[GTB_AF_FieldType.CREDIT_CARD_NAME]],reg:["address[.]name"],type:"text"},{fillData:[[GTB_AF_FieldType.COMPANY_NAME]],reg:["company[ -_]?(name)?"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_HOME_COUNTRY_CODE]],
reg:["phone[ -_]?country","phone[ -_]?country[ -_]?code"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_HOME_CITY_CODE]],reg:["area","area[ -_]?code","phone[ -_]?area"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_HOME_NUMBER]],reg:["phone[ -_]?number1?"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_HOME_WHOLE_NUMBER],[GTB_AF_FieldType.PHONE_HOME_CITY_CODE,GTB_AF_FieldType.PHONE_HOME_NUMBER],[GTB_AF_FieldType.PHONE_HOME_COUNTRY_CODE,GTB_AF_FieldType.PHONE_HOME_CITY_CODE,GTB_AF_FieldType.PHONE_HOME_NUMBER]],
reg:["(phone|telephone)"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_FAX_COUNTRY_CODE]],reg:["fax[ -_]?country","fax[ -_]?country[ -_]?code"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_FAX_CITY_CODE]],reg:["fax[ -_]?area","fax[ -_]?area[ -_]?code"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_FAX_NUMBER]],reg:["fax[ -_]?number"],type:"text"},{fillData:[[GTB_AF_FieldType.PHONE_FAX_WHOLE_NUMBER],[GTB_AF_FieldType.PHONE_FAX_CITY_CODE,GTB_AF_FieldType.PHONE_FAX_NUMBER],[GTB_AF_FieldType.PHONE_FAX_COUNTRY_CODE,
GTB_AF_FieldType.PHONE_FAX_CITY_CODE,GTB_AF_FieldType.PHONE_FAX_NUMBER]],reg:["fax"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_CITY],[GTB_AF_FieldType.ADDRESS_HOME_CITY,GTB_AF_FieldType.ADDRESS_HOME_STATE],[GTB_AF_FieldType.ADDRESS_HOME_CITY,GTB_AF_FieldType.ADDRESS_HOME_STATE,GTB_AF_FieldType.ADDRESS_HOME_ZIP]],reg:["(shipping|home)[ -_]?(city|town)","(city|town)"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_CITY],[GTB_AF_FieldType.ADDRESS_BILLING_CITY,GTB_AF_FieldType.ADDRESS_BILLING_STATE],
[GTB_AF_FieldType.ADDRESS_BILLING_CITY,GTB_AF_FieldType.ADDRESS_BILLING_STATE,GTB_AF_FieldType.ADDRESS_BILLING_ZIP]],reg:["billing[ -_]?(city|town)"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_ZIP],[GTB_AF_FieldType.ADDRESS_HOME_ZIP,null]],reg:["(shipping|home)[ -_]?(zip|postal)[ -_]?(code)?","(zip|postal)[ -_]?(code)?"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_ZIP],[GTB_AF_FieldType.ADDRESS_BILLING_ZIP,null]],reg:["billing[ -_]?(zip|postal)[ -_]?(code)?"],type:"text"},
{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_STATE]],reg:["alabama","(shipping|home)[ -_]?state","state"],type:"select-one"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_STATE]],reg:["(shipping|home)[ -_]?state","state"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_STATE]],reg:["billing[ -_]?state"]},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_STATE]],reg:["province","region"]},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_COUNTRY]],reg:["afghanistan","united states","country","(shipping|home)[ -_]?country"],
type:"select-one"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_COUNTRY]],reg:["billing[ -_]?country"],type:"select-one"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_COUNTRY]],reg:["(shipping|home)[ -_]?country","country"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_COUNTRY]],reg:["billing[ -_]?country"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_LINE2]],reg:["(shipping|home)[ -_]?line[ -_]?2","line[ -_]?2","(shipping|home)[ -_]?address[ -_]?2","address[ -_]?2","(shipping|home)[ -_]?street[ -_]?2",
"street[ -_]?2"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_LINE2]],reg:["billing[ -_]?line[ -_]?2","billing[ -_]?address[ -_]?2","billing[ -_]?street[ -_]?2"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_LINE1]],reg:["(shipping|home)[ -_]?line[ -_]?1","line[ -_]?1","(shipping|home)[ -_]?address[ -_]?1?","address[ -_]?1?","(shipping|home)[ -_]?street[ -_]?1?","street[ -_]?1?"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_LINE1]],reg:["billing[ -_]?line[ -_]?1",
"billing[ -_]?address[ -_]?1?","billing[ -_]?street[ -_]?1?"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_LINE1],[GTB_AF_FieldType.ADDRESS_HOME_LINE1,GTB_AF_FieldType.ADDRESS_HOME_LINE2],[GTB_AF_FieldType.ADDRESS_HOME_LINE1,GTB_AF_FieldType.ADDRESS_HOME_LINE2,null]],reg:["(shipping|home)[ -_]?address","address","(shipping|home)[ -_]?street","street"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_BILLING_LINE1],[GTB_AF_FieldType.ADDRESS_BILLING_LINE1,GTB_AF_FieldType.ADDRESS_BILLING_LINE2],
[GTB_AF_FieldType.ADDRESS_BILLING_LINE1,GTB_AF_FieldType.ADDRESS_BILLING_LINE2,null]],reg:["billing[ -_]?address","billing[ -_]?street"],type:"text"},{fillData:[[GTB_AF_FieldType.ADDRESS_HOME_APPT_NUM]],reg:["apt","suite","unit"],disable:true,type:"text"},{fillData:[[GTB_AF_FieldType.CREDIT_CARD_NAME]],reg:["cardholder ?s?[ -_]?name","card holder"],type:"text"},{fillData:[[GTB_AF_FieldType.CREDIT_CARD_TYPE]],reg:["visa","credit[ -_]?card"],type:"select-one"},{fillData:[[GTB_AF_FieldType.CREDIT_CARD_NUMBER]],
reg:["card[ -_]?number","card[ -_]?no","card[ -_]?#","account[ -_]?number"],type:"text"},{fillData:[[GTB_AF_FieldType.CREDIT_CARD_EXP_MONTH]],reg:["expiration[ -_]?month","card[ -_]?month"]},{fillData:[[GTB_AF_FieldType.CREDIT_CARD_EXP_4_DIGIT_YEAR]],reg:["expiration[ -_]?year","card[ -_]?year"]},{fillData:[[],[GTB_AF_FieldType.CREDIT_CARD_EXP_MONTH,GTB_AF_FieldType.CREDIT_CARD_EXP_4_DIGIT_YEAR]],reg:["expiration"]},{fillData:[[GTB_AF_FieldType.CREDIT_CARD_VERIFICATION_CODE]],reg:["cvc2?","cvv2",
"cvvc"],type:"text"}];GTB_AF_Heuristics.regexpsCreated_=false;function GTB_AF_PrefConverter(){this.debugZone="GTB_AF_PrefConverter";this.crypto_=null;this.prefs_=new G_Preferences("google.toolbar.autofill.");this.toolbarPrefs_=new G_Preferences("google.toolbar.");this.pwdSaved_=null;var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.defaultProfName_=b.GetStringFromName("prop.gtb.autofill2.profile");this.defaultCardName_=b.GetStringFromName("prop.gtb.autofill2.card")}
GTB_AF_PrefConverter.conversionTable_=null;function GTB_AF_Identity(b){return b}function GTB_AF_BillingSelector(b,c,d){return b?c:d}function GTB_AF_BillingPref(b){return["billingIsShipping","shipping"+b,"billing"+b]}
GTB_AF_PrefConverter.createTable=function(){var b=[];b[GTB_AF_FieldType.NAME_FIRST]={section:"profile",pref:["firstName"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.NAME_MIDDLE]={section:"profile",pref:["middleName"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.NAME_LAST]={section:"profile",pref:["lastName"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.NAME_MIDDLE_INITIAL]={section:"profile",pref:["middleName"],conversion:function(g){return g&&g.charAt(0)&&g.charAt(0).toUpperCase()}};var c=
"{firstName} {middleName} {lastName}";b[GTB_AF_FieldType.NAME_FULL]={section:"profile",pref:["firstName","middleName","lastName"],conversion:function(g,h,i){return c.replace(/\{firstName\}/g,g).replace(/\{middleName\}/g,h).replace(/\{lastName\}/g,i)}};b[GTB_AF_FieldType.NAME_SUFFIX]={section:"profile",pref:null,conversion:GTB_AF_Identity};b[GTB_AF_FieldType.EMAIL_ADDRESS]={section:"profile",pref:["eMail"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.PHONE_HOME_NUMBER]={section:"profile",pref:["phoneNumber"],
conversion:GTB_AF_Identity};b[GTB_AF_FieldType.PHONE_HOME_CITY_CODE]={section:"profile",pref:["phoneArea"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.PHONE_HOME_COUNTRY_CODE]={section:"profile",pref:["phoneCountry"],conversion:GTB_AF_Identity};var d="{area}{number}";b[GTB_AF_FieldType.PHONE_HOME_CITY_AND_NUMBER]={section:"profile",pref:["phoneArea","phoneNumber"],conversion:function(g,h){return d.replace(/\{area\}/g,g).replace(/\{number\}/g,h)}};var e="{country}{area}{number}";b[GTB_AF_FieldType.PHONE_HOME_WHOLE_NUMBER]=
{section:"profile",pref:["phoneCountry","phoneArea","phoneNumber"],conversion:function(g,h,i){return e.replace(/\{country\}/g,g).replace(/\{area\}/g,h).replace(/\{number\}/g,i)}};b[GTB_AF_FieldType.PHONE_FAX_NUMBER]={section:"profile",pref:["faxNumber"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.PHONE_FAX_CITY_CODE]={section:"profile",pref:["faxArea"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.PHONE_FAX_COUNTRY_CODE]={section:"profile",pref:["faxCountry"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.PHONE_FAX_CITY_AND_NUMBER]=
{section:"profile",pref:["faxArea","faxNumber"],conversion:function(g,h){return d.replace(/\{area\}/g,g).replace(/\{number\}/g,h)}};b[GTB_AF_FieldType.PHONE_FAX_WHOLE_NUMBER]={section:"profile",pref:["faxCountry","faxArea","faxNumber"],conversion:function(g,h,i){return e.replace(/\{country\}/g,g).replace(/\{area\}/g,h).replace(/\{number\}/g,i)}};b[GTB_AF_FieldType.ADDRESS_HOME_LINE1]={section:"profile",pref:["shippingAddr1"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_HOME_LINE2]={section:"profile",
pref:["shippingAddr2"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_HOME_APPT_NUM]={section:"profile",pref:null,conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_HOME_CITY]={section:"profile",pref:["shippingCity"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_HOME_STATE]={section:"profile",pref:["shippingState"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_HOME_ZIP]={section:"profile",pref:["shippingZip"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_HOME_COUNTRY]=
{section:"profile",pref:["shippingCountry"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_BILLING_LINE1]={section:"profile",pref:GTB_AF_BillingPref("Addr1"),isTernary:true,conversion:GTB_AF_BillingSelector};b[GTB_AF_FieldType.ADDRESS_BILLING_LINE2]={section:"profile",pref:GTB_AF_BillingPref("Addr2"),isTernary:true,conversion:GTB_AF_BillingSelector};b[GTB_AF_FieldType.ADDRESS_BILLING_APPT_NUM]={section:"profile",pref:null,isTernary:true,conversion:GTB_AF_Identity};b[GTB_AF_FieldType.ADDRESS_BILLING_CITY]=
{section:"profile",pref:GTB_AF_BillingPref("City"),isTernary:true,conversion:GTB_AF_BillingSelector};b[GTB_AF_FieldType.ADDRESS_BILLING_STATE]={section:"profile",pref:GTB_AF_BillingPref("State"),isTernary:true,conversion:GTB_AF_BillingSelector};b[GTB_AF_FieldType.ADDRESS_BILLING_ZIP]={section:"profile",pref:GTB_AF_BillingPref("Zip"),isTernary:true,conversion:GTB_AF_BillingSelector};b[GTB_AF_FieldType.ADDRESS_BILLING_COUNTRY]={section:"profile",pref:GTB_AF_BillingPref("Country"),isTernary:true,conversion:GTB_AF_BillingSelector};
b[GTB_AF_FieldType.COMPANY_NAME]={section:"profile",pref:["companyName"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.CREDIT_CARD_NAME]={section:"card",pref:["nameOnCard"],conversion:GTB_AF_Identity};b[GTB_AF_FieldType.CREDIT_CARD_NUMBER]={section:"card",pref:["number"],encrypted:true,conversion:GTB_AF_Identity};b[GTB_AF_FieldType.CREDIT_CARD_EXP_MONTH]={section:"card",pref:["expMonth"],encrypted:true,conversion:GTB_AF_Identity};b[GTB_AF_FieldType.CREDIT_CARD_EXP_2_DIGIT_YEAR]={section:"card",pref:["expYear"],
encrypted:true,conversion:function(g){return g.slice(g.length-2)}};b[GTB_AF_FieldType.CREDIT_CARD_EXP_4_DIGIT_YEAR]={section:"card",pref:["expYear"],encrypted:true,conversion:GTB_AF_Identity};var f="{month}/{year}";b[GTB_AF_FieldType.CREDIT_CARD_EXP_DATE_2_DIGIT_YEAR]={section:"card",pref:["expMonth","expYear"],encrypted:true,conversion:function(g,h){return f.replace(/\{month\}/g,g).replace(/\{year\}/g,h.slice(h.length-2))}};b[GTB_AF_FieldType.CREDIT_CARD_EXP_DATE_4_DIGIT_YEAR]={section:"card",pref:["expMonth",
"expYear"],encrypted:true,conversion:function(g,h){return f.replace(/\{month\}/g,g).replace(/\{year\}/g,h)}};b[GTB_AF_FieldType.CREDIT_CARD_TYPE]={section:"card",pref:null,conversion:GTB_AF_Identity};b[GTB_AF_FieldType.CREDIT_CARD_VERIFICATION_CODE]={section:"card",pref:["cvc"],encrypted:true,conversion:GTB_AF_Identity};return b};a=GTB_AF_PrefConverter.prototype;
a.getConversionTable=function(){if(!GTB_AF_PrefConverter.conversionTable_)GTB_AF_PrefConverter.conversionTable_=GTB_AF_PrefConverter.createTable();return GTB_AF_PrefConverter.conversionTable_};
a.getChoices=function(b){var c=[];b=this.getConversionTable()[b];if(!b||!b.pref)return c;for(var d=this.prefs_.getPref(b.section+"s",0),e={index:0},f=0;f<d;++f){var g=this.getOptions_(b.section+"."+f,b.pref,false),h=this.validateOptions_(b,g);if(h)(g=b.conversion.apply(null,g))&&c.push({value:g,profile:this.getLabel_(b.section,f,e),profileIndex:f})}return c};
a.getLabel_=function(b,c,d){c=b+"."+c;var e=this.prefs_.getPref(c+".label");if(e)return e;if(b=="profile"){b=[this.prefs_.getPref(c+".firstName"),this.prefs_.getPref(c+".middleName"),this.prefs_.getPref(c+".lastName")];c="";for(e=0;e<b.length;++e)if(b[e]){if(c)c+=" ";c+=b[e]}if(c)return c;else{++d.index;return this.defaultProfName_+" "+d.index}}else if(b=this.prefs_.getPref(c+".nameOnCard"))return b;else{++d.index;return this.defaultCardName_+" "+d.index}};
a.getDefaultProfileCard_=function(b){var c=this.prefs_.getPref(b+"s");if(!c)return null;for(var d=0;d<c;++d){var e=b+"."+d+".";if(e=this.prefs_.getPref(e+"isDefault"))return d}return null};a.getDefaultProfile=function(){return this.getDefaultProfileCard_("profile")};a.getDefaultCreditCard=function(){return this.getDefaultProfileCard_("card")};a.getProfileLabels=function(){for(var b=this.prefs_.getPref("profiles",0),c=[],d={index:0},e=0;e<b;++e)c.push(this.getLabel_("profile",e,d));return c};
a.getValue=function(b,c,d){if(typeof b!="number")return null;c=this.getConversionTable()[c];if(!c||!c.pref)return null;b=this.getOptions_(c.section+"."+b,c.pref,!d&&c.encrypted);if(d=this.validateOptions_(c,b))return d?c.conversion.apply(null,b):null;return null};a.isEnabled=function(){return this.toolbarPrefs_.getPref("button_option.gtbAutoFill")};a.addEnableObserver=function(b){this.toolbarPrefs_.addObserver("button_option.gtbAutoFill",b)};
a.isDefined=function(b){if(!this.isEnabled())return false;b=this.getChoices(b);return b.length>0};a.isCardType=function(b){return(b=this.getConversionTable()[b])&&b.section=="card"};a.isEncrypted=function(b){return(b=this.getConversionTable()[b])&&b.encrypted};a.needPromotion=function(){if(this.prefs_.getPref("noPromotion"))return false;var b=new GTB_AutoFillDataCluster("profile",GTB_AutoFillProfileFieldDefs,""),c=new G_Preferences("google.toolbar.autofill.");b.loadFromPrefs(c);return b.isEmpty()};
a.appendPref=function(b,c,d){b=this.getConversionTable()[b];var e=-1;switch(b.conversion){case GTB_AF_Identity:e=0;break;case GTB_AF_BillingSelector:e=2;break}if(e>=0){d[b.pref[e]]=c;d.count_=!d.count_?1:d.count_+1}};a.prepareProfile=function(b){if(!b.count_||b.count_<3)return false;return true};a.getOptions_=function(b,c,d){for(var e=[],f,g=0;g<c.length;++g){if(d)f=this.decrypt_(b,this.prefs_.getPref("ccpwd",""),c[g]);else{f=b+"."+c[g];f=this.prefs_.getPref(f,null)}e.push(f)}return e};
a.decrypt_=function(b,c,d){if(!this.crypto_)this.crypto_=GTB_AutoFillOptions.createCrypto();if(!this.crypto_)return null;if(c)c=this.getPassword_(c);b=this.prefs_.getPref(b+".data",null);c=this.crypto_.decrypt(c,b);if(!c)return null;c=c.split("\u0000");for(b=0;b<c.length;++b){var e=c[b].split("\u0001");if(d==e[0])return e[1]}return null};a.setDocument=function(b){if(b){this.pwdSaved_=b;b.gtbCancelled=false}};
a.clearPassword_=function(){this.prefs_.setPref("ccpwd","");for(var b=this.prefs_.getPref("cards",0),c=0;c<b;++c){var d="card."+c+".",e="";for(var f in GTB_AutoFillCreditCardFieldDefs)if(GTB_AutoFillCreditCardFieldDefs[f].encrypt){this.prefs_.setPref(d+f,"");if(e)e+="\u0000";e=e+f+"\u0001"}var g="";if(this.crypto_)g=this.crypto_.encrypt("",e);this.prefs_.setPref(d+"data",g)}};
a.getPassword_=function(b){if(!this.pwdSaved_)this.pwdSaved_={};if(typeof this.pwdSaved_.gtbPassword=="string")return this.pwdSaved_.gtbPassword;if(!this.pwdSaved_.gtbCancelled){if(!this.crypto_)this.crypto_=GTB_AutoFillOptions.createCrypto();var c={value:"",cancelled:true,cleared:false},d=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties"),e=d.GetStringFromName("prop.gtb.autofill2.enterpwd.title"),f=
d.GetStringFromName("prop.gtb.autofill2.cancelledpwd");for(d=d.GetStringFromName("prop.gtb.autofill2.pwdincorrect");;){this.pwdSaved_.defaultView.top.openDialog("chrome://google-toolbar/content/auto-fill-enter-pwd.xul","gtbAutoFillEnterPwd","chrome,centerscreen,modal,resizable=no",c);if(c.cleared){this.clearPassword_();return this.pwdSaved_.gtbPassword=""}if(c.cancelled){alert(f,e);break}if(c.value&&this.decryptPassword_(c.value,b))return this.pwdSaved_.gtbPassword=c.value;else alert(d,e)}}this.pwdSaved_.gtbCancelled=
true;return this.pwdSaved_.gtbPassword=null};a.decryptPassword_=function(b,c){if(!this.crypto_)return true;var d=this.crypto_.decrypt(b,c);if(!d)return false;if(this.prefs_.getPref("imported",false)){var e=this.crypto_.decrypt("",this.prefs_.getPref("card.0.data",""));e=e?e.split("\u0000"):[];e.push("number\u0001"+d);this.prefs_.setPref("card.0.data",this.crypto_.encrypt(b,e.join("\u0000")));this.prefs_.setPref("ccpwd",this.crypto_.encrypt(b,b));this.prefs_.clearPref("imported")}return true};
a.validateOptions_=function(b,c){var d=false;if(b.isTernary)d=c.length==3&&c[0]?!!c[1]:!!c[2];else if(b.conversion)for(var e=0;!d&&e<c.length;++e)d=!!c[e];else d=c.length==1&&!!c[0];return d};function GTB_AutoFillPwdObject(){this.debugZone="AutoFill password object"}goog.exportSymbol("GTB_AutoFillPwdObject",GTB_AutoFillPwdObject);GTB_AutoFillPwdObject.prototype.onAccept=function(b){b.arguments[0].value=b.document.getElementById("gtbAutoFillPassword").value;b.arguments[0].cancelled=false};
goog.exportProperty(GTB_AutoFillPwdObject.prototype,"onAccept",GTB_AutoFillPwdObject.prototype.onAccept);GTB_AutoFillPwdObject.prototype.onCancel=function(b){b.arguments[0].cancelled=true};goog.exportProperty(GTB_AutoFillPwdObject.prototype,"onCancel",GTB_AutoFillPwdObject.prototype.onCancel);
GTB_AutoFillPwdObject.prototype.onForgotPassword=function(b){var c=b.arguments[0],d=Cc["@mozilla.org/embedcomp/prompt-service;1"].getService(Ci.nsIPromptService),e=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties"),f=e.GetStringFromName("prop.gtb.autofill2.enterpwd.title");e=e.GetStringFromName("prop.gtb.autofill2.enterpwd.forgot");if(d.confirm(null,f,e)){c.cleared=true;b.close()}};
goog.exportProperty(GTB_AutoFillPwdObject.prototype,"onForgotPassword",GTB_AutoFillPwdObject.prototype.onForgotPassword);
GTB_AF_PrefConverter.prototype.collectPossibleTypes=function(b){for(var c=false,d=0;d<b.fields.length;++d){var e=b.fields[d];e.possibleFillTypes=[];var f=e.input&&e.input.value;if(f){for(var g=this.prefs_.getChildNames("profile.").concat(this.prefs_.getChildNames("card.")),h=0;h<g.length;++h){var i=g[h],j=this.prefs_.getPref(i);if(j&&typeof j=="string"&&j.toLowerCase()==f.toString().toLowerCase()){i=i.split(".");if(i=(i[0]=="profile"?GTB_AutoFillProfileFieldDefs:GTB_AutoFillCreditCardFieldDefs)[i[2]].afTypes){e.possibleFillTypes=
e.possibleFillTypes.concat(i);c=true}}}e.possibleFillTypes.length==0&&e.possibleFillTypes.push(GTB_AF_FieldType.UNKNOWN_TYPE)}else e.possibleFillTypes.push(GTB_AF_FieldType.EMPTY_TYPE)}return c};
GTB_AF_PrefConverter.prototype.collectDataPresence=function(){for(var b=[],c=this.prefs_.getChildNames("profile.").concat(this.prefs_.getChildNames("card.")),d=0;d<c.length;++d){var e=c[d],f=this.prefs_.getPref(e);if(f&&typeof f=="string"){e=e.split(".");if(e=(e[0]=="profile"?GTB_AutoFillProfileFieldDefs:GTB_AutoFillCreditCardFieldDefs)[e[2]].afTypes)b=b.concat(e)}}b.indexOf(GTB_AF_FieldType.NAME_FIRST)>=0&&b.indexOf(GTB_AF_FieldType.NAME_LAST)>=0&&b.push(GTB_AF_FieldType.NAME_FULL);c="";for(d=0;d<
GTB_AF_FieldType.MAX_VALID_FIELD_TYPE;d+=32){e=0;for(f=d;f<d+32;++f){e<<=1;b.indexOf(f)>=0&&++e}e=e.toString(16);f=e.length;if(f<8)e="00000000".slice(f)+e;c+=e}return this.truncateZeros_(c)};GTB_AF_PrefConverter.prototype.truncateZeros_=function(b){for(var c=b.length-1;c;--c)if(b.charAt(c)!="0")break;return b.substring(0,c+1)};function GTB_AF_PreviewIFrame(b){this.debugZone="GTB_AF_PreviewIFrame";this.typeService_=b;this.idCount_=0;this.loadingState_=null;this.loadingStarted_=0}
GTB_AF_PreviewIFrame.prototype.show=function(b,c,d){if(b.length!=0){var e=this.loadingState_&&Date.now()-this.loadingStarted_<1E3,f=b[0].input.ownerDocument,g=c.ownerDocument;c=GTB_AF_Util.getBoundingBox(c,f,d);this.loadingState_=d=new GTB_AF_PreviewIFrameLoadState(this);this.loadingStarted_=Date.now();for(f=0;f<b.length;++f){var h=b[f].input,i=b[f].value,j=this.typeService_.getFieldInfo(h);if(j)if(i)e||(d.previewCount+=this.prepareField_(g,j,h,i,c,d));else this.hideFor_(g,j)}d.collectingFields=false;
d.showFieldsIfDone()}};GTB_AF_PreviewIFrame.prototype.loadingComplete=function(){this.loadingState_=null;this.loadingStarted_=0};function GTB_AF_PreviewIFrameLoadState(b){this.debugZone="GTB_AF_PreviewIFrame";this.preview_=b;this.elementsToShow=[];this.collectingFields=true;this.previewCount=0}
GTB_AF_PreviewIFrameLoadState.prototype.showFieldsIfDone=function(){if(!this.collectingFields&&this.previewCount==this.elementsToShow.length){for(var b=0;b<this.elementsToShow.length;++b){this.elementsToShow[b].collapsed=false;this.elementsToShow[b].parentNode.collapsed=false}this.preview_.loadingComplete(this)}};
GTB_AF_PreviewIFrameLoadState.prototype.onFrameReady=function(b,c,d){if(c){c.setAttribute("value",d.value);d=d.style;for(var e in d)c.style[e]=d[e]}(c=b&&b.parentNode)&&this.elementsToShow.push(b);this.showFieldsIfDone()};GTB_AF_PreviewIFrameLoadState.prototype.onFrameLoaded_=function(b,c){var d=c.currentTarget,e=d.contentDocument;if(e=e.getElementById("gtb-autofill-preview-input")){this.onFrameReady(d,e,b);b.target&&b.target.removeEventListener(b.event,b.handler,true)}};
GTB_AF_PreviewIFrame.prototype.prepareField_=function(b,c,d,e,f,g){var h=d.ownerDocument.defaultView,i=GTB_getWindowZoom(h,b.defaultView);i=GTB_getBoxObjectFor(d,i);f=GTB_AF_Util.adjustPosition(i,f);if(f.width<=0||f.height<=0){this.hideFor_(b,c);return 0}if(!c.preview)c.preview={};var j=c.preview;i=c=null;if(j.id)i=b.getElementById(j.id);c=i&&i.parentNode;d=h.getComputedStyle(d,null);d={fontSize:d.fontSize,fontFamily:d.fontFamily,fontStyle:d.fontStyle,fontVariant:d.fontVariant,fontWeight:d.fontWeight,
width:f.width+"px",height:f.height+"px"};if(c){b=i.contentDocument;b=b.getElementById("gtb-autofill-preview-input");g.onFrameReady(i,b,{value:e,style:d})}else{i=this.createIFrame_(b,g,e,d);j.id=i.id;c=i.parentNode}i.style.left=f.offsetX+"px";i.style.top=f.offsetY+"px";i.style.width=f.width-f.offsetX+"px";i.style.height=f.height-f.offsetY+"px";e=c.parentNode.boxObject;c.style.left=f.screenX-e.screenX+"px";c.style.top=f.screenY-e.screenY+"px";c.style.width=f.width+"px";c.style.height=f.height+"px";
return 1};
GTB_AF_PreviewIFrame.prototype.createIFrame_=function(b,c,d,e){var f=b.getElementById("main-window"),g=b.createElement("box");g.collapsed=true;b=b.createElement("iframe");b.collapsed=true;g.appendChild(b);d={value:d,style:e,target:b,event:"load"};d.handler=BindToObject(c.onFrameLoaded_,c,d);b.addEventListener(d.event,d.handler,true);b.gtbFrameState=d;b.setAttribute("src","chrome://google-toolbar/content/autofill-preview.html");f.appendChild(g);g.setAttribute("class","gtb-autofill-preview-box");b.setAttribute("class",
"gtb-autofill-preview-iframe");c=++this.idCount_;b.id="gtb-autofill-preview-"+c;g.id="gtb-autofill-preview-box-"+c;return b};GTB_AF_PreviewIFrame.prototype.hideFor_=function(b,c){var d=c.preview;if(d&&d.id){var e=null,f=b.getElementById(d.id);e=f&&f.parentNode;delete d.id;if(e&&e.parentNode){(d=f.gtbFrameState)&&f.removeEventListener(d.event,d.handler,true);e.collapsed=true;f.collapsed=true}}};
GTB_AF_PreviewIFrame.prototype.hideAll=function(b,c){GTB_AF_FormController.cleanZoomListeners_(b);if(c&&c.forms&&c.forms.length){var d=this.typeService_.getFieldsInfo(c);if(d)for(var e in d)this.hideFor_(b,d[e])}};function GTB_AF_PreviewOverlay(b){this.debugZone="GTB_AF_PreviewOverlay";this.typeService_=b;this.idCount_=0}
GTB_AF_PreviewOverlay.prototype.show=function(b,c,d){if(b.length!=0){var e=b[0].input.ownerDocument,f=c.ownerDocument;c=GTB_AF_Util.getBoundingBox(c,e,d);d=[];for(e=0;e<b.length;++e){var g=b[e].input,h=b[e].value,i=this.typeService_.getFieldInfo(g);if(i)if(h){if(i=(g=this.prepareField_(f,i,g,c))&&g.parentNode){g.value=h;d.push(i)}}else this.hideFor_(f,i)}for(e=0;e<d.length;++e)d[e].hidden=false}};
GTB_AF_PreviewOverlay.prototype.prepareField_=function(b,c,d,e){var f=GTB_getBoxObjectFor(d);e=GTB_AF_Util.adjustPosition(f,e);if(e.width<=0||e.height<=0){this.hideFor_(b,c);return null}if(!c.preview)c.preview={};var g=c.preview;f=c=null;if(g.id)f=b.getElementById(g.id);if(!f&&b.GTB_AF_previewPool&&b.GTB_AF_previewPool.length>0){f=b.GTB_AF_previewPool.pop();g.id=f.id}c=f&&f.parentNode;if(!c){f=b.getElementById("main-window");c=b.createElement("box");c.hidden=true;f.appendChild(c);c.setAttribute("class",
"gtb-autofill-preview-box");f=b.createElementNS("http://www.w3.org/1999/xhtml","input");c.appendChild(f);f.setAttribute("class","gtb-autofill-preview-input");g.id="gtb-autofill-preview-input-"+ ++this.idCount_;f.setAttribute("id",g.id)}b=d.ownerDocument.defaultView.getComputedStyle(d,null);f.style.fontSize=b.fontSize;f.style.fontFamily=b.fontFamily;f.style.fontStyle=b.fontStyle;f.style.fontVariant=b.fontVariant;f.style.fontWeight=b.fontWeight;f.style.width=e.width+"px";f.style.height=e.height+"px";
f.style.left=e.offsetX+"px";f.style.top=e.offsetY+"px";b=c.parentNode.boxObject;c.style.left=e.screenX-b.screenX+"px";c.style.top=e.screenY-b.screenY+"px";c.style.width=e.width+"px";c.style.height=e.height+"px";return f};GTB_AF_PreviewOverlay.prototype.hideFor_=function(b,c){var d=c.preview;if(d&&d.id){var e=null,f=b.getElementById(d.id);e=f&&f.parentNode;delete d.id;if(e&&e.parentNode){if(!b.GTB_AF_previewPool)b.GTB_AF_previewPool=[];b.GTB_AF_previewPool.push(f);e.hidden=true}}};
GTB_AF_PreviewOverlay.prototype.hideAll=function(b,c){GTB_AF_FormController.cleanZoomListeners_(b);if(c&&c.forms&&c.forms.length){var d=this.typeService_.getFieldsInfo(c);if(d)for(var e in d)this.hideFor_(b,d[e])}};var GTB_AF_Util={};GTB_AF_Util.IMPORT_PROFILE_MAP={firstName:"firstName",middleName:"middleName",lastName:"lastName",email:"eMail",defaultPhoneAll:"phoneNumber",addressLine1:"shippingAddr1",addressLine2:"shippingAddr2",city:"shippingCity",state:"shippingState",zipcode:"shippingZip",country:"shippingCountry",cardAddressType:"billingIsShipping",altAddressLine1:"billingAddr1",altAddressLine2:"billingAddr2",altCity:"billingCity",altState:"billingState",altZipcode:"billingZip",altCountry:"billingCountry"};
GTB_AF_Util.IMPORT_CARD_MAP={cardName:"nameOnCard",cardType:"label",cardExpMonth:"expMonth",cardExpYear:"expYear"};GTB_AF_Util.windowForDocShell=function(b){return GTB_getBrowserAndWindowFromDocShell(b).window};GTB_AF_Util.browserForDocShell=function(b){return GTB_getBrowserAndWindowFromDocShell(b).browser};
GTB_AF_Util.findBrowserForDoc=function(b,c){var d=c&&c.defaultView;if(!d)return null;d=d.top;b.getBrowserForDocument||"No tabbrowser.getBrowserForDocument, stack: "+Error().stack;return!b.getBrowserForDocument?null:b.getBrowserForDocument(d.document)};
GTB_AF_Util.GTB_AutoFillImportOldSettings=function(){var b=new G_Preferences("google.toolbar.");if(!b.getPref("autofill.imported",false))if(!(b.getPref("autofill.profiles",0)||b.getPref("autofill.cards",0))){var c=b.getPref("autofill.cc",""),d=b.getPref("AUTOFILL_Preferences","");if(d||c){var e={id:1,number:c},f={id:1};d=d.split("\n");var g=false;c=!!c;for(var h=0;h<d.length-1;h+=2){var i=d[h],j=d[h+1];if(j){var k=GTB_AF_Util.IMPORT_PROFILE_MAP[i],l=GTB_AF_Util.IMPORT_CARD_MAP[i];if(k){f[k]=j;if(i!=
"cardAddressType")g=true}else if(l){e[l]=j;c=true}}}if(g){f.isDefault=true;b.setPref("autofill.profiles",1);f.billingIsShipping=f.billingIsShipping?f.billingIsShipping=="primary":true;if(d=f.phoneNumber){d=d.replace(/\D/g,"");g=d.length-7;f.phoneNumber=d.substring(g);f.phoneArea=d.substring(g-3,g);f.phoneCountry=d.substring(0,g-3)}for(i in f)b.setPref("autofill.profile.0."+i,f[i])}f=GTB_AutoFillOptions.createCrypto();if(c&&f){e.isDefault=true;b.setPref("autofill.cards",1);c=[];if(e.number)if(d=f.decrypt("",
e.number)){e.number=d;c.push("number\u0001"+d)}else{b.setPref("autofill.ccpwd",e.number);b.setPref("autofill.imported",true);e.number="****************"}e.expMonth&&c.push("expMonth\u0001"+e.expMonth);e.expYear&&c.push("expYear\u0001"+e.expYear);if(c.length)e.data=f.encrypt("",c.join("\u0000"));for(i in e)b.setPref("autofill.card.0."+i,e[i])}b.clearPref("AUTOFILL_Preferences");b.clearPref("autofill.cc")}}};goog.exportSymbol("GTB_AF_Util.GTB_AutoFillImportOldSettings",GTB_AF_Util.GTB_AutoFillImportOldSettings);
GTB_AF_Util.GTB_AutoFillRepairIds=function(){var b=new G_Preferences("google.toolbar.autofill.");if(b.getPref("profiles",0)&&!b.getPref("profile.0.id",0)||b.getPref("cards",0)&&!b.getPref("card.0.id",0)){for(var c=b.getPref("profiles",0),d=0;d<c;++d)b.setPref("profile."+d+".id",d+1);c=b.getPref("cards",0);for(d=0;d<c;++d)b.setPref("card."+d+".id",d+1)}};goog.exportSymbol("GTB_AF_Util.GTB_AutoFillRepairIds",GTB_AF_Util.GTB_AutoFillRepairIds);
GTB_AF_Util.getBoundingBox=function(b,c,d){var e=null,f=null;if(d){e=GTB_getWindowZoom(c.defaultView,b.ownerDocument.defaultView);e=GTB_getBoxObjectFor(d,e);f=d.QueryInterface(Ci.nsIFrameLoaderOwner);f=f.frameLoader.docShell;f=f.QueryInterface(Ci.nsIInterfaceRequestor);f=f.getInterface(Ci.nsIScrollable)}else{e=GTB_AF_Util.findBrowserForDoc(b,c);e=e.boxObject;f=c.defaultView;f=f.QueryInterface(Ci.nsIInterfaceRequestor);f=f.getInterface(Ci.nsIWebNavigation);f=f.QueryInterface(Ci.nsIInterfaceRequestor);
f=f.getInterface(Ci.nsIScrollable)}d={value:false};c={value:false};f.getScrollbarVisibility(d,c);f=0;if(d.value||c.value)f=GTB_getScrollbarWidth();d=d.value?f:0;f=c.value?f:0;return{screenX:e.screenX,screenY:e.screenY,width:e.width-d,height:e.height-f}};
GTB_AF_Util.adjustPosition=function(b,c){var d={screenX:b.screenX,width:b.width,screenY:b.screenY,height:b.height,offsetX:0,offsetY:0};if(c.screenX>d.screenX){d.offsetX=d.screenX-c.screenX;d.width+=d.offsetX;d.screenX=c.screenX}var e=c.screenX+c.width;if(d.screenX+d.width>e)d.width=e-d.screenX;if(c.screenY>d.screenY){d.offsetY=d.screenY-c.screenY;d.height+=d.offsetY;d.screenY=c.screenY}e=c.screenY+c.height;if(d.screenY+d.height>e)d.height=e-d.screenY;return d};
GTB_AF_Util.getDocHost=function(b){var c=null;try{c=b.location.hostname}catch(d){}return c};var GTB_BACKOFF_TABLE={};function GTB_BackoffState(b,c,d,e,f){this.debugZone="gtb-backoff-state";this.protectionEnabled_=false;this.blockedUntil_=null;this.lastBlockDuration_=0;this.lastFailures_=[];this.firstBlockDuration_=d||6E5;this.multiplier_=e||4;this.addition_=f||0;this.maxNumFailures_=b||3;this.maxBlockTime_=c||864E5}GTB_BackoffState.registerComponentForBackoff=function(b,c,d,e,f,g){GTB_BACKOFF_TABLE[b]||(GTB_BACKOFF_TABLE[b]=new GTB_BackoffState(c,d,e,f,g));return GTB_BACKOFF_TABLE[b]};
GTB_BackoffState.registerSyncComponentForBackoff=function(){var b="tbsync";GTB_BACKOFF_TABLE[b]||(GTB_BACKOFF_TABLE[b]=new GTB_BackoffState(1,576E5,36E5,2));return GTB_BACKOFF_TABLE[b]};GTB_BackoffState.registerSuggestComponentForBackoff=function(){var b="tbsync";GTB_BACKOFF_TABLE[b]||(GTB_BACKOFF_TABLE[b]=new GTB_BackoffState(3,864E5,6E5,2,6E5));return GTB_BACKOFF_TABLE[b]};
GTB_BackoffState.prototype.registerSuccess=function(){if(this.protectionEnabled_){this.protectionEnabled_=false;this.lastFailures_=[];this.blockedUntil_=null;this.lastBlockDuration_=0}};
GTB_BackoffState.prototype.registerFailure=function(){if(this.protectionEnabled_){this.lastBlockDuration_=Math.min(this.lastBlockDuration_*(2+Math.random()*(this.multiplier_-2))+this.addition_,this.maxBlockTime_);this.blockedUntil_=new Date(Date.now()+this.lastBlockDuration_)}else{var b=Date.now(),c;for(c=0;c<this.lastFailures_.length;++c)if(b-this.lastFailures_[c].getTime()<=6E5)break;this.lastFailures_=this.lastFailures_.splice(c,this.lastFailures_.length-c);if(this.lastFailures_.length==this.maxNumFailures_-
1){this.protectionEnabled_=true;this.lastBlockDuration_=this.firstBlockDuration_;this.blockedUntil_=new Date(Date.now()+this.lastBlockDuration_)}else this.lastFailures_.push(new Date(Date.now()))}};GTB_BackoffState.prototype.isBlocked=function(){return this.protectionEnabled_&&Date.now()<this.blockedUntil_.getTime()};function GTB_BackoffedFetcher(b,c){this.debugZone="gtb-backoff-fetcher";this.component_=b;this.fetcher_=c?new G_NoAuthXMLFetcher:new G_XMLFetcher}GTB_BackoffedFetcher.prototype.blocked=function(){this.callback_({responseText:null,responseXML:null,status:999})};
GTB_BackoffedFetcher.prototype.post=function(b,c,d){var e=GTB_BACKOFF_TABLE[this.component_];e||(e=GTB_BackoffState.registerComponentForBackoff(this.component_));this.callback_=d;if(e.isBlocked())new G_Alarm(BindToObject(this.blocked,this),0);else this.fetcher_.post(b,c,BindToObject(this.checkResponse,this))};goog.exportSymbol("GTB_BackoffedFetcher.prototype.post",GTB_BackoffedFetcher.prototype.post);
GTB_BackoffedFetcher.prototype.get=function(b,c){var d=GTB_BACKOFF_TABLE[this.component_];d||(d=GTB_BackoffState.registerComponentForBackoff(this.component_));this.callback_=c;if(d.isBlocked())new G_Alarm(BindToObject(this.blocked,this),0);else this.fetcher_.get(b,BindToObject(this.checkResponse,this))};goog.exportSymbol("GTB_BackoffedFetcher.prototype.get",GTB_BackoffedFetcher.prototype.get);GTB_BackoffedFetcher.prototype.setRequestHeader=function(b,c){this.fetcher_.setRequestHeader(b,c)};
goog.exportSymbol("GTB_BackoffedFetcher.prototype.setRequestHeader",GTB_BackoffedFetcher.prototype.setRequestHeader);GTB_BackoffedFetcher.prototype.getResponseHeader=function(b){return this.fetcher_.getResponseHeader(b)};goog.exportSymbol("GTB_BackoffedFetcher.prototype.getResponseHeader",GTB_BackoffedFetcher.prototype.getResponseHeader);
GTB_BackoffedFetcher.prototype.checkResponse=function(b){!b||b.status==500||b.status==502||b.status==503?GTB_BACKOFF_TABLE[this.component_].registerFailure():GTB_BACKOFF_TABLE[this.component_].registerSuccess();this.callback_&&this.callback_(b)};goog.exportSymbol("GTB_BackoffedFetcher.prototype.checkResponse",GTB_BackoffedFetcher.prototype.checkResponse);GTB_BackoffedFetcher.createFetcherForSync=function(){GTB_BackoffState.registerSyncComponentForBackoff();return new GTB_BackoffedFetcher("tbsync")};
goog.exportSymbol("GTB_BackoffedFetcher.createFetcherForSync",GTB_BackoffedFetcher.createFetcherForSync);GTB_BackoffedFetcher.createFetcherForAutofill=function(){GTB_BackoffState.registerComponentForBackoff("autofill");return new GTB_BackoffedFetcher("autofill")};goog.exportSymbol("GTB_BackoffedFetcher.createFetcherForAutofill",GTB_BackoffedFetcher.createFetcherForAutofill);GTB_BackoffedFetcher.createFetcherForInfoQuery=function(){GTB_BackoffState.registerComponentForBackoff("info_query");return new GTB_BackoffedFetcher("info_query")};
goog.exportSymbol("GTB_BackoffedFetcher.createFetcherForInfoQuery",GTB_BackoffedFetcher.createFetcherForInfoQuery);GTB_BackoffedFetcher.createFetcherForBookmarks=function(){GTB_BackoffState.registerComponentForBackoff("bookmarks");return new GTB_BackoffedFetcher("bookmarks",true)};goog.exportSymbol("GTB_BackoffedFetcher.createFetcherForBookmarks",GTB_BackoffedFetcher.createFetcherForBookmarks);
GTB_BackoffedFetcher.createFetcherForCBFeed=function(b){b="button feed for "+b;GTB_BackoffState.registerComponentForBackoff(b);return new GTB_BackoffedFetcher(b,true)};goog.exportSymbol("GTB_BackoffedFetcher.createFetcherForCBFeed",GTB_BackoffedFetcher.createFetcherForCBFeed);GTB_BackoffedFetcher.createFetcherForSuggest=function(){GTB_BackoffState.registerSuggestComponentForBackoff();return new GTB_BackoffedFetcher("suggest")};goog.exportSymbol("GTB_BackoffedFetcher.createFetcherForSuggest",GTB_BackoffedFetcher.createFetcherForSuggest);
GTB_BackoffedFetcher.createFetcherForSpellcheck=function(){var b="spellcheck";GTB_BackoffState.registerComponentForBackoff(b);return new GTB_BackoffedFetcher(b)};goog.exportSymbol("GTB_BackoffedFetcher.createFetcherForSpellcheck",GTB_BackoffedFetcher.createFetcherForSpellcheck);var G_SelectionRangeUtils={};G_SelectionRangeUtils.WHITESPACE_REGEXP=/^(\s*)$/;
G_SelectionRangeUtils.GetValidSelectionRange=function(b){b=b.wrappedJSObject||b;var c=b.getSelection(),d=G_SelectionRangeUtils.GetSelectionRange_(b),e=null;if(d){if(!G_SelectionRangeUtils.WHITESPACE_REGEXP.test(c.toString())&&c.toString().replace(/^\s+|\s+$/g,"").length>1)return d.cloneRange();c=d.commonAncestorContainer;if(c!=null&&"getElementsByTagName"in c){c=c.getElementsByTagName("IMG");for(var f=0;f<c.length;++f){var g=b.document.createRange();g.selectNode(c[f]);if(d.compareBoundaryPoints(d.START_TO_START,
g)==-1&&d.compareBoundaryPoints(d.END_TO_END,g)==1)e=d.cloneRange();g.detach();if(e)return e}}}return e};G_SelectionRangeUtils.SerializeRange=function(b,c){if(c==null||b==null)return null;var d=b.createElement("div");d.appendChild(c.cloneContents());return d.innerHTML.replace(/^\s+|\s+$/g,"")};
G_SelectionRangeUtils.SelectionContainsNode=function(b,c){b=b.wrappedJSObject||b;var d=G_SelectionRangeUtils.GetSelectionRange_(b);if(d){var e=b.document.createRange();e.selectNode(c);return d.compareBoundaryPoints(d.START_TO_START,e)<=0&&d.compareBoundaryPoints(d.END_TO_END,e)>=0}return false};G_SelectionRangeUtils.GetSelectionRange_=function(b){b=b.getSelection();return b!=null&&b.rangeCount>0?b.getRangeAt(b.rangeCount-1):null};function GTB_Bookmark(){this.url_=this.title_="";this.timestamp_=0;this.id_="";this.isDeleted_=false;this.labels_=[]}GTB_Bookmark.splitString_=function(b,c){if(b.length<=c)return b;var d=[],e=0;do{d.push(b.substr(e,c));e+=c}while(e<b.length);return d.join(" ")};a=GTB_Bookmark.prototype;a.getTitle=function(){return this.title_};a.getUrl=function(){return this.url_};a.getTimestamp=function(){return this.timestamp_};a.getId=function(){"Bookmark without id, title = "+this.getTitle();return this.id_};
a.getLabels=function(){return this.labels_};a.isDeleted=function(){return this.isDeleted_};a.identical=function(b){return this.getUrl()==b.getUrl()&&this.getTitle()==b.getTitle()&&this.getLabels().length==b.getLabels().length&&this.getLabels().sort().join(",")==b.getLabels().sort().join(",")};
a.createFromDom=function(b){var c=GTB_Bookmark.getText("./url/text()",b);if(!c||c.substring(0,5)!="http:"&&c.substring(0,6)!="https:"&&c.substring(0,4)!="ftp:")return false;this.url_=c;var d=GTB_Bookmark.getText("./title/text()",b);this.title_=d||c.substring(c.indexOf("://")+3);this.title_=GTB_truncateWithElipsis(this.title_,50);if(!d)this.title_=GTB_Directionality.toLTR(this.title_);if(c=GTB_Bookmark.getText("./id/text()",b))this.id_=c;c=GTB_Bookmark.getText("./timestamp/text()",b);c=parseInt(c,
10);this.timestamp_=isNaN(c)?0:c/1E3;for(b=b.ownerDocument.evaluate("./labels/label/text()",b,null,Ci.nsIDOMXPathResult.ORDERED_NODE_ITERATOR_TYPE,null);c=b.iterateNext();){c=c.nodeValue;if("^k"==c)this.isDeleted_=true;else if(!c.startsWith("^")){c=GTB_truncateWithElipsis(c,60);this.labels_.push(c)}}return true};a.hasLabel=function(b){return this.labels_.indexOf(b)!=-1};a.removeLabel=function(b){b=this.labels_.indexOf(b);b!=-1&&this.labels_.splice(b,1)};
a.renameLabel=function(b,c){var d=this.labels_.indexOf(b);if(d!=-1){this.labels_.splice(d,1);this.labels_.push(c)}};a.addLabel=function(b){this.hasLabel(b)||this.labels_.push(b)};
a.makeMenuItem=function(b){var c=this.getUrl();b=b.createElement("menuitem");if(GTB_GeckoVersion.isFirefox2()){var d=GTB_Bookmark.splitString_(c,100);b.setAttribute("tooltip","gtbMultilineTooltip");b.setAttribute("gtbTooltipText",GTB_Directionality.toLTR(d))}else b.setAttribute("tooltiptext",GTB_Directionality.toLTR(c));b.setAttribute("class","menuitem-iconic");b.setAttribute("label",this.getTitle());b.setAttribute("value",c);b.setAttribute("bookmarkId",this.getId());b.setAttribute("image","chrome://google-toolbar/skin/favicon-default.png");
b.setAttribute("image-url",this.getFaviconUrl());b.setAttribute("context","gtbBookmarksMenuBookmarkContext");return b};a.getFaviconUrl=function(){var b=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);try{var c=b.newURI(this.getUrl(),null,null);if(!c.hostPort)return"chrome://google-toolbar/skin/favicon-default.png";return"http://"+c.hostPort+"/favicon.ico"}catch(d){return"chrome://google-toolbar/skin/favicon-default.png"}};
GTB_Bookmark.getText=function(b,c){var d=GTB_Bookmark.getNode_(b,c);return d&&d.nodeValue};GTB_Bookmark.getNode_=function(b,c){return c.ownerDocument.evaluate(b,c,null,Ci.nsIDOMXPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue};GTB_Bookmark.getTitleComparator=function(){return GTB_BookmarkTitleComparator};function GTB_BookmarkTitleComparator(b,c){return GTB_AlphabethicalComparator(b.title_,c.title_)}
function GTB_AlphabethicalComparator(b,c){return GTB_LocaleCompare(b.toLocaleLowerCase(),c.toLocaleLowerCase())||GTB_LocaleCompare(b,c)}GTB_Bookmark.getTimestampComparator=function(){return GTB_BookmarkTimestampComparator};function GTB_BookmarkTimestampComparator(b,c){return c.timestamp_-b.timestamp_}function GTB_BookmarkCollection(){this.debugZone="GTB_BookmarkCollection";this.idToBookmark_={};this.urlToBookmark_={};this.nameToLabel_={};this.urlToOrphanBookmark_={}}a=GTB_BookmarkCollection.prototype;
a.addBookmark=function(b){this.idToBookmark_[b.getId()]=b;var c=b.getUrl();this.urlToBookmark_[c]=b;for(var d=0,e;e=b.getLabels()[d];d++){e=this.getOrCreateLabel_(e);e.addBookmark(b)}if(b.getLabels().length==0)this.urlToOrphanBookmark_[c]=b};
a.removeBookmark=function(b){var c=this.urlToBookmark_[b];if(c){delete this.urlToBookmark_[b];delete this.idToBookmark_[c.getId()];for(var d=0;d<c.getLabels().length;d++){var e=c.getLabels()[d],f=this.nameToLabel_[e];(f=f.removeBookmark(c))&&delete this.nameToLabel_[e]}c.getLabels().length==0&&delete this.urlToOrphanBookmark_[b]}};a.getBookmarkById=function(b){return this.idToBookmark_[b]};a.isEmpty=function(){return GTB_IsEmptyMap(this.idToBookmark_)};
a.removeLabel=function(b){var c=this.nameToLabel_[b];c.removeFromBookmarks();delete this.nameToLabel_[b]};a.renameLabel=function(b,c){var d=this.nameToLabel_[b];delete this.nameToLabel_[b];d.rename(c);this.nameToLabel_[c]=d};a.getBookmarkByUrl=function(b){return this.urlToBookmark_[b]};a.getLabelByName=function(b){return this.nameToLabel_[b]};a.getAllLabels=function(){return GTB_GetMapValuesArray(this.nameToLabel_)};a.getAllBookmarks=function(){return GTB_GetMapValuesArray(this.idToBookmark_)};
a.getOrphanBookmarks=function(){return GTB_GetMapValuesArray(this.urlToOrphanBookmark_)};a.forEachBookmark=function(b){for(var c in this.idToBookmark_){var d=this.idToBookmark_[c];if(!b(d))return}};a.getOrCreateLabel_=function(b){var c=this.nameToLabel_[b];if(!c){c=new GTB_BookmarkLabel(b);this.nameToLabel_[b]=c}return c};function GTB_BookmarkLabel(b){this.debugZone="GTB_BookmarkLabel";this.name_=b||"";this.lowerName_=null;this.idToBookmark_={};this.maxTimestamp_=0}a=GTB_BookmarkLabel.prototype;
a.addBookmark=function(b){this.idToBookmark_[b.getId()]=b;this.updateMaxTimestamp_(b)};a.removeBookmark=function(b){if(!this.idToBookmark_[b.getId()])return false;var c=this.idToBookmark_[b.getId()];c=c?c.getTimestamp()==this.maxTimestamp_:false;delete this.idToBookmark_[b.getId()];if(c){this.maxTimestamp_=0;for(var d in this.idToBookmark_){b=this.idToBookmark_[d];this.updateMaxTimestamp_(b)}}return GTB_IsEmptyMap(this.idToBookmark_)};a.getAllBookmarks=function(){return GTB_GetMapValuesArray(this.idToBookmark_)};
a.containsManyBookmarks=function(){var b=0;for(var c in this.idToBookmark_){b++;if(b>1)return true}return false};a.removeFromBookmarks=function(){for(var b in this.idToBookmark_){var c=this.idToBookmark_[b];c.removeLabel(this.name_)}};a.rename=function(b){for(var c in this.idToBookmark_){var d=this.idToBookmark_[c];d.renameLabel(this.name_,b)}this.name_=b;this.lowerName_=null};a.getName=function(){return this.name_};a.getMaxTimestamp=function(){return this.maxTimestamp_};
a.updateMaxTimestamp_=function(b){this.maxTimestamp_=Math.max(this.maxTimestamp_,b.getTimestamp())};a.getLowerName=function(){if(!this.lowerName_)this.lowerName_=this.name_.toLowerCase();return this.lowerName_};function GTB_BookmarkLabelLowerNameComparator(b,c){return GTB_LocaleCompare(b.getLowerName(),c.getLowerName())}function GTB_BookmarkLabelMaxTimestampComparator(b,c){return c.maxTimestamp_-b.maxTimestamp_};GTB_BookmarksManager.TOP_SEPARATOR_ID="gtbBookmarksListMenuSeparatorTop";GTB_BookmarksManager.BOTTOM_SEPARATOR_ID="gtbBookmarksListMenuSeparatorBottom";
function GTB_BookmarksManager(b,c,d){this.debugZone="bookmarks";this.tabWatcher_=b;GTB_RegisterListener(b,"pageshow",this.onPageShowEvent_,this);GTB_RegisterListener(b,"tabswitch",this.onTabSwitch_,this);this.doc_=c;this.win_=d;this.contentArea_=c.getElementById("content");this.gaiaSettings_=this.doc_.defaultView.GTB_getToolbar().settings.gaia_;this.bookmarksService_=Cc["@google.com/toolbar/bookmarks;1"].getService().wrappedJSObject;b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);
this.stringBundle=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.observers_=[new G_ObserverServiceObserver("GTB_BOOKMARKS_UPDATE_UI",BindToObject(this.updateUI_,this))];this.updateUI_();this.bookmarksService_.networkErrorString=this.win_.networkErrorString;this.menuItemsToUpdate_=[]}a=GTB_BookmarksManager.prototype;a.shutdown=function(){for(var b=0,c=null;c=this.observers_[b];++b)c.unregister()};a.getXulElementById=function(b){return this.doc_.getElementById(b)};
a.maybeRenderBookmarksMenu=function(){var b=this.doc_.getElementById("gtbBookmarksMenuPopup");if(this.cacheHasChangedSince(b)){this.renderBookmarksMenu_();this.recordMenuTimestamp(b)}return true};a.cacheHasChangedSince=function(b){if(!b.hasAttribute("renderedAt"))return true;b=b.getAttribute("renderedAt");b=parseInt(b,10);if(isNaN(b))b=-1;return this.bookmarksService_.cacheHasChangedSince(b)};a.recordMenuTimestamp=function(b){b.setAttribute("renderedAt",Date.now())};
a.onGaiaSignIn=function(b){this.bookmarksService_.isUserSignedIn()||this.gaiaSettings_.gaiaSignIn();b.stopPropagation()};goog.exportProperty(GTB_BookmarksManager.prototype,"onGaiaSignIn",GTB_BookmarksManager.prototype.onGaiaSignIn);a=GTB_BookmarksManager.prototype;a.isEnabled_=function(){if(!this.bookmarksService_.isEnabled())return false;var b=this.doc_.getElementById("gtbBookmarks");return!!b&&GTB_isToolbarVisible(b.parentNode)};a.onToolbarVisibilityChanged=function(){this.updateUI_()};
a.updateUI_=function(){var b=this.doc_.getElementById("gtbBookmarksMenuPopup");b&&b.parentNode.open&&this.maybeRenderBookmarksMenu();this.updateStarAndMenuForCurrentPage_()};a.updateStarAndMenuForCurrentPage_=function(){this.isEnabled_()&&this.bookmarksService_.isUserSignedIn()?this.setLoggedInUIState_():this.setLoggedOutUIState_()};
a.renderBookmarksMenu_=function(){this.clearBookmarks_();var b=this.bookmarksService_.downloadState;switch(b){case "waiting":this.updateBookmarksMenuItems_(GTB_BookmarksManager.WAITING_ITEMS);break;case "failed":this.updateBookmarksMenuItems_(GTB_BookmarksManager.FAILURE_ITEMS);break;case "end":if(this.bookmarksService_.isUserSignedIn()){this.renderBookmarksMenuLoggedIn_();break}default:this.updateBookmarksMenuItems_(GTB_BookmarksManager.LOGGED_OUT_ITEMS)}};GTB_BookmarksManager.WAITING_ITEMS=["gtbBookmarksWaiting"];
GTB_BookmarksManager.FAILURE_ITEMS=["gtbBookmarksFailure","gtbBookmarksRefresh"];GTB_BookmarksManager.LOGGED_IN_ITEMS=["gtbBookmarkAllTabs","gtbManageBookmarks","gtbBookmarksListMenuSeparatorBottom","gtbBookmarksRefresh","gtbBookmarksImport"];GTB_BookmarksManager.LOGGED_OUT_ITEMS=["gtbBookmarksSignIn"];a=GTB_BookmarksManager.prototype;
a.renderBookmarksMenuLoggedIn_=function(){this.updateBookmarksMenuItems_(GTB_BookmarksManager.LOGGED_IN_ITEMS);var b=this.contentArea_.contentDocument.location.href;b=this.bookmarksService_.isPageABookmark(b);this.updateMenu_(b);this.loadBookmarks_()};a.updateBookmarksMenuItems_=function(b){this.hideAllBookmarksMenuItems_();for(var c=0;c<b.length;c++){var d=this.doc_.getElementById(b[c]);d.hidden=false}};
a.hideAllBookmarksMenuItems_=function(){var b=this.doc_.getElementById("gtbBookmarksMenuPopup");for(b=b.firstChild;b;){b.hidden=true;b=b.nextSibling}};a.setLoggedInUIState_=function(){var b=this.contentArea_.contentDocument.location.href;b=this.bookmarksService_.isPageABookmark(b);this.updateButton_(b);this.updateMenu_(b);b=this.doc_.getElementById("gtbBookmarksMenu");var c=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.menu.tooltiptext");b.setAttribute("tooltiptext",c)};
a.setLoggedOutUIState_=function(){var b=this.doc_.getElementById("gtbBookmarkstar");if(b){this.updateButton_(false);var c=this.doc_.getElementById("gtbBookmarksMenu"),d=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.signin.tooltiptext");b.setAttribute("tooltiptext",d);c.setAttribute("tooltiptext",d);if(this.bookmarksService_.doGaiaLogin){this.bookmarksService_.doGaiaLogin=false;this.gaiaSettings_.gaiaSignIn()}}};
a.onBookmark=function(b,c){if(this.bookmarksService_.isUserSignedIn()){if(this.ensureOnline_()){var d=this.contentArea_.contentDocument.location.href,e=this.contentArea_.contentWindow.document.title;e=e.trim();var f=this.doc_.commandDispatcher.focusedWindow;G_SelectionRangeUtils.GetValidSelectionRange(f);f=c||[];(d=this.createAddBookmarkAction_(d,e,f))&&d.start();b.stopPropagation()}}else this.gaiaSettings_.gaiaSignIn()};goog.exportProperty(GTB_BookmarksManager.prototype,"onBookmark",GTB_BookmarksManager.prototype.onBookmark);
GTB_BookmarksManager.prototype.ensureOnline_=function(){if(GTB_IsOnline())return true;var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService),c=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");b=c.GetStringFromName("prop.gtb.bookmarks.offline.title");c=c.GetStringFromName("prop.gtb.bookmarks.offline.message");alert(c,b);return false};
GTB_BookmarksManager.prototype.showAddedBookmarkTooltip_=function(b){var c=this.doc_.getElementById("gtbBookmarkstar");b=GTB_truncateWithElipsis(b,50);b=this.stringBundle.formatStringFromName("prop.gtb.bookmarks.addedbookmark.tooltiptext",[b],1);this.win_.GTB_TT_XULTooltipAlert(c,b,false)};GTB_BookmarksManager.prototype.validateLabelsArray_=function(b){if(!b)return[];if(!b.every(this.checkValidLabelName_,this))return null;return b=b.filter(function(c){return c.trim().length>0})};
GTB_BookmarksManager.prototype.addBookmarksOnMenu_=function(){var b=this.doc_.getElementById("gtbBookmarksMenuPopup"),c=this.doc_.getElementById(GTB_BookmarksManager.BOTTOM_SEPARATOR_ID),d=GTB_BookmarksManager.TOP_SEPARATOR_ID,e=this.bookmarksService_.getSortPref();e=this.bookmarksService_.getLabels(e);var f=this.bookmarksService_.getNoLabelBookmarks();if(e.length==0&&f.length==0)d&&this.createMenuSeparator_(d,null);else{if(e.length>0){this.createMenuSeparator_(d,this.stringBundle.GetStringFromName("prop.gtb.bookmarks.separator.labels"));
d=null}for(var g=0,h;h=e[g];++g){h=this.createLabelMenu_(h);b.insertBefore(h,c)}f.length>0&&this.createMenuSeparator_(d,null);this.menuItemsToUpdate_=[];this.populateMenu_(b,f,c)}};GTB_BookmarksManager.FAVICON_REQUESTS_PER_SEC=200;GTB_BookmarksManager.FAVICON_BATCHES_PER_SEC=20;
GTB_BookmarksManager.prototype.populateMenu_=function(b,c,d){for(var e=[],f=0,g;g=c[f];f++){g=g.makeMenuItem(this.doc_);e.push(g);b.insertBefore(g,d)}this.menuItemsToUpdate_=e.concat(this.menuItemsToUpdate_);if(this.menuItemsToUpdate_.length&&!this.daemon){b=1E3/GTB_BookmarksManager.FAVICON_BATCHES_PER_SEC;c=Math.max(1,Math.round(GTB_BookmarksManager.FAVICON_REQUESTS_PER_SEC/GTB_BookmarksManager.FAVICON_BATCHES_PER_SEC));this.daemon=new G_Alarm(BindToObject(this.fetchFavicons_,this,c),b,true)}};
GTB_BookmarksManager.prototype.fetchFavicons_=function(b){b=Math.min(b,this.menuItemsToUpdate_.length);for(var c=0;c!=b;c++){var d=this.menuItemsToUpdate_[c];d.setAttribute("image",d.getAttribute("image-url"))}this.menuItemsToUpdate_.splice(0,b);if(!this.menuItemsToUpdate_.length&&this.daemon){this.daemon.cancel();this.daemon=null}};
GTB_BookmarksManager.prototype.onBookmarkThisPage=function(b){this.hidePopups();if(this.ensureOnline_()){var c=this.contentArea_.contentDocument.location.href;if(GTB_LooksLikeUrl(c)){var d=this.contentArea_.contentWindow.document.title,e=this.bookmarksService_.getFaviconUrl(c),f=this.doc_.commandDispatcher.focusedWindow;c=new GTB_EditNewBookmarkController(d,e,c,this);f=this.contentArea_.contentWindow;f.openDialog("chrome://google-toolbar/content/bookmarks-edit.xul","gtbBookmarksEditDialog","modal,centerscreen,chrome,resizable=no",
c);b.stopPropagation()}else this.onInvalidBookmarkUrl()}};goog.exportProperty(GTB_BookmarksManager.prototype,"onBookmarkThisPage",GTB_BookmarksManager.prototype.onBookmarkThisPage);
GTB_BookmarksManager.prototype.onBookmarkAllTabs=function(b){if(this.ensureOnline_()){for(var c=this.tabWatcher_.getTabBrowser().browsers,d=0;d<c.length;d++){var e=c[d].contentDocument.location.href;if(!GTB_LooksLikeUrl(e)){this.onInvalidBookmarkUrl();return}}c=new GTB_BookmarkAllTabsController(this);this.openRenameDialog_(c);b.stopPropagation()}};goog.exportProperty(GTB_BookmarksManager.prototype,"onBookmarkAllTabs",GTB_BookmarksManager.prototype.onBookmarkAllTabs);
GTB_BookmarksManager.prototype.hidePopups=function(){this.doc_.getElementById("gtbBookmarksMenuPopup").hidePopup();this.doc_.getElementById("gtbChevronMenu").hidePopup();this.doc_.getElementById("gtbBookmarkstarPopup").hidePopup()};GTB_BookmarksManager.prototype.onEditBookmarkFromContextMenu=function(b){var c=this.getBookmarkByMenuitem_(this.doc_.popupNode);this.hidePopups();if(this.ensureOnline_()){this.showEditBookmarkDialog_(c);b.stopPropagation()}};
goog.exportProperty(GTB_BookmarksManager.prototype,"onEditBookmarkFromContextMenu",GTB_BookmarksManager.prototype.onEditBookmarkFromContextMenu);GTB_BookmarksManager.prototype.onEditBookmark=function(b){if(this.ensureOnline_()){var c=this.contentArea_.contentDocument.location.href;if(GTB_LooksLikeUrl(c)){c=this.bookmarksService_.getBookmarkByUrl(c);this.showEditBookmarkDialog_(c);b.stopPropagation()}else this.onInvalidBookmarkUrl()}};
goog.exportProperty(GTB_BookmarksManager.prototype,"onEditBookmark",GTB_BookmarksManager.prototype.onEditBookmark);GTB_BookmarksManager.prototype.showEditBookmarkDialog_=function(b){if(b){b=new GTB_EditExistingBookmarkController(b,this);var c=this.contentArea_.contentWindow;c.openDialog("chrome://google-toolbar/content/bookmarks-edit.xul","gtbBookmarksEditDialog","modal,centerscreen,chrome,resizable=no",b)}};
GTB_BookmarksManager.prototype.onRemoveBookmark=function(b){b.stopPropagation();if(b.target.id=="gtbBookmarksMenuBookmarkContextRemove"){b=this.getBookmarkByMenuitem_(this.doc_.popupNode);this.hidePopups()}else{b=this.contentArea_.contentDocument.location.href;b=this.bookmarksService_.getBookmarkByUrl(b)}if(this.ensureOnline_())if(b){b=new GTB_BookmarkRemoveWarningController(b,this);this.openRemoveWarningDialog_(b)}};goog.exportProperty(GTB_BookmarksManager.prototype,"onRemoveBookmark",GTB_BookmarksManager.prototype.onRemoveBookmark);
GTB_BookmarksManager.prototype.getBookmarkByMenuitem_=function(b){b=b.getAttribute("bookmarkId");return this.bookmarksService_.getBookmarkById(b)||null};GTB_BookmarksManager.prototype.onManageBookmarks=function(b){var c="http://www.google.com/bookmarks/?hl={LANG}".replace("{LANG}",GTB_getLangCode());this.win_.openUILink(c,b);b.stopPropagation()};goog.exportProperty(GTB_BookmarksManager.prototype,"onManageBookmarks",GTB_BookmarksManager.prototype.onManageBookmarks);
GTB_BookmarksManager.prototype.onOpenBookmark=function(b){var c=this.getBookmarkByMenuitem_(b.target);c=c.getUrl();this.win_.openUILink(c,b);b.stopPropagation()};goog.exportProperty(GTB_BookmarksManager.prototype,"onOpenBookmark",GTB_BookmarksManager.prototype.onOpenBookmark);
GTB_BookmarksManager.prototype.onOpenBookmarksInTabs=function(b){b.stopPropagation();for(b=b.target.previousSibling;b&&b.nodeName!="menuseparator";)b=b.previousSibling;if(b){for(var c=b;c.previousSibling&&c.previousSibling.nodeName=="menuitem";)c=c.previousSibling;for(;c!=b;){var d=this.getBookmarkByMenuitem_(c).getUrl();this.win_.openUILinkIn(d,"tab");c=c.nextSibling}}};goog.exportProperty(GTB_BookmarksManager.prototype,"onOpenBookmarksInTabs",GTB_BookmarksManager.prototype.onOpenBookmarksInTabs);
GTB_BookmarksManager.prototype.onOpenInNewTabOrWindow=function(b,c){var d=this.getBookmarkByMenuitem_(this.doc_.popupNode);d=d.getUrl();this.win_.openUILinkIn(d,c);this.hidePopups();b.stopPropagation()};goog.exportProperty(GTB_BookmarksManager.prototype,"onOpenInNewTabOrWindow",GTB_BookmarksManager.prototype.onOpenInNewTabOrWindow);a=GTB_BookmarksManager.prototype;a.doAddNewBookmark=function(b,c,d){(b=this.createAddBookmarkAction_(b,c,d))&&b.startSoon()};
a.createAddBookmarkAction_=function(b,c,d){if(this.bookmarksService_.isBeingBookmarked(b))return null;this.bookmarksService_.setBeingBookmarked(b,true);c=this.createBasicEditData_(b,c,d);if(!c)return null;c=new GTB_BookmarksAction(this,c);c.addCallback(BindToObject(this.bookmarksService_.setBeingBookmarked,this.bookmarksService_,b,false));return c};a.doEditExistingBookmark=function(b,c,d){(b=this.createAddBookmarkAction_(b.getUrl(),c,d))&&b.startSoon()};
a.createBasicEditData_=function(b,c,d){if(!GTB_LooksLikeUrl(b)){this.onInvalidBookmarkUrl();return null}d=this.validateLabelsArray_(d);if(d==null)return null;d=d.join(",");c||(c=b);return b="bkmk={URL}&title={TITLE}&labels={LABELS}&zx={RAND}".replace("{URL}",encodeURIComponent(b)).replace("{TITLE}",encodeURIComponent(c)).replace("{LABELS}",encodeURIComponent(d))};a.doRemoveBookmark=function(b){b=this.removeBookmarkOnServer_(b);b.startSoon()};
a.removeBookmarkOnServer_=function(b){var c=Math.floor(Math.random()*32768);b="dlq={BOOKMARK_ID}&op=remove&zx={RAND}".replace("{BOOKMARK_ID}",b.getId()).replace("{RAND}",c);return new GTB_BookmarksAction(this,b)};a.onRefreshBookmarks=function(b){if(this.ensureOnline_()){this.bookmarksService_.downloadState=="failed"?this.bookmarksService_.downloadServerBookmark():this.bookmarksService_.downloadServerBookmarkDiff();b.stopPropagation()}};
goog.exportProperty(GTB_BookmarksManager.prototype,"onRefreshBookmarks",GTB_BookmarksManager.prototype.onRefreshBookmarks);GTB_BookmarksManager.prototype.onImportBookmarks=function(b){var c=new GTB_FirefoxBookmarkImporter(this.bookmarksService_),d=this.doc_.defaultView;c.importBookmarks(d);b.stopPropagation()};goog.exportProperty(GTB_BookmarksManager.prototype,"onImportBookmarks",GTB_BookmarksManager.prototype.onImportBookmarks);
GTB_BookmarksManager.prototype.onRenameLabel=function(b){this.hidePopups();if(this.ensureOnline_()){var c=this.doc_.popupNode.getAttribute("label");c=new GTB_BookmarksRenameLabelController(c,this);this.openRenameDialog_(c);b.stopPropagation()}};goog.exportProperty(GTB_BookmarksManager.prototype,"onRenameLabel",GTB_BookmarksManager.prototype.onRenameLabel);
GTB_BookmarksManager.prototype.doRenameLabel=function(b,c){c=c.trim();if(this.checkValidLabelName_(c)){var d=this.bookmarksService_.getValidatedLabelName(c);if(d.toLowerCase()!=b.toLowerCase())c=d;if(c!=b)if(c=="")new G_Alarm(BindToObject(this.showRemoveLabelWarning_,this,b),0);else{d=this.renameLabelOnServer_(b,c);d.startSoon()}}};
GTB_BookmarksManager.prototype.doBookmarkAllTabs=function(b){b=b.trim();if(this.checkValidLabelName_(b)){b=this.bookmarksService_.getValidatedLabelName(b);for(var c=null,d=new GTB_BookmarksActions,e=this.tabWatcher_.getTabBrowser().browsers,f=0;f<e.length;f++){c=e[f].contentDocument.location.href;var g=e[f].contentDocument.title,h=[];b&&h.push(b);var i=this.bookmarksService_.getBookmarkByUrl(c);if(i){h=h.concat(i.getLabels());c=this.createBasicEditData_(i.getUrl(),i.getTitle(),h);c=c!==null?new GTB_BookmarksAction(this,
c):null}else c=this.createAddBookmarkAction_(c,g,h);c&&d.add(c)}d.startSoon()}};GTB_BookmarksManager.prototype.renameLabelOnServer_=function(b,c){b=encodeURIComponent(b);c=encodeURIComponent(c);var d=Math.floor(Math.random()*32768),e=this.bookmarksService_.getAuthToken();d="op=modlabel&labels={OLD_LABEL},{NEW_LABEL}&zx={RAND}".replace("{TOKEN}",e).replace("{OLD_LABEL}",b).replace("{NEW_LABEL}",c).replace("{RAND}",d);return new GTB_BookmarksAction(this,d)};
GTB_BookmarksManager.prototype.onRemoveLabel=function(b){this.hidePopups();if(this.ensureOnline_()){var c=this.doc_.popupNode.getAttribute("label");this.showRemoveLabelWarning_(c);b.stopPropagation()}};goog.exportProperty(GTB_BookmarksManager.prototype,"onRemoveLabel",GTB_BookmarksManager.prototype.onRemoveLabel);a=GTB_BookmarksManager.prototype;a.showRemoveLabelWarning_=function(b){b=new GTB_BookmarksRemoveLabelWarningController(b,this,this.bookmarksService_);this.openRemoveWarningDialog_(b)};
a.openRemoveWarningDialog_=function(b){var c=this.contentArea_.contentWindow;c.openDialog("chrome://google-toolbar/content/bookmarks-remove-warning.xul","gtbBookmarksRemoveLabelWarning","modal,centerscreen,chrome,resizable=no",b)};a.openRenameDialog_=function(b){var c=this.contentArea_.contentWindow;c.openDialog("chrome://google-toolbar/content/bookmarks-rename-dialog.xul","gtbBookmarksRenameDialog","modal,centerscreen,chrome,resizable=no",b)};
a.doRemoveLabel=function(b){b=this.renameLabelOnServer_(b,"");b.startSoon()};
a.onApplyRemoveLabel=function(b){if(this.ensureOnline_()){var c=b.target,d=c.getAttribute("checked");c=c.value;var e=this.contentArea_.contentDocument.location.href;if(e=this.bookmarksService_.getBookmarkByUrl(e)){var f=e.getTitle(),g=[].concat(e.getLabels());if(!d&&e.hasLabel(c))g.splice(g.indexOf(c),1);else d&&!e.hasLabel(c)&&g.push(c);d=this.createAddBookmarkAction_(e.getUrl(),f,g);d.start();b.stopPropagation()}else this.onBookmark(b,[c])}};
goog.exportProperty(GTB_BookmarksManager.prototype,"onApplyRemoveLabel",GTB_BookmarksManager.prototype.onApplyRemoveLabel);
GTB_BookmarksManager.prototype.onNewLabel=function(b){this.hidePopups();if(this.ensureOnline_()){var c=this.contentArea_.contentDocument.location.href;c=this.bookmarksService_.getBookmarkByUrl(c);c=new GTB_BookmarkAddLabelController(c,this);var d=this.contentArea_.contentWindow;d.openDialog("chrome://google-toolbar/content/bookmarks-edit.xul","gtbBookmarksEditDialog","modal,centerscreen,chrome,resizable=no",c);b.stopPropagation()}};goog.exportProperty(GTB_BookmarksManager.prototype,"onNewLabel",GTB_BookmarksManager.prototype.onNewLabel);
a=GTB_BookmarksManager.prototype;a.onInvalidBookmarkUrl=function(){var b=this.contentArea_.contentWindow;b.openDialog("chrome://google-toolbar/content/bookmarks-invalidUrl-warning.xul","gtbBookmarksInvalidUrlWarning","modal,centerscreen,chrome,resizable=no")};a.onPageShowEvent_=function(){this.onForegroundPageChanged_()};a.onForegroundPageChanged_=function(){this.isEnabled_()&&this.bookmarksService_.isUserSignedIn()&&this.setLoggedInUIState_()};a.onTabSwitch_=function(){this.onForegroundPageChanged_()};
a.updateButton_=function(b){if(this.isEnabled_()){var c=this.doc_.getElementById("gtbBookmarkstar");this.doc_.getElementById("gtbBookmarkstarBookmarkThisPage").hidden=b;this.doc_.getElementById("gtbBookmarkstarEditThisBookmark").hidden=!b;this.doc_.getElementById("gtbBookmarkstarRemoveThisBookmark").hidden=!b;if(b){c.setAttribute("type","menu");c.removeAttribute("oncommand");c.setAttribute("color","yellow");c.setAttribute("tooltiptext",this.stringBundle.GetStringFromName("prop.gtb.bookmarks.star.on.tooltiptext"))}else{c.setAttribute("type",
"button");c.setAttribute("oncommand","GTB_getToolbar().bookmarksManager.onBookmark(event);");c.setAttribute("color","transparent");c.setAttribute("tooltiptext",this.stringBundle.GetStringFromName("prop.gtb.bookmarks.star.off.tooltiptext"))}}};
a.updateMenu_=function(b){if(this.isEnabled_()){var c=this.tabWatcher_.getTabBrowser().browsers;c=c.length<=1;this.doc_.getElementById("gtbBookmarkstarBookmarkAllTabs").hidden=c;this.doc_.getElementById("gtbBookmarkAllTabs").hidden=c;this.doc_.getElementById("gtbBookmarkThisPage").hidden=b;this.doc_.getElementById("gtbEditThisBookmark").hidden=!b;this.doc_.getElementById("gtbRemoveThisBookmark").hidden=!b;c=this.bookmarksService_.getLabels("alpha");c=c.length==0;this.doc_.getElementById("gtbBookmarksLabelListMenuSeparatorTop").hidden=
c;var d=this.doc_.getElementById("gtbBookmarkstarApplyRemoveLabel");d.hidden=c;if(!c)if(b){d.setAttribute("label",this.stringBundle.GetStringFromName("prop.gtb.bookmarks.applyremovelabel.label"));d.setAttribute("tooltiptext",this.stringBundle.GetStringFromName("prop.gtb.bookmarks.applyremovelabel.tooltiptext"))}else{d.setAttribute("label",this.stringBundle.GetStringFromName("prop.gtb.bookmarks.applylabel.label"));d.setAttribute("tooltiptext",this.stringBundle.GetStringFromName("prop.gtb.bookmarks.applylabel.tooltiptext"))}}};
a.onBookmarkstarPopup=function(b){if(!this.bookmarksService_.isUserSignedIn())return false;this.loadLabels_();var c=this.contentArea_.contentDocument.location.href,d=this.bookmarksService_.isPageABookmark(c);c=this.bookmarksService_.getBookmarkByUrl(c);if(d&&c){c=c.getLabels();for(var e=0;e<c.length;e++)this.checkLabel_(c[e])}c=this.doc_.getElementById("gtbBookmarkstarNewLabel");c.setAttribute("disabled",!d);if(b.target.id=="gtbBookmarkstarContext"){d=this.doc_.getElementById("gtbBookmarkstarPopup");
this.copyMenuContents_(d,b.target)}b.stopPropagation();return true};goog.exportProperty(GTB_BookmarksManager.prototype,"onBookmarkstarPopup",GTB_BookmarksManager.prototype.onBookmarkstarPopup);a=GTB_BookmarksManager.prototype;a.copyMenuContents_=function(b,c){for(;c.firstChild;)c.removeChild(c.firstChild);for(var d=b.firstChild;d;d=d.nextSibling){var e=d.cloneNode(true);e.id=null;c.appendChild(e)}};
a.checkLabel_=function(b){var c=this.doc_.getElementById("gtbBookmarkstarPopup");if(c){b=c.getElementsByAttribute("value",b);b.length>0&&b[0].setAttribute("checked","true")}};a.loadBookmarks_=function(){this.bookmarksService_.hasBookmarks()&&this.addBookmarksOnMenu_()};
a.clearBookmarks_=function(){var b=this.doc_.getElementById(GTB_BookmarksManager.BOTTOM_SEPARATOR_ID),c=this.doc_.getElementById(GTB_BookmarksManager.TOP_SEPARATOR_ID);if(c){for(var d=b.parentNode;c.nextSibling!=b;)d.removeChild(c.nextSibling);d.removeChild(c)}};
a.loadLabels_=function(){this.clearLabels_();var b=this.doc_.getElementById("gtbBookmarksLabelListMenuSeparatorBottom");if(b){var c=this.bookmarksService_.getLabels("alpha");if(c.length==0){this.doc_.getElementById("gtbBookmarksLabelListMenuSeparatorTop").hidden=true;this.doc_.getElementById("gtbBookmarkstarApplyRemoveLabel").hidden=true}else for(var d=b.parentNode,e=0;e<c.length;e++){var f=this.doc_.createElement("menuitem");f.setAttribute("type","checkbox");f.setAttribute("label",c[e].getName());
f.setAttribute("value",c[e].getName());f.setAttribute("checked","false");f.setAttribute("oncommand","GTB_getToolbar().bookmarksManager.onApplyRemoveLabel(event);");d.insertBefore(f,b)}}};a.clearLabels_=function(){var b=this.doc_.getElementById("gtbBookmarkstarApplyRemoveLabel"),c=this.doc_.getElementById("gtbBookmarksLabelListMenuSeparatorBottom");if(b)for(var d=b.parentNode;b.nextSibling!=c;)d.removeChild(b.nextSibling)};
a.createLabelMenu_=function(b){var c=this.doc_.createElement("menupopup");c.setAttribute("labelName",b.getName());c.setAttribute("onpopupshowing","GTB_getToolbar().bookmarksManager.onLabelPopupShowing(event)");var d=this.doc_.createElement("menu");d.setAttribute("label",b.getName());d.appendChild(c);d.id="gtbBookmarksLabelId-"+b.getName();d.setAttribute("context","gtbBookmarksMenuLabelContext");return d};
a.addOpenInTabsMenuItem_=function(b,c){var d=this.createOpenInTabsMenuItem_(c>1);b.appendChild(d);d.setAttribute("oncommand","GTB_getToolbar().bookmarksManager.onOpenBookmarksInTabs(event);")};
a.createOpenInTabsMenuItem_=function(b){var c=this.doc_.createElement("menuitem"),d;if(b){b=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.openall.label");d=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.openall.tooltiptext")}else{b=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.openinnewtab.label");d=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.openinnewtab.tooltiptext")}c.setAttribute("label",b);c.setAttribute("tooltiptext",d);return c};
a.createMenuSeparator_=function(b,c){var d;if(c){d=this.doc_.createElement("hbox");d.setAttribute("disabled","true");d.setAttribute("align","center");d.id=b;var e=this.doc_.createElement("menuseparator");e.setAttribute("flex","1");d.appendChild(e);e=this.doc_.createElement("label");e.setAttribute("value",c);d.appendChild(e);if(!IsPlatformVista()){e=this.doc_.createElement("menuseparator");e.setAttribute("flex","1");d.appendChild(e)}}else d=this.doc_.createElement("menuseparator");if(b)d.id=b;e=this.doc_.getElementById(GTB_BookmarksManager.BOTTOM_SEPARATOR_ID);
e.parentNode.insertBefore(d,e)};a.findLabelOnMenu_=function(b){var c=this.doc_.getElementById("gtbBookmarksLabelId-"+b);if(!c)return null;if(c.getAttribute("label")!=b)return null;return c};a.onLabelPopupShowing=function(b){b=b.target;if(this.cacheHasChangedSince(b)){var c=b.getAttribute("labelName");c=this.bookmarksService_.getSortedBookmarksByLabel(c);var d=this.doc_.createElement("menuseparator");b.appendChild(d);this.populateMenu_(b,c,d);this.addOpenInTabsMenuItem_(b,c.length);this.recordMenuTimestamp(b)}};
goog.exportProperty(GTB_BookmarksManager.prototype,"onLabelPopupShowing",GTB_BookmarksManager.prototype.onLabelPopupShowing);
GTB_BookmarksManager.prototype.checkValidLabelName_=function(b){if(b.charAt(0)=="^"){b=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.invalidlabel.title");var c=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.invalidlabel.description");alert(c,b);return false}else if(b.search(",")!=-1){b=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.invalidlabel.title");c=this.stringBundle.GetStringFromName("prop.gtb.bookmarks.invalidlabelcomma.description");alert(c,b);return false}return true};GTB_BookmarksService.BOOKMARKS_ENABLED_PREF="google.toolbar.button_option.gtbBookmarks";GTB_BookmarksService.SORT_PREF="google.toolbar.bookmarks.sort";function GTB_BookmarksService(){this.debugZone="bookmarks-service";this.bookmarkCollection_=new GTB_BookmarkCollection;this.clientTimestamp_=this.maxTimeStamp_=0;this.prefs_=null;this.wrappedJSObject=this;this.actionWaitingOnAuth_=null;this.doGaiaLogin=false;this.authToken_=null;this.beingBookmarked_={}}a=GTB_BookmarksService.prototype;
a.init=function(){this.gaiaService_=Cc["@google.com/toolbar/gaia-service;1"].getService().wrappedJSObject;this.observerService_=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);this.observers_=[new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.onCustomized_,this),false),new G_ObserverServiceObserver("gaia-signin-change",BindToObject(this.onGaiaStatusChange,this)),new G_ObserverServiceObserver("gaia-email-change",BindToObject(this.onGaiaEmailChange,
this))];this.prefs_=new G_Preferences(null,false,true);this.prefs_.addObserver(GTB_BookmarksService.BOOKMARKS_ENABLED_PREF,BindToObject(this.onEnabledPrefChanged_,this));this.prefs_.addObserver(GTB_BookmarksService.SORT_PREF,BindToObject(this.onSortPrefChanged_,this));this.sortPref_=GTB_getPrefWithLocaleDefault(GTB_BookmarksService.SORT_PREF);var b=this.isEnabled()&&this.isUserSignedIn();this.downloadState="begin";b&&new G_Alarm(BindToObject(this.downloadServerBookmark,this),3E3);this.wasEnabledAndSignedIn_=
b;this.handlingPrefChange_=false;b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.suggestComment_=b.GetStringFromName("google-suggest.bookmarks");this.networkErrorTitle_=b.GetStringFromName("prop.gtb.bookmarks.invalidlabel.title");this.networkErrorString="";this.winWatcher_=Cc["@mozilla.org/embedcomp/window-watcher;1"].getService(Ci.nsIWindowWatcher);this.winWatcher_.registerNotification(this);
this.managerShowingUsage=null};a.observe=function(b,c){if("domwindowclosed"==c&&b.GTB_getToolbar){var d=b.GTB_getToolbar()._getCurrentWindow().name;if("gtbOptionsMore-bmmenu"==d&&this.onIntroClose){this.onIntroClose();this.onIntroClose=null}}};a.QueryInterface=function(b){if(b.equals(Ci.nsIObserver)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};a.showNetworkError=function(){alert(this.networkErrorString,this.networkErrorTitle_)};
a.shutdown=function(){for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.winWatcher_.unregisterNotification(this)};a.isUserSignedIn=function(){return this.gaiaService_.gaiaIsSignedIn()};a.onGaiaEmailChange=function(){if(this.isEnabled()&&this.isUserSignedIn()){this.actionWaitingOnAuth_&&Date.now()<this.actionWaitingOnAuthExpiration_&&this.actionWaitingOnAuthUser_==this.gaiaService_.gaiaUserEmail()&&this.actionWaitingOnAuth_.startSoon();this.actionWaitingOnAuth_=null}};
a.onGaiaStatusChange=function(){if(this.isEnabled()&&this.isUserSignedIn())this.downloadServerBookmark();else{this.clear_();this.notifyBookmarksUpdated_()}};a.notifyBookmarksUpdated_=function(){this.observerService_&&this.observerService_.notifyObservers(null,"GTB_BOOKMARKS_UPDATE_UI",null)};
a.downloadServerBookmarkDiff=function(){if(this.isEnabled()&&this.isUserSignedIn()){var b=GTB_BackoffedFetcher.createFetcherForBookmarks(),c=BindToObject(this.handleResponse_,this,true),d=Math.ceil(1E3*this.maxTimeStamp_),e=Math.floor(Math.random()*32768);d="https://www.google.com/bookmarks/?output=xml&num=2000&min={TIMESTAMP}&all=1&zx={RAND}".replace("{TIMESTAMP}",d).replace("{RAND}",e);GTB_OverrideUserAgent(BindToObject(b.get,b,d,c))}};
a.downloadServerBookmark=function(){this.downloadState="waiting";this.markCacheChanged_();this.notifyBookmarksUpdated_();var b=GTB_BackoffedFetcher.createFetcherForBookmarks(),c=BindToObject(this.handleResponse_,this,false),d=Math.floor(Math.random()*32768);d="https://www.google.com/bookmarks/?output=xml&num=2000&zx={RAND}".replace("{RAND}",d);GTB_OverrideUserAgent(BindToObject(b.get,b,d,c))};
a.handleTokenUpdated_=function(b,c){if(c==200)b.call(this);else c==401?this.handleUnauthorizedResponse_():this.bookmarksDownloadFailed_()};a.getAuthToken=function(){return this.authToken_};a.handleTokenDownloaded_=function(b,c){var d=-1;if(c&&c.responseText&&c.status==200)if(d=/^\/\*(.+)\*\/$/.exec(c.responseText)){this.authToken_=d[1];d=c.status}else{this.authToken_=null;d=-c.status}else{if(c&&goog.isDef(c.status))d=c.status;this.authToken_=null}b(d,this.authToken_)};
a.handleResponse_=function(b,c){if(c&&c.status==401)this.handleUnauthorizedResponse_();else if(c&&c.status==403)this.handleUnauthorizedResponse_();else{var d=null;if(c&&c.status==200){d=c.responseXML?c.responseXML:Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromString(c.responseText,"text/xml");if(G_FirefoxXMLUtils.isParserError(d))d=null}if(d){this.extractResponse_(d.documentElement,b);this.downloadState="end";this.markCacheChanged_();this.notifyBookmarksUpdated_()}else b?
this.showNetworkError():this.bookmarksDownloadFailed_()}};a.handleUnauthorizedResponse_=function(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getMostRecentWindow("navigator:browser");b.GTB_getToolbar().settings.gaia_.gaiaSignOut();this.doGaiaLogin=true};a.bookmarksDownloadFailed_=function(){this.downloadState="failed";this.markCacheChanged_();this.notifyBookmarksUpdated_()};
a.extractResponse_=function(b,c){GTB_EventProfiler.timestamp("+GTB_BookmarksService.extractResponse_");c||this.clear_();for(var d=b.getElementsByTagName("bookmark"),e=d.length,f=0;f<e;f++){var g=new GTB_Bookmark,h=g.createFromDom(d[f]);if(h){this.bookmarkCollection_.removeBookmark(g.getUrl());g.isDeleted()||this.bookmarkCollection_.addBookmark(g);this.markCacheChanged_();this.maxTimeStamp_=Math.max(g.getTimestamp(),this.maxTimeStamp_)}else"Failed to create bookmark from DOM node: "+G_FirefoxXMLUtils.getXMLString(d[f])}this.handlingPrefChange_=
false;GTB_EventProfiler.timestamp("-GTB_BookmarksService.extractResponse_")};a.getFaviconUrl=function(b){var c=GTB_convertToUrl(b);if(!(c instanceof Ci.nsIURL))return"chrome://google-toolbar/skin/favicon-default.png";if(c.scheme=="https"){c.scheme="http";b=c.spec}else if(c.scheme!="http")return"chrome://google-toolbar/skin/favicon-default.png";return GetFavicon(b)};a.onCustomized_=function(){this.markCacheChanged_();!this.handlingPrefChange_&&this.isEnabled()&&this.notifyBookmarksUpdated_()};
a.onEnabledPrefChanged_=function(){var b=this.isEnabled()&&this.isUserSignedIn();this.wasEnabledAndSignedIn_&&!b&&this.clear_();this.markCacheChanged_();this.notifyBookmarksUpdated_();if(!this.wasEnabledAndSignedIn_&&b){this.handlingPrefChange_=true;new G_Alarm(BindToObject(this.downloadServerBookmark,this),0)}this.wasEnabledAndSignedIn_=b};a.onSortPrefChanged_=function(){var b=GTB_getPrefWithLocaleDefault(GTB_BookmarksService.SORT_PREF);if(b!=this.sortPref_){this.sortPref_=b;this.markCacheChanged_()}};
a.getSortPref=function(){return this.sortPref_};a.clear_=function(){this.markCacheChanged_();this.bookmarkCollection_=new GTB_BookmarkCollection};a.isEnabled=function(){return GTB_getPrefWithLocaleDefault(GTB_BookmarksService.BOOKMARKS_ENABLED_PREF,false)};a.isPageABookmark=function(b){return!!this.getBookmarkByUrl(b)};a.getBookmarkByUrl=function(b){return this.bookmarkCollection_.getBookmarkByUrl(b)};a.getBookmarkById=function(b){return this.bookmarkCollection_.getBookmarkById(b)};
a.getLabels=function(b){var c=this.bookmarkCollection_.getAllLabels();b="date"==b?GTB_BookmarkLabelMaxTimestampComparator:GTB_BookmarkLabelLowerNameComparator;c.sort(b);return c};a.getNoLabelBookmarks=function(){var b=this.bookmarkCollection_.getOrphanBookmarks();return this.sortBookmarks(b)};a.sortBookmarks=function(b){var c="date"==this.sortPref_?GTB_Bookmark.getTimestampComparator():GTB_Bookmark.getTitleComparator();b.sort(c);return b};a.hasBookmarks=function(){return!this.bookmarkCollection_.isEmpty()};
a.getSortedBookmarksByLabel=function(b){b=this.bookmarkCollection_.getLabelByName(b);b=b.getAllBookmarks();return this.sortBookmarks(b)};a.getNumberOfBookmarksWithLabel=function(b){b=this.bookmarkCollection_.getLabelByName(b);return b.getAllBookmarks().length};
a.getLabelItems=function(b){var c=[];b=b||"";var d=b.lastIndexOf(","),e="";if(d>=0){e=b.substring(0,d+1);e=e.trim();b=b.substring(d+1)}b=b.trim().toLowerCase();d=this.bookmarkCollection_.getAllLabels();for(var f=0,g;g=d[f];f++)if(g.getLowerName().startsWith(b)&&e.indexOf(g.getName())<0){g=e+g.getName();c.push(g)}c.sort(GTB_AlphabethicalComparator);return c};
a.getValidatedLabelName=function(b){b=GTB_truncateWithElipsis(b,60);for(var c=b.toLowerCase(),d=this.bookmarkCollection_.getAllLabels(),e=0;e<d.length;e++)if(c==d[e].getLowerName())return d[e].getName();return b};
a.getBookmarkItems=function(b){var c=GTB_getPrefWithLocaleDefault("google.toolbar.search_box_use_suggest",false);if(!c)return[];c=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);c=c.getMostRecentWindow("navigator:browser");var d=c.document.getElementById("gtbSearchButton").searchType,e=[],f=b||"";f=f.toLowerCase();var g=this;this.bookmarkCollection_.forEachBookmark(function(i){var j=GTB_BookmarksService.getMatchPriority_(i,f,d);if(j==-1)return true;var k=new GTB_HistoryItem(i.getTitle(),
i.getUrl(),"gtbSearchBookmarks");k.comment=g.suggestComment_;k.icon=i.getFaviconUrl();e.push({item:k,weight:j});return true});e.sort(function(i,j){return j.weight-i.weight});b=[];c=d=="gtbSearchBookmarks"?e.length:2;for(var h=0;h<c&&e[h];h++)b.push(e[h].item);return b};a.mapBookmarks=function(b){var c=[];this.bookmarkCollection_.forEachBookmark(function(d){c.push(b(d));return true});return c};
GTB_BookmarksService.getMatchPriority_=function(b,c,d){if(b.getTitle().toLowerCase().indexOf(c)!=-1)return 3;if(d=="gtbSearchBookmarks"){d=b.getLabels();for(var e=0;e<d.length;e++)if(d[e].toLowerCase().indexOf(c)!=-1)return 2}b=b.getUrl().toLowerCase();d=0;if(b.indexOf("http://",d)==d)d+=7;if(b.indexOf("https://",d)==d)d+=8;if(b.indexOf("www.",d)==d)d+=4;if(b.indexOf(c,d)!=-1)return 1;return-1};GTB_BookmarksService.prototype.markCacheChanged_=function(){this.clientTimestamp_=Date.now()};
GTB_BookmarksService.prototype.cacheHasChangedSince=function(b){return this.clientTimestamp_>b};GTB_BookmarksService.prototype.setBeingBookmarked=function(b,c){if(c)this.beingBookmarked_[b]=(new Date).getTime();else delete this.beingBookmarked_[b]};GTB_BookmarksService.prototype.isBeingBookmarked=function(b){return b in this.beingBookmarked_&&(new Date).getTime()-this.beingBookmarked_[b]<2E3};function GTB_BookmarksActions(){this.actions_=[];this.tokenUpdated_=false}a=GTB_BookmarksActions.prototype;a.add=function(b){if(b){this.actions_.push(b);b.container=this}};a.startSoon=function(){new G_Alarm(BindToObject(this.start,this),0)};a.startSoonSync=function(){new G_Alarm(BindToObject(this.startSync,this,0),0)};a.start=function(){this.errorShown=false;if(this.actions_.length!=0)for(var b=0;b<this.actions_.length;b++)this.actions_[b].start()};
a.startSync=function(b){if(!(this.actions_.length<=b)){this.actions_[b].addCallback(BindToObject(this.startSync,this,b+1));this.actions_[b].start()}};function GTB_BookmarksAction(b,c){this.debugZone="bookmarks-action";this.container=null;this.manager_=b;this.postString_=c;this.callbacks_=[];this.tokenUpdated_=false}a=GTB_BookmarksAction.prototype;a.addCallback=function(b){b&&this.callbacks_.push(b)};a.startSoon=function(){new G_Alarm(BindToObject(this.start,this),0)};
a.start=function(){if(this.postString_){var b=this.postString_.replace("{RAND}",Math.floor(Math.random()*32768)),c=new G_NoAuthXMLFetcher,d=BindToObject(this.handlePostResponse_,this);GTB_OverrideUserAgent(BindToObject(c.post,c,"https://www.google.com/bookmarks/mark",b,d))}};
a.handleError_=function(b){if(this.container)if(this.container.errorShown)return;else this.container.errorShown=true;var c=this.manager_.bookmarksService_;if(b==401){this.getRootAction_().tokenUpdated_=false;c.actionWaitingOnAuth_=this.container||this;c.actionWaitingOnAuthExpiration_=Date.now()+12E4;c.actionWaitingOnAuthUser_=c.gaiaService_.gaiaUserEmail();this.manager_.gaiaSettings_.gaiaSignOut();c.doGaiaLogin=true}else c.showNetworkError()};
a.getRootAction_=function(){if(this.container)return this.container;return this};a.handlePostResponse_=function(b){var c=this.manager_.bookmarksService_;if(!b||b.status!=200)this.handleError_(b&&b.status);else{c.downloadServerBookmarkDiff();for(b=0;b<this.callbacks_.length;b++)this.callbacks_[b]()}};function GTB_BookmarksRenameLabelController(b,c){this.oldLabel_=b;this.bookmarksManager_=c}GTB_BookmarksRenameLabelController.prototype.onDialogLoad=function(b,c){var d=b.document;d.title=this.bookmarksManager_.stringBundle.GetStringFromName("prop.gtb.bookmarks.renamelabel.title");var e=d.getElementById("gtbRenameTextbox");e.value=this.oldLabel_;e.select();new GTB_NoEmptyInputValidator(d,e,b);c.stopPropagation()};goog.exportProperty(GTB_BookmarksRenameLabelController.prototype,"onDialogLoad",GTB_BookmarksRenameLabelController.prototype.onDialogLoad);
GTB_BookmarksRenameLabelController.prototype.onDialogAccept=function(b,c){var d=b.document;d=d.getElementById("gtbRenameTextbox").value;d=d.trim();this.bookmarksManager_.doRenameLabel(this.oldLabel_,d);c.stopPropagation()};function GTB_BookmarkAllTabsController(b){this.bookmarksManager_=b}GTB_BookmarkAllTabsController.prototype.onDialogLoad=function(b,c){var d=b.document;d.title=this.bookmarksManager_.stringBundle.GetStringFromName("prop.gtb.bookmarks.bookmarkall.title");c.stopPropagation()};
goog.exportProperty(GTB_BookmarkAllTabsController.prototype,"onDialogLoad",GTB_BookmarkAllTabsController.prototype.onDialogLoad);GTB_BookmarkAllTabsController.prototype.onDialogAccept=function(b,c){var d=b.document;d=d.getElementById("gtbRenameTextbox").value;this.bookmarksManager_.doBookmarkAllTabs(d);c.stopPropagation()};
function GTB_BookmarksRemoveLabelWarningController(b,c,d){this.debugZone="GTB_BookmarksRemoveLabelWarningController";this.bookmarksManager_=c;this.bookmarksService_=d;this.labelName_=b}
GTB_BookmarksRemoveLabelWarningController.prototype.onDialogLoad=function(b,c){var d=b.document;d.title=this.bookmarksManager_.stringBundle.GetStringFromName("prop.gtb.bookmarks.removelabel.title");d=d.getElementById("gtbBookmarksRemoveWarningDescription");d=d.firstChild;var e=this.bookmarksService_.getNumberOfBookmarksWithLabel(this.labelName_),f=this.bookmarksManager_.stringBundle.GetStringFromName("prop.gtb.bookmarks.removelabel.warning");f=f.replace("%S",this.labelName_);f=f.replace("%d",e);d.data=
f;c.stopPropagation()};GTB_BookmarksRemoveLabelWarningController.prototype.onDialogAccept=function(b,c){this.bookmarksManager_.doRemoveLabel(this.labelName_);c.stopPropagation()};function GTB_BookmarkRemoveWarningController(b,c){this.bookmark_=b;this.bookmarksManager_=c}
GTB_BookmarkRemoveWarningController.prototype.onDialogLoad=function(b,c){var d=b.document;d=d.getElementById("gtbBookmarksRemoveWarningDescription");d=d.firstChild;var e=this.bookmark_.getTitle();e=GTB_truncateWithElipsis(e,50);e=this.bookmarksManager_.stringBundle.formatStringFromName("prop.gtb.bookmarks.remove.warning",[e],1);d.data=e;c.stopPropagation()};goog.exportProperty(GTB_BookmarkRemoveWarningController.prototype,"onDialogLoad",GTB_BookmarkRemoveWarningController.prototype.onDialogLoad);
GTB_BookmarkRemoveWarningController.prototype.onDialogAccept=function(b,c){this.bookmarksManager_.doRemoveBookmark(this.bookmark_);c.stopPropagation()};function GTB_EditBookmarkBaseController_(b){this.debugZone="GTB_EditBookmarkBaseController_";this.bookmarksManager_=b}a=GTB_EditBookmarkBaseController_.prototype;
a.onDialogLoad=function(b,c){var d=b.document;d.getElementById("gtbBookmarksEditDialog").setAttribute("gtbPlatform",GetPlatformStr());var e=d.getElementById("gtbBookmarksEditUrl"),f=d.getElementById("gtbBookmarksEditUrlFavicon"),g=d.getElementById("gtbBookmarksEditNameTextbox"),h=d.getElementById("gtbBookmarksEditLabelsTextbox");this.changeTitle_&&this.changeTitle_(d);this.setLabelsTextBoxValue_&&this.setLabelsTextBoxValue_(h);e.value=this.getUrl_();f.src=this.getFavicon_();g.value=this.getBookmarkTitle_();
this.highlightTextBox_(d);c.stopPropagation()};a.onDialogAccept=function(b,c){c.stopPropagation();var d=b.document,e=d.getElementById("gtbBookmarksEditNameTextbox").value.trim();d=d.getElementById("gtbBookmarksEditLabelsTextbox").value;d=this.labelStringToArray_(d);this.doDialogAccept_(e,d)};a.doDialogAccept_=function(){throw Error("Must be overriden");};
a.labelStringToArray_=function(b){b=b.split(",");for(var c=0;c<b.length;++c){b[c]=b[c].trim();if(b[c].length>60)b[c]=b[c].substr(0,57)+"..."}for(c=0;c<b.length;c++)for(var d=c+1;d<b.length;)if(b[c].toLowerCase()==b[d].trim().toLowerCase())b.splice(d,1);else d++;return b};a.onFaviconError=function(b){b.src="chrome://google-toolbar/skin/favicon-default.png"};goog.exportProperty(GTB_EditBookmarkBaseController_.prototype,"onFaviconError",GTB_EditBookmarkBaseController_.prototype.onFaviconError);
GTB_EditBookmarkBaseController_.prototype.highlightTextBox_=function(b){b=b.getElementById("gtbBookmarksEditNameTextbox");b.select()};function GTB_EditExistingBookmarkController(b,c){GTB_EditBookmarkBaseController_.call(this,c);this.bookmark_=b}GTB_EditExistingBookmarkController.inherits(GTB_EditBookmarkBaseController_);a=GTB_EditExistingBookmarkController.prototype;a.getBookmarkTitle_=function(){return this.bookmark_.getTitle()};a.getFavicon_=function(){return this.bookmark_.getFaviconUrl()};
a.getUrl_=function(){return this.bookmark_.getUrl()};a.doDialogAccept_=function(b,c){this.bookmarksManager_.doEditExistingBookmark(this.bookmark_,b,c)};a.setLabelsTextBoxValue_=function(b){var c=this.bookmark_.getLabels().join(",");b.value=c};function GTB_EditNewBookmarkController(b,c,d,e){GTB_EditBookmarkBaseController_.call(this,e);this.bookmarkTitle_=b||d;this.bookmarkFavicon_=c;this.url_=d;this.bookmarksManager_=e}GTB_EditNewBookmarkController.inherits(GTB_EditBookmarkBaseController_);a=GTB_EditNewBookmarkController.prototype;
a.changeTitle_=function(b){b.title=this.bookmarksManager_.stringBundle.GetStringFromName("prop.gtb.bookmarks.add.title")};a.getBookmarkTitle_=function(){return this.bookmarkTitle_};a.getFavicon_=function(){return this.bookmarkFavicon_};a.getUrl_=function(){return this.url_};a.doDialogAccept_=function(b,c){this.bookmarksManager_.doAddNewBookmark(this.url_,b,c)};function GTB_BookmarkAddLabelController(b,c){GTB_EditExistingBookmarkController.call(this,b,c)}GTB_BookmarkAddLabelController.inherits(GTB_EditExistingBookmarkController);
GTB_BookmarkAddLabelController.prototype.highlightTextBox_=function(b){b=b.getElementById("gtbBookmarksEditLabelsTextbox");b.select()};function GTB_NoEmptyInputValidator(b,c,d){this.debugZone="GTB_NoEmptyInputValidator";this.textbox_=c;this.acceptButton_=b.documentElement.getButton("accept");this.inputListener_=BindToObject(this.onInput_,this);c.addEventListener("input",this.inputListener_,false);d.addEventListener("unload",BindToObject(this.onDialogUnload_,this),false)}
GTB_NoEmptyInputValidator.prototype.onInput_=function(){this.acceptButton_.disabled=this.textbox_.value.trim()==""};GTB_NoEmptyInputValidator.prototype.onDialogUnload_=function(){this.textbox_.removeEventListener("input",this.inputListener_,false);this.acceptButton_=this.textbox_=null};function GTB_ChangeListenerManager(b){this.httpResponseHandler_=b;this.observedTabs_=[];this.responseObserver_=null}GTB_ChangeListenerManager.prototype.debugZone="GTB_ChangeListenerManager";GTB_ChangeListenerManager.prototype.startObservingHttpResponses=function(){if(!this.responseObserver_)this.responseObserver_=new G_ObserverServiceObserver("http-on-examine-response",this.httpResponseHandler_)};
GTB_ChangeListenerManager.prototype.attachListener=function(b){if(this.observedTabs_.indexOf(b)==-1){new GTB_BookmarksChangeListener(b,this);this.observedTabs_.push(b)}};GTB_ChangeListenerManager.prototype.detachListener_=function(b){b=this.observedTabs_.indexOf(b);this.observedTabs_.splice(b,1);if(this.observedTabs_.length==0&&this.responseObserver_){this.responseObserver_.unregister();this.responseObserver_=null}};
function GTB_BookmarksChangeListener(b,c){this.browser_=b;this.listenerManager_=c;this.listeners_=new GTB_ListenersBinding(b,this);this.listeners_.addEventListener("load",this.handleLoad_);this.listeners_.addEventListener("unload",this.handleUnload_)}GTB_BookmarksChangeListener.prototype.debugZone="GTB_BookmarksChangeListener";GTB_BookmarksChangeListener.prototype.handleLoad_=function(){this.listenerManager_.startObservingHttpResponses()};
GTB_BookmarksChangeListener.prototype.handleUnload_=function(){if(!this.browser_.docShell){this.listeners_.removeAllListeners();this.listenerManager_.detachListener_(this.browser_)}};function GTB_ImportCompleteListener(b){var c;try{c=b.QueryInterface(Ci.nsIHttpChannel).URI.asciiSpec}catch(d){}c.startsWith("http://www.google.com/bookmarks/mark?")&&c.indexOf("op=upload_selection")!=-1&&c.indexOf("btnC")==-1&&GTB_RefreshBookmarks()}GTB_ImportCompleteListener.manager=new GTB_ChangeListenerManager(GTB_ImportCompleteListener);
function GTB_MarkHistoryEntryListener(b){var c;try{c=b.QueryInterface(Ci.nsIHttpChannel).URI.asciiSpec}catch(d){}GTB_MarkHistoryEntryListener.BOOKMARK_ADD_REMOVE_URL_PATTERN.test(c)&&GTB_RefreshBookmarks()}GTB_MarkHistoryEntryListener.BOOKMARK_ADD_REMOVE_URL_PATTERN=/^http:\/\/www.google((\.[a-z]{2,3}){1,2})\/bookmarks\/mark\?.*(q=|dlq=)/;GTB_MarkHistoryEntryListener.manager=new GTB_ChangeListenerManager(GTB_MarkHistoryEntryListener);
function GTB_BookmarksChangesObserver(){var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT)}a=GTB_BookmarksChangesObserver.prototype;a.debugZone="GTB_BookmarksChangesObserver";a.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};a.onLocationChange=GTB_NotImplemented;
a.onProgressChange=GTB_NotImplemented;a.onSecurityChange=GTB_NotImplemented;a.onStatusChange=GTB_NotImplemented;function GTB_NotImplemented(){}GTB_BookmarksChangesObserver.NOTEBOOK_URL_PATTERN=/^http:\/\/www.google((\.[a-z]{2,3}){1,2})\/notebook/;GTB_BookmarksChangesObserver.WEB_HISTORY_URL_PATTERN=/^http:\/\/www.google((\.[a-z]{2,3}){1,2})\/history/;
GTB_BookmarksChangesObserver.prototype.onStateChange=function(b,c,d){if(d&Ci.nsIWebProgressListener.STATE_STOP){var e;try{e=c.QueryInterface(Ci.nsIHttpChannel);if(e.responseStatus!=200)return}catch(f){return}c=e.URI.spec;if(GTB_BookmarksChangesObserver.NOTEBOOK_URL_PATTERN.test(c))this.handleNotebookPageLoaded_(b);else GTB_BookmarksChangesObserver.WEB_HISTORY_URL_PATTERN.test(c)&&this.handleWebHistoryPageLoaded_(b)}};
GTB_BookmarksChangesObserver.prototype.handleNotebookPageLoaded_=function(b){try{var c=b.QueryInterface(Ci.nsIDocShell),d=c.contentViewer,e=d.DOMDocument.defaultView;if(e.wrappedJSObject)e=e.wrappedJSObject;var f=e._GN_interface;f&&f._setOnChangeHandler&&f._setOnChangeHandler(GTB_RefreshBookmarks)}catch(g){}};
GTB_BookmarksChangesObserver.prototype.handleWebHistoryPageLoaded_=function(b){b=b.QueryInterface(Ci.nsIDocShell);b=GTB_getBrowserAndWindowFromDocShell(b);if(b!=null){b=b.browser;GTB_MarkHistoryEntryListener.manager.attachListener(b);GTB_MarkHistoryEntryListener.manager.startObservingHttpResponses()}};GTB_BookmarksChangesObserver.singleton=new GTB_BookmarksChangesObserver;
function GTB_RefreshBookmarks(){var b=Cc["@google.com/toolbar/bookmarks;1"].getService().wrappedJSObject;b.downloadServerBookmarkDiff()};function GTB_FirefoxBookmarkImporter(b){this.bookmarksService_=b}a=GTB_FirefoxBookmarkImporter.prototype;
a.importBookmarks=function(b){var c=this.getFirefoxBookmarks_();c=this.convertBookmarksToPostDataXML_(c);c=G_FirefoxXMLUtils.getXMLString(c);var d=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);d.charset="UTF-8";c=d.convertToInputStream(c);d=Cc["@mozilla.org/network/mime-input-stream;1"].createInstance(Ci.nsIMIMEInputStream);d.addContentLength=true;d.setData(c);c=d.QueryInterface(Ci.nsIInputStream);d=b.GTB_GoogleToolbarOverlay.tabBrowser.selectedBrowser;
GTB_ImportCompleteListener.manager.attachListener(d);d=Math.floor(Math.random()*32768);d="https://www.google.com/bookmarks/mark?op=upload&zx={RAND}".replace("{RAND}",d);GTB_OverrideUserAgent(BindToObject(b.loadURI,b,d,null,c))};a.nodeIsFolder_=function(b){return b.type==Ci.nsINavHistoryResultNode.RESULT_TYPE_FOLDER||b.type==Ci.nsINavHistoryResultNode.RESULT_TYPE_FOLDER_SHORTCUT};
a.getBookmarksFromFolder_=function(b,c,d){this.query_.setFolders([b],1);var e=this.historyService_.executeQuery(this.query_,this.queryOptions_);e=e.root;e.containerOpen=true;if(this.genericFolders_.indexOf(b)==-1){b=this.mozBookmarksService_.getItemTitle(b);if(d.length>0)d+=":"+b;else d=b}for(b=0;b<e.childCount;b++){var f=e.getChild(b);if(f.type==Ci.nsINavHistoryResultNode.RESULT_TYPE_URI&&f.itemId!=-1){var g=f.title;f=f.uri;if(GTB_LooksLikeUrl(f)){g=new GTB_ImportedBookmark(g,f);d&&g.addLabel(this.bookmarksService_.getValidatedLabelName(d));
c.push(g)}}else this.nodeIsFolder_(f)&&!this.livemarkService_.isLivemark(f.itemId)&&this.getBookmarksFromFolder_(f.itemId,c,d)}e.containerOpen=false};
a.getFirefoxBookmarksFF3_=function(){this.historyService_=Cc["@mozilla.org/browser/nav-history-service;1"].getService(Ci.nsINavHistoryService);this.mozBookmarksService_=Cc["@mozilla.org/browser/nav-bookmarks-service;1"].getService(Ci.nsINavBookmarksService);this.livemarkService_=Cc["@mozilla.org/browser/livemark-service;2"].getService(Ci.nsILivemarkService);this.queryOptions_=this.historyService_.getNewQueryOptions();this.query_=this.historyService_.getNewQuery();this.genericFolders_=[this.mozBookmarksService_.placesRoot,
this.mozBookmarksService_.bookmarksMenuFolder,this.mozBookmarksService_.toolbarFolder];var b=[];this.getBookmarksFromFolder_(this.mozBookmarksService_.placesRoot,b,"");delete this.query_;delete this.queryOptions_;return b};
a.getFirefoxBookmarksFF2_=function(){var b=Cc["@mozilla.org/browser/bookmarks-service;1"].getService(Ci.nsIBookmarksService),c=Cc["@mozilla.org/rdf/rdf-service;1"].getService(Ci.nsIRDFService),d=c.GetDataSource("rdf:bookmarks"),e=d.GetAllResources(),f=c.GetResource("http://home.netscape.com/NC-rdf#Name"),g=c.GetResource("http://home.netscape.com/NC-rdf#URL");c=c.GetResource("http://www.w3.org/1999/02/22-rdf-syntax-ns#type");for(var h=[],i={};e.hasMoreElements();){var j=e.getNext(),k=d.GetTarget(j,
f,true),l=d.GetTarget(j,g,true),m=d.GetTarget(j,c,true),n="",o="";m=m?m.QueryInterface(Ci.nsIRDFResource).Value:"";if(m!="")m=m.split("#")[1];if(k instanceof Ci.nsIRDFLiteral)n=k.QueryInterface(Ci.nsIRDFLiteral).Value;if(l instanceof Ci.nsIRDFLiteral||l instanceof Ci.nsIRDFResource)o=l.Value;if(!(m!="Bookmark"||!GTB_LooksLikeUrl(o))){l=k="";m=true;j=b.getParent(j);if(j instanceof Ci.nsIRDFResource)l=j.QueryInterface(Ci.nsIRDFResource).Value;for(;j&&l!="NC:BookmarksRoot";){var p=d.GetTarget(j,f,true),
r=d.GetTarget(j,c,true),q="";r=r?r.QueryInterface(Ci.nsIRDFResource).Value:"";if(r!="")r=r.split("#")[1];if(r!="Folder"){m=false;break}if(p instanceof Ci.nsIRDFLiteral)q=p.QueryInterface(Ci.nsIRDFLiteral).Value;k=k==""?q:q.concat(":"+k);j=b.getParent(j);if(j instanceof Ci.nsIRDFResource)l=j.QueryInterface(Ci.nsIRDFResource).Value}if(m){n=new GTB_ImportedBookmark(n,o);if(k!=""){o=this.bookmarksService_.getValidatedLabelName(k);k=o.toLowerCase();if(l=i[k])o=l;else i[k]=o;n.addLabel(o)}h.push(n)}}}return h};
a.getFirefoxBookmarks_=function(){return Cc["@mozilla.org/browser/nav-history-service;1"]&&Cc["@mozilla.org/browser/nav-bookmarks-service;1"]&&Cc["@mozilla.org/browser/livemark-service;2"]?this.getFirefoxBookmarksFF3_():this.getFirefoxBookmarksFF2_()};
a.convertBookmarksToPostDataXML_=function(b){function c(l,m){var n=d.createElement(l),o=d.createTextNode(m);n.appendChild(o);return n}for(var d=G_FirefoxXMLUtils.newXML(),e=d.createElement("bookmarks"),f=0;f<b.length;f++){var g=d.createElement("bookmark"),h=c("title",b[f].getTitle()),i=c("url",b[f].getUrl());g.appendChild(i);g.appendChild(h);h=b[f].getLabels();if(h.length>0){i=d.createElement("labels");for(var j=0;j<h.length;j++){var k=c("label",h[j]);i.appendChild(k)}g.appendChild(i)}e.appendChild(g)}d.appendChild(e);
return d};function GTB_ImportedBookmark(b,c){this.url_=c;this.title_=b;this.labels_=[]}GTB_ImportedBookmark.prototype.addLabel=function(b){this.labels_.indexOf(b)==-1&&this.labels_.push(b)};GTB_ImportedBookmark.prototype.getUrl=function(){return this.url_};GTB_ImportedBookmark.prototype.getTitle=function(){return this.title_};GTB_ImportedBookmark.prototype.getLabels=function(){return this.labels_};function LabelAutoComplete(){this.debugZone="LabelAutoComplete"}LabelAutoComplete.prototype={_listener:null};a=LabelAutoComplete.prototype;a.onLabelResultsReady_=function(b,c){if(this._listener){this._results=c;if(this._results!=null){var d=new LabelAutoCompleteResult(b,Ci.nsIAutoCompleteResult.RESULT_SUCCESS,0,"",this._results);this._listener.onSearchResult(this,d)}}};
a.startSearch=function(b,c,d,e){this.labelResults_=null;this._listener=e;this._searchString=b;b=this._getMatchingLabel(this._searchString);this.labelResults_=[];for(c=0;c<b.length;c++)this.labelResults_[this.labelResults_.length]=b[c];this.onLabelResultsReady_(this._searchString,this.labelResults_)};a.stopSearch=function(){this._listener=null};a._getMatchingLabel=function(b){var c=Cc["@google.com/toolbar/bookmarks;1"].getService().wrappedJSObject;return c.getLabelItems(b)};
a.QueryInterface=function(b){if(!b.equals(Ci.nsIAutoCompleteSearch)&&!b.equals(Ci.nsIAutoCompleteObserver)&&!b.equals(Ci.nsISupports))throw Cr.NS_ERROR_NO_INTERFACE;return this};function LabelAutoCompleteResult(b,c,d,e,f){this._searchString=b;this._searchResult=c;this._defaultIndex=d;this._errorDescription=e;b=[];this._results=b=b.concat(f)}LabelAutoCompleteResult.prototype={_resultString:"",_resultsString:"",_searchString:"",_searchResult:0,_defaultIndex:0,_errorDescription:"",_results:[]};a=LabelAutoCompleteResult.prototype;a.getValueAt=function(b){return this._results[b]};a.getCommentAt=function(){return null};a.getStyleAt=function(){return null};a.getImageAt=function(){return null};
a.removeValueAt=function(b){this._results.splice(b,1)};a.QueryInterface=function(b){if(!b.equals(Ci.nsIAutoCompleteResult)&&!b.equals(Ci.nsISupports))throw Cr.NS_ERROR_NO_INTERFACE;return this};LabelAutoCompleteResult.prototype.__defineGetter__("searchString",function(){return this._searchString});LabelAutoCompleteResult.prototype.__defineGetter__("searchResult",function(){return this._searchResult});LabelAutoCompleteResult.prototype.__defineGetter__("defaultIndex",function(){return this._defaultIndex});
LabelAutoCompleteResult.prototype.__defineGetter__("errorDescription",function(){return this._errorDescription});LabelAutoCompleteResult.prototype.__defineGetter__("matchCount",function(){return this._results.length});var GTB_PermalinkDetector={};GTB_PermalinkDetector.debugZone="GTB_PermalinkDetector";GTB_PermalinkDetector.findPagePermalink=function(b){b=b.getElementsByTagName("A");for(var c=0;c<b.length;c++){var d=b[c];if(GTB_PermalinkDetector.isPermalink_(d)){var e=d.getAttribute("href");if(e)if(!GTB_PermalinkDetector.findEnclosingHEntry_(d))return e}}return null};
GTB_PermalinkDetector.findSelectionPermalink=function(b){b=b.commonAncestorContainer;if(b=GTB_PermalinkDetector.findEnclosingHEntry_(b)){var c=new GTB_PermalinkInfo;if(c.extractInfo_(b))return c}return null};GTB_PermalinkDetector.findEnclosingHEntry_=function(b){for(;b;){if(GTB_PermalinkDetector.isHEntry_(b))return b;b=b.parentNode}return null};GTB_PermalinkDetector.isHEntry_=function(b){return GTB_PermalinkDetector.hasClass_(b,"hentry")};
GTB_PermalinkDetector.hasClass_=function(b,c){if(b.nodeType!=Ci.nsIDOMNode.ELEMENT_NODE)return false;var d=b.getAttribute("class");if(!d||d.indexOf(c)==-1)return false;d=d.split(" ");return d.indexOf(c)!=-1};GTB_PermalinkDetector.isPermalink_=function(b){return b.getAttribute("rel")=="bookmark"};function GTB_PermalinkInfo(){this.debugZone="GTB_PermalinkInfo";this.title_=this.url_=null}GTB_PermalinkInfo.prototype.getUrl=function(){return this.url_};GTB_PermalinkInfo.prototype.getTitle=function(){return this.title_};
GTB_PermalinkInfo.prototype.extractInfo_=function(b){if(b.nodeType!=Ci.nsIDOMNode.ELEMENT_NODE)return false;if(!this.url_)if(b.nodeName=="A")if(GTB_PermalinkDetector.isPermalink_(b))this.url_=b.getAttribute("href");if(!this.title_)if(GTB_PermalinkDetector.hasClass_(b,"entry-title"))this.title_=b.textContent;if(this.url_&&this.title_)return true;for(b=b.firstChild;b;b=b.nextSibling){var c=this.extractInfo_(b);if(c)return true}return false};function GTB_SearchBoxContentProvider(b){this.debugZone="GTB_SearchBoxContentProvider";this.labelBox_=b;this.bookmarksService_=Cc["@google.com/toolbar/bookmarks;1"].getService().wrappedJSObject;b=this.labelBox_;b.addEventListener("popupshowing",BindToObject(this.onPopupShowing_,this),false);b.addEventListener("keydown",BindToObject(this.onKeyDown_,this),false)}GTB_SearchBoxContentProvider.prototype.onPopupShowing_=function(){var b=this.labelBox_;b.selectedIndex=-1;b.removeAllItems();this.addMenuItems_(b)};
GTB_SearchBoxContentProvider.prototype.addMenuItems_=function(){throw Error("Pure virtual method call: GTB_SearchBoxContentProvider.prototype.addMenuItems_");};GTB_SearchBoxContentProvider.prototype.onKeyDown_=function(b){if(b.keyCode==b.DOM_VK_DOWN&&!b.ctrlKey&&""==this.labelBox_.value.trim())this.labelBox_.open=true};
GTB_SearchBoxContentProvider.prototype.shutdown=function(){var b=this.labelBox_;b.removeEventListener("popupshowing",BindToObject(this.onPopupShowing_,this),false);b.removeEventListener("keydown",BindToObject(this.onKeyDown_,this),false)};function GTB_LabelSearchContentProvider(b){GTB_SearchBoxContentProvider.call(this,b);this.debugZone="GTB_LabelSearchContentProvider"}GTB_LabelSearchContentProvider.inherits(GTB_SearchBoxContentProvider);
GTB_LabelSearchContentProvider.prototype.addMenuItems_=function(b){for(var c=this.bookmarksService_.getLabelItems(),d=0,e=null;e=c[d];d++)b.appendItem(e)};var GTB_CB_XmlUtils={};GTB_CB_XmlUtils.debugZone="xml-utils";GTB_CB_XmlUtils.getBoolAttribute=function(b,c){var d=c.getAttribute(b);switch(d){case "false":case "0":case "no":return false;default:return!!d}};GTB_CB_XmlUtils.getNodes=function(b,c){for(var d=[],e=0,f=G_FirefoxXMLUtils.selectNodes(c,b,GTB_CB_XmlUtils.nsResolver),g;g=f.iterateNext();){d[e]=g;e++}return d};
GTB_CB_XmlUtils.getNode=function(b,c){var d=GTB_CB_XmlUtils.getNodes(b,c);if(d.length==1)return d[0];if(d.length==0)return null;for(var e=GTB_getLangCode(),f=0;f<d.length;f++){var g=d[f],h=g.getAttribute("locale");if(e==h)return g}return d[0]};GTB_CB_XmlUtils.getChildByTagName=function(b,c){return b.getElementsByTagNameNS("*",c)[0]};
GTB_CB_XmlUtils.getTextContent=function(b,c,d){if(b=GTB_CB_XmlUtils.getNode("//gtb:button/gtb:"+b,c)){if(!d)return GTB_Directionality.adaptToCurrentLocale(b.textContent,b.getAttribute("locale"));return b.textContent}else return""};GTB_CB_XmlUtils.getUpdateUrl=function(b){var c="//gtb:button/gtb:update/text()";return(b=G_FirefoxXMLUtils.selectSingleNode(b,c,GTB_CB_XmlUtils.nsResolver))&&b.nodeValue};
GTB_CB_XmlUtils.getButtonVersion=function(b){var c="//gtb:button/gtb:version/text()";return(b=G_FirefoxXMLUtils.selectSingleNode(b,c,GTB_CB_XmlUtils.nsResolver))?b.nodeValue:null};GTB_CB_XmlUtils.nsResolver=function(b){switch(b){case "gtb":return"http://toolbar.google.com/custombuttons/";case "atom":return"http://www.w3.org/2005/Atom";case "rss":return"http://purl.org/rss/1.0/";case "rdf":return"http://www.w3.org/1999/02/22-rdf-syntax-ns#";default:return"http://toolbar.google.com/custombuttons/"}};function GTB_CompareVersions(b,c){var d=b.split("."),e=c.split("."),f,g,h,i,j,k;try{f=parseInt(d[0],10);h=parseInt(d[1],10);j=d[2];if(!j)throw Error("Missing timestamp");}catch(l){throw Error("Malformed version string: "+b+" ("+l.message+")");}try{g=parseInt(e[0],10);i=parseInt(e[1],10);k=e[2];if(!k)throw Error("Missing timestamp");}catch(m){throw Error("Malformed version string: "+c+" ("+m.message+")");}if(f!=g)return f-g;if(h!=i)return h-i;if(j<k)return-1;if(j>k)return 1;return 0};function GTB_PrefFile(){this.debugZone="GTB_PrefFile"}
GTB_PrefFile.prototype.getPref=function(b){var c=this.getUserGoogleDir_();c.append("firefox-toolbar.xml");if(!c.exists())return null;try{var d=G_FirefoxXMLUtils.loadXML(c)}catch(e){return null}c=d.documentElement;b=c.getElementsByTagName(b);if(b.length==0)return null;b=b[0];c=b.getAttribute("type");d=null;if(c=="boolean")d="true"==b.textContent;else if(c=="number")d=Number(b.textContent);else if(c=="string")d=b.textContent;else if(!c){d=b.textContent;if(d==="true")d=true;else if(d==="false")d=false}return d};
GTB_PrefFile.prototype.setPref=function(b,c){var d=this.getUserGoogleDir_();if(!d.exists())try{d.create(Ci.nsIFile.DIRECTORY_TYPE,493)}catch(e){return}d=d;d.append("firefox-toolbar.xml");var f;if(d.exists())try{f=G_FirefoxXMLUtils.loadXML(d)}catch(g){f=G_FirefoxXMLUtils.newXML("firetools");f.documentElement.setAttribute("version","1.0")}else{f=G_FirefoxXMLUtils.newXML("firetools");f.documentElement.setAttribute("version","1.0")}var h=f.documentElement,i=h.getElementsByTagName(b);if(i.length>0)i=i[0];
else{i=f.createElement(b);h.appendChild(i)}i.setAttribute("type",typeof c);i.textContent=c;try{G_FirefoxXMLUtils.saveXML(f,d)}catch(j){}};GTB_PrefFile.prototype.clearPref=function(b){var c=this.getUserGoogleDir_();c.append("firefox-toolbar.xml");if(c.exists()){try{var d=G_FirefoxXMLUtils.loadXML(c)}catch(e){return}var f=d.documentElement;b=f.getElementsByTagName(b);if(b.length!=0){for(var g=0,h;h=b[g];g++)f.removeChild(h);try{G_FirefoxXMLUtils.saveXML(d,c)}catch(i){}}}};
GTB_PrefFile.prototype.getUserGoogleDir_=function(){var b;b=GetPlatform();if(b==1)b=G_File.getSpecialFile("LocalAppData","Google");else if(b==2){b=G_File.getSpecialFile("ULibDir","Application Support");b.append("Google")}else{b=G_File.getHomeFile();b.append(".google")}return b};function GTB_Animator(b,c){this.node_=b;this.timeline_=c;this.timer_=null}a=GTB_Animator.prototype;a.debugZone="GTB_Animator";a.start=function(){this.timer_&&this.cancel();this.next_(0)};a.cancel=function(){if(this.timer_){this.timer_.cancel();this.timer_=null}};a.stop=function(){if(this.timer_){this.timer_.cancel();this.next_(this.timeline_.length-1)}};
a.next_=function(b){if(b>=this.timeline_.length)this.cancel();else{for(var c in this.timeline_[b].css)this.node_.style[c]=this.timeline_[b].css[c];this.timer_=new G_Alarm(BindToObject(this.next_,this,b+1),this.timeline_[b].period)}};
function GTB_NewButton(b){this.win_=b;this.doc_=b.document;b=this.doc_.getElementById("gtbToolbar");this.direction_=b.getAttribute("chromedir");this.overlay_=this.win_.GTB_GoogleToolbarOverlay;this.button_=this.doc_.getElementById("gtbNewButton");b=this.doc_.getAnonymousElementByAttribute(this.button_,"class","toolbarbutton-text");this.animator_=new GTB_Animator(b,this.getButtonAnimation_());this.prefs_=new G_Preferences("google.toolbar.newbutton.");this.onKeyPressBound_=BindToObject(this.onKeyPress_,
this);this.onMouseEventBound_=BindToObject(this.onMouseEvent_,this);this.resizer_=null}GTB_NewButton.MIN_OVERLAY_WIDTH=80;GTB_NewButton.MIN_OVERLAY_HEIGHT=50;GTB_NewButton.prototype.debugZone="GTB_NewButton";
GTB_NewButton.prototype.getButtonAnimation_=function(){for(var b=[{css:{opacity:0,borderStyle:"outset",backgroundColor:"yellow"},period:100}],c=0;c<2;++c){for(var d=0.2;d<1;d+=0.2)b.push({css:{opacity:d},period:100});b.push({css:{opacity:1},period:200});for(d=0.8;d>0;d-=0.2)b.push({css:{opacity:d},period:100});b.push({css:{opacity:0},period:200})}b.push({css:{opacity:1,borderStyle:"hidden",backgroundColor:"transparent"},period:0});return b};
GTB_NewButton.prototype.showButton=function(){if(this.shouldShowButton_()){var b=this.doc_.getAnonymousElementByAttribute(this.button_,"class","toolbarbutton-text");b.value=this.prefs_.getPref("caption","New!");this.button_.hidden=false;this.overlay_.chevron.doResize();this.animator_.start()}};goog.exportProperty(GTB_NewButton.prototype,"showButton",GTB_NewButton.prototype.showButton);GTB_NewButton.prototype.hideButton=function(){this.button_.hidden=true;this.overlay_.chevron.doResize()};
goog.exportProperty(GTB_NewButton.prototype,"hideButton",GTB_NewButton.prototype.hideButton);a=GTB_NewButton.prototype;a.shouldShowButton_=function(){var b=this.prefs_.getPref("show","");return b&&b!=this.prefs_.getPref("shown","")};
a.onCommand=function(){this.animator_.stop();var b=this.doc_.getElementById("gtb-newbutton-iframe");b.contentDocument.documentElement.setAttribute("dir",this.direction_);b=this.getIFrame_();var c=this.prefs_.getPref("show","");if(b.src!=c)b.src=c;b=this.prefs_.getPref("width",400);c=this.prefs_.getPref("height",300);this.showOverlay_(b,c)};a.onKeyPress_=function(){this.hideOverlay_()};a.onMouseEvent_=function(){this.hideOverlay_()};
a.getIFrame_=function(){var b=this.doc_.getElementById("gtb-newbutton-iframe");return b.contentDocument.getElementById("gtb-newbutton-content")};
a.showOverlay_=function(b,c){var d=this.doc_.getElementById("gtb-newbutton-dropdown-container");this.resizer_=new GTB_OverlayResizer(this.win_,d,this.direction_,"gtb-newbutton-gripper",null,BindToObject(this.resize_,this));var e=this.doc_.getElementById("gtb-newbutton-iframe"),f=this.button_.boxObject;d.hidden=false;d.style.display="block";d.style.top=f.y+f.height+1+"px";d.style.width=b+"px";d.style.height=c+"px";e.style.width=b+"px";e.style.height=c+"px";if(this.direction_=="rtl")if(f.x+b>this.win_.innerWidth){e=
this.win_.innerWidth-b;if(e<0)e=0;d.style.left=e+"px"}else d.style.left=f.x+"px";else d.style.left=f.x+f.width<b?"0":f.x+f.width-b+"px";this.win_.addEventListener("keypress",this.onKeyPressBound_,false);this.win_.addEventListener("mouseup",this.onMouseEventBound_,false);this.prefs_.setPref("shown",this.prefs_.getPref("show",""))};
a.hideOverlay_=function(){if(this.resizer_){this.resizer_.shutdown();this.resizer_=null}this.win_.removeEventListener("keypress",this.onKeyPressBound_,false);this.win_.removeEventListener("mouseup",this.onMouseEventBound_,false);var b=this.doc_.getElementById("gtb-newbutton-dropdown-container");b.hidden=true;b.style.display="none"};
a.resize_=function(b,c){if(b<GTB_NewButton.MIN_OVERLAY_WIDTH)b=GTB_NewButton.MIN_OVERLAY_WIDTH;if(c<GTB_NewButton.MIN_OVERLAY_HEIGHT)c=GTB_NewButton.MIN_OVERLAY_HEIGHT;var d=this.doc_.getElementById("gtb-newbutton-dropdown-container");d.style.width=b+"px";d.style.height=c+"px";d=this.doc_.getElementById("gtb-newbutton-iframe");d.style.width=b+"px";d.style.height=c+"px"};function GTB_NewButtonRequester(){this.debugZone="GTB_NewButtonRequester";this.prefs_=new G_Preferences("google.toolbar.newbutton.")}GTB_NewButtonRequester.REQUEST_URL="";a=GTB_NewButtonRequester.prototype;
a.setRequest=function(){var b=this.prefs_.getPref("url",GTB_NewButtonRequester.REQUEST_URL);if(b){var c=new G_XMLFetcher;b=b.replace("{ID}",this.getProfileId_()).replace("{VERSION}",GTB_version).replace("{LANG}",GTB_getLangCode()).replace("{USER_TYPE}",this.getUserType_()).replace("{STATISTICS}",this.getStatistics_()).replace("{RANDOM}",""+Math.floor(Math.random()*1299709));c.get(b,BindToObject(this.getResponse_,this))}};
a.getResponse_=function(b){if(b&&b.status==200&&b.responseXML){b=b.responseXML;var c=b.documentElement;c=c.getAttribute("show");if(!(!c||c=="no")){this.prefs_.clearPref("show");if((c=b.getElementsByTagName("url"))&&c[0]){c=c[0].firstChild.nodeValue;this.prefs_.setPref("show",c)}this.prefs_.clearPref("caption");if((c=b.getElementsByTagName("caption"))&&c[0]){c=c[0].firstChild.nodeValue;this.prefs_.setPref("caption",c)}this.prefs_.clearPref("width");if((c=b.getElementsByTagName("width"))&&c[0]){c=c[0].firstChild.nodeValue;
this.prefs_.setPref("width",parseInt(c,10))}this.prefs_.clearPref("height");if((b=b.getElementsByTagName("height"))&&b[0]){b=b[0].firstChild.nodeValue;this.prefs_.setPref("height",parseInt(b,10))}}}};a.getProfileId_=function(){var b=this.prefs_.getPref("id","");if(!b){b=new G_Base64;for(var c=[],d=(new Date).getTime(),e=0;e<6;++e){c.push(d&255);d>>=8}for(e=0;e<24;++e)c.push(Math.floor(Math.random()*256));b=b.encodeByteArray(c,true);this.prefs_.setPref("id",b)}return b};a.getUserType_=function(){return""};
a.getStatistics_=function(){return 0};function GetEmResourceValue(b,c){var d=Cc["@mozilla.org/rdf/rdf-service;1"].getService(Ci.nsIRDFService),e=Cc["@mozilla.org/extensions/manager;1"].getService(Ci.nsIExtensionManager).datasource,f=d.GetResource(c);d=d.GetResource(b);if(!f||!d)return null;e=e.GetTarget(d,f,true);if(!e)return null;if(e instanceof Ci.nsIRDFLiteral||e instanceof Ci.nsIRDFResource)return e.Value;return null}
function GTB_SaveLayout(){var b=Cc["@mozilla.org/preferences;1"].getService(Ci.nsIPrefService);b=b.getBranch("google.toolbar.");var c=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator),d=c.getMostRecentWindow("navigator:browser");c=d.GTB_GoogleToolbarOverlay.layout;d=d.document.getElementById("gtbToolbar");var e=c.getCurrentLayout();if(e!="classic"){b.setCharPref("uninstall_layout",e);GTB_LayoutManager.setLayout("classic");c.persistToolbars()}if(!d.collapsed){b.setBoolPref("uninstall_collapsed",
true);d.collapsed=true}}function GTB_FreshInstall(){return!(new G_Preferences("google.toolbar.")).hasUserValue("google_home")}goog.exportSymbol("GTB_FreshInstall",GTB_FreshInstall);
function GTB_RestoreLayout(){var b=Cc["@mozilla.org/preferences;1"].getService(Ci.nsIPrefService);b=b.getBranch("google.toolbar.");var c=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);c=c.getMostRecentWindow("navigator:browser");var d=c.document.getElementById("gtbToolbar");c=c.GTB_GoogleToolbarOverlay.layout;if(GTB_FreshInstall()){d.collapsed=false;GTB_LayoutManager.setLayout("classic");c.persistToolbars()}if(b.prefHasUserValue("uninstall_collapsed")){try{var e=b.getCharPref("done_page_shown")||
""}catch(f){e=""}if(e.substring(0,3)=="AU_")e=e.substring(3);if(e&&parseInt(e,10)>=5)d.collapsed=false;b.clearUserPref("uninstall_collapsed");if(!GTB_FreshInstall()){if(b.prefHasUserValue("firstrun.setsearch")&&b.getBoolPref("firstrun.setsearch")){GTB_SearchEngineService.makeGoogleDefaultSearch();b.setBoolPref("keep_search_google.default",true)}if(b.prefHasUserValue("firstrun.sethome")&&b.getBoolPref("firstrun.sethome")){e=b.getCharPref("google_home.default");e="http://"+e+"/";GTB_GlobalPrefs.setPref("browser.startup.homepage",
e)}}}if(b.prefHasUserValue("uninstall_layout")){e=b.getCharPref("uninstall_layout");GTB_LayoutManager.setLayout(e);c.persistToolbars();b.clearUserPref("uninstall_layout")}}function GTB_Uninstaller(){this.emActionObserver_=new G_ObserverServiceObserver("em-action-requested",BindToObject(this.onEmActionRequested_,this),false);new G_ObserverServiceObserver("xpcom-shutdown",BindToObject(this.onXpcomShutdown_,this),true)}a=GTB_Uninstaller.prototype;a.debugZone="GTB_Uninstaller";a.init=function(){this.writeExtensionInfoToRegistry_()};
a.delayedInit=function(){if(GTB_Uninstaller.uninstallVerboseAndShutdown)try{var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator),c=b.getMostRecentWindow("navigator:browser");GTB_ShowUninstallDialog(c,true)}catch(d){GTB_UninstallExtension("3112ca9c-de6d-4884-a869-9855de68056c")}};
a.writeExtensionInfoToRegistry_=function(){try{var b=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);b.create(Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER,"SOFTWARE\\Google\\Toolbar for Firefox",Ci.nsIWindowsRegKey.ACCESS_ALL);var c=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties).get("ProfD",Ci.nsIFile),d=b.createChild(c.leafName,Ci.nsIWindowsRegKey.ACCESS_ALL);d.writeStringValue("path",c.path);if(GTB_Uninstall_isLocalExtension())d.hasValue("global")&&
d.removeValue("global");else d.writeStringValue("global","true");d.close();b.close()}catch(e){b&&b.close();d&&d.close()}};
a.handleUninstall=function(){GTB_Uninstall_isLocalExtension()||runExeUninstaller();var b=Cc["@google.com/toolbar/content-prefs;1"].getService().wrappedJSObject;for(var c in b.fileTypes)b.unassociateFile(c);Cc["@google.com/toolbar/linkdoctor;1"].getService().wrappedJSObject.uninstall();b=Cc["@mozilla.org/preferences;1"].getService(Ci.nsIPrefService);c=b.getBranch("google.toolbar.");c.deleteBranch("");c=b.getBranch("metrics.");c.deleteBranch("");try{Cc["@google.com/dictionarycompression;1"].getService(Ci.GIDictionaryCompressionService).uninstall()}catch(d){}GetPlatform()==
1&&this.uninstallWindows();try{b.savePrefFile(null)}catch(e){}b=["GoogleToolbarData","gtb-metrics.xml","gtb-metrics-config.xml"];c=0;for(var f;f=b[c];++c){var g=G_File.getProfileFile();g.append(f);try{g.remove(g.isDirectory())}catch(h){}}(new GTB_Pinging).clearAll()};
a.uninstallWindows=function(){try{var b=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);b.open(Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE,"SOFTWARE\\Google\\Toolbar for Firefox",Ci.nsIWindowsRegKey.ACCESS_ALL);b.removeValue("id");b.close()}catch(c){}try{b.open(Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER,"SOFTWARE\\Google\\Toolbar for Firefox",Ci.nsIWindowsRegKey.ACCESS_ALL);var d=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties).get("ProfD",Ci.nsIFile);
b.hasChild(d.leafName)&&b.removeChild(d.leafName);var e=b.childCount==0;b.close();if(e){b.open(Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER,"SOFTWARE\\Google",Ci.nsIWindowsRegKey.ACCESS_ALL);b.removeChild("Toolbar for Firefox");b.close()}}catch(f){b&&b.close()}};a.handleUpgrade=function(){var b=new G_Preferences("google.toolbar.");b.clearPref("custombuttons.installed");var c=b.getPref("done_page_shown","");(c=c&&c.indexOf("AU_")==0)||b.setPref("uninstall_collapsed",true);G_Preferences.savePrefFile()};
a.onEmActionRequested_=function(b,c,d){b=b.QueryInterface(Ci.nsIUpdateItem);b=b.id.toLowerCase();if(b=="{3112ca9c-de6d-4884-a869-9855de68056c}"){b=Cc["@mozilla.org/preferences;1"].getService(Ci.nsIPrefService);b=b.getBranch("google.toolbar.");c=Cc["@google.com/toolbar/content-prefs;1"].getService().wrappedJSObject;if(d=="item-uninstalled"){b.setBoolPref("uninstall_pending",true);GTB_SaveLayout();c.restoreFirefoxMailtoPrefs();GTB_SubmitUninstallFeedback(null);if(GTB_Uninstaller.uninstallVerboseAndShutdown){d=
Cc["@mozilla.org/toolkit/app-startup;1"].getService(Ci.nsIAppStartup);d.quit(Ci.nsIAppStartup.eForceQuit)}}else if(d=="item-disabled"){GTB_SaveLayout();c.restoreFirefoxMailtoPrefs();(new GTB_SendPings).sendDisablePing()}else if(d=="item-cancel-action"){b.prefHasUserValue("uninstall_pending")&&b.clearUserPref("uninstall_pending");GTB_RestoreLayout();c.restoreToolbarMailtoPrefs()}}};
a.checkNeedToUninstall_=function(){var b=false;try{var c=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);c.open(Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER,"SOFTWARE\\Google\\Toolbar for Firefox",Ci.nsIWindowsRegKey.ACCESS_ALL);var d=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties).get("ProfD",Ci.nsIFile);if(c.hasChild(d.leafName)){var e=c.openChild(d.leafName,Ci.nsIWindowsRegKey.ACCESS_ALL);if(e.hasValue("uninstall")){b=true;e.removeValue("uninstall")}e.close()}c.close()}catch(f){c&&
c.close()}return b};
a.onXpcomShutdown_=function(){var b=Cc["@mozilla.org/preferences;1"].getService(Ci.nsIPrefService);b=b.getBranch("google.toolbar.");this.checkNeedToUninstall_()&&!b.prefHasUserValue("uninstall_pending")&&GTB_UninstallExtension("3112ca9c-de6d-4884-a869-9855de68056c");if(b.prefHasUserValue("uninstall_pending"))this.handleUninstall();else{b=GetEmResourceValue("urn:mozilla:item:{3112ca9c-de6d-4884-a869-9855de68056c}","http://www.mozilla.org/2004/em-rdf#opType");if("needs-uninstall"==b){this.handleUninstall();
this.uninstallExtension("{3112ca9c-de6d-4884-a869-9855de68056c}")}else"needs-upgrade"==b&&this.handleUpgrade();this.emActionObserver_.unregister()}};a.uninstallExtension=function(b){try{var c=Cc["@mozilla.org/extensions/manager;1"].getService(Ci.nsIExtensionManager);c.uninstallItem(b)}catch(d){}};
function GTB_TuneUninstall(b,c,d){var e=c.commands.cmd_uninstall;c.commands.cmd_uninstall=function(h){if(h.id.indexOf("3112ca9c-de6d-4884-a869-9855de68056c")>=0){GTB_ShowUninstallDialog(b.defaultView,true);h=b.getElementById("cmd_cancelUninstall");"true"==h.getAttribute("disabled")&&h.setAttribute("disabled",!GTB_Uninstaller.canUndo)}else e(h)};var f=c.commands.cmd_disable;c.commands.cmd_disable=function(h){if(h.id.indexOf("3112ca9c-de6d-4884-a869-9855de68056c")>=0){GTB_SendPings.disableStarted();
f(h);GTB_SendPings.disableFinished()}else f(h)};var g=c.isCommandEnabled;c.isCommandEnabled=function(h){var i=g(h),j=d.selectedItem;if(!j||"urn:mozilla:item:{3112ca9c-de6d-4884-a869-9855de68056c}"!=j.id)return i;switch(h){case "cmd_uninstall":return i||!!getRegistryInstallLocation();case "cmd_cancelUninstall":return i&&GTB_Uninstaller.canUndo;default:return i}}}goog.exportSymbol("GTB_TuneUninstall",GTB_TuneUninstall);
function GTB_ShowUninstallDialog(b,c){var d=!GTB_Uninstall_isLocalExtension();b.openDialog("chrome://google-toolbar/content/uninstall.xul",null,"close=yes,centerscreen,modal",!!c,d)}goog.exportSymbol("GTB_ShowUninstallDialog",GTB_ShowUninstallDialog);
function GTB_UninstallExtension(b){var c=Components.classes["@mozilla.org/extensions/manager;1"].getService(Components.interfaces.nsIExtensionManager);if("uninstallExtension"in c)c.uninstallExtension("{"+b+"}");else if("uninstallItem"in c)c.uninstallItem("{"+b+"}");else return false;return true}
function getRegistryInstallLocation(){var b=null;try{var c=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);c.open(Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE,"Software\\Mozilla\\Firefox\\Extensions",Ci.nsIWindowsRegKey.ACCESS_READ);b=c.readStringValue("{3112ca9c-de6d-4884-a869-9855de68056c}");c.close()}catch(d){}return b}
function runExeUninstaller(){var b=getRegistryInstallLocation();GTB_getInstallFile().path;GTB_Uninstaller.canUndo=b==null;if(b)try{b=b;var c=Cc["@mozilla.org/file/local;1"].createInstance(Ci.nsILocalFile);c.initWithPath(b);c.append("uninstaller.exe");"uninstaller: "+c.path+", exists: "+c.exists();if(c.exists())c.launch();else throw Error("Program not found: "+c.path);return true}catch(d){}try{var e=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);e.open(Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE,
"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\{2CCBABCB-6427-4A55-B091-49864623C43F}",Ci.nsIWindowsRegKey.ACCESS_READ);if(e.hasValue("UninstallerPath")){var f=Cc["@mozilla.org/file/local;1"].createInstance(Ci.nsILocalFile);f.initWithPath(e.readStringValue("UninstallerPath"));var g=Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess);g.init(f);g.run(false,["/S"],1)}return true}catch(h){}GTB_Uninstaller.canUndo=true;return false}
function GTB_Uninstall_isLocalExtension(){var b=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties).get("ProfD",Ci.nsIFile),c=Cc["@mozilla.org/extensions/manager;1"].getService(Ci.nsIExtensionManager);return(c=c.getInstallLocation("{3112ca9c-de6d-4884-a869-9855de68056c}").location)&&b.contains(c,true)}
function GTB_Uninstall_uninstall(b,c,d){b=!!d&&!GTB_Uninstaller.uninstallVerboseAndShutdown;c=c?0:1;d=new G_Preferences("google.toolbar.");d.setPref("uninstall_pending",true);if(GTB_Uninstall_isLocalExtension())runExeUninstaller();else if(!GTB_Uninstaller.uninstallVerboseAndShutdown&&!b)c=2;if(GTB_UninstallExtension("3112ca9c-de6d-4884-a869-9855de68056c"))if(b){c=Cc["@mozilla.org/toolkit/app-startup;1"].getService(Ci.nsIAppStartup);c.quit(Ci.nsIAppStartup.eRestart|Ci.nsIAppStartup.eForceQuit)}else{c=
c||0;if(c!=0){c=c==1?"google-uninstall.finalMessage":"google-uninstall.finalMessageAdmin";b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);d=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");b=d.GetStringFromName(c);c=d.GetStringFromName(c+".title");alert(b,c)}}};function GTB_HistoryItem(b,c,d){this.debugZone="search-history-item";this.query=b;this.queryTime=(new Date).getTime();this.uri=c||"";this.searchType=d||"gtbSearchGoogle";this.count=1;this.icon_=null}GTB_HistoryItem.prototype.comment="";GTB_HistoryItem.prototype.__defineGetter__("icon",function(){if(this.icon_)return this.icon_;if(this.searchType){var b=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;return(b=b.getButton(this.searchType))?b.getIconDefault():"chrome://google-toolbar/skin/custom-unknown.png"}return GTB_LayoutUtil.getGoogleSearchIconUrl()});
GTB_HistoryItem.prototype.__defineSetter__("icon",function(b){this.icon_=b});GTB_HistoryItem.fromDOM=function(b){for(var c=new GTB_HistoryItem(""),d=["query","uri","searchType"],e=0,f=null;f=d[e];++e)c[f]=b.getAttribute(f)||"";if(!c.searchType)c.searchType="gtbSearchGoogle";d=["queryTime","count"];for(e=0;f=d[e];++e){var g=b.getAttribute(f)||0;c[f]=parseInt(g,10)}return c};
GTB_HistoryItem.prototype.toDOM=function(b){for(var c=["query","uri","searchType","queryTime","count"],d=0,e=null;e=c[d];++d)b.setAttribute(e,this[e]);return b};GTB_HistoryItem.prototype.equals=function(b){return this.uri&&this.uri==b.uri||this.canonicalize()==b.canonicalize()&&this.searchType==b.searchType};GTB_HistoryItem.prototype.canonicalize=function(){return this.query.trim().toLowerCase()};function GTB_SearchHistoryService(){this.debugZone="search-history-service";this.history_=[];this.prefs_=null;this.wrappedJSObject=this}GTB_SearchHistoryService.HISTORY_MAX_ELEMENTS=100;
GTB_SearchHistoryService.prototype.init=function(){var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");GTB_HistoryItem.prototype.comment=b.GetStringFromName("google-suggest.history");this.prefs_=new G_Preferences("google.toolbar.",false,true);this.prefs_.addObserver("search_box_save_history",BindToObject(this.onHistoryPrefChanged_,this));this.observers_=[new G_ObserverServiceObserver("GTB_CLEAR_HISTORY",
BindToObject(this.clearHistory_,this)),new G_ObserverServiceObserver("GTB_CLEAR_HISTORY",BindToObject(this.clearBrowserSearchHistory_,this)),new G_ObserverServiceObserver("GTB_SEARCH_PERFORMED",BindToObject(this.onSearch_,this))];new G_ObserverServiceObserver("xpcom-shutdown",BindToObject(this.shutdown_,this),true);this.prefs_.getPref("search_box_save_history")&&this.loadHistory_()};
GTB_SearchHistoryService.prototype.getHistoryItems=function(b,c){var d=[],e=b||"";e=e.toLowerCase();for(var f=!c,g=0,h=null;h=this.history_[g];++g){var i=h.query.toLowerCase().startsWith(e);if((h.query[0]=='"'||h.query[0]=="'")&&h.query.substring(1).toLowerCase().startsWith(e))i=true;if(i)if(f||GTB_SearchHistoryService.matchTypes_(c,h.searchType))d.push(h)}return d};GTB_SearchHistoryService.matchTypes_=function(b,c){return b==c||c=="url"&&(b=="gtbSearchGoogle"||b=="gtbFFSearch")};a=GTB_SearchHistoryService.prototype;
a.isEmpty=function(){return this.history_.length==0};
a.loadHistory_=function(b){b=b||"searchhistory.xml";var c=this.prefs_.getUnicodePref("search_box_history","");if(c){var d=c.split("\n");c=null;for(b=0;c=d[b];++b)c.length>0&&this.history_.push(new GTB_HistoryItem(c));this.prefs_.clearPref("search_box_history");this.saveHistory_()}else{c=GTB_getDataDir();c.append(b);if(c.exists()){try{d=G_FirefoxXMLUtils.loadXML(c)}catch(e){}if(d){this.history_=[];for(b=0;b<d.documentElement.childNodes.length;++b){c=d.documentElement.childNodes[b];this.history_.push(GTB_HistoryItem.fromDOM(c))}}}}};
a.saveHistory_=function(b){var c=b||"searchhistory.xml";b=G_FirefoxXMLUtils.newXML("searches");var d=b.documentElement;d.setAttribute("version","1.0");for(var e=0,f=null;f=this.history_[e];++e){var g=b.createElement("search");g=f.toDOM(g);d.appendChild(g)}d=GTB_getDataDir();GTB_ensureDirectoryExists(d);d.append(c);c=Cc["@mozilla.org/network/file-output-stream;1"].createInstance(Ci.nsIFileOutputStream);c.init(d,G_File.PR_WRONLY|G_File.PR_CREATE_FILE|G_File.PR_TRUNCATE,-1,0);d=Cc["@mozilla.org/xmlextras/xmlserializer;1"].createInstance(Ci.nsIDOMSerializer);
d.serializeToStream(b.documentElement,c,"UTF-8");c.close()};a.shutdown_=function(){for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.saveHistory_()};
a.clearBrowserSearchHistory_=function(){try{for(var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator),c=b.getEnumerator("navigator:browser");c.hasMoreElements();){var d=c.getNext().document.getElementById("searchbar");d&&d.textbox.reset()}var e=Cc["@mozilla.org/satchel/form-history;1"].getService(Ci.nsIFormHistory2);e.removeEntriesForName("searchbar-history")}catch(f){}};a.clearHistory_=function(){this.history_=[];this.saveHistory_()};
a.removeFromHistory=function(b){for(var c=0,d;d=this.history_[c];++c)if(d.equals(b)){this.history_.splice(c,1);break}};a.addToHistory_=function(b){if(!GTB_IsPrivateBrowsing()){var c=new GTB_SearchData(b);b=c.query;var d=c.uri;c=c.type;if(b.trim()!==""){b=new GTB_HistoryItem(b,d,c);d=this.history_;c=[b];for(var e=GTB_SearchHistoryService.HISTORY_MAX_ELEMENTS,f=0;f<d.length&&c.length<e;f++)if(d[f].equals(b)){b.count=d[f].count+1;b.searchType=d[f].searchType}else c.push(d[f]);this.history_=c}}};
a.onSearch_=function(b,c,d){this.prefs_.getPref("search_box_save_history")&&this.addToHistory_(d)};a.onHistoryPrefChanged_=function(){this.prefs_.getPref("search_box_save_history")||this.clearHistory_()};function GTB_SearchData(b){b=b.split("\n");this.query=b[0];this.uri=b[1];this.type=b[2]};function GTB_getSearchLocale(){var b=new G_Preferences("google.toolbar.");return b.getPref("search_locale","none")}function GTB_SearchService(){this.debugZone="search-service";this.prefs_=new G_Preferences("google.toolbar.");this.wrappedJSObject=this;this.lastPreconnectHost_=null;this.lastPreconnectTime_=0}GTB_SearchService.PRECONNECT_TIMEOUT=9E4;GTB_SearchService.GTB_PREF_PRECONNECT="search_box_preconnect";a=GTB_SearchService.prototype;
a.executeSearch=function(b,c,d,e,f,g,h){var i=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;i=i.getButton(c);var j="";if(i){j=b.GTB_getToolbar()._getCurrentBrowser().currentURI;j=i.getQueryURL(d,e,j);if(f)j+=f;this.loadSearchUrl(b,j,g,h);this.broadcastSearch(d,j,c)}};a.shouldPreconnect_=function(b){return this.prefs_.getPref(GTB_SearchService.GTB_PREF_PRECONNECT,true)&&GTB_isGoogleDomain(b)&&(this.lastPreconnectHost_!==b||Date.now()-this.lastPreconnectTime_>GTB_SearchService.PRECONNECT_TIMEOUT)};
a.tryPreconnect=function(b){var c=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;b=c.getButton(b);this.tryPreconnectToUrl_(b.getQueryURL("","",undefined))};
a.tryPreconnectToUrl_=function(b){var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);try{var d=c.newURI(b,null,null),e=d.host.toLowerCase();if(this.shouldPreconnect_(e)){d.path="/generate_204";var f=c.newChannelFromURI(d);b={onStartRequest:function(){},onStopRequest:function(){},onDataAvailable:function(){},onChannelRedirect:function(){}};f.asyncOpen(b,null);this.lastPreconnectHost_=e;this.lastPreconnectTime_=Date.now();var g=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);
g.notifyObservers(null,"GTB_SEARCH_PRECONNECT",e)}}catch(h){}};a.tryPreconnectToBrowserEngine=function(){var b=Cc["@mozilla.org/browser/search-service;1"].getService(Ci.nsIBrowserSearchService);b=b.currentEngine;(b=b.getSubmission("",null))&&this.tryPreconnectToUrl_(b.uri.spec)};
a.loadSearchUrl=function(b,c,d,e){var f=b.GTB_getToolbar(),g=f._getTabBrowser(),h=this.prefs_.getPref("search_new_window_or_tab",null);if(d||h=="newTab"){b=f._getCurrentLocation().href;if(b==="about:blank"||b==="chrome://google-toolbar/content/new-tab.html")f._getCurrentBrowser().loadURI(c,null,null);else{c=g.addTab(c);if(this.prefs_.getPref("select_new_tab"))g.selectedTab=c}}else if(h=="newWindow")b.open(c,"gtbSearchWindow");else e&&("click"==e.type||"command"==e.type)?b.openUILink(c,e,false,true):
f._getCurrentBrowser().loadURI(c,null,null)};a.broadcastSearch=function(b,c,d){d=d||"";b=[b,c,d].join("\n");c=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);c.notifyObservers(null,"GTB_SEARCH_PERFORMED",b)};function GTB_GaiaSettings(b){GTB_StartupProfiler.timestamp("+GTB_GaiaSettings");this.win_=b;this.debugZone="gaia";this.gaiaService_=Cc["@google.com/toolbar/gaia-service;1"].getService().wrappedJSObject;this.signInWindow=null;b=GTB_getGoogleHome();this.continueUrl_=uri_create("http",null,b.replace("www","toolbar"),-1,"/command",["close_browser"],null);this.observerHandler_=BindToObject(this.onGaiaChange_,this);this.observers_=[new G_ObserverServiceObserver("gaia-signin-change",this.observerHandler_),
new G_ObserverServiceObserver("gaia-email-change",this.observerHandler_),new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.gaiaUpdateUI_,this))];b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.SIGN_OUT_LABEL_=b.GetStringFromName("prop.gtb.gaia.signout");this.SIGN_IN_LABEL_=b.GetStringFromName("prop.gtb.gaia.signin");this.SIGN_OUT_NOEMAIL_LABEL_=b.GetStringFromName("prop.gtb.gaia.signout.noemail");
this.SIGN_IN_TOOLTIP_=b.GetStringFromName("prop.gtb.gaia.signin.tooltip");this.SIGN_OUT_TOOLTIP_=b.GetStringFromName("prop.gtb.gaia.signout.tooltip");this.SIGN_OUT_NOEMAIL_TOOLTIP_=b.GetStringFromName("prop.gtb.gaia.signout.noemail.tooltip");this.MANAGE_ACCOUNT_TOOLTIP_=b.GetStringFromName("prop.gtb.gaia.account");this.SYNCED_IN_LABEL_=b.GetStringFromName("prop.gtb.gaia.syncout");this.SYNCED_OUT_LABEL_=b.GetStringFromName("prop.gtb.gaia.syncin");this.checkModeChanged_();this.gaiaInitUI_();new G_Alarm(BindToObject(this.gaiaUpdateUI_,
this),1E3);GTB_StartupProfiler.timestamp("-GTB_GaiaSettings")}a=GTB_GaiaSettings.prototype;a.shutdown=function(){for(var b=0;b<this.observers_.length;b++)this.observers_[b].unregister()};a.gaiaIsToolbarSynced=function(){return this.gaiaService_.gaiaIsToolbarSynced()};a.lastMode_=null;a.checkModeChanged_=function(){var b=this.win_.document.getElementById("gtbToolbar");if(!b)return false;b=b.getAttribute("mode");var c=this.lastMode_!=b;this.lastMode_=b;return c};a.gaiaInitUI_=function(){this.setUIState_(false)};
a.gaiaUpdateUI_=function(){GTB_StartupProfiler.timestamp("+GTB_GaiaSettings.gaiaUpdateUI_");this.setUIState_(this.gaiaService_.gaiaIsSignedIn());GTB_StartupProfiler.timestamp("-GTB_GaiaSettings.gaiaUpdateUI_")};
a.setUIState_=function(b){if(this.win_.document){var c=this.win_.document.getElementById("gtbGaiaMenuitem"),d=this.win_.document.getElementById("gtbSignings"),e=this.win_.document.getElementById("gtbToolbarSyncMenuitem");if(c&&d){if(b){b=this.SIGN_OUT_NOEMAIL_LABEL_;var f=this.SIGN_OUT_NOEMAIL_TOOLTIP_,g=this.gaiaService_.gaiaUserEmail();if(g){b=this.SIGN_OUT_LABEL_.replace("%s",g);f=this.SIGN_OUT_TOOLTIP_.replace("%s",g)}else g="";d.setAttribute("label",GTB_truncateWithElipsis(g.split("@")[0],9));
d.setAttribute("tooltiptext",this.MANAGE_ACCOUNT_TOOLTIP_);c.setAttribute("label",b);c.setAttribute("tooltiptext",f);c.setAttribute("signedin","true");d.setAttribute("signedin","true");c=this.gaiaIsToolbarSynced();d.setAttribute("tbsync",c);e.hidden=false;e.setAttribute("label",c?this.SYNCED_IN_LABEL_:this.SYNCED_OUT_LABEL_);if(GTB_GeckoVersion.isFirefox2()&&this.checkModeChanged_()){d.setAttribute("type","menu-button");new G_Alarm(BindToObject(d.setAttribute,d,"type","menu"),0)}else d.setAttribute("type",
"menu")}else{d.setAttribute("label",this.SIGN_IN_LABEL_);c.setAttribute("label",this.SIGN_IN_LABEL_);d.setAttribute("tooltiptext",this.SIGN_IN_TOOLTIP_);c.setAttribute("tooltiptext",this.SIGN_IN_TOOLTIP_);c.setAttribute("signedin","false");d.setAttribute("signedin","false");d.setAttribute("tbsync","false");e.hidden=true;d.setAttribute("type","menu-button")}d=this.win_.document.getElementById("gtbSettingsItem");e=this.win_.document.getElementById("gtbSettingsSpacer");if(d.parentNode.id=="gtbToolbar"&&
(d.nextSibling==null||d.nextSibling.id=="gtbChevron")){d.setAttribute("flex","1");e.style.display="inline"}else{d.setAttribute("flex","0");e.style.display="none"}d=this.win_.GTB_getToolbar().chevron;d.doResize();this.closeOpenPopups_(this.win_.document.getElementById("gtbToolbar"))}}};a.closeOpenPopups_=function(b){b=b.getElementsByTagName("menupopup");for(var c=0;c<b.length;++c)goog.isFunction(b[c].hidePopup)&&b[c].hidePopup()};
a.gaiaSignIn=function(b){if(this.signInWindow_&&!this.signInWindow_.closed)this.signInWindow_.focus();else{var c=GTB_getLangCode();c="https://www.google.com/accounts/ServiceLogin?service=toolbar&nui=1&hl={LANG}&continue={CONT}&zx={RAND}".replace("{LANG}",c);c=c.replace("{CONT}",encodeURIComponent(this.continueUrl_));c=c.replace("{RAND}",Math.floor(Math.random()*32768));var d;d=this.win_;var e=d.screen.left+d.screenX+(d.outerWidth-350)/2,f=d.screen.top+d.screenY+(d.outerHeight-350)/2;e=Math.min(d.screen.left+
d.screen.width-350,e);e=Math.max(e,d.screen.left);f=Math.min(d.screen.top+d.screen.height-350,f);f=Math.max(f,d.screen.top);d="width=350,height=350,left="+e+",top="+f;d=d+",toolbars=no,menubar=no,status=no,resizable=yes,scrollbars=yes";this.signInWindow_=this.win_.open(c,"gtbGaiaLogin",d);c=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);c=c.getMostRecentWindow("navigator:browser");c.addEventListener("keypress",BindToObject(this.onKeyPress_,this),true)}if(b)this.gtbCallbackAfterClose=
b};a.onKeyPress_=function(b){b.keyCode==Ci.nsIDOMKeyEvent.DOM_VK_ESCAPE&&b.currentTarget.close()};a.gaiaSignOut=function(){GTB_GaiaService.openHiddenWindow("https://www.google.com/accounts/Logout?continue={CONT}&zx={RAND}",this.continueUrl_)};a.onGaiaChange_=function(b,c){if(c=="gaia-signin-change"||c=="gaia-email-change"&&this.gaiaService_.gaiaIsSignedIn())this.gaiaUpdateUI_()};a.handleMenuitemClick=function(){this.gaiaService_.gaiaIsSignedIn()?this.gaiaSignOut():this.gaiaSignIn()};function GTB_GaiaService(){this.debugZone="gaia-service";this.wrappedJSObject=this;this.lastGaiaRequestTime_=0;this.lastGaiaResponseTime_=1;this.requestAlarm_=null}a=GTB_GaiaService.prototype;
a.init=function(){this.notifying_=false;this.toolbarPrefs_=new G_Preferences("google.toolbar.");this.cachedEmailLoaded_=this.cryptoInitialized_=false;this.userEmail_=this.crypto_=null;this.isSignedIn_=GTB_getCookie("https://www.google.com/accounts/","SID")!=null&&GTB_getCookie("https://www.google.com/accounts/","LSID",true)!=null;this.tbsync_=false;this.tbSyncManager_=new GTB_ToolbarSyncManager(this);this.msh_=false;this.cookieChangeHandler_=BindToObject(this.observeCookieChanges_,this);new G_ObserverServiceObserver("cookie-changed",
this.cookieChangeHandler_);this.toolbarPrefs_.addObserver("google_home",BindToObject(this.onGoogleHomeChange_,this));this.requestUserInfoHandler_=BindToObject(this.loadUserInfo_,this);this.cachedSID_=null;new G_Alarm(BindToObject(this.checkInfoFreshness_,this),400)};a.getLastGaiaRequestTime=function(){return this.lastGaiaRequestTime_};
a.loadUserInfo_=function(b){this.lastGaiaResponseTime_=Date.now();if(!(!b||!b.responseText||b.status!=200)){var c=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService),d=Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromString(b.responseText,"text/xml"),e=d.getElementsByTagName("email"),f=b=null;if(e&&e[0]&&e[0].hasAttribute("data")){b=e[0].getAttribute("data");if(this.userEmail_!=b&&this.userEmail_!=null&&this.isSignedIn_){this.notifying_=true;this.isSignedIn_=
false;c.notifyObservers(null,"gaia-signin-change",false);this.isSignedIn_=true;c.notifyObservers(null,"gaia-signin-change",true);this.notifying_=false}f=GTB_getCookie("https://www.google.com/accounts/","SID")}var g=d.getElementsByTagName("service");e=d=false;if(g)for(var h=0;h<g.length;++h)switch(g[h].getAttribute("data")){case "tbsync":d=true;break;case "msh":e=true;break}g=this.userEmail_;h=this.tbsync_;var i=this.msh_;this.cacheUserInfo(f,b,d,e);if(g!=b||h!=d||i!=e){this.notifying_=true;c.notifyObservers(null,
"gaia-email-change",this.userEmail_);this.notifying_=false}}};a.getCrypto_=function(){if(!this.cryptoInitialized_){this.cryptoInitialized_=true;try{this.crypto_=new GTB_AutoFillCrypto}catch(b){this.crypto_=null}}return this.crypto_};
a.cacheUserInfo=function(b,c,d,e){this.cachedSID_=b;if(typeof c!="undefined")this.userEmail_=c;if(typeof d!="undefined")this.tbsync_=d;if(typeof e!="undefined")this.msh_=e;if(this.getCrypto_()&&this.cachedSID_&&this.userEmail_){b=[this.userEmail_,this.tbsync_,this.msh_].join("\n");b=this.getCrypto_().encrypt(this.cachedSID_,b);this.toolbarPrefs_.setPref("user.info1",b)}else this.toolbarPrefs_.clearPref("user.info1")};
a.checkInfoFreshness_=function(){var b=GTB_getCookie("https://www.google.com/accounts/","SID");if(this.cachedEmailLoaded_||this.userEmail_){if(this.cachedSID_==b||!this.isSignedIn_)return true;this.requestUserInfo_();return false}this.cachedEmailLoaded_=true;var c=this.toolbarPrefs_.getPref("user.info1");if(this.getCrypto_()&&c)if(b){c=(c=this.getCrypto_().decrypt(b,c))&&c.split("\n");if(!c||c.length!=3){this.requestUserInfo_(true);return false}this.cachedSID_=b;this.userEmail_=c[0];this.tbsync_=
"true"==c[1];this.msh_="true"==c[2];b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);b.notifyObservers(null,"gaia-signin-change",this.isSignedIn_);this.userEmail_&&b.notifyObservers(null,"gaia-email-change",this.userEmail_);return true}this.toolbarPrefs_.clearPref("user.info1");return false};a.refreshNow=function(b){new G_Alarm(BindToObject(this.requestUserInfo_,this,b,true),0)};
a.getMinInterval_=function(){var b=this.toolbarPrefs_.getPref("debug.gaia.interval",0);return b*1E3||9E5};
a.requestUserInfo_=function(b,c){GTB_StartupProfiler.timestamp("+GTB_GaiaService.requestUserInfo_");var d=Date.now()-this.lastGaiaRequestTime_,e=this.lastGaiaRequestTime_>this.lastGaiaResponseTime_,f=this.getMinInterval_();if(!(this.notifying_||e&&d<f))if(d<f&&this.cachedSID_&&!c){if(!this.requestAlarm_)this.requestAlarm_=new G_Alarm(BindToObject(this.requestUserInfo_,this),f-d+10)}else{if(this.requestAlarm_)try{this.requestAlarm_.cancel()}catch(g){}this.requestAlarm_=null;if(!this.userEmail_||!this.cachedSID_||
b||this.cachedSID_!=GTB_getCookie("https://www.google.com/accounts/","SID"))if(GTB_IsOnline()){d="http://www.google.com/tbproxy/getaccountinfo?key="+Date.now();e=new G_XMLFetcher;e.get(d,this.requestUserInfoHandler_);this.lastGaiaRequestTime_=Date.now()}}GTB_StartupProfiler.timestamp("-GTB_GaiaService.requestUserInfo_")};
a.observeCookieChanges_=function(b,c,d){if(d=="cleared"){var e=GTB_getGoogleHome();e=uri_create("http",null,e.replace("www","toolbar"),-1,"/command",["close_browser"],null);var f="https://www.google.com/accounts/ServiceLogin?service=toolbar&nui=1&hl={LANG}&continue={CONT}&zx={RAND}".replace("{LANG}",GTB_getLangCode());GTB_GaiaService.openHiddenWindow(f,e)}b=b?b.QueryInterface(Ci.nsICookie2):null;if(d=="cleared"||GTB_isGoogleDomain(b.host))new G_Alarm(BindToObject(this.handleCookieChanges_,this,b,
c),50)};
a.handleCookieChanges_=function(){var b=this.isSignedIn_,c=GTB_getCookie("https://www.google.com/accounts/","SID");(this.isSignedIn_=c!=null&&GTB_getCookie("https://www.google.com/accounts/","LSID",true)!=null)||this.cacheUserInfo(this.cachedSID_,null,false,false);if(this.isSignedIn_!=b){b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);this.notifying_=true;b.notifyObservers(null,"gaia-signin-change",this.isSignedIn_);this.notifying_=false;this.cachedSID_=null}this.isSignedIn_&&c!=
this.cachedSID_&&this.requestUserInfo_()};a.gaiaIsSignedIn=function(){return this.isSignedIn_};a.gaiaUserEmail=function(){this.checkInfoFreshness_();return this.isSignedIn_&&this.userEmail_||null};
a.onGoogleHomeChange_=function(){var b=this.toolbarPrefs_.getPref("google_home");b=b.split(".").splice(2).join(".");var c="https://www.google.{DOMAIN}/accounts/".replace("{DOMAIN}",b);if(this.isSignedIn_&&(!GTB_getCookie(c,"SID")||!GTB_getCookie(c,"LSID",true))){b="http://toolbar.google.{DOMAIN}/command?close_browser".replace("{DOMAIN}",b);c="https://www.google.com/accounts/CheckCookie?continue={CONT}&zx={RAND}";GTB_GaiaService.openHiddenWindow(c,b)}};
GTB_GaiaService.openHiddenWindow=function(b,c){var d=Cc["@mozilla.org/appshell/appShellService;1"].getService(Ci.nsIAppShellService).hiddenDOMWindow,e=d.document;d=e.getElementById("gtb-gaia-login");if(!d){d=e.createElementNS("http://www.w3.org/1999/xhtml","iframe");d.id="gtb-gaia-login";e=e.body||e.documentElement;e.appendChild(d)}e=b.replace("{CONT}",encodeURIComponent(c)).replace("{RAND}",Math.floor(Math.random()*32768));d.setAttribute("src",e)};
GTB_GaiaService.prototype.gaiaIsToolbarSynced=function(){this.checkInfoFreshness_();return this.isSignedIn_&&this.tbsync_};GTB_GaiaService.prototype.gaiaIsSearchHistoryOn=function(){this.checkInfoFreshness_();return this.isSignedIn_&&this.msh_};GTB_GaiaService.prototype.toggleToolbarSync=function(){this.tbSyncManager_.toggleToolbarSyncStatus()};GTB_GaiaService.prototype.doRefreshSync=function(){this.tbSyncManager_.refreshSync()};function GTB_CB_EditButtonInfo(b){this.prefs_=new G_Preferences("google.toolbar.button_option.");this.name=this.prefs_.getPref(b+".name",null);this.option=this.prefs_.getPref(b+".gadgetOptions",null)}
function GTB_CB_Options(b){this.debugZone="custom-buttons-options";this.prefix_="gtbOptionsCustomButtons";this.prefs_=new G_Preferences("google.toolbar.button_option.");this.prefs_.addObserver("",BindToObject(this.onPrefChange_,this));this.service_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;this.toolbarWindow_=b;this.doc_=null;this.observers_=[];this.editedButtons_={};this.removedButtons_=[];this.dragDropObserver_=null}a=GTB_CB_Options.prototype;
a.onLoad=function(b){this.doc_=b.document;b.addEventListener("unload",BindToObject(this.onUnload,this),false);this.observers_=[new G_ObserverServiceObserver("GTB_CB_ADD",BindToObject(this.onAddButton_,this)),new G_ObserverServiceObserver("GTB_CB_REMOVE",BindToObject(this.onRemoveObserver_,this)),new G_ObserverServiceObserver("GTB_CB_NAMECHANGE",BindToObject(this.onButtonNameChange_,this)),new G_ObserverServiceObserver("GTB_CB_UPDATE",BindToObject(this.onButtonUpdate_,this))];b=this.doc_.getElementById(this.prefix_+
"Container");for(var c=this.service_.getList().toArray(),d=0;d<c.length;d++){var e=c[d],f=this.service_.getButton(e);if(f)if(!f.isSearchTypeWithoutButton()){this.addPreferenceElt_(e);e=this.createListItem_(f);b.appendChild(e)}}this.updateButtons();this.dragDropObserver_=new GTB_CB_DragDropInList(this.doc_,this.prefix_)};a.onUnload=function(){for(var b=0;b<this.observers_.length;b++)this.observers_[b].unregister();this.dragDropObserver_=this.prefs_=null};
a.onPrefChange_=function(b){var c=b.indexOf(".");if(c!=-1)b=b.substr(0,c);this.updateItemLabel_(b)};a.onAddButton_=function(b,c,d){b=this.service_.getButton(d);if(!b.isSearchTypeWithoutButton()){this.addPreferenceElt_(d);d=this.createListItem_(b);b=this.doc_.getElementById(this.prefix_+"Container");b.insertBefore(d,b.firstChild);this.updateButtons()}};
a.onButtonUpdate_=function(b,c,d){if(b=this.doc_.getElementById(d+"-listitem")){d=this.service_.getButton(d);d=this.createListItem_(d);c=this.doc_.getElementById(this.prefix_+"Container");c.replaceChild(d,b)}};a.onButtonNameChange_=function(b,c,d){this.updateItemLabel_(d)};a.updateItemLabel_=function(b){var c=this.doc_.getElementById(b+"-listitem");if(c){c=c.getElementsByTagName("label")[0];b=this.service_.getButton(b);c.setAttribute("value",b.getNameFull())}};
a.addPreferenceElt_=function(b){var c=this.doc_.createElement("preference"),d="google.toolbar.button_option."+b;b="gtbPref"+b;c.setAttribute("id",b);c.setAttribute("name",d);c.setAttribute("type","bool");d=this.doc_.getElementById("gtbSearchPreferences");d.appendChild(c)};
a.createListItem_=function(b){var c=b.getID(),d="gtbPref"+c,e=this.doc_.createElement("richlistitem");e.setAttribute("id",c+"-listitem");e.setAttribute("value",c);b.canRemove()||e.setAttribute("gtb-read-only",true);e.setAttribute("align","center");var f=b.getDescriptionDefault();e.setAttribute("tooltiptext",f);var g=this.doc_.createElement("checkbox");g.setAttribute("value",c);g.setAttribute("checked",this.prefs_.getPref(c));g.setAttribute("preference",d);g.setAttribute("tooltiptext",f);c=this.doc_.createElement("image");
c.setAttribute("class","gtb-custombutton-icon");c.setAttribute("src",b.getIconDefault());c.setAttribute("tooltiptext",f);d=this.doc_.createElement("label");d.setAttribute("value",b.getNameFull());d.setAttribute("tooltiptext",f);d.setAttribute("crop","end");g.setAttribute("class","gtbCustomButtonListItem");e.appendChild(g);e.appendChild(c);e.appendChild(d);return e};
a.onRemoveObserver_=function(b,c,d){b=this.doc_.getElementById(this.prefix_+"Container");d=this.doc_.getElementById(d+"-listitem");if(b&&d){c=b.selectedIndex;b.removeChild(d);d=Math.min(c,b.getRowCount()-1);if(d>-1)b.selectedIndex=d;this.updateButtons()}};a.onBeforeAccept=function(){var b=this.doc_.getElementById(this.prefix_+"Container");b=b.childNodes;for(var c=Array(b.length),d=0;d<b.length;d++)c[d]=b[d].getAttribute("value");this.service_.setButtonList(c)};
goog.exportSymbol("GTB_CB_Options.prototype.onBeforeAccept",GTB_CB_Options.prototype.onBeforeAccept);GTB_CB_Options.prototype.onKeyPress=function(b){if(b.keyCode==b.DOM_VK_DELETE){b=this.doc_.getElementById(this.prefix_+"RemoveButton");b.disabled||this.removeButton()}};goog.exportSymbol("GTB_CB_Options.prototype.onKeyPress",GTB_CB_Options.prototype.onKeyPress);goog.exportProperty(GTB_CB_Options.prototype,"onKeyPress",GTB_CB_Options.prototype.onKeyPress);
GTB_CB_Options.prototype.updateButtons=function(){var b=this.doc_.getElementById(this.prefix_+"Container"),c=this.doc_.getElementById(this.prefix_+"EditButton"),d=this.doc_.getElementById(this.prefix_+"RemoveButton"),e=b.selectedIndex==-1;c.setAttribute("disabled",e);c=e||b.selectedItem.hasAttribute("gtb-read-only");d.setAttribute("disabled",c);d=this.doc_.getElementById(this.prefix_+"MoveUpButton");c=this.doc_.getElementById(this.prefix_+"MoveDownButton");if(e){d.setAttribute("disabled",true);c.setAttribute("disabled",
true)}else{d.setAttribute("disabled",b.selectedIndex==0);c.setAttribute("disabled",b.selectedIndex+1==b.getRowCount())}b.ensureSelectedElementIsVisible()};goog.exportSymbol("GTB_CB_Options.prototype.updateButtons",GTB_CB_Options.prototype.updateButtons);GTB_CB_Options.prototype.addButton=function(){this.toolbarWindow_.openDialog("chrome://browser/content/","_blank","chrome,all,dialog=no",GTB_CB_Options.getButtonGalleryUrl())};goog.exportSymbol("GTB_CB_Options.prototype.addButton",GTB_CB_Options.prototype.addButton);
GTB_CB_Options.getButtonGalleryUrl=function(){return"http://www.google.com/tools/toolbar/buttons/gallery?hl="+GTB_getLangCode()};GTB_CB_Options.prototype.selectButtonItem_=function(b){var c=this.doc_.getElementById(this.prefix_+"Container");b=this.doc_.getElementById(b+"-listitem");c.selectedItem=b};GTB_CB_Options.prototype.openEditorFor=function(b){this.selectButtonItem_(b);this.editButton()};goog.exportSymbol("GTB_CB_Options.prototype.openEditorFor",GTB_CB_Options.prototype.openEditorFor);
GTB_CB_Options.prototype.editButton=function(){var b=this.doc_.getElementById(this.prefix_+"Container");if(b.selectedItem){b=b.selectedItem.value;var c=this.service_.getButton(b),d=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);d=d.getMostRecentWindow("GoogleToolbar:CustomButtons:Edit");this.editedButtons_[b]||(this.editedButtons_[b]=new GTB_CB_EditButtonInfo(b));if(d){c=d.arguments[0];c.setButtonToEdit(d,b)}else{c=new GTB_CB_EditDialogController(c,this.service_);this.doc_.defaultView.openDialog("chrome://google-toolbar/content/custom-buttons-edit.xul",
"gtbCustomButtonsEdit","modal,centerscreen,chrome,resizabe=no",c)}}};goog.exportSymbol("GTB_CB_Options.prototype.editButton",GTB_CB_Options.prototype.editButton);GTB_CB_Options.prototype.restoreRemovedButtons=function(){for(;this.removedButtons_.length>0;){var b=this.removedButtons_.pop();this.service_.installButton(b)}};goog.exportSymbol("GTB_CB_Options.prototype.restoreRemovedButtons",GTB_CB_Options.prototype.restoreRemovedButtons);
GTB_CB_Options.prototype.restoreChangedButtons=function(){for(var b in this.editedButtons_){var c=this.editedButtons_[b],d=this.service_.getButton(b);this.service_.restoreButtonOptions(d,c.name,c.option)}this.editedButtons_={}};goog.exportSymbol("GTB_CB_Options.prototype.restoreChangedButtons",GTB_CB_Options.prototype.restoreChangedButtons);
GTB_CB_Options.prototype.removeButton=function(){var b=this.doc_.getElementById(this.prefix_+"Container");if(b.selectedItem){var c=Cc["@google.com/toolbar/gaia-service;1"].getService().wrappedJSObject;b=b.selectedItem.value;this.removedButtons_.push(this.service_.getButton(b));this.service_.uninstall(b,c.gaiaIsToolbarSynced())}};goog.exportSymbol("GTB_CB_Options.prototype.removeButton",GTB_CB_Options.prototype.removeButton);
GTB_CB_Options.prototype.moveButtonUp=function(){var b=this.doc_.getElementById(this.prefix_+"Container"),c=b.selectedItem;b.insertBefore(c,c.previousSibling);this.updateButtons()};goog.exportSymbol("GTB_CB_Options.prototype.moveButtonUp",GTB_CB_Options.prototype.moveButtonUp);goog.exportProperty(GTB_CB_Options.prototype,"moveButtonUp",GTB_CB_Options.prototype.moveButtonUp);
GTB_CB_Options.prototype.moveButtonDown=function(){var b=this.doc_.getElementById(this.prefix_+"Container"),c=b.selectedItem;b.insertBefore(c.nextSibling,c);this.updateButtons()};goog.exportSymbol("GTB_CB_Options.prototype.moveButtonDown",GTB_CB_Options.prototype.moveButtonDown);goog.exportProperty(GTB_CB_Options.prototype,"moveButtonDown",GTB_CB_Options.prototype.moveButtonDown);GTB_CB_Options.prototype.getDragDropObserver=function(){return this.dragDropObserver_};
goog.exportSymbol("GTB_CB_Options.prototype.getDragDropObserver",GTB_CB_Options.prototype.getDragDropObserver);goog.exportProperty(GTB_CB_Options.prototype,"getDragDropObserver",GTB_CB_Options.prototype.getDragDropObserver);function GTB_CB_DragDropInList(b,c){this.debugZone="custom-buttons-options-dnd";this.doc_=b;this.prefix_=c}GTB_CB_DragDropInList.BUTTON_ID_FLAVOR="application/x-googletoolbar-custombutton-id";
GTB_CB_DragDropInList.prototype.onDragStart=function(b,c){var d=this.findContainingItem_(b.target);if(d!=null){d=d.getAttribute("value");c.data=new TransferData;c.data.addDataForFlavour(GTB_CB_DragDropInList.BUTTON_ID_FLAVOR,d)}};goog.exportProperty(GTB_CB_DragDropInList.prototype,"onDragStart",GTB_CB_DragDropInList.prototype.onDragStart);GTB_CB_DragDropInList.prototype.onDragOver=function(){};goog.exportProperty(GTB_CB_DragDropInList.prototype,"onDragOver",GTB_CB_DragDropInList.prototype.onDragOver);
GTB_CB_DragDropInList.prototype.getSupportedFlavours=function(){var b=new FlavourSet;b.appendFlavour(GTB_CB_DragDropInList.BUTTON_ID_FLAVOR);return b};GTB_CB_DragDropInList.prototype.onDrop=function(b,c){var d=c.data;d=d+"-listitem";d=this.doc_.getElementById(d);var e=this.doc_.getElementById(this.prefix_+"Container"),f=this.findContainingItem_(b.target);f==null?e.appendChild(d):e.insertBefore(d,f)};goog.exportProperty(GTB_CB_DragDropInList.prototype,"onDrop",GTB_CB_DragDropInList.prototype.onDrop);
GTB_CB_DragDropInList.prototype.findContainingItem_=function(b){var c=this.doc_.getElementById(this.prefix_+"Container");if(b==c)return null;for(;b!=null&&b.parentNode!=c;)b=b.parentNode;return b};function GTB_IsAlpha(b){return!!GTB_UNICODE_DB[b.charCodeAt(0)]}function GTB_HasAlpha(b){for(var c=0;c<b.length;c++)if(GTB_IsAlpha(b.charAt(c)))return true;return false}
var GTB_UNICODE_DB=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,
0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,0,3,3,0,0,3,3,3,3,0,0,0,0,0,0,0,0,3,0,3,3,3,0,3,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,5,0,5,5,0,5,5,0,5,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,
5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,0,6,6,6,6,6,6,6,6,0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0,6,6,6,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,
1,0,0,1,1,0,0,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,0,0,1,1,
1,1,1,1,1,1,1,0,1,1,1,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,0,1,1,1,1,0,0,0,1,1,0,1,0,1,1,0,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,
0,0,0,0,1,1,1,1,1,0,0,0,1,1,1,0,1,1,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,
1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,1,0,1,0,0,1,0,0,0,0,0,0,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,0,0,1,
1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,
0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,
1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,0,0,3,3,3,3,3,3,
3,3,0,3,0,3,0,3,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,0,3,0,0,0,3,3,3,0,3,3,3,3,3,3,3,0,0,0,3,3,3,3,0,0,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,3,3,3,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,
0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,8,8,8,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,
8,8,8,8,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,
8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,9,12,9,9,9,10,12,12,12,12,9,12,10,9,11,10,9,10,12,11,12,9,12,11,10,10,10,10,12,11,9,9,10,9,10,10,11,10,9,9,10,9,9,12,9,9,12,9,9,9,10,9,9,9,11,12,10,12,9,10,10,9,9,9,11,12,9,12,9,9,10,10,9,12,10,9,
12,12,10,9,9,9,10,9,11,9,12,11,9,9,9,12,12,12,10,10,9,9,9,9,10,9,9,9,9,9,9,9,9,9,10,10,9,12,9,9,9,9,9,9,9,9,9,9,12,9,9,9,11,9,9,9,12,9,11,10,9,12,12,9,12,10,9,12,12,9,12,12,9,9,9,11,10,12,9,9,11,12,9,12,11,9,12,12,12,10,9,9,9,12,12,12,11,9,9,9,10,11,9,9,9,9,9,11,12,9,9,9,9,9,11,12,9,9,9,10,12,12,9,9,12,12,9,12,10,9,9,9,9,10,11,11,12,12,12,12,9,9,9,9,11,9,9,9,9,12,12,12,9,9,9,9,10,9,10,9,9,9,12,9,12,9,9,9,12,9,9,9,9,12,9,9,9,11,9,9,9,9,9,9,9,9,9,11,12,9,9,12,12,12,12,12,9,9,9,9,9,10,10,10,10,9,9,9,
10,10,10,9,9,9,10,9,9,9,9,9,10,9,9,9,9,12,9,9,9,9,12,9,9,10,12,9,12,9,12,9,9,9,9,9,9,9,9,9,12,9,11,9,9,9,9,12,12,12,12,12,9,10,11,12,9,12,9,12,9,11,12,9,12,9,12,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,9,9,9,12,9,11,9,9,9,9,9,12,9,9,9,12,9,9,9,9,10,9,11,9,11,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,12,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,12,12,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,12,9,9,11,12,12,9,9,9,9,11,12,9,9,9,11,9,9,9,9,9,9,9,9,12,11,9,9,9,9,12,12,12,11,12,9,9,9,9,9,9,9,9,9,9,9,10,12,12,9,12,9,9,9,9,9,9,11,
9,12,9,9,9,12,9,9,9,9,9,9,11,9,9,9,11,9,11,9,12,9,11,9,11,12,9,9,9,11,9,12,12,12,9,9,9,9,12,9,12,9,11,9,11,12,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,10,9,9,9,9,12,9,9,9,12,9,11,9,9,9,9,12,12,9,9,9,9,9,11,9,9,9,9,12,9,12,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,12,12,9,9,9,9,9,11,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,9,9,11,9,9,9,12,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,11,9,11,9,9,12,11,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,11,11,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,
12,9,9,9,9,9,9,9,9,9,9,11,9,12,9,9,9,9,9,12,12,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,11,9,9,9,9,12,9,9,9,11,9,9,9,9,9,9,9,9,12,9,11,11,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,11,9,9,10,12,12,9,12,12,12,12,11,12,12,9,12,9,12,9,9,9,9,11,9,12,9,10,11,9,9,10,9,12,9,9,9,9,9,12,9,9,12,9,11,12,11,9,12,12,12,12,9,10,12,9,10,10,12,12,12,12,10,9,10,12,10,9,9,12,9,9,9,9,10,9,9,10,9,11,9,10,12,9,11,9,12,12,11,9,11,9,11,9,10,9,10,10,9,11,9,12,9,12,9,12,11,9,9,9,9,9,9,12,
9,9,10,12,9,10,10,9,10,11,12,9,9,9,9,9,9,9,9,9,9,9,9,10,9,12,9,9,10,9,12,12,11,9,10,9,10,9,9,9,9,9,9,9,9,9,10,11,12,9,9,12,12,9,9,10,9,9,9,9,9,9,9,9,10,9,9,12,11,9,12,9,9,12,9,9,11,12,10,9,12,9,10,12,11,9,12,9,9,12,12,12,9,9,9,9,9,12,9,9,12,10,9,9,9,11,12,10,10,10,10,9,12,9,9,9,9,9,9,11,11,9,9,9,12,9,10,9,9,11,9,12,9,9,9,9,9,12,11,9,9,12,12,9,9,9,9,9,12,9,9,9,9,9,11,9,9,12,11,12,12,9,9,10,10,9,9,11,9,12,9,9,9,9,11,12,11,9,9,9,9,9,9,9,10,9,9,9,12,9,9,9,9,11,12,9,9,12,9,9,11,9,9,9,9,9,9,9,9,9,12,9,
9,9,11,11,9,9,11,12,11,11,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,10,10,12,12,10,9,12,9,9,9,9,10,12,11,12,11,12,9,9,9,10,10,10,9,9,9,9,9,9,9,9,9,9,11,10,9,11,9,11,9,9,9,12,9,12,9,10,9,9,9,9,9,9,12,9,9,11,9,11,11,11,9,11,9,11,11,12,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,11,9,11,9,9,9,11,12,9,9,9,9,9,12,12,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,12,12,9,11,9,9,9,11,9,9,12,12,9,12,9,9,9,9,9,9,11,9,9,9,9,11,9,11,9,9,9,9,9,9,9,12,10,10,9,9,9,12,11,12,9,12,9,9,9,12,12,9,12,9,9,9,10,10,9,12,12,12,11,
10,10,12,9,9,12,9,11,9,12,9,12,9,10,9,9,9,11,10,9,9,9,10,11,9,9,11,12,12,9,12,10,12,9,12,11,11,9,11,9,9,9,12,9,9,9,9,11,10,10,9,9,10,9,10,10,9,9,9,9,9,9,9,12,10,9,9,9,9,12,9,9,9,9,12,9,9,9,9,9,11,9,9,10,9,9,9,9,11,10,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,9,10,9,9,10,11,9,9,9,9,12,12,12,12,10,12,9,9,9,10,9,9,12,9,12,12,10,10,9,12,9,9,9,11,9,11,11,12,12,12,12,9,11,12,12,12,12,9,11,12,12,12,12,12,9,12,10,10,12,10,9,9,9,9,9,9,9,12,9,12,12,9,9,9,12,12,12,9,12,12,12,12,12,12,9,10,9,10,9,9,9,9,9,12,9,12,12,12,
11,9,9,9,9,9,12,9,9,12,9,11,10,9,9,10,9,9,9,11,10,9,11,9,11,12,9,11,11,9,12,9,11,9,11,9,9,9,12,9,12,9,12,9,9,9,9,9,10,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,12,9,12,9,9,9,9,9,11,12,12,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,9,11,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,12,9,9,12,12,11,9,12,9,9,9,9,12,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,11,9,9,9,12,9,9,11,12,9,9,9,12,12,9,9,9,11,9,9,9,9,9,9,9,12,9,9,11,9,9,
9,9,9,9,9,9,11,10,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,12,9,9,9,9,9,11,9,11,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,12,9,9,9,9,9,12,11,12,9,9,9,11,12,12,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,11,9,12,12,9,12,9,9,9,9,9,9,9,12,11,9,11,9,11,9,11,9,9,9,9,9,9,9,9,10,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,11,9,9,12,9,9,9,12,12,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,12,9,9,9,9,9,11,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,12,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,12,9,12,11,12,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,11,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,11,
9,9,9,9,9,9,9,9,12,12,9,9,12,9,12,9,10,9,9,9,9,9,9,9,9,9,9,10,9,9,12,9,9,9,10,9,9,11,9,9,12,9,9,10,10,9,9,9,9,11,9,9,10,9,12,9,9,12,9,11,9,9,9,9,11,11,9,9,11,9,11,9,9,9,9,9,9,12,9,9,9,10,9,9,9,9,12,9,9,9,9,12,9,9,12,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,12,9,11,9,11,10,12,12,9,9,9,9,9,10,9,9,10,10,9,9,10,10,10,12,9,9,12,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,12,9,12,9,9,9,9,9,11,9,9,9,9,12,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,12,9,9,9,9,9,9,9,12,9,9,11,12,9,9,9,9,9,9,9,9,9,9,10,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,9,9,9,9,11,11,11,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,12,9,9,9,9,11,9,9,11,9,9,11,12,9,11,9,9,9,12,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,11,9,11,9,9,12,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,10,9,
9,11,9,11,12,9,9,9,9,9,9,9,9,11,11,9,9,11,9,11,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,11,9,9,12,9,9,9,11,9,11,9,9,9,9,9,9,11,9,9,12,9,11,9,12,9,9,11,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,12,11,9,10,11,10,9,9,10,9,9,10,9,9,9,11,9,11,11,9,9,9,9,9,9,10,9,9,10,9,9,9,9,9,10,9,12,9,9,9,9,11,12,12,9,9,12,12,9,12,9,9,9,11,9,11,9,11,11,9,12,9,12,12,12,9,11,12,9,9,12,9,9,10,9,9,12,10,10,10,9,9,9,11,9,9,10,9,9,12,9,9,12,12,12,9,10,9,9,11,12,11,11,9,9,12,12,9,11,9,9,11,9,9,9,9,9,12,9,12,9,9,9,9,11,9,11,11,9,9,9,11,
9,9,11,9,12,12,9,9,9,12,9,9,9,11,12,9,9,9,9,12,12,12,9,10,10,9,9,9,9,9,9,9,11,9,9,12,12,9,9,12,9,9,12,9,9,9,11,9,9,9,9,9,9,9,11,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,12,9,9,12,9,9,9,9,9,9,9,9,9,9,9,11,12,9,9,9,9,11,12,9,12,12,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,9,9,10,9,12,9,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,12,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,10,9,12,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,12,9,9,9,9,9,9,12,9,9,12,9,9,9,9,9,10,9,10,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,11,9,9,12,11,9,12,12,10,12,9,9,12,9,12,9,9,9,12,12,9,10,9,9,12,9,11,9,9,9,9,12,11,9,9,9,9,9,9,11,9,12,9,9,12,9,9,9,10,9,11,11,12,9,12,12,12,9,12,11,9,9,11,9,9,9,11,9,9,9,12,12,12,12,12,12,10,10,9,10,10,12,12,12,12,12,9,9,9,10,10,9,9,11,9,12,9,9,12,12,12,12,9,9,12,9,9,9,10,10,12,9,9,11,9,12,11,12,12,9,9,9,9,12,9,9,9,11,9,12,12,9,9,9,9,9,9,9,9,9,10,11,12,9,12,11,9,11,9,11,11,12,11,9,11,11,9,11,9,11,9,9,9,9,11,11,9,12,10,12,10,10,9,9,10,9,12,9,9,12,9,10,11,11,12,12,
11,9,11,11,12,9,12,9,9,10,9,12,9,10,9,12,9,9,10,9,9,9,9,9,9,11,9,9,10,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,12,12,12,9,11,10,12,9,11,9,10,9,9,12,9,9,12,9,9,12,9,11,9,12,11,11,9,9,9,12,9,9,9,9,9,9,9,9,10,9,12,10,11,9,11,12,10,9,11,9,9,9,11,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,9,9,9,9,9,9,9,9,9,12,9,9,9,12,12,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,12,9,12,9,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,
9,9,9,11,9,9,11,9,9,9,11,9,11,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,11,9,9,9,9,9,12,9,11,11,9,9,12,9,9,9,9,9,9,9,9,9,12,9,11,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,11,9,11,9,
9,9,9,9,9,12,12,9,9,12,12,9,9,12,12,11,12,9,9,12,9,9,12,9,9,12,12,12,11,9,9,12,9,9,9,9,9,11,12,9,9,9,12,12,9,10,11,9,10,9,9,9,11,9,9,9,10,9,9,9,9,11,11,9,10,11,12,12,10,12,9,9,9,9,9,9,9,11,10,9,9,9,9,11,9,12,10,9,9,9,9,11,9,9,11,11,12,9,9,10,9,11,9,9,9,9,9,11,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,12,9,11,11,9,9,11,9,9,9,11,9,12,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,12,12,12,9,12,9,12,11,9,11,12,12,11,10,9,9,9,9,10,9,10,11,9,9,12,9,9,9,9,11,10,9,9,10,10,11,11,12,9,10,11,9,12,9,10,10,9,9,9,9,9,9,12,12,9,
9,9,11,9,12,9,9,9,9,9,9,9,11,12,12,11,9,9,9,9,9,11,9,9,11,11,9,9,9,9,9,11,12,12,11,9,9,9,9,9,9,12,9,9,9,11,9,9,11,11,9,9,11,9,11,9,11,11,11,9,9,9,9,11,11,9,9,11,9,9,9,9,9,9,11,9,9,12,12,9,9,12,9,9,9,9,9,10,9,10,10,12,9,9,11,11,9,11,9,9,9,9,11,9,10,11,12,11,12,9,11,12,9,9,11,9,9,9,12,10,9,9,9,9,9,12,9,9,12,9,9,9,9,9,9,9,12,9,9,9,11,9,11,9,9,10,9,12,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,11,9,11,9,9,9,10,10,9,10,9,9,11,9,9,9,9,11,9,9,9,9,12,9,11,11,9,12,9,12,12,9,11,12,9,9,12,12,9,9,9,9,9,11,9,12,9,10,12,
9,9,11,12,12,11,9,10,12,9,11,9,9,11,12,11,9,9,9,12,11,12,9,9,9,9,12,11,12,9,9,9,9,11,9,9,12,9,9,9,9,9,9,11,11,12,9,9,9,12,9,9,9,9,9,9,11,9,12,9,11,9,9,11,11,9,9,9,9,9,12,9,12,9,9,9,9,9,9,12,12,9,9,9,9,12,9,9,9,12,12,12,12,9,9,9,12,9,9,12,9,9,9,11,9,9,10,9,9,9,12,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,9,12,9,12,10,10,9,9,9,9,9,9,9,9,9,9,9,9,12,12,9,9,12,9,9,12,12,9,9,9,9,9,10,12,9,9,12,11,9,9,9,12,9,12,12,9,12,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,11,11,12,9,9,11,9,9,9,9,10,9,12,9,9,12,9,9,9,9,
12,9,9,9,12,9,9,9,9,9,9,9,9,12,12,12,11,9,9,12,12,12,9,11,12,9,12,12,9,9,9,9,9,10,9,10,9,9,9,10,10,9,9,9,9,9,11,11,11,9,9,9,12,9,9,11,11,9,9,9,9,11,9,12,9,11,9,9,9,12,9,9,9,9,12,11,9,9,12,9,9,10,9,9,9,9,9,10,9,9,10,9,9,12,9,11,11,11,9,9,9,11,9,11,11,9,9,9,9,9,9,9,12,11,12,9,9,10,9,9,9,9,9,9,12,9,9,9,11,9,9,9,9,12,9,12,9,9,12,12,11,9,9,9,9,9,10,10,9,9,9,9,10,10,10,12,11,11,12,9,9,12,9,9,12,9,9,9,9,9,9,11,12,9,9,9,9,11,9,12,11,9,9,9,11,9,12,9,9,9,9,9,12,9,9,9,9,12,11,9,9,9,12,9,9,9,9,10,9,9,12,9,9,
9,9,11,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,12,9,9,9,9,11,9,9,11,12,9,9,11,12,11,12,9,9,9,9,9,9,12,9,9,11,9,11,9,9,9,9,11,9,9,12,11,9,9,9,11,12,9,9,9,9,9,11,9,12,9,9,9,9,11,11,12,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,12,9,11,11,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,12,9,11,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,11,11,11,12,12,11,11,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,11,9,9,9,11,11,11,12,11,9,9,9,9,9,9,11,
12,9,11,9,12,11,12,10,12,12,12,9,9,12,12,9,10,9,12,9,9,9,9,12,9,11,11,9,9,9,9,9,9,9,12,9,9,9,12,9,11,9,11,12,12,9,11,10,9,9,9,9,9,9,12,12,12,11,9,9,9,9,9,11,12,11,9,12,9,12,10,9,9,10,11,12,9,9,9,9,12,9,9,12,9,9,9,9,9,9,9,11,9,9,9,10,9,9,9,10,10,11,12,12,10,9,9,11,9,9,12,9,9,11,11,9,11,9,9,12,11,9,9,9,12,9,9,9,9,9,12,9,9,9,9,9,9,11,11,11,9,12,12,12,12,9,10,10,9,9,9,9,10,9,10,9,10,10,9,9,9,9,9,12,12,9,9,9,9,12,9,9,9,12,9,9,9,12,9,9,12,12,9,9,9,9,12,9,11,9,12,9,12,12,11,11,9,12,9,12,9,9,12,11,12,9,12,
11,11,12,11,12,12,9,9,10,9,9,9,10,9,10,10,9,10,10,9,9,12,12,9,12,9,12,9,11,12,9,9,11,9,9,9,11,11,12,12,12,9,12,12,9,9,9,9,12,9,12,9,9,9,9,9,9,11,12,9,9,9,9,11,9,9,9,9,9,9,9,9,10,9,10,9,9,10,10,9,9,11,9,11,12,9,9,9,12,9,9,9,9,9,9,9,9,9,9,12,9,9,12,11,9,9,9,9,9,9,9,10,9,9,12,9,9,9,11,11,9,12,9,9,9,9,12,9,9,9,9,9,9,9,9,10,10,9,9,10,9,9,9,9,12,11,9,9,9,9,9,10,9,9,11,11,9,9,9,9,12,9,9,9,12,9,11,9,9,11,9,9,11,11,9,9,9,12,11,9,9,12,9,12,9,9,11,12,9,9,9,11,9,12,11,9,11,9,9,9,9,12,11,12,12,9,12,9,11,12,12,
12,9,11,9,9,9,9,9,9,10,9,9,9,10,9,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,12,9,12,9,9,9,12,9,9,9,11,11,9,9,9,9,9,12,9,11,9,9,9,9,9,9,12,9,9,12,11,9,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,11,9,9,9,9,9,9,11,9,11,9,9,9,9,11,9,11,9,9,9,9,9,12,9,9,9,12,9,9,9,9,11,12,9,11,9,11,9,12,12,9,9,9,9,9,9,12,9,11,9,9,9,10,9,9,9,9,9,9,9,9,9,10,9,10,10,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,12,9,9,11,9,9,9,11,9,9,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,11,9,9,11,9,11,9,9,9,9,11,9,9,9,9,9,9,10,9,9,11,11,9,9,
9,9,9,9,9,11,9,11,11,9,9,9,9,12,9,11,9,9,9,12,9,9,9,9,9,12,11,9,9,9,11,9,11,9,12,9,9,11,9,11,9,9,9,9,9,9,9,10,11,12,9,11,11,9,11,12,9,11,12,9,11,9,9,11,11,9,12,12,9,12,9,12,9,11,9,9,9,9,9,11,9,9,9,10,9,11,9,12,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,11,11,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,11,11,9,11,11,11,9,9,9,9,11,9,9,9,9,9,9,9,11,9,11,9,9,12,9,9,9,9,9,9,12,9,12,12,9,12,9,9,12,12,9,9,9,9,9,12,9,9,12,9,9,9,10,9,9,11,9,12,9,9,9,12,11,11,11,12,9,10,9,11,11,9,9,9,
12,12,9,9,12,9,11,9,9,9,12,9,9,9,10,9,12,9,12,11,9,12,11,9,9,9,9,9,9,9,9,9,11,11,9,9,9,12,9,9,9,9,11,9,9,9,11,11,9,9,9,9,9,12,9,12,9,12,12,9,9,12,9,11,9,9,12,11,9,12,9,10,9,9,11,10,9,12,12,9,9,9,9,9,9,11,11,12,9,9,11,12,9,9,9,12,11,9,12,12,11,9,9,9,9,12,12,9,9,12,9,9,11,9,9,9,9,12,9,9,9,11,9,9,9,9,10,9,12,9,9,12,12,10,12,12,9,9,12,9,9,9,11,12,9,9,11,9,10,10,9,9,12,12,9,9,9,9,9,9,12,11,9,9,12,11,9,9,11,9,12,9,12,12,9,9,9,12,12,12,9,9,9,9,9,9,9,9,9,12,12,9,9,9,9,12,9,12,12,9,9,9,9,12,9,12,9,12,9,9,
11,9,11,9,9,9,9,9,10,9,10,9,9,9,11,12,9,9,9,9,9,11,12,10,12,9,9,11,9,9,11,10,10,9,9,9,9,11,12,9,9,11,9,9,9,9,9,9,11,9,11,9,11,9,9,9,9,9,12,12,9,9,9,9,12,9,9,9,9,9,12,9,9,9,9,9,9,9,10,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,12,12,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,11,9,9,11,9,9,12,9,9,9,9,9,12,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,11,9,9,9,12,9,12,11,12,9,9,11,11,12,9,9,12,9,12,12,12,9,9,11,9,9,9,9,12,12,9,12,9,12,9,9,12,
9,9,9,12,12,9,12,9,9,9,12,9,12,9,12,9,9,9,9,9,9,12,11,12,9,12,12,12,12,9,10,9,12,9,9,11,11,9,9,9,9,10,9,9,12,9,9,10,9,10,10,9,9,12,9,9,11,9,9,9,9,12,9,12,12,9,9,9,9,12,9,9,9,9,9,11,9,9,12,11,10,9,9,9,10,9,9,10,9,9,9,9,12,9,12,10,11,9,11,9,11,9,9,9,9,9,9,9,9,12,12,9,10,9,9,10,9,9,9,9,12,9,9,9,9,9,9,12,9,11,9,9,12,9,12,9,9,11,9,12,12,9,9,9,9,9,10,9,9,9,9,9,9,10,10,9,10,9,12,11,9,9,12,9,9,12,12,9,11,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,11,12,11,9,12,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,
12,9,9,9,9,9,11,9,12,9,12,12,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,10,9,9,10,10,9,9,9,10,9,10,9,9,9,9,10,12,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,10,11,12,9,9,11,11,9,9,11,9,11,12,9,9,9,9,12,9,9,9,12,9,9,9,12,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,12,9,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,11,9,9,11,9,9,9,10,12,11,9,9,9,9,9,9,12,11,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,11,9,9,9,9,9,9,11,
9,11,11,9,9,9,12,9,9,9,9,11,12,9,11,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,11,12,9,9,9,9,9,9,10,9,9,9,12,9,9,9,9,9,9,9,12,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,12,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,11,11,11,11,9,9,9,9,9,11,9,12,9,9,9,9,10,9,9,9,9,9,11,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,
9,9,12,9,9,9,12,9,9,9,9,9,11,9,9,9,9,9,9,9,9,12,11,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,11,11,9,9,9,9,9,9,9,12,9,9,9,9,9,9,11,9,11,9,9,9,11,9,11,9,9,9,9,11,9,9,11,9,11,9,9,9,9,9,9,10,9,9,9,9,9,9,10,9,9,9,12,9,9,9,11,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,
9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,12,10,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,11,9,9,12,11,9,11,12,9,9,9,9,12,9,9,11,12,9,9,9,9,12,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,11,12,12,12,12,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,11,11,9,12,9,9,9,11,11,9,11,
12,12,9,12,9,9,9,12,10,9,9,9,9,9,9,10,9,9,9,11,9,11,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,11,11,9,9,11,9,10,12,9,12,9,9,11,9,11,12,9,12,11,10,9,9,9,12,11,9,9,9,9,12,9,12,9,12,9,9,12,11,12,10,12,11,9,10,9,12,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,12,11,12,9,9,10,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,12,9,9,9,9,9,12,9,9,12,12,9,9,9,9,9,9,10,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,11,9,9,12,12,9,12,
12,12,9,9,10,9,9,9,9,9,11,9,9,9,9,9,12,9,11,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,12,11,9,11,11,9,12,12,9,9,11,9,9,9,11,9,11,11,11,9,11,9,9,12,9,12,9,9,9,10,9,10,9,9,9,10,10,9,9,9,9,9,9,9,12,9,9,11,9,12,9,9,9,9,12,11,9,12,9,12,11,12,9,11,9,9,12,9,9,9,9,12,12,9,11,9,9,9,9,9,9,9,9,12,9,12,9,9,9,12,9,11,9,9,9,9,12,12,9,12,9,9,12,9,10,9,9,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,10,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,12,9,9,9,12,9,9,12,9,9,9,9,9,9,12,9,9,9,11,12,9,9,9,12,9,9,11,11,9,9,9,11,9,9,11,
9,12,9,11,12,9,9,12,9,9,9,10,10,9,9,9,10,10,9,9,10,9,9,10,9,10,9,9,9,9,9,12,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,12,12,9,9,9,11,9,9,9,9,9,11,9,9,12,12,11,9,9,9,9,9,9,9,9,10,9,9,9,9,11,12,12,9,9,12,9,11,9,9,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,10,10,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,12,9,9,9,9,11,9,12,11,9,9,9,11,9,9,9,9,9,11,11,9,9,9,9,9,12,9,11,9,9,11,9,9,9,12,9,9,9,9,9,9,11,11,11,12,9,9,12,12,9,12,9,12,9,11,9,12,9,12,11,12,9,9,9,9,9,9,9,9,9,12,9,9,9,9,10,9,9,9,10,9,10,10,9,9,10,
9,9,10,9,11,12,11,9,12,9,9,12,12,9,9,12,9,9,9,9,10,9,9,11,12,9,11,11,9,9,9,11,9,9,9,12,9,11,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,10,9,10,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,11,11,9,11,9,9,11,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,12,9,9,11,9,11,11,9,9,9,11,12,9,11,11,9,9,9,9,9,12,9,9,11,11,9,11,9,9,12,12,9,9,9,9,10,9,9,9,9,9,9,10,9,9,9,10,9,9,10,10,9,9,9,9,9,11,9,9,11,
9,11,9,9,9,9,9,9,9,9,9,11,11,9,11,9,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,11,9,11,11,9,9,9,9,9,9,9,12,9,9,9,11,9,9,11,11,9,9,9,9,11,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,12,9,9,11,10,9,11,9,9,9,11,9,11,9,9,9,9,9,9,9,9,11,12,11,11,9,9,9,9,9,9,9,12,9,11,9,11,9,9,9,9,9,9,9,12,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,
11,9,9,11,9,9,9,11,12,11,9,9,11,9,11,9,9,9,9,11,11,9,12,11,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,10,9,10,11,9,9,9,9,10,11,9,11,9,9,9,11,11,10,10,9,9,9,9,9,9,9,9,9,10,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,12,12,9,9,9,9,11,9,9,9,9,9,10,11,9,9,
9,9,9,9,9,10,9,9,9,9,9,12,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,10,9,11,9,10,9,9,9,9,9,9,10,10,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,12,9,9,9,9,9,9,11,9,9,9,9,12,9,9,9,9,9,9,9,9,11,12,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,11,9,9,9,11,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,11,9,9,11,9,12,12,11,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,11,9,9,9,12,9,9,9,9,9,
9,9,9,9,9,9,9,12,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,11,9,9,9,11,9,9,9,9,9,12,9,9,9,11,9,9,12,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,11,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,12,9,12,11,9,9,11,10,9,9,9,12,12,9,9,9,11,11,9,12,11,9,9,11,11,9,9,9,11,12,11,9,9,9,12,9,9,9,9,9,12,9,9,9,9,9,9,12,9,12,9,11,9,12,9,12,12,9,9,9,9,12,9,12,9,9,9,9,9,9,9,9,11,9,9,10,9,9,9,12,9,9,9,11,9,9,11,9,9,9,12,9,9,9,
9,9,9,9,9,11,9,9,9,9,12,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,12,9,9,12,9,9,9,9,9,9,10,9,9,10,9,9,9,9,9,9,11,9,12,9,11,9,9,9,10,9,9,9,9,9,11,9,12,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,12,11,9,9,9,9,9,9,9,12,9,9,10,10,10,9,9,10,9,9,9,9,9,9,9,11,9,9,12,11,9,9,9,9,9,9,9,9,9,11,9,9,12,9,9,9,10,9,9,9,9,9,9,9,12,9,9,9,9,12,11,11,9,9,9,9,9,9,9,11,9,9,9,9,10,9,9,9,10,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,12,9,9,11,9,11,11,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,
9,11,10,11,9,9,9,11,9,9,11,9,9,11,9,11,11,9,9,9,9,9,9,9,9,12,9,11,12,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,12,9,11,9,9,9,10,10,9,12,9,9,9,9,11,9,9,10,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,11,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,10,12,9,9,9,12,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,12,9,9,9,11,9,12,9,11,9,11,9,9,12,11,9,9,9,9,9,9,9,10,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,11,9,9,9,9,9,11,12,9,11,11,9,9,9,11,11,9,9,9,9,11,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,11,9,9,11,11,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,12,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,10,9,11,9,9,9,11,9,11,9,12,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,11,10,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,11,9,9,12,9,12,9,11,9,9,12,9,9,11,9,9,11,11,9,12,9,9,12,11,9,9,11,12,12,
12,12,9,10,9,12,11,9,9,10,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,11,12,9,9,12,9,9,9,9,12,9,9,9,9,12,9,9,11,11,9,9,9,9,11,9,9,12,9,9,9,9,12,11,9,9,9,11,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,12,11,9,9,11,12,9,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,12,9,9,10,9,9,9,12,9,9,9,9,9,11,9,9,9,11,11,12,9,9,9,9,9,9,12,9,11,10,9,12,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,12,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,11,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,11,9,9,11,9,9,9,11,9,9,9,9,9,9,9,11,9,9,12,11,12,12,9,9,9,11,9,12,9,12,12,11,9,9,12,9,9,11,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,11,11,9,9,11,9,12,9,12,9,9,12,9,10,10,10,11,9,12,9,10,10,10,9,9,12,11,9,11,12,9,11,9,11,11,9,9,11,9,12,11,9,9,9,12,9,9,12,11,
9,12,9,9,9,12,9,9,9,11,9,12,9,9,12,9,9,9,9,9,11,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,11,9,9,9,9,11,9,9,9,11,9,9,9,12,9,9,9,9,9,9,9,9,9,12,11,9,11,9,12,9,11,9,10,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,12,11,9,9,9,9,12,9,12,9,9,12,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,10,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,12,9,9,11,9,9,11,11,9,11,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,
9,9,12,11,9,9,9,9,9,12,12,9,12,9,9,9,12,9,10,9,12,9,11,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,10,9,12,9,9,9,9,9,9,9,9,9,12,12,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,12,9,9,9,9,9,9,9,9,9,10,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,12,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,10,12,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,12,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,10,9,12,9,12,12,9,9,9,9,9,11,12,9,9,9,9,9,9,9,12,9,9,9,9,11,12,11,9,9,11,9,11,12,12,9,11,9,9,9,11,12,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,10,10,9,11,9,9,9,9,11,10,12,9,9,10,9,9,9,9,9,9,9,9,11,11,12,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,
9,11,9,9,9,11,9,11,11,9,11,9,9,9,9,9,12,10,10,9,12,12,11,12,12,9,9,9,9,9,9,9,12,9,12,9,12,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,11,9,9,9,12,9,9,12,9,9,9,9,9,11,11,9,10,10,9,9,9,9,9,9,9,9,9,9,12,9,10,9,9,12,9,9,9,9,11,9,9,9,9,9,12,9,12,9,9,9,9,9,9,11,9,9,11,9,9,12,9,11,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,10,9,9,9,12,9,9,9,12,11,12,9,11,11,9,9,9,9,9,12,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,11,9,12,10,9,11,12,9,9,9,9,12,9,12,9,10,11,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,11,9,9,9,10,10,9,11,11,9,9,9,9,10,10,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,11,9,11,9,9,11,12,9,9,9,9,9,9,9,9,9,9,10,9,9,11,9,9,9,9,10,12,12,9,9,11,9,12,9,9,9,9,9,9,9,12,9,12,9,9,9,9,9,9,11,9,9,12,12,9,9,9,9,12,9,9,9,10,12,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,11,9,9,9,9,11,9,9,9,9,9,12,9,9,9,9,9,12,9,12,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,12,9,11,9,9,9,11,9,10,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,11,9,9,9,9,9,9,12,9,9,9,10,9,9,9,9,9,9,10,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,12,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,11,12,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,11,11,9,9,11,9,12,12,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,12,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,10,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,12,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,12,9,9,9,9,9,9,9,9,9,9,9,9,11,12,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,9,9,9,12,9,9,9,9,9,10,9,12,9,9,9,9,9,11,9,11,9,9,10,9,9,9,10,9,9,11,11,9,9,9,9,9,9,11,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,11,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,12,9,9,11,9,11,9,11,9,11,11,11,9,9,9,9,11,9,11,9,9,11,9,9,9,11,9,9,11,11,11,11,11,11,9,9,9,12,9,12,9,9,9,9,10,9,9,9,12,9,9,11,12,11,9,9,11,
9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,11,11,9,11,9,9,9,9,9,9,9,9,11,11,9,9,9,9,11,9,9,9,9,9,11,9,9,11,9,9,11,9,9,9,9,11,9,11,9,9,9,9,9,11,9,9,11,11,11,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,11,9,9,9,9,9,9,9,9,11,11,9,9,11,9,9,9,9,9,11,9,9,9,9,9,11,11,9,9,9,11,11,9,11,11,9,9,11,9,11,11,9,11,11,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,11,9,9,11,11,9,11,9,9,11,9,9,9,9,11,11,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,11,9,9,
9,9,9,9,9,9,9,11,11,9,11,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,11,9,9,11,11,11,9,9,9,11,9,9,9,9,9,11,11,9,9,12,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,11,9,9,9,11,9,9,11,9,9,9,9,9,9,9,11,11,11,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,11,11,9,9,9,11,9,9,11,11,9,9,9,10,9,10,10,9,9,10,10,9,9,10,9,10,9,10,10,9,9,10,10,9,10,9,10,10,9,9,9,9,10,9,10,9,9,9,10,9,9,10,10,10,9,10,9,9,10,9,10,9,10,10,10,9,10,9,9,9,10,9,10,10,10,10,10,9,9,10,10,9,9,10,10,9,10,9,
9,9,10,9,9,10,9,9,10,10,10,10,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,10,9,9,9,9,9,9,9,10,9,9,9,9,10,9,9,10,9,10,9,10,9,9,10,9,10,10,9,10,9,9,9,9,9,9,9,9,9,9,10,9,9,10,9,9,9,10,9,9,9,9,9,12,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,12,12,9,10,9,9,10,9,9,9,9,9,9,11,10,11,9,9,9,9,9,11,12,9,9,9,12,9,11,9,12,9,9,11,9,11,9,11,9,9,9,9,11,9,9,9,9,9,9,11,9,9,11,9,12,9,12,9,12,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,11,9,9,12,9,9,9,12,12,9,9,9,9,9,9,9,9,11,9,9,9,9,9,12,11,9,9,9,12,9,12,9,11,9,9,9,11,9,9,9,
9,12,9,9,9,12,9,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,11,12,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,11,9,11,9,9,9,9,9,11,9,12,12,9,9,9,12,12,9,11,9,12,11,9,9,9,9,9,12,9,9,9,12,11,11,9,9,12,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,12,9,9,9,9,10,9,12,9,12,9,9,9,9,9,9,9,9,9,9,11,9,10,9,9,9,9,9,9,9,10,9,11,9,12,9,12,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,11,11,9,11,11,9,9,9,11,9,9,9,9,9,11,11,9,9,9,9,10,9,11,12,9,9,12,9,11,11,9,9,9,9,9,9,11,9,9,11,9,12,9,11,9,9,12,9,9,10,12,12,9,9,12,
9,9,9,12,9,9,9,9,9,12,9,11,12,9,9,9,9,9,9,9,12,9,9,9,9,9,10,10,9,11,12,9,10,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,12,9,9,9,9,9,10,9,11,9,9,12,9,9,12,12,9,10,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,12,9,9,9,9,12,9,9,9,9,12,9,9,11,9,9,11,9,12,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,10,11,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,11,9,9,9,11,9,10,9,9,9,9,9,9,10,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,12,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,11,9,9,11,9,12,9,9,11,12,9,9,9,11,12,9,9,9,9,10,12,11,9,11,9,9,9,
9,9,9,9,12,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,12,9,12,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,12,9,9,11,11,9,9,9,12,9,9,9,9,9,9,11,9,9,9,11,9,11,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,11,9,9,9,12,9,11,9,12,11,9,12,9,9,12,9,9,9,9,9,12,12,9,9,9,9,9,11,11,11,9,12,9,9,9,9,9,9,12,10,11,11,11,11,9,12,12,9,9,9,9,12,9,9,9,9,9,9,9,9,9,12,9,12,12,9,9,9,9,9,9,9,9,9,9,10,9,12,9,9,9,9,9,9,9,9,11,9,9,11,12,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,11,9,9,9,9,9,9,11,
9,11,9,9,9,9,9,9,12,10,11,12,10,9,9,9,9,9,9,10,9,9,9,12,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,10,11,9,11,9,9,9,9,9,12,10,11,9,9,9,9,9,9,9,9,9,12,9,12,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,10,9,9,9,9,10,10,9,10,9,11,11,9,9,9,9,12,9,9,9,11,9,9,12,11,9,9,9,9,9,12,12,9,9,9,9,9,9,9,9,9,9,12,9,9,11,9,9,9,9,11,9,11,9,9,9,9,9,9,12,12,9,12,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,12,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,10,9,9,12,
11,9,9,9,9,11,10,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,10,9,10,9,10,9,9,9,9,9,9,9,10,9,9,9,11,9,9,9,12,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,12,9,9,9,9,9,10,10,9,9,9,9,10,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,11,9,9,9,11,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,10,10,9,10,9,9,9,9,11,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,12,9,9,9,9,9,9,9,12,9,9,11,9,9,9,9,11,12,11,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,10,9,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,11,9,9,9,9,9,11,11,11,9,11,9,9,12,9,9,9,9,11,9,11,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,12,9,9,9,9,9,9,11,9,9,
9,9,9,9,12,9,11,9,9,9,9,9,9,11,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,11,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,11,9,11,9,12,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,11,12,12,9,9,9,9,9,9,9,9,9,9,9,12,11,9,9,9,9,9,9,11,11,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,11,
9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,11,9,12,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,12,10,12,10,9,9,12,11,9,9,9,9,10,11,11,9,12,11,9,9,11,9,9,9,9,11,9,9,9,10,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,10,9,
9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,12,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,
9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,12,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,11,9,9,9,9,12,9,9,9,9,10,9,9,9,9,9,9,12,11,9,9,9,9,9,11,10,9,9,12,9,12,9,11,9,11,9,9,9,12,11,12,9,9,9,9,12,9,9,11,9,9,9,9,12,9,9,9,9,9,9,12,9,9,9,9,9,11,9,11,9,12,9,9,10,10,9,9,9,9,9,12,9,12,9,9,9,9,11,11,9,9,12,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,12,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,12,9,9,10,
9,9,9,9,11,9,9,9,9,11,9,9,11,9,12,9,9,9,11,11,9,9,11,11,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,12,9,9,9,11,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,12,9,11,9,9,9,11,9,12,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,12,9,12,9,9,9,9,12,9,11,9,9,11,9,9,9,11,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,
9,9,9,9,11,9,9,9,9,11,9,9,11,9,9,11,9,9,11,10,10,9,10,10,10,9,10,10,9,9,9,9,9,9,10,10,12,9,11,9,9,9,9,9,9,9,11,9,10,9,9,9,9,12,9,12,10,9,9,9,9,11,9,9,9,9,9,9,9,11,11,9,9,9,11,9,9,9,9,9,9,9,12,9,11,11,9,9,9,9,11,9,11,9,9,9,11,9,9,9,9,11,9,11,11,11,11,9,9,11,9,11,9,11,9,9,9,11,9,9,9,9,9,9,11,9,9,11,9,9,9,11,9,9,11,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,11,9,9,9,9,9,9,9,9,11,9,11,11,11,11,9,9,11,9,9,11,9,9,9,11,11,9,11,11,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,
10,9,9,9,11,9,9,9,11,9,12,9,11,9,9,11,9,9,9,9,9,11,9,11,9,9,11,11,11,11,9,11,9,11,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,11,9,9,9,9,11,9,11,9,11,9,11,9,11,9,9,11,9,9,12,11,9,9,9,9,11,9,11,9,9,9,11,9,9,9,9,11,11,9,9,9,11,9,11,11,9,9,11,9,11,9,9,11,11,11,9,11,9,9,9,11,9,11,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,11,11,9,11,11,11,9,11,9,9,11,9,11,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,11,9,9,9,9,11,9,11,9,11,11,11,9,11,9,9,11,9,
9,9,9,9,9,11,9,9,9,9,9,12,9,9,11,11,9,9,9,11,9,9,11,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,11,9,11,9,11,9,9,9,11,11,9,9,11,9,9,9,11,9,9,9,9,9,9,10,9,9,10,10,9,9,10,10,9,10,9,10,10,9,10,9,10,10,10,9,10,9,10,10,10,9,9,10,10,10,10,9,9,9,10,9,10,9,10,10,9,9,9,10,9,10,9,9,9,9,9,10,9,10,9,9,10,10,9,10,10,9,9,10,9,10,9,10,10,9,9,10,9,9,9,10,9,10,10,10,10,9,10,9,9,10,10,9,10,10,9,9,9,9,10,10,9,10,9,9,9,9,10,9,10,10,10,9,9,10,10,9,10,10,9,10,9,10,9,10,9,9,9,9,10,9,9,9,10,10,10,9,10,9,10,9,9,9,9,9,9,10,9,9,
9,9,9,9,10,12,9,9,9,9,9,9,9,11,9,12,9,9,9,9,11,9,11,9,9,11,9,9,11,9,11,9,9,9,11,11,9,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,12,9,12,12,11,9,9,9,9,9,9,9,9,9,9,9,11,12,12,9,9,9,9,9,9,9,12,9,9,12,9,9,9,9,9,9,12,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,11,11,9,11,11,11,9,9,9,9,11,11,11,11,11,11,9,9,11,9,9,11,11,11,9,11,11,9,9,9,11,11,11,9,9,11,11,11,9,11,9,9,11,11,9,11,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,11,9,11,9,9,9,11,11,11,9,11,9,9,9,11,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,11,9,11,11,9,9,9,9,9,9,11,11,9,9,11,9,11,
9,9,11,9,11,9,9,9,11,9,9,11,9,9,9,9,9,9,10,10,10,9,10,10,10,10,10,9,9,10,10,10,10,9,10,10,10,9,10,10,9,9,10,9,9,9,10,10,9,10,10,10,10,10,9,10,10,10,9,9,9,9,9,9,9,9,10,9,10,10,9,9,9,9,9,10,9,9,9,10,10,9,9,10,9,10,9,10,9,12,9,12,11,9,9,9,11,9,9,9,9,12,9,9,9,12,10,10,12,9,9,9,9,9,9,9,9,9,12,9,9,9,12,9,9,9,9,12,10,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,12,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,12,11,9,11,9,9,11,9,9,9,9,11,9,9,9,9,11,9,11,9,12,9,11,9,
11,9,9,9,9,12,9,12,9,9,9,9,12,9,9,9,12,9,10,9,9,10,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,10,9,10,9,9,12,11,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,12,11,11,11,9,11,9,9,9,11,9,9,9,9,11,9,9,9,12,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,11,9,11,9,9,12,9,9,11,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,12,9,9,10,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,
9,9,11,9,11,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,11,9,9,9,9,9,9,9,11,9,11,9,9,9,11,9,9,9,9,9,9,9,9,11,9,11,11,9,9,9,9,9,11,11,11,9,11,9,9,9,9,9,9,11,9,9,11,11,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,11,11,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,11,9,11,9,9,9,9,10,9,9,10,9,9,10,9,9,9,10,9,9,9,9,10,9,9,10,9,9,10,9,10,9,9,9,9,9,10,10,10,10,10,10,10,9,9,9,9,10,9,9,10,9,10,10,10,10,9,9,9,9,12,12,9,10,11,9,9,9,9,9,9,
11,9,11,10,9,9,9,11,9,11,12,12,11,9,9,9,9,9,9,10,9,9,9,10,10,9,9,10,11,9,11,11,11,10,10,9,9,9,9,9,12,9,10,12,9,12,12,11,9,9,10,10,9,10,10,10,10,10,9,9,11,9,12,9,9,9,9,9,9,12,9,11,9,9,12,9,9,10,11,9,9,12,12,9,9,9,9,12,9,9,12,12,10,12,9,11,12,9,9,10,10,9,9,11,9,12,12,9,10,9,12,11,9,11,9,11,12,9,9,12,12,12,12,11,12,11,9,9,9,9,9,9,9,9,9,9,12,9,9,11,11,9,9,11,12,9,12,9,9,9,12,9,11,9,9,12,12,9,9,9,9,12,9,9,11,11,9,12,11,11,11,11,9,12,11,11,9,10,9,11,9,11,11,9,11,9,11,9,9,12,9,10,9,9,11,11,9,9,9,12,12,9,
9,9,11,9,9,12,11,11,11,9,11,9,11,12,9,12,12,11,11,9,11,9,9,11,12,9,11,9,9,9,9,11,11,12,9,10,9,12,9,9,9,12,9,11,9,9,9,9,11,11,11,12,9,9,11,9,9,9,12,9,9,9,10,11,11,12,9,12,11,12,9,9,12,10,9,10,9,11,9,9,9,10,9,11,9,9,9,9,9,9,12,9,9,9,12,9,9,10,9,9,9,9,9,11,9,9,9,9,9,12,9,11,9,12,11,9,11,9,10,9,12,9,9,9,9,12,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,12,9,12,9,9,11,9,12,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,11,9,12,9,11,12,9,9,9,11,9,9,9,9,9,11,9,9,11,11,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
11,11,11,9,11,12,12,9,9,9,9,12,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,12,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,11,12,11,9,9,9,9,10,10,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,11,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,11,9,11,9,9,11,12,9,9,10,11,12,12,12,12,11,12,9,9,9,9,9,9,11,9,9,9,11,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,12,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,10,9,9,9,9,11,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,12,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,
9,9,11,9,9,9,9,9,11,9,11,9,9,9,11,9,9,9,9,11,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,12,9,9,9,9,9,9,9,11,9,11,11,9,11,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,10,9,9,9,10,10,9,10,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,10,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,
9,9,10,9,9,9,10,9,9,9,9,9,10,10,9,9,9,10,9,9,9,9,9,10,9,9,9,9,10,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,10,10,10,10,10,9,9,9,9,9,9,10,9,10,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,10,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,11,9,9,9,9,9,9,9,10,11,9,9,11,9,9,9,9,9,11,9,11,9,9,9,9,9,11,11,11,11,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,11,11,11,9,9,9,11,9,9,9,9,11,9,9,11,9,11,9,11,9,9,9,9,9,9,9,9,9,12,9,9,11,9,11,9,9,9,9,9,9,11,11,11,9,
9,9,9,9,9,11,9,11,9,9,11,9,9,9,11,9,9,10,9,10,9,9,10,10,9,9,9,10,9,10,10,9,10,9,10,10,10,9,9,9,10,9,10,9,9,9,9,9,9,9,10,10,9,9,10,10,9,9,10,9,9,10,9,10,9,9,10,9,9,12,9,9,10,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,12,10,10,10,10,9,9,9,9,12,9,9,9,12,9,9,12,9,12,10,10,10,10,9,9,12,12,12,9,9,12,9,9,9,9,10,9,9,9,9,9,12,9,11,11,11,9,9,12,11,12,9,9,9,9,10,12,9,9,9,9,9,11,9,9,11,9,12,12,12,11,9,9,9,9,11,9,9,9,9,9,9,11,12,11,9,11,9,11,9,9,9,11,10,10,9,9,9,12,11,9,12,12,12,9,11,11,9,9,9,9,9,9,9,9,9,9,11,11,
9,11,9,9,9,9,9,11,11,9,11,11,9,10,9,11,9,9,11,9,10,10,9,12,12,9,9,12,11,12,9,9,12,9,11,12,12,9,9,9,9,11,9,9,12,11,9,9,11,9,11,11,11,11,9,9,9,11,11,9,9,9,9,12,9,12,9,9,9,9,9,9,9,11,10,9,9,12,12,9,12,9,11,9,9,10,9,12,9,9,9,11,9,12,12,9,9,9,9,9,12,12,11,9,11,9,10,9,9,11,9,9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,12,12,9,9,9,11,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,9,9,9,12,9,9,10,11,9,11,9,12,9,12,12,12,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,11,9,9,9,9,9,9,9,12,9,11,9,9,10,9,9,9,9,9,12,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,10,9,9,10,9,9,9,11,9,9,9,9,9,12,9,9,12,9,9,9,9,11,9,9,9,11,9,11,11,11,9,11,11,9,11,9,9,9,11,9,11,9,11,11,9,11,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,11,11,11,9,11,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,11,11,9,11,9,9,11,9,9,9,9,11,11,9,9,11,9,9,11,9,9,9,9,
9,9,9,9,11,9,9,9,11,9,9,9,11,9,11,9,9,9,10,10,10,9,10,10,10,9,9,10,10,9,9,10,9,10,9,10,10,10,9,9,9,9,10,9,9,10,10,9,10,10,9,10,10,10,10,9,9,10,10,9,9,10,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,10,10,10,9,9,9,9,9,9,9,10,9,9,11,9,9,10,12,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,11,9,9,9,11,11,9,11,9,9,9,12,9,11,11,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,
9,9,9,9,9,9,11,9,9,9,11,9,11,11,9,9,9,9,11,11,9,11,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,10,10,9,10,10,9,9,9,10,10,9,9,9,9,9,9,9,9,10,9,10,9,9,9,9,10,9,10,9,9,9,9,9,9,9,9,10,9,9,10,9,12,11,11,12,9,9,9,9,9,9,9,9,9,9,9,12,9,9,11,9,9,9,11,11,11,9,9,11,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,11,9,9,11,9,9,9,11,9,9,9,11,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,11,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,11,9,11,11,9,11,9,9,9,9,9,11,11,9,9,9,9,9,9,11,9,11,9,9,11,9,11,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,11,9,11,9,9,11,11,9,9,9,11,9,9,11,9,11,11,9,9,9,9,9,9,10,9,9,9,10,10,9,9,10,9,9,9,9,10,9,10,9,9,10,10,9,10,10,9,10,10,9,10,10,9,9,10,10,9,9,10,9,10,9,10,9,9,9,9,9,9,10,9,9,10,9,9,10,9,9,9,10,9,9,10,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,9,9,9,12,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,11,9,11,11,12,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,
9,9,9,9,12,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,11,9,11,11,9,9,9,9,9,11,11,9,11,9,9,9,9,9,9,9,9,9,12,12,9,9,9,9,12,12,9,11,11,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,11,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,
9,9,11,9,9,9,11,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,11,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,11,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,11,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,11,10,10,10,9,10,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,9,9,9,9,10,9,9,9,9,10,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,10,9,9,9,9,9,9,9,9,9,10,9,9,9,9,11,9,9,9,11,9,9,9,11,9,12,9,9,9,9,9,9,9,9,11,9,9,12,9,9,9,9,9,9,11,9,9,9,9,11,9,9,9,9,9,9,9,12,9,9,9,9,9,11,10,9,9,9,9,9,9,9,9,9,9,9,9,9,12,11,9,9,9,9,9,11,11,9,
12,9,9,9,9,11,10,9,9,9,9,9,9,9,9,12,12,9,9,12,9,9,9,9,9,9,12,9,9,12,11,9,11,9,9,9,9,9,9,12,9,9,11,9,9,9,9,9,9,11,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,11,9,9,12,9,11,9,9,9,11,9,9,9,9,9,9,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,12,9,9,9,9,9,11,9,9,9,9,9,9,9,9,11,11,9,11,11,11,10,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,11,9,9,9,11,11,9,9,9,10,10,9,11,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,
4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
2,2,2,2,2,2,2,2,2,2,2,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function GTB_InfoQueryService(b,c){this.debugZone="GTB_InfoQueryService";this.infoQueryUsers_=[];this.latencyInfoQueue_=[];var d=Cc["@google.com/toolbar/pagerank-progress;1"];this.webprogress_=d&&Ci.GTBIPageRankWebProgress&&d.getService(Ci.GTBIPageRankWebProgress);this.wpInfoQueryUser_=new GTB_IQWebProgress;this.iqServerIp_="";this.tabDataManager_=b;this.tabDataManager_.makeContainers(GTB_InfoQueryService.TAB_DATA_KEY_,function(){return new GTB_InfoQueryTabData});this.tabWatcher_=c;this.prefs_=new G_Preferences("google.toolbar.");
GTB_RegisterListener(this.tabWatcher_,G_TabbedBrowserWatcher.events.LOCATIONCHANGE,this.onLocationChange_,this);GTB_RegisterListener(this.tabWatcher_,G_TabbedBrowserWatcher.events.TABSWITCH,this.onTabSwitch_,this);this.customizeObserver_=new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.onCustomize_,this),false);this.privateModeObserver_=new G_ObserverServiceObserver("private-browsing",BindToObject(this.onPrivateBrowsing_,this))}
GTB_InfoQueryService.PREF_ENHANCED_FEATURES_WEEK_="enhanced_features.week";GTB_InfoQueryService.InfoQueryExtraParams_={sourceid:"navclient-ff",client:"navclient-auto-ff"};GTB_InfoQueryService.TAB_DATA_KEY_="info_queries";GTB_InfoQueryService.SERVER_HOST_="toolbarqueries.google.";GTB_InfoQueryService.ALT_SERVER_HOST_="alt1.toolbarqueries.google.";GTB_InfoQueryService.PATH_="/tbr";GTB_InfoQueryService.HASH_SEED_="Mining PageRank is AGAINST GOOGLE'S TERMS OF SERVICE. Yes, I'm talking to you, scammer.";
GTB_InfoQueryService.awesomeHash=function(b){for(var c=16909125,d=0;d<b.length;d++){c^=GTB_InfoQueryService.HASH_SEED_.charCodeAt(d%GTB_InfoQueryService.HASH_SEED_.length)^b.charCodeAt(d);c=c>>>23|c<<9}return GTB_InfoQueryService.hexEncodeU32(c)};GTB_InfoQueryService.hexEncodeU32=function(b){var c=GTB_InfoQueryService.toHex8(b>>>24);c+=GTB_InfoQueryService.toHex8(b>>>16&255);c+=GTB_InfoQueryService.toHex8(b>>>8&255);return c+GTB_InfoQueryService.toHex8(b&255)};
GTB_InfoQueryService.toHex8=function(b){return(b<16?"0":"")+b.toString(16)};a=GTB_InfoQueryService.prototype;a.registerUser=function(b){this.infoQueryUsers_.push(b)};a.unregisterUser=function(b){var c=this.infoQueryUsers_.indexOf(b);if(c>=0)this.infoQueryUsers_.splice(c,1);else"WARNING in unregisterUser(): info queries user "+b.getRequestPrefix()+" was not found."};a.forceSendRequest=function(b,c){this.defferedEventHandler_(b,c)};
a.shutdown=function(){this.customizeObserver_.unregister();this.customizeObserver_=null;this.privateModeObserver_.unregister();this.privateModeObserver_=null};a.getUrlToSendQueryFor_=function(b){var c=b.match(/^https:\/\/[^\/]*[\/]?/i);if(c)return c[0];return b};a.getUrlInfo_=function(b){b=goog.uri.utils.split(b);var c={scheme:"",hasPrivateInfo:false};if(b){c.scheme=b[goog.uri.utils.ComponentIndex.SCHEME]||"";c.hasPrivateInfo=!!b[goog.uri.utils.ComponentIndex.USER_INFO]}return c};
a.getActiveUsers_=function(b,c,d){d=!!(d&&GTB_isLocalIP(d));for(var e=this.getUrlInfo_(c),f=[],g,h=0;g=this.infoQueryUsers_[h];h++)g.isEnabled()&&g.shouldSendRequest(b,c,e.scheme,d,e.hasPrivateInfo)&&f.push(g);return f};
a.prepareAndSendRequest_=function(b,c,d){if(b){var e=b.currentURI&&b.currentURI.asciiSpec;if(e==c){e=this.tabDataManager_.getContainer(b,GTB_InfoQueryService.TAB_DATA_KEY_);e.setHostIp(d)}e=this.getActiveUsers_(b,c,d);if(e.length){for(var f=false,g,h=0;g=this.infoQueryUsers_[h];h++)if(g.isEnabled()&&g.isSleepingPillActive()){f=true;break}if(!f){d=new GTB_InfoQuery(b,c,d,e);f=[];var i=[];for(h=0;g=e[h];h++){var j=g.getRequestPrefix();j&&f.push(j);(g=g.getRequestToSend(b,c))&&i.push(g)}this.latencyInfoQueue_.length>
0&&i.push(this.latencyInfoQueue_.shift());if((h=b.contentWindow)&&c&&this.webprogress_)(h=this.webprogress_.getQueryParameters(h,c))&&i.push(h);(h=this.prefs_.getPref(GTB_InfoQueryService.PREF_ENHANCED_FEATURES_WEEK_,""))&&i.push("swwk="+h);h="http://"+GTB_InfoQueryService.SERVER_HOST_+GTB_getGoogleDomain()+GTB_InfoQueryService.PATH_;h=this.buildQueryString_(h,c,f,i);g="http://"+GTB_InfoQueryService.ALT_SERVER_HOST_+GTB_getGoogleDomain()+GTB_InfoQueryService.PATH_;f=this.buildQueryString_(g,c,f,i);
d.setQueryStatus(GTB_InfoQuery.QueryStatuses.PENDING);d.tickQueryStarted();d=BindToObject(this.handleResponse_,this,d,f);this.sendRequest_(h,d);for(h=0;g=e[h];h++)g.onRequestSend(b,c);this.sendUnsentRequests_()}}}};
a.sendUnsentRequests_=function(){if(this.webprogress_){for(var b=false,c,d=0;c=this.infoQueryUsers_[d];d++)if(c.isEnabled()){b=true;break}if(b){b={};for(c={};;){this.webprogress_.getUnsentQueryParameters(b,c);d=b.value;if(!d)return;var e=c.value;e&&GTB_resolveIp(goog.uri.utils.getDomain(d),BindToObject(this.prepareAndSendUnsentRequest_,this,d,e))}}}};
a.prepareAndSendUnsentRequest_=function(b,c,d){d=!!(d&&GTB_isLocalIP(d));var e=this.getUrlInfo_(b);if(this.wpInfoQueryUser_.shouldSendRequest(null,b,e.scheme,d,e.hasPrivateInfo)){d="http://"+GTB_InfoQueryService.SERVER_HOST_+GTB_getGoogleDomain()+GTB_InfoQueryService.PATH_;e=[this.wpInfoQueryUser_.getRequestPrefix()];c=[c];b=this.buildQueryString_(d,b,e,c);this.sendRequest_(b,null)}};
a.sendRequest_=function(b,c){var d=goog.uri.utils.getDomain(b);GTB_resolveIp(d,BindToObject(this.onInfoQueriesServerIpResolved_,this));d=GTB_BackoffedFetcher.createFetcherForInfoQuery();var e=" GoogleToolbarFF "+GTB_version;GTB_OverrideUserAgent(BindToObject(d.get,d,b,c),e)};
a.handleResponse_=function(b,c,d){b.tickQueryEnded();if((!d||200!=d.status)&&c){d=BindToObject(this.handleResponse_,this,b,"");b.tickQueryStarted();this.sendRequest_(c,d)}else{for(var e=true,f=b.getQueryUsers(),g=b.getBrowser(),h=b.getPageUrl(),i,j=0;i=f[j];j++)e=i.handleResponse(g,h,d&&d.responseText)&&e;if(d.status)if(200!=d.status)b.setQueryStatus(GTB_InfoQuery.QueryStatuses.FAILED);else if(e)c?b.setQueryStatus(GTB_InfoQuery.QueryStatuses.OKAY):b.setQueryStatus(GTB_InfoQuery.QueryStatuses.ALTERNATE_WORKED);
else b.setQueryStatus(GTB_InfoQuery.QueryStatuses.UNPARSABLE);else b.setQueryStatus(GTB_InfoQuery.QueryStatuses.CONNECTION_FAILURE);this.putLatencyInfoInQueue_(b);"Retrieval time: "+b.getQueryTime()}};
a.buildQueryString_=function(b,c,d,e){d="features="+d.join(":")+"&";for(var f in GTB_InfoQueryService.InfoQueryExtraParams_)d+=f+"="+GTB_InfoQueryService.InfoQueryExtraParams_[f]+"&";for(var g=0;f=e[g];g++)d+=f+"&";c=this.getUrlToSendQueryFor_(c);e="8"+GTB_InfoQueryService.awesomeHash(c);d+="ch="+e+"&q=info:"+encodeURIComponent(c);return b+"?"+d};a.putLatencyInfoInQueue_=function(b){if(b.getQueryTime()>=0){b="googleip="+b.getQueryStatus()+";"+this.iqServerIp_+";"+b.getQueryTime();this.latencyInfoQueue_.push(b)}};
a.onInfoQueriesServerIpResolved_=function(b){this.iqServerIp_=b||""};a.onTabSwitch_=function(b){if(b=b.toBrowser){var c=b.currentURI&&b.currentURI.asciiSpec;this.defferedEventHandler_(b,c,true)}};a.onLocationChange_=function(b){var c=b.browser;if(!(typeof b.isTop=="boolean"&&!b.isTop))if(c){b=c.currentURI&&c.currentURI.asciiSpec;this.defferedEventHandler_(c,b,true)}};
a.onCustomize_=function(){var b=this.tabWatcher_.getCurrentBrowser(),c=b&&b.currentURI&&b.currentURI.asciiSpec;b&&c&&this.defferedEventHandler_(b,c,true)};a.onPrivateBrowsing_=function(){if(this.webprogress_){var b={},c={};do this.webprogress_.getUnsentQueryParameters(b,c);while(b.value)}};
a.defferedEventHandler_=function(b,c,d){if(c)if(this.customizeObserver_)if(d)new G_Alarm(BindToObject(this.defferedEventHandler_,this,b,c),10);else{var e;d=this.tabDataManager_.getContainer(b,GTB_InfoQueryService.TAB_DATA_KEY_);if(d.getPageUrl()==c)e=d.getHostIp();e?this.prepareAndSendRequest_(b,c,e):GTB_resolveIp(goog.uri.utils.getDomain(c),BindToObject(this.prepareAndSendRequest_,this,b,c))}};function GTB_InfoQueryUser(){}a=GTB_InfoQueryUser.prototype;a.getRequestPrefix=function(){return""};a.getRequestToSend=function(){return""};a.isEnabled=function(){return false};a.isSleepingPillActive=function(){return false};a.shouldSendRequest=function(){return false};a.onRequestSend=function(){};a.handleResponse=function(){return true};a.isAllowedInternal=function(b,c,d,e){c=c&&c.toLowerCase();return!d&&!e&&("http"==c||"https"==c)};goog.debug={};goog.debug.Error=function(b){this.stack=Error().stack||"";if(b)this.message=String(b)};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.string={};goog.string.Unicode={NBSP:"\u00a0"};goog.string.startsWith=function(b,c){return b.lastIndexOf(c,0)==0};goog.string.endsWith=function(b,c){var d=b.length-c.length;return d>=0&&b.indexOf(c,d)==d};goog.string.caseInsensitiveStartsWith=function(b,c){return goog.string.caseInsensitiveCompare(c,b.substr(0,c.length))==0};goog.string.caseInsensitiveEndsWith=function(b,c){return goog.string.caseInsensitiveCompare(c,b.substr(b.length-c.length,c.length))==0};
goog.string.subs=function(b){for(var c=1;c<arguments.length;c++){var d=String(arguments[c]).replace(/\$/g,"$$$$");b=b.replace(/\%s/,d)}return b};goog.string.collapseWhitespace=function(b){return b.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};goog.string.isEmpty=function(b){return/^[\s\xa0]*$/.test(b)};goog.string.isEmptySafe=function(b){return goog.string.isEmpty(goog.string.makeSafe(b))};goog.string.isBreakingWhitespace=function(b){return!/[^\t\n\r ]/.test(b)};goog.string.isAlpha=function(b){return!/[^a-zA-Z]/.test(b)};
goog.string.isNumeric=function(b){return!/[^0-9]/.test(b)};goog.string.isAlphaNumeric=function(b){return!/[^a-zA-Z0-9]/.test(b)};goog.string.isSpace=function(b){return b==" "};goog.string.isUnicodeChar=function(b){return b.length==1&&b>=" "&&b<="~"||b>="\u0080"&&b<="\ufffd"};goog.string.stripNewlines=function(b){return b.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(b){return b.replace(/(\r\n|\r|\n)/g,"\n")};
goog.string.normalizeWhitespace=function(b){return b.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(b){return b.replace(/\xa0|[ \t]+/g," ")};goog.string.trim=function(b){return b.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};goog.string.trimLeft=function(b){return b.replace(/^[\s\xa0]+/,"")};goog.string.trimRight=function(b){return b.replace(/[\s\xa0]+$/,"")};goog.string.caseInsensitiveCompare=function(b,c){var d=String(b).toLowerCase(),e=String(c).toLowerCase();return d<e?-1:d==e?0:1};
goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g;goog.string.numerateCompare=function(b,c){if(b==c)return 0;if(!b)return-1;if(!c)return 1;for(var d=b.toLowerCase().match(goog.string.numerateCompareRegExp_),e=c.toLowerCase().match(goog.string.numerateCompareRegExp_),f=Math.min(d.length,e.length),g=0;g<f;g++){var h=d[g],i=e[g];if(h!=i){d=parseInt(h,10);if(!isNaN(d)){e=parseInt(i,10);if(!isNaN(e)&&d-e)return d-e}return h<i?-1:1}}if(d.length!=e.length)return d.length-e.length;return b<c?-1:1};
goog.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/;goog.string.urlEncode=function(b){b=String(b);if(!goog.string.encodeUriRegExp_.test(b))return encodeURIComponent(b);return b};goog.string.urlDecode=function(b){return decodeURIComponent(b.replace(/\+/g," "))};goog.string.newLineToBr=function(b,c){return b.replace(/(\r\n|\r|\n)/g,c?"<br />":"<br>")};
goog.string.htmlEscape=function(b,c){if(c)return b.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;");else{if(!goog.string.allRe_.test(b))return b;if(b.indexOf("&")!=-1)b=b.replace(goog.string.amperRe_,"&amp;");if(b.indexOf("<")!=-1)b=b.replace(goog.string.ltRe_,"&lt;");if(b.indexOf(">")!=-1)b=b.replace(goog.string.gtRe_,"&gt;");if(b.indexOf('"')!=-1)b=b.replace(goog.string.quotRe_,"&quot;");return b}};
goog.string.amperRe_=/&/g;goog.string.ltRe_=/</g;goog.string.gtRe_=/>/g;goog.string.quotRe_=/\"/g;goog.string.allRe_=/[&<>\"]/;goog.string.unescapeEntities=function(b){if(goog.string.contains(b,"&"))return"document"in goog.global&&!goog.string.contains(b,"<")?goog.string.unescapeEntitiesUsingDom_(b):goog.string.unescapePureXmlEntities_(b);return b};
goog.string.unescapeEntitiesUsingDom_=function(b){var c=goog.global.document.createElement("a");c.innerHTML=b;c[goog.string.NORMALIZE_FN_]&&c[goog.string.NORMALIZE_FN_]();b=c.firstChild.nodeValue;c.innerHTML="";return b};goog.string.unescapePureXmlEntities_=function(b){return b.replace(/&([^;]+);/g,function(c,d){switch(d){case "amp":return"&";case "lt":return"<";case "gt":return">";case "quot":return'"';default:if(d.charAt(0)=="#"){var e=Number("0"+d.substr(1));if(!isNaN(e))return String.fromCharCode(e)}return c}})};
goog.string.NORMALIZE_FN_="normalize";goog.string.whitespaceEscape=function(b,c){return goog.string.newLineToBr(b.replace(/  /g," &#160;"),c)};goog.string.stripQuotes=function(b,c){for(var d=c.length,e=0;e<d;e++){var f=d==1?c:c.charAt(e);if(b.charAt(0)==f&&b.charAt(b.length-1)==f)return b.substring(1,b.length-1)}return b};goog.string.truncate=function(b,c,d){if(d)b=goog.string.unescapeEntities(b);if(b.length>c)b=b.substring(0,c-3)+"...";if(d)b=goog.string.htmlEscape(b);return b};
goog.string.truncateMiddle=function(b,c,d){if(d)b=goog.string.unescapeEntities(b);if(b.length>c){var e=Math.floor(c/2),f=b.length-e;e+=c%2;b=b.substring(0,e)+"..."+b.substring(f)}if(d)b=goog.string.htmlEscape(b);return b};goog.string.jsEscapeCache_={"\u0008":"\\b","\u000c":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\u000b":"\\x0B",'"':'\\"',"'":"\\'","\\":"\\\\"};
goog.string.quote=function(b){b=String(b);if(b.quote)return b.quote();else{for(var c=['"'],d=0;d<b.length;d++)c[d+1]=goog.string.escapeChar(b.charAt(d));c.push('"');return c.join("")}};goog.string.escapeChar=function(b){if(b in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[b];var c=b,d=b.charCodeAt(0);if(d>31&&d<127)c=b;else{if(d<256){c="\\x";if(d<16||d>256)c+="0"}else{c="\\u";if(d<4096)c+="0"}c+=d.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[b]=c};
goog.string.toMap=function(b){for(var c={},d=0;d<b.length;d++)c[b.charAt(d)]=true;return c};goog.string.contains=function(b,c){return b.indexOf(c)!=-1};goog.string.removeAt=function(b,c,d){var e=b;if(c>=0&&c<b.length&&d>0)e=b.substr(0,c)+b.substr(c+d,b.length-c-d);return e};goog.string.remove=function(b,c){var d=RegExp(goog.string.regExpEscape(c),"");return b.replace(d,"")};goog.string.removeAll=function(b,c){var d=RegExp(goog.string.regExpEscape(c),"g");return b.replace(d,"")};
goog.string.regExpEscape=function(b){return String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=function(b,c){return Array(c+1).join(b)};goog.string.padNumber=function(b,c,d){b=goog.isDef(d)?b.toFixed(d):String(b);d=b.indexOf(".");if(d==-1)d=b.length;return goog.string.repeat("0",Math.max(0,c-d))+b};goog.string.makeSafe=function(b){return b==null?"":String(b)};goog.string.buildString=function(){return Array.prototype.join.call(arguments,"")};
goog.string.getRandomString=function(){return Math.floor(Math.random()*2147483648).toString(36)+(Math.floor(Math.random()*2147483648)^goog.now()).toString(36)};
goog.string.compareVersions=function(b,c){for(var d=0,e=goog.string.trim(String(b)).split("."),f=goog.string.trim(String(c)).split("."),g=Math.max(e.length,f.length),h=0;d==0&&h<g;h++){var i=e[h]||"",j=f[h]||"",k=RegExp("(\\d*)(\\D*)","g"),l=RegExp("(\\d*)(\\D*)","g");do{var m=k.exec(i)||["","",""],n=l.exec(j)||["","",""];if(m[0].length==0&&n[0].length==0)break;d=m[1].length==0?0:parseInt(m[1],10);var o=n[1].length==0?0:parseInt(n[1],10);d=goog.string.compareElements_(d,o)||goog.string.compareElements_(m[2].length==
0,n[2].length==0)||goog.string.compareElements_(m[2],n[2])}while(d==0)}return d};goog.string.compareElements_=function(b,c){if(b<c)return-1;else if(b>c)return 1;return 0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(b){for(var c=0,d=0;d<b.length;++d){c=31*c+b.charCodeAt(d);c%=goog.string.HASHCODE_MAX_}return c};goog.string.uniqueStringCounter_=Math.random()*2147483648|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};
goog.string.toNumber=function(b){var c=Number(b);if(c==0&&goog.string.isEmpty(b))return NaN;return c};goog.asserts={};goog.asserts.ENABLE_ASSERTS=goog.DEBUG;goog.asserts.AssertionError=function(b,c){c.unshift(b);goog.debug.Error.call(this,goog.string.subs.apply(null,c));c.shift();this.messagePattern=b};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);goog.asserts.AssertionError.prototype.name="AssertionError";goog.asserts.doAssertFailure_=function(b,c,d,e){var f="Assertion failed";if(d){f+=": "+d;var g=e}else if(b){f+=": "+b;g=c}throw new goog.asserts.AssertionError(""+f,g||[]);};
goog.asserts.assert=function(b,c){goog.asserts.ENABLE_ASSERTS&&!b&&goog.asserts.doAssertFailure_("",null,c,Array.prototype.slice.call(arguments,2))};goog.asserts.fail=function(b){if(goog.asserts.ENABLE_ASSERTS)throw new goog.asserts.AssertionError("Failure"+(b?": "+b:""),Array.prototype.slice.call(arguments,1));};
goog.asserts.assertNumber=function(b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(b)&&goog.asserts.doAssertFailure_("Expected number but got %s.",[b],c,Array.prototype.slice.call(arguments,2));return b};goog.asserts.assertString=function(b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isString(b)&&goog.asserts.doAssertFailure_("Expected string but got %s.",[b],c,Array.prototype.slice.call(arguments,2));return b};
goog.asserts.assertFunction=function(b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(b)&&goog.asserts.doAssertFailure_("Expected function but got %s.",[b],c,Array.prototype.slice.call(arguments,2));return b};goog.asserts.assertObject=function(b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isObject(b)&&goog.asserts.doAssertFailure_("Expected object but got %s.",[b],c,Array.prototype.slice.call(arguments,2));return b};
goog.asserts.assertArray=function(b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isArray(b)&&goog.asserts.doAssertFailure_("Expected array but got %s.",[b],c,Array.prototype.slice.call(arguments,2));return b};goog.asserts.assertInstanceof=function(b,c,d){goog.asserts.ENABLE_ASSERTS&&!(b instanceof c)&&goog.asserts.doAssertFailure_("instanceof check failed.",null,d,Array.prototype.slice.call(arguments,3))};goog.uri={};goog.uri.utils={};goog.uri.utils.CharCode_={AMPERSAND:38,EQUAL:61,HASH:35,QUESTION:63};goog.uri.utils.buildFromEncodedParts=function(b,c,d,e,f,g,h){var i=[];b&&i.push(b,":");if(d){i.push("//");c&&i.push(c,"@");i.push(d);e&&i.push(":",e)}f&&i.push(f);g&&i.push("?",g);h&&i.push("#",h);return i.join("")};goog.uri.utils.splitRe_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");
goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};goog.uri.utils.split=function(b){return b.match(goog.uri.utils.splitRe_)};goog.uri.utils.decodeIfPossible_=function(b){return b&&decodeURIComponent(b)};goog.uri.utils.getComponentByIndex_=function(b,c){return goog.uri.utils.split(c)[b]||null};goog.uri.utils.getScheme=function(b){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.SCHEME,b)};
goog.uri.utils.getUserInfoEncoded=function(b){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.USER_INFO,b)};goog.uri.utils.getUserInfo=function(b){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getUserInfoEncoded(b))};goog.uri.utils.getDomainEncoded=function(b){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.DOMAIN,b)};goog.uri.utils.getDomain=function(b){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getDomainEncoded(b))};
goog.uri.utils.getPort=function(b){return Number(goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PORT,b))||null};goog.uri.utils.getPathEncoded=function(b){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PATH,b)};goog.uri.utils.getPath=function(b){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getPathEncoded(b))};goog.uri.utils.getQueryData=function(b){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.QUERY_DATA,b)};
goog.uri.utils.getFragmentEncoded=function(b){var c=b.indexOf("#");return c<0?null:b.substr(c+1)};goog.uri.utils.setFragmentEncoded=function(b,c){return goog.uri.utils.removeFragment(b)+(c?"#"+c:"")};goog.uri.utils.getFragment=function(b){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getFragmentEncoded(b))};
goog.uri.utils.getHost=function(b){b=goog.uri.utils.split(b);return goog.uri.utils.buildFromEncodedParts(b[goog.uri.utils.ComponentIndex.SCHEME],b[goog.uri.utils.ComponentIndex.USER_INFO],b[goog.uri.utils.ComponentIndex.DOMAIN],b[goog.uri.utils.ComponentIndex.PORT])};goog.uri.utils.getPathAndAfter=function(b){b=goog.uri.utils.split(b);return goog.uri.utils.buildFromEncodedParts(null,null,null,null,b[goog.uri.utils.ComponentIndex.PATH],b[goog.uri.utils.ComponentIndex.QUERY_DATA],b[goog.uri.utils.ComponentIndex.FRAGMENT])};
goog.uri.utils.removeFragment=function(b){var c=b.indexOf("#");return c<0?b:b.substr(0,c)};goog.uri.utils.haveSameDomain=function(b,c){var d=goog.uri.utils.split(b),e=goog.uri.utils.split(c);return d[goog.uri.utils.ComponentIndex.DOMAIN]==e[goog.uri.utils.ComponentIndex.DOMAIN]&&d[goog.uri.utils.ComponentIndex.SCHEME]==e[goog.uri.utils.ComponentIndex.SCHEME]&&d[goog.uri.utils.ComponentIndex.PORT]==e[goog.uri.utils.ComponentIndex.PORT]};
goog.uri.utils.assertNoFragmentsOrQueries_=function(b){if(goog.DEBUG&&(b.indexOf("#")>=0||b.indexOf("?")>=0))throw Error("goog.uri.utils: Fragment or query identifiers are not supported: ["+b+"]");};goog.uri.utils.QueryValue=goog.typedef;goog.uri.utils.QueryArray=goog.typedef;goog.uri.utils.appendQueryData_=function(b){if(b[1]){var c=b[0],d=c.indexOf("#");if(d>=0){b.push(c.substr(d));b[0]=c=c.substr(0,d)}d=c.indexOf("?");if(d<0)b[1]="?";else if(d==c.length-1)b[1]=undefined}return b.join("")};
goog.uri.utils.appendKeyValuePairs_=function(b,c,d){if(goog.isArray(c)){c=c;for(var e=0;e<c.length;e++){d.push("&",b);c[e]!==""&&d.push("=",goog.string.urlEncode(c[e]))}}else if(c!=null){d.push("&",b);c!==""&&d.push("=",goog.string.urlEncode(c))}};goog.uri.utils.buildQueryDataBuffer_=function(b,c,d){goog.asserts.assert(Math.max(c.length-(d||0),0)%2==0,"goog.uri.utils: Key/value lists must be even in length.");for(d=d||0;d<c.length;d+=2)goog.uri.utils.appendKeyValuePairs_(c[d],c[d+1],b);return b};
goog.uri.utils.buildQueryData=function(b,c){var d=goog.uri.utils.buildQueryDataBuffer_([],b,c);d[0]="";return d.join("")};goog.uri.utils.buildQueryDataBufferFromMap_=function(b,c){for(var d in c)goog.uri.utils.appendKeyValuePairs_(d,c[d],b);return b};goog.uri.utils.buildQueryDataFromMap=function(b){b=goog.uri.utils.buildQueryDataBufferFromMap_([],b);b[0]="";return b.join("")};
goog.uri.utils.appendParams=function(b){return goog.uri.utils.appendQueryData_(arguments.length==2?goog.uri.utils.buildQueryDataBuffer_([b],arguments[1],0):goog.uri.utils.buildQueryDataBuffer_([b],arguments,1))};goog.uri.utils.appendParamsFromMap=function(b,c){return goog.uri.utils.appendQueryData_(goog.uri.utils.buildQueryDataBufferFromMap_([b],c))};goog.uri.utils.appendParam=function(b,c,d){return goog.uri.utils.appendQueryData_([b,"&",c,"=",goog.string.urlEncode(d)])};
goog.uri.utils.findParam_=function(b,c,d,e){c=c;for(var f=d.length;(c=b.indexOf(d,c))>=0&&c<e;){var g=b.charCodeAt(c-1);if(g==goog.uri.utils.CharCode_.AMPERSAND||g==goog.uri.utils.CharCode_.QUESTION){g=b.charCodeAt(c+f);if(!g||g==goog.uri.utils.CharCode_.EQUAL||g==goog.uri.utils.CharCode_.AMPERSAND||g==goog.uri.utils.CharCode_.HASH)return c}c+=f+1}return-1};goog.uri.utils.hashOrEndRe_=/#|$/;
goog.uri.utils.hasParam=function(b,c){return goog.uri.utils.findParam_(b,0,c,b.search(goog.uri.utils.hashOrEndRe_))>=0};goog.uri.utils.getParamValue=function(b,c){var d=b.search(goog.uri.utils.hashOrEndRe_),e=goog.uri.utils.findParam_(b,0,c,d);if(e<0)return null;else{var f=b.indexOf("&",e);if(f<0||f>d)f=d;e+=c.length+1;return goog.string.urlDecode(b.substr(e,f-e))}};
goog.uri.utils.getParamValues=function(b,c){for(var d=b.search(goog.uri.utils.hashOrEndRe_),e=0,f,g=[];(f=goog.uri.utils.findParam_(b,e,c,d))>=0;){e=b.indexOf("&",f);if(e<0||e>d)e=d;f+=c.length+1;g.push(goog.string.urlDecode(b.substr(f,e-f)))}return g};goog.uri.utils.trailingQueryPunctuationRe_=/[?&]($|#)/;
goog.uri.utils.removeParam=function(b,c){for(var d=b.search(goog.uri.utils.hashOrEndRe_),e=0,f,g=[];(f=goog.uri.utils.findParam_(b,e,c,d))>=0;){g.push(b.substring(e,f));e=Math.min(b.indexOf("&",f)+1||d,d)}g.push(b.substr(e));return g.join("").replace(goog.uri.utils.trailingQueryPunctuationRe_,"$1")};goog.uri.utils.setParam=function(b,c,d){return goog.uri.utils.appendParam(goog.uri.utils.removeParam(b,c),c,d)};
goog.uri.utils.appendPath=function(b,c){goog.uri.utils.assertNoFragmentsOrQueries_(b);if(goog.string.endsWith(b,"/"))b=b.substr(0,b.length-1);if(goog.string.startsWith(c,"/"))c=c.substr(1);return goog.string.buildString(b,"/",c)};goog.uri.utils.StandardQueryParam={RANDOM:"zx"};goog.uri.utils.makeUnique=function(b){return goog.uri.utils.setParam(b,goog.uri.utils.StandardQueryParam.RANDOM,goog.string.getRandomString())};function GTB_InfoQuery(b,c,d,e){this.debugZone="GTB_InfoQuery";this.browser_=b;this.pageUrl_=c;this.hostIp_=d||"";this.qUsers_=e;this.endQueryTimestamp_=this.startQueryTimestamp_=-1;this.queryStatus_=""}GTB_InfoQuery.QueryStatuses={OKAY:"O",ALTERNATE_WORKED:"A",PENDING:"P",UNPARSABLE:"U",FAILED:"F",CONNECTION_FAILURE:"C",ERROR:"E"};a=GTB_InfoQuery.prototype;a.getBrowser=function(){return this.browser_};a.getPageUrl=function(){return this.pageUrl_};a.getHostIp=function(){return this.hostIp_};
a.getQueryUsers=function(){return this.qUsers_};a.tickQueryStarted=function(){this.startQueryTimestamp_=Date.now()};a.tickQueryEnded=function(){this.endQueryTimestamp_=Date.now()};a.getQueryTime=function(){if(this.queryStatus_!=GTB_InfoQuery.QueryStatuses.PENDING||this.startQueryTimestamp_>=0&&this.endQueryTimestamp_>=0&&this.endQueryTimestamp_>=this.startQueryTimestamp_)return this.endQueryTimestamp_-this.startQueryTimestamp_;return-1};a.getQueryStatus=function(){return this.queryStatus_};
a.setQueryStatus=function(b){this.queryStatus_=b};function GTB_InfoQueryTabData(){this.debugZone="GTB_InfoQueryTabData";this.hostIp_=this.pageUrl_=""}a=GTB_InfoQueryTabData.prototype;a.getPageUrl=function(){return this.pageUrl_};a.setPageUrl=function(b){this.pageUrl_=b};a.getHostIp=function(){return this.hostIp_};a.setHostIp=function(b){this.hostIp_=b||""};a.reset=function(){this.hostIp_=this.pageUrl_=""};function GTB_IQWebProgress(){this.debugZone="GTB_IQWebProgress"}GTB_IQWebProgress.inherits(GTB_InfoQueryUser);GTB_IQWebProgress.prototype.getRequestPrefix=function(){return"Rank"};GTB_IQWebProgress.prototype.isEnabled=function(){return true};GTB_IQWebProgress.prototype.shouldSendRequest=function(b,c,d,e,f){return this.isEnabled()&&this.isAllowedInternal(c,d,e,f)};GTB_IQWebProgress.prototype.onRequestSend=function(){};function GTB_IsOnline(){var b=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);if(b.offline)return false;try{var c=Cc["@google.com/connectutil;1"];if(!c)return true;var d=c.createInstance(Ci.GTBIConnectUtil);if(!d)return true;return d.isOnline()}catch(e){return true}};var GTB_ButtonLocalDict=null,GTB_DOMAIN_SPECIFIC_FEATURE_IDS={gtbSearchFroogle:"froogle",gtbSearchLocal:"local",gtbSearchNews:"news",gtbCountrySearch:"country",gtbSearchGroups:"groups",gtbSearchVideo:"video",gtbSearchBlogs:"blogsearch",gtbSearchBooks:"books",gtbSearchFinance:"finance",gtbSearchPatents:"patents",gtbSearchPhotos:"photos",gtbSearchScholar:"scholar","gtbstoolbar-google-com_CTK0Y7F4MTG6NKYH03WT-xml":"orkut"},GTB_GOOGLE_HOME_CHANGES={"www.google.off.ai":"www.google.com.ai"};
function GTB_LocaleFeatureListService(){this.debugZone="GTB_LocaleFeatureListService";this.featuresFile_=null;this.prefsProperties_={};this.wrappedJSObject=this;this.inited_=false}a=GTB_LocaleFeatureListService.prototype;
a.init=function(){if(!this.inited_){var b=GTB_getDataDir();GTB_ensureDirectoryExists(b);this.featuresFile_=b.clone();this.featuresFile_.append("features.properties");this.readLocaleFeatures_();b=5E3;if(this.featuresFile_.exists()){var c=Date.now(),d=this.featuresFile_.lastModifiedTime;c=c-d;b=Math.max(b,864E5-c)}new G_Alarm(BindToObject(this.startLocaleFeatureListUpdater_,this),b,false,null);this.inited_=true}};
a.startLocaleFeatureListUpdater_=function(){this.updateLocaleFeatureList_();new G_Alarm(BindToObject(this.updateLocaleFeatureList_,this),864E5,true,null)};
a.readLocaleFeatures_=function(){var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);if(this.featuresFile_.exists()){var c=Cc["@mozilla.org/network/protocol;1?name=file"].getService(Ci.nsIFileProtocolHandler);c=c.getURLSpecFromFile(this.featuresFile_);c=b.createBundle(c);for(c=c.getSimpleEnumeration();c.hasMoreElements();){var d=c.getNext().QueryInterface(Ci.nsIPropertyElement);this.prefsProperties_[d.key]=d.value}}b=b.createBundle("chrome://google-toolbar/locale/prefs.properties");
for(b=b.getSimpleEnumeration();b.hasMoreElements();){c=b.getNext().QueryInterface(Ci.nsIPropertyElement);if(typeof this.prefsProperties_[c.key]=="undefined")this.prefsProperties_[c.key]=c.value}};a.getPref=function(b){this.init();return this.prefsProperties_[b]};a.getBoolPref=function(b){this.init();return!!this.prefsProperties_[b]&&this.prefsProperties_[b].toLowerCase()=="true"};
a.updateLocaleFeatureList_=function(){if(GTB_IsOnline()){var b="http://www.google.com/tools/service/npredir?r=ff_tb_prefs&hl={LANG}&v={VERSION}".replace("{LANG}",GTB_getLangCode()).replace("{VERSION}",GTB_version),c=new G_XMLFetcher(false);c.get(b,BindToObject(this.processResponse_,this))}};a.processResponse_=function(b){if(b.status==200){try{this.featuresFile_.exists()&&this.featuresFile_.remove(false);G_FileWriter.writeAll(this.featuresFile_,b.responseText,false)}catch(c){return}this.readLocaleFeatures_()}};
function GTB_getLangCode(){return GTB_languages.firefoxLanguage().google}
function GTB_localizeLogo(b,c){var d=c;if(!d){d=b.src;var e=d.lastIndexOf("/");d=e<0||e==d.length-1?GTB_localizeLogo.DEFAULT_FILE:d.substring(e+1)}e=GTB_getLangCode();var f=GTB_localizeLogo.CHROME_URL_MAP[d]||GTB_localizeLogo.CHROME_URL;if("en"==e)b.src=f;else{var g=GTB_getDataDir();g.append(GTB_localizeLogo.CACHE_FILE.replace("{LANG}",e).replace("{FILE}",d));if(g.exists())b.src="file://"+g.path;else{var h=GTB_localizeLogo.requestSent[d];if(!GTB_IsOnline()||h&&h<Date.now()-2E3)b.src=f;else{var i=
GTB_localizeLogo.HTTP_URL.replace("{LANG}",e).replace("{VERSION}",GTB_version).replace("{FILE}",d),j=new G_Alarm(function(){b.src=g.exists()?"file://"+g.path:f},2E3);b.addEventListener("load",function(){b.src==i&&j.cancel()},false);b.src=i;if(!GTB_localizeLogo.requestSent[d]){GTB_localizeLogo.requestSent[d]=Date.now();GTB_httpGetBinary(i,function(k){GTB_saveBinaryFile(g,k.responseText)})}}}}}GTB_localizeLogo.DEFAULT_FILE="toolbar_logo_sm.gif";
GTB_localizeLogo.CHROME_URL="chrome://google-toolbar/skin/"+GTB_localizeLogo.DEFAULT_FILE;GTB_localizeLogo.CHROME_URL_MAP={};GTB_localizeLogo.CHROME_URL_MAP[GTB_localizeLogo.DEFAULT_FILE]=GTB_localizeLogo.CHROME_URL;GTB_localizeLogo.CHROME_URL_MAP["sidewiki_logo.gif"]="chrome://google-toolbar/skin/sidewiki_logo.gif";GTB_localizeLogo.HTTP_URL="http://www.google.com/tools/service/npredir?r=ff_tb6_image&hl={LANG}&v={VERSION}&f={FILE}";GTB_localizeLogo.CACHE_FILE="logo_{LANG}_{FILE}";
GTB_localizeLogo.requestSent={};function GTB_getGoogleDomain(){return GTB_getGoogleHome().replace(/.*google\./,"")}function GTB_getGoogleHome(){var b="google.toolbar.google_home",c=GTB_getPrefWithLocaleDefault(b,"www.google.com");if(GTB_GOOGLE_HOME_CHANGES[c]){c=GTB_GOOGLE_HOME_CHANGES[c];GTB_GlobalPrefs.setPref(b,c)}if(GTB_GOOGLE_HOME_DICT[c])return c;c=GTB_getLocaleDefaultForPref(b);GTB_GOOGLE_HOME_DICT[c]||(c="www.google.com");GTB_GlobalPrefs.setPref(b,c);return c}
function GTB_getGoogleHomeCountryShortName(b){b=b?b:GTB_getGoogleHome();c=GTB_GOOGLE_HOME_DICT[b].shortName;if(!c)var c=GTB_GOOGLE_HOME_DICT[b].name;c||(c=GTB_GOOGLE_HOME_DICT[b].iso.replace(/[\;].*/,""));return c}
function GTB_buttonAvailableInLocale(b){if(!GTB_ButtonLocalDict){GTB_ButtonLocalDict={};var c=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;c=c.getPref("buttonList");c=c.split(",");for(var d=0;d<c.length;d++)GTB_ButtonLocalDict[c[d]]=1}c=b=="gtbTranslate"?!GTB_GeckoVersion.isFirefox2():true;return c&&b in GTB_ButtonLocalDict}
function GTB_buttonAvailableInDomain(b){b=b.replace(/.*button_option\./,"");b=GTB_DOMAIN_SPECIFIC_FEATURE_IDS[b];if(!b)return true;var c=GTB_getGoogleHome();c=GTB_GOOGLE_HOME_DICT[c];return b in c.features}function GTB_checkValueIsBool(b){if(typeof b!="string")return b;if(b.toLowerCase()=="true"||b.toLowerCase=="t")return true;if(b.toLowerCase()=="false"||b.toLowerCase=="f")return false;return b}
function GTB_getLocaleDefaultForPref(b){var c=b.replace("google.toolbar.","");if(c=="button_option.gtbSpellCheck")try{var d=Cc["@mozilla.org/editor/editorspellchecker;1"].createInstance(Ci.nsIEditorSpellCheck);if(d&&d.canSpellCheck&&d.canSpellCheck())return false;else if((d=Cc["@mozilla.org/editor/editorspellchecker;1"].createInstance(Ci.nsIEditorSpellCheck_MOZILLA_1_8_BRANCH))&&d.CanSpellCheck())return false}catch(e){}if(c=="button_option.gtbPageRank"){b=new G_Preferences("google.toolbar.");return!!b.getPref("opted_into_advanced_features_1",
false)}if(c=="translate.target_lang")return GTB_languages.firefoxLanguage().google;d=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;(c=d.getPref(c+"_default"))||(c=GTB_DefaultPreferences.getDefaultValue(b));return c=GTB_checkValueIsBool(c)}function GTB_getPrefWithLocaleDefault(b,c){var d=GTB_GlobalPrefs.getPref(b,null);if(d!=null)return d;d=GTB_getLocaleDefaultForPref(b);if(d!=null)return d;return c}
function GTB_resetPrefToLocaleDefault(b){if(!(GTB_DefaultPreferences.isButtonOptionPref(b)&&!GTB_DefaultPreferences.isFeaturePref(b))){var c=GTB_getLocaleDefaultForPref(b);c!=null?GTB_GlobalPrefs.setPref(b,c):GTB_GlobalPrefs.clearPref(b)}}function GTB_getFirefoxLocalPreference(b){var c=new G_Preferences;c=c.getPref(b);if(c.startsWith("chrome://")){var d=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);c=d.createBundle(c);c=c.GetStringFromName(b)}return c};var GTB_GOOGLE_HOME_DICT={"www.google.com":{tld:"com",iso:"US",features:{groups:1,froogle:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,blogsearch:1,books:1,finance:1,orkut:1,photos:1,patents:1,scholar:1,video:1}},"www.google.ae":{tld:"ae",iso:"AE",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.com.af":{tld:"com.af",iso:"AF",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.com.ag":{tld:"com.ag",iso:"AG",features:{groups:1,news:1,country:1,
blogthis:1,gmailthis:1,books:1}},"www.google.com.ai":{tld:"com.ai",iso:"AI",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.am":{tld:"am",iso:"AM",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.ar":{tld:"com.ar",iso:"AR",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.as":{tld:"as",iso:"AS",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.at":{tld:"at",
iso:"AT",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1}},"www.google.com.au":{tld:"com.au",iso:"AU",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,video:1}},"www.google.az":{tld:"az",iso:"AZ",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.ba":{tld:"ba",iso:"BA",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.com.bd":{tld:"com.bd",iso:"BD",features:{groups:1,
country:1,blogthis:1,gmailthis:1,books:1}},"www.google.be":{tld:"be",iso:"BE",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1}},"www.google.bg":{tld:"bg",iso:"BG",features:{groups:1,country:1,blogthis:1,gmailthis:1,scholar:1,photos:1}},"www.google.com.bh":{tld:"com.bh",iso:"BH",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.bi":{tld:"bi",iso:"BI",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},
"www.google.com.bo":{tld:"com.bo",iso:"BO",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.com.br":{tld:"com.br",iso:"BR",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,orkut:1}},"www.google.bs":{tld:"bs",iso:"BS",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.co.bw":{tld:"co.bw",iso:"BW",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.bz":{tld:"com.bz",
iso:"BZ",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.ca":{tld:"ca",iso:"CA",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,finance:1,blogsearch:1,video:1}},"www.google.cd":{tld:"cd",iso:"CD",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.cg":{tld:"cg",iso:"CG",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.ch":{tld:"ch",iso:"CH",features:{groups:1,
local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,photos:1,blogsearch:1}},"www.google.ci":{tld:"ci",iso:"CI",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1}},"www.google.co.ck":{tld:"co.ck",iso:"CK",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.cl":{tld:"cl",iso:"CL",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.com.co":{tld:"com.co",iso:"CO",features:{groups:1,news:1,country:1,blogthis:1,
gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.co.cr":{tld:"co.cr",iso:"CR",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.com.cu":{tld:"com.cu",iso:"CU",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.cz":{tld:"cz",iso:"CZ",features:{groups:1,news:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.de":{tld:"de",iso:"DE",features:{groups:1,froogle:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,
books:1,scholar:1,photos:1,blogsearch:1,orkut:1,video:1}},"www.google.dj":{tld:"dj",iso:"DJ",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.dk":{tld:"dk",iso:"DK",features:{groups:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.dm":{tld:"dm",iso:"DM",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.do":{tld:"com.do",iso:"DO",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},
"www.google.com.ec":{tld:"com.ec",iso:"EC",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.ee":{tld:"ee",iso:"EE",features:{groups:1,country:1,gmailthis:1}},"www.google.com.eg":{tld:"com.eg",iso:"EG",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,orkut:1}},"www.google.es":{tld:"es",iso:"ES",features:{groups:1,news:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,video:1}},"www.google.com.et":{tld:"com.et",
iso:"ET",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.fi":{tld:"fi",iso:"FI",features:{groups:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.com.fj":{tld:"com.fj",iso:"FJ",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.fm":{tld:"fm",iso:"FM",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.fr":{tld:"fr",iso:"FR",features:{groups:1,news:1,local:1,country:1,blogthis:1,
gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,orkut:1,video:1}},"www.google.co.uk":{tld:"co.uk",iso:"UK;GB",features:{groups:1,froogle:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,finance:1,blogsearch:1,video:1}},"www.google.gg":{tld:"gg",iso:"GG",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.gi":{tld:"com.gi",iso:"GI",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.gl":{tld:"gl",iso:"GL",
features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.gm":{tld:"gm",iso:"GM",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.gr":{tld:"gr",iso:"GR",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.com.gt":{tld:"com.gt",iso:"GT",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.com.hk":{tld:"com.hk",iso:"HK",features:{groups:1,local:1,news:1,country:1,blogthis:1,
gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1}},"www.google.hn":{tld:"hn",iso:"HN",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.hr":{tld:"hr",iso:"HR",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.ht":{tld:"ht",iso:"HT",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.hu":{tld:"hu",iso:"HU",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},
"www.google.co.id":{tld:"co.id",iso:"ID",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1}},"www.google.ie":{tld:"ie",iso:"IE",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,blogsearch:1}},"www.google.co.il":{tld:"co.il",iso:"IL",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,scholar:1}},"www.google.co.im":{tld:"co.im",iso:"IM",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.co.in":{tld:"co.in",
iso:"IN",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,orkut:1}},"www.google.is":{tld:"is",iso:"IS",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.it":{tld:"it",iso:"IT",features:{groups:1,news:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,video:1}},"www.google.co.je":{tld:"co.je",iso:"JE",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.jm":{tld:"com.jm",
iso:"JM",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.jo":{tld:"jo",iso:"JO",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.co.jp":{tld:"co.jp",iso:"JP",features:{groups:1,news:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1}},"www.google.co.ke":{tld:"co.ke",iso:"KE",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,blogsearch:1}},"www.google.kg":{tld:"kg",iso:"KG",features:{groups:1,
country:1,blogthis:1,gmailthis:1}},"www.google.co.kr":{tld:"co.kr",iso:"KR",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,scholar:1,photos:1,blogsearch:1,video:1}},"www.google.kz":{tld:"kz",iso:"KZ",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.li":{tld:"li",iso:"LI",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.lk":{tld:"lk",iso:"LK",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.co.ls":{tld:"co.ls",
iso:"LS",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.lt":{tld:"lt",iso:"LT",features:{groups:1,country:1,blogthis:1,gmailthis:1,scholar:1,photos:1}},"www.google.lu":{tld:"lu",iso:"LU",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.lv":{tld:"lv",iso:"LV",features:{groups:1,country:1,blogthis:1,gmailthis:1,scholar:1,photos:1,books:1}},"www.google.com.ly":{tld:"com.ly",iso:"LY",features:{groups:1,country:1,blogthis:1,gmailthis:1,
scholar:1}},"www.google.co.ma":{tld:"co.ma",iso:"MA",features:{groups:1,news:1,country:1,gmailthis:1,blogsearch:1}},"www.google.mn":{tld:"mn",iso:"MN",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.ms":{tld:"ms",iso:"MS",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.mt":{tld:"com.mt",iso:"MT",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.mu":{tld:"mu",iso:"MU",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,
books:1}},"www.google.mw":{tld:"mw",iso:"MW",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.mx":{tld:"com.mx",iso:"MX",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.com.my":{tld:"com.my",iso:"MY",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.com.na":{tld:"com.na",iso:"NA",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.nf":{tld:"com.nf",
iso:"NF",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.ni":{tld:"com.ni",iso:"NI",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.nl":{tld:"nl",iso:"NL",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,video:1}},"www.google.no":{tld:"no",iso:"NO",features:{groups:1,news:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.com.np":{tld:"com.np",
iso:"NP",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.co.nz":{tld:"co.nz",iso:"NZ",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.com.om":{tld:"com.om",iso:"OM",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.com.pa":{tld:"com.pa",iso:"PA",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.com.pe":{tld:"com.pe",iso:"PE",features:{groups:1,news:1,country:1,
blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.com.ph":{tld:"com.ph",iso:"PH",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,scholar:1,photos:1,books:1,blogsearch:1}},"www.google.com.pk":{tld:"com.pk",iso:"PK",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.pl":{tld:"pl",iso:"PL",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,video:1}},"www.google.pn":{tld:"pn",iso:"PN",
features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.pr":{tld:"com.pr",iso:"PR",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.pt":{tld:"pt",iso:"PT",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.com.py":{tld:"com.py",iso:"PY",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.com.qa":{tld:"com.qa",iso:"QA",features:{groups:1,news:1,
country:1,gmailthis:1,books:1}},"www.google.ro":{tld:"ro",iso:"RO",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.ru":{tld:"ru",iso:"RU",features:{groups:1,news:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,photos:1,blogsearch:1}},"www.google.rw":{tld:"rw",iso:"RW",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.sa":{tld:"com.sa",iso:"SA",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.sc":{tld:"sc",
iso:"SC",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.se":{tld:"se",iso:"SE",features:{groups:1,news:1,local:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1}},"www.google.com.sg":{tld:"com.sg",iso:"SG",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.sh":{tld:"sh",iso:"SH",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.si":{tld:"si",iso:"SI",
features:{groups:1,country:1,gmailthis:1,scholar:1,photos:1}},"www.google.sk":{tld:"sk",iso:"SK",features:{groups:1,country:1,blogthis:1,gmailthis:1,scholar:1,photos:1}},"www.google.sm":{tld:"sm",iso:"SM",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.sn":{tld:"sn",iso:"SN",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1}},"www.google.com.sv":{tld:"com.sv",iso:"SV",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.co.th":{tld:"co.th",
iso:"TH",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1}},"www.google.com.tj":{tld:"com.tj",iso:"TJ",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.tm":{tld:"tm",iso:"TM",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.to":{tld:"to",iso:"TO",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.tr":{tld:"com.tr",iso:"TR",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,
blogsearch:1}},"www.google.tt":{tld:"tt",iso:"TT",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.tw":{tld:"com.tw",iso:"TW",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1,video:1}},"www.google.com.ua":{tld:"com.ua",iso:"UA",features:{groups:1,country:1,blogthis:1,gmailthis:1,scholar:1,photos:1}},"www.google.co.ug":{tld:"co.ug",iso:"UG",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},
"www.google.com.uy":{tld:"com.uy",iso:"UY",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1}},"www.google.co.uz":{tld:"co.uz",iso:"UZ",features:{groups:1,country:1,blogthis:1,gmailthis:1}},"www.google.com.vc":{tld:"com.vc",iso:"VC",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.co.ve":{tld:"co.ve",iso:"VE",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.vg":{tld:"vg",iso:"VG",features:{groups:1,
news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.co.vi":{tld:"co.vi",iso:"VI",features:{groups:1,news:1,country:1,blogthis:1,gmailthis:1,books:1}},"www.google.com.vn":{tld:"com.vn",iso:"VN",features:{groups:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,photos:1,blogsearch:1}},"www.google.co.za":{tld:"co.za",iso:"ZA",features:{groups:1,local:1,news:1,country:1,blogthis:1,gmailthis:1,books:1,scholar:1,blogsearch:1}},"www.google.co.zm":{tld:"co.zm",iso:"ZM",features:{groups:1,news:1,
country:1,blogthis:1,gmailthis:1,books:1}}};function GTB_Languages(){this.debugZone="GTB_Languages";this.inited_=false;this.languages_=[];this.googleMap_={};this.firefoxMap_={};this.defaultLanguage_=this.osLanguage_=this.firefoxLanguage_=null}a=GTB_Languages.prototype;
a.init_=function(){if(!this.inited_){this.inited_=true;var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");for(var c in GTB_Languages.GOOGLE_TO_FIREFOX_MAP){var d=GTB_Languages.GOOGLE_TO_FIREFOX_MAP[c],e=b.GetStringFromName("prop.gtb.language.native.capitalized."+c),f=GTB_Languages.RTL.indexOf(c)==-1?"ltr":"rtl";e={google:c,firefox:d,capitalized:e,direction:f};this.languages_.push(e);this.googleMap_[c]=
e;this.firefoxMap_[d]=e}this.defaultLanguage_=this.googleMap_.en}};a.byGoogle=function(b){this.init_();return this.googleMap_[b]||null};a.byFirefox=function(b){this.init_();return this.firefoxMap_[b]||null};a.byCLD=function(b){this.init_();if(b=="he")b="iw";return this.byGoogle(b)};a.byAny=function(b){this.init_();var c=this.byCLD(b)||this.byFirefox(b)||this.byGoogle(b);if(c)return c;for(var d=0;c=this.languages_[d];d++){if(c.google.indexOf(b+"-")==0)return c;if(c.firefox.indexOf(b+"-")==0)return c}return null};
a.all=function(){this.init_();return this.languages_};a.getDefault=function(){this.init_();return this.defaultLanguage_};a.isIdeographic=function(b){this.init_();return GTB_Languages.IDEOGRAPHIC.indexOf(b.google)!=-1};a.isEnglish=function(b){this.init_();return GTB_Languages.ENGLISH.indexOf(b.google)!=-1};a.osLanguage=function(){this.init_();if(!this.osLanguage_)try{var b=Cc["@mozilla.org/intl/nslocaleservice;1"].getService(Ci.nsILocaleService),c=b.getSystemLocale();this.osLanguage_=this.byAny(c.getCategory("NSILOCALE_MESSAGES"))}catch(d){}return this.osLanguage_};
a.firefoxLanguage=function(){this.init_();if(!this.firefoxLanguage_){var b=GTB_getFirefoxLocalPreference("general.useragent.locale");this.firefoxLanguage_=this.byAny(b);if(!this.firefoxLanguage_&&b.length>5)this.firefoxLanguage_=this.byAny(b.substring(0,5))}return this.firefoxLanguage_||this.defaultLanguage_};
GTB_Languages.GOOGLE_TO_FIREFOX_MAP={ar:"ar",bg:"bg",ca:"ca",cs:"cs-CZ",da:"da-DK",de:"de-DE",el:"el",en:"en-US","en-GB":"en-GB",es:"es-ES",fi:"fi-FI",fr:"fr-FR",iw:"he-IL",hu:"hu-HU",it:"it-IT",ja:"ja-JP",ko:"ko-KR",lt:"lt",nl:"nl-NL",no:"nb-NO",pl:"pl-PL","pt-BR":"pt-BR","pt-PT":"pt-PT",ro:"ro",ru:"ru-RU",sk:"sk-SK",sl:"sl",sv:"sv-SE",tr:"tr-TR",uk:"uk","zh-CN":"zh-CN","zh-TW":"zh-TW"};GTB_Languages.RTL=["ar","iw"];GTB_Languages.IDEOGRAPHIC=["ja","zh-CN","zh-TW"];GTB_Languages.ENGLISH=["en","en-GB"];
var GTB_languages=new GTB_Languages;function GTB_HoverTranslatePopup(b,c){this.debugZone="GTB_HoverTranslatePopup";this.document_=b;this.translate_=c;this.prefs_=new G_Preferences("google.toolbar.");this.popup_=this.document_.getElementById("gtbHoverTranslatePopup");this.translationElement_=this.document_.getElementById("gtbHoverTranslatePopupTranslation");this.disableLink_=this.document_.getElementById("gtbHoverTranslatePopupDisableLink");this.disableLink_.addEventListener("click",BindToObject(this.onDisableClick_,this),true);this.learnMoreLink_=
this.document_.getElementById("gtbHoverTranslatePopupLearnMoreLink");this.learnMoreLink_.addEventListener("click",BindToObject(this.onLearnMoreClick_,this),true);this.fullLink_=this.document_.getElementById("gtbHoverTranslatePopupFullLink");this.fullLink_.addEventListener("click",BindToObject(this.onFullClick_,this),true);this.document_.addEventListener("mousemove",BindToObject(this.onMouseMove_,this),true);this.document_.addEventListener("mouseout",BindToObject(this.onMouseOut_,this),true);this.document_.addEventListener("blur",
BindToObject(this.onBlur_,this),true);this.document_.addEventListener("DOMMouseScroll",BindToObject(this.onDomMouseScroll_,this),true);this.onShowAlarmBound_=BindToObject(this.onShowAlarm_,this);var d=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);d=d.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.NO_TRANSLATION=d.GetStringFromName("google-translate.noTranslation");this.TRANSLATING=d.GetStringFromName("google-translate.translating")}a=GTB_HoverTranslatePopup.prototype;
a.showAlarm_=null;a.screenX_=null;a.screenY_=null;a.cursorRightX_=null;a.parent_=null;a.offset_=null;a.fullLinkUrl_=null;a.fullLinkData_=null;GTB_HoverTranslatePopup.BORDER=3;GTB_HoverTranslatePopup.SHIFT=11;GTB_HoverTranslatePopup.CURSOR_AREA_HEIGHT=21;GTB_HoverTranslatePopup.CURSOR_AREA_WIDTH=70;GTB_HoverTranslatePopup.TIMEOUT=1E3;a=GTB_HoverTranslatePopup.prototype;a.isVisible=function(){return this.popup_.state=="open"||this.popup_.state=="showing"};
a.cancelAlarm_=function(){if(this.showAlarm_){this.showAlarm_.cancel();this.showAlarm_=null}};a.hidePopup_=function(){this.isVisible()&&this.popup_.hidePopup()};a.getCurrentDocument_=function(){return this.document_.getElementById("content").selectedBrowser.contentDocument};a.onDisableClick_=function(){this.hidePopup_();this.translate_.disable();var b="gtbOptionsFeaturesPane",c={gtbToolPaneId:"gtbOptionsTranslateImages"};GTB_OpenOptionsWindow(this.document_.defaultView,b,c)};
a.onLearnMoreClick_=function(){this.hidePopup_();GTB_Links.showMore(this.document_.defaultView,"translate")};a.onFullClick_=function(){this.hidePopup_();var b=this.document_.getElementById("content");if(this.fullLinkData_){var c=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);c.charset="UTF-8";c=c.ConvertFromUnicode(this.fullLinkData_)+c.Finish();b.selectedTab=b.addTab(this.fullLinkUrl_,null,null,GTB_createPostDataStream(c))}else b.selectedTab=b.addTab(this.fullLinkUrl_)};
a.onMouseOut_=function(){this.cancelAlarm_()};a.onBlur_=function(b){if(b.target==this.getCurrentDocument_()){this.hidePopup_();this.cancelAlarm_()}};a.onDomMouseScroll_=function(){this.hidePopup_();this.cancelAlarm_()};
a.onMouseMove_=function(b){this.showAlarm_&&this.showAlarm_.cancel();var c=b.screenX,d=b.screenY;if(this.isVisible()){b=GTB_HoverTranslatePopup.BORDER;var e=c>=this.screenX_-b&&c<=this.screenX_+this.popup_.boxObject.width+b&&d>=this.screenY_-b&&d<=this.screenY_+this.popup_.boxObject.height+b;e|=c>=this.screenX_-b&&c<=this.cursorRightX_&&d>=this.screenY_-GTB_HoverTranslatePopup.CURSOR_AREA_HEIGHT&&d<=this.screenY_;e||this.hidePopup_()}else{this.screenX_=c;this.screenY_=d;if(b.target.ownerDocument.defaultView.top.document==
this.getCurrentDocument_())if(!(this.translate_.holdShift&&!b.shiftKey)){this.parent_=b.rangeParent;this.offset_=b.rangeOffset;this.showAlarm_=new G_Alarm(this.onShowAlarmBound_,GTB_HoverTranslatePopup.TIMEOUT)}}};
a.onShowAlarm_=function(){this.showAlarm_=null;var b=this.document_.getElementById("contentAreaContextMenu");if(!(b&&b.state!="closed"))(b=this.document_.getElementById("aHTMLTooltip"))&&b.state!="closed"||!this.parent_||this.offset_==null||this.translate_.maybeTranslate(this.getCurrentDocument_(),this.parent_,this.offset_)};a.setDirection=function(b){this.translationElement_.style.direction=b};a.setNoTranslation=function(b){this.setTranslationText(this.NO_TRANSLATION.replace("&term;",b))};
a.setTranslating=function(b){this.setTranslationText(this.TRANSLATING.replace("&term;",b));this.fullLink_.style.display="none"};a.showFullLink=function(b,c){this.fullLinkUrl_=b;this.fullLinkData_=c;this.fullLink_.style.display="inline"};a.setTranslationText=function(b){for(var c=this.translationElement_;c.hasChildNodes();)c.removeChild(c.lastChild);c.appendChild(this.document_.createTextNode(b))};
a.checkLearnMoreLink_=function(){var b=this.prefs_.getPref("translate.hover.learn_more_count",0);if(b<3){this.learnMoreLink_.style.display="inline";this.prefs_.setPref("translate.hover.learn_more_count",b+1)}else this.learnMoreLink_.style.display="none"};
a.showPopup=function(){this.checkLearnMoreLink_();this.popup_.openPopupAtScreen(this.screenX_,this.screenY_+GTB_HoverTranslatePopup.SHIFT,false);this.cursorRightX_=this.screenX_+GTB_HoverTranslatePopup.CURSOR_AREA_WIDTH;this.screenX_=this.popup_.boxObject.screenX;this.screenY_=this.popup_.boxObject.screenY};function GTB_HoverTranslateLocal(b){this.debugZone="GTB_HoverTranslateLocal";this.available=!!Cc["@google.com/autotranslate;1"];this.dataDir=GTB_getDataDir();GTB_ensureDirectoryExists(this.dataDir);this.downloading_={};this.downloadAttempts_={};this.requestConfig_=null;this.updateConfig(b)}GTB_HoverTranslateLocal.prototype.updateConfig=function(b){this.requestConfig_=b};GTB_HoverTranslateLocal.MAX_FAILED_DOWNLOADS=10;a=GTB_HoverTranslateLocal.prototype;
a.substitute_=function(b,c,d){b=b.replace(/{{SOURCE_LANGUAGE}}/g,c.google);return b=b.replace(/{{TARGET_LANGUAGE}}/g,d.google)};a.getUrl_=function(b,c){var d=[];for(var e in this.requestConfig_.parameters){d.push(this.substitute_(e,b,c));var f=this.requestConfig_.parameters[e];d.push(this.substitute_(f,b,c))}d=uri_create("http",null,this.substitute_(this.requestConfig_.hostname,b,c),this.substitute_(this.requestConfig_.port,b,c),this.substitute_("/"+this.requestConfig_.path,b,c),d,null);return d.toString()};
a.checkAndDownloadDictionary_=function(b,c){var d=b.google+"2"+c.google,e=this.dataDir.clone();e.append(d+".dat");var f=this.dataDir.clone();f.append(d+".tmp");if(e.exists()&&e.isReadable())return true;if(this.downloading_[d])return false;if(this.downloadAttempts_[d]==undefined)this.downloadAttempts_[d]=0;if(this.downloadAttempts_[d]>=GTB_HoverTranslateLocal.MAX_FAILED_DOWNLOADS)return false;this.downloadAttempts_[d]++;try{f.remove(false)}catch(g){}var h=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);
e=Cc["@mozilla.org/network/downloader;1"].createInstance(Ci.nsIDownloader);this.downloading_[d]=e;d=this.getUrl_(b,c);d=h.newChannel(d,null,null);e.init(this,f);d.asyncOpen(e,null);return false};
a.onDownloadComplete=function(b,c,d,e){for(var f in this.downloading_)if(this.downloading_[f]==b)break;delete this.downloading_[f];b=this.dataDir.clone();b.append(f+".dat");c=this.dataDir.clone();c.append(f+".tmp");f=null;if(Components.isSuccessCode(e))c.exists()||(f="new dict file not found!");else f="unable to download dict file!";if(!f)try{c.copyTo(null,b.leafName);c.remove(false)}catch(g){}};
a.translate=function(b,c){if(!this.available||!b.from)c(null);else if(this.checkAndDownloadDictionary_(b.from,b.to)){var d=b.from.google+"2"+b.to.google,e=Cc["@google.com/autotranslate;1"];e=e.getService(Ci.GTBIAutoTranslate);d=e.getTranslation(b.text,d+".dat",d,GTB_languages.isEnglish(b.from));c(d||null)}else c(null)};function GTB_HoverTranslateRemote(b){this.debugZone="GTB_HoverTranslateRemote";this.requestConfig_=b.request;this.responseType_=b.response;this.cjkRequestConfig_=b["cjk-request"]?b["cjk-request"]:this.requestConfig_;this.backoffId_=GTB_HoverTranslateRemote.BACKOFF_ID_PREFIX+b.name;(b=b.backoff)?GTB_BackoffState.registerComponentForBackoff(this.backoffId_,b.failures,b.maxblock,b.firstblock,b.multiplier):GTB_BackoffState.registerComponentForBackoff(this.backoffId_)}
GTB_HoverTranslateRemote.BACKOFF_ID_PREFIX="hovertranslate.";a=GTB_HoverTranslateRemote.prototype;a.substitute_=function(b,c){var d=b;if(c.from)d=b.replace(/{{SOURCE_LANGUAGE}}/g,c.from.google);d=d.replace(/{{TARGET_LANGUAGE}}/g,c.to.google);d=d.replace(/{{WORD_BEFORE}}/g,c.before);d=d.replace(/{{WORD}}/g,c.text);d=d.replace(/{{WORD_AFTER}}/g,c.after);d=d.replace(/{{HUMAN_LANGUAGE}}/g,GTB_getLangCode());return d=d.replace(/{{SIGNATURE}}/g,"8"+GTB_InfoQueryService.awesomeHash(c.text))};
a.getUrl_=function(b,c){var d=[];for(var e in b.parameters){d.push(this.substitute_(e,c));var f=b.parameters[e];d.push(this.substitute_(f,c))}d=uri_create("http",null,this.substitute_(b.hostname,c),this.substitute_(b.port,c),this.substitute_("/"+b.path,c),d,null);return d.toString()};
a.translate=function(b,c){var d=b.from&&GTB_languages.isIdeographic(b.from)?this.getUrl_(this.cjkRequestConfig_,b):this.getUrl_(this.requestConfig_,b),e=new GTB_BackoffedFetcher(this.backoffId_);e.get(d,BindToObject(this.processResponse_,this,b,c))};a.processResponse_=function(b,c,d){var e=d.responseText;d.status==200&&e?c(this.parseResponse_(b,e)):c(null)};
a.parseResponse_=function(b,c){if(this.responseType_=="type_plain")return c;if(this.responseType_=="type_rosetta"||this.responseType_=="type_rosetta_v1"||this.responseType_=="type_rosetta_v2")return this.parseRosetta_(b,c);if(this.responseType_=="type_suggest")return this.parseSuggest_(b,c);return null};a.extractResult_=function(b){b=goog.string.unescapeEntities(b);var c=b.indexOf("<b id=0>"),d=b.indexOf("</b>"),e=c+8;return c!=-1&&d!=-1?b.substring(e,d):b};
a.parseRosettaString_=function(b,c){var d=this.extractResult_(c);if(d&&b.text&&d.toUpperCase()==b.text.toUpperCase())return null;return d};a.parseRosettaSimple_=function(b,c){var d=null;if(c[0]&&typeof c[0]=="string")d=c[0];if(d&&b.text&&d.toUpperCase()==b.text.toUpperCase())return null;return d};
a.parseRosetta_=function(b,c){try{var d=GTB_parseJson(c)}catch(e){return null}if(!d)return null;if(typeof d=="string")return this.parseRosettaString_(b,d);if(d[0])return this.parseRosettaSimple_(b,d);if(d.src&&b.from&&d.src==b.to.google)return null;var f=[];if(d.sentences)for(var g,h=0;g=d.sentences[h];h++){var i=typeof g.trans=="string"&&typeof g.orig=="string"&&g.trans.toUpperCase()==g.orig.toUpperCase();i=i||g.trans==g.orig;if(g.trans&&!i){this.appendStringOrList_(this.extractResult_(g.trans),
f);if(typeof g.orig=="string")b.truncated=this.extractResult_(g.orig)}}g=[];if(d.dict){d=d.dict;for(h=0;i=d[h];h++)i.terms&&this.appendStringOrList_(i.terms,g)}if(g.length==0&&f.length==0)return null;var j={};for(h=0;d=g[h];h++)d in j||(j[d]=h);for(h=0;d=f[h];h++)d in j||(j[d]=h+g.length);f=[];for(d in j)f.push(d);h=function(k,l){return j[k]-j[l]};f.sort(h);return f.join(", ")};a.appendStringOrList_=function(b,c){if(typeof b=="string")c.push(b);else for(var d,e=0;d=b[e];e++)c.push(d)};
a.parseSuggest_=function(b,c){if(c.length<20)return null;c=c.substring(19,c.length-1);try{var d=GTB_parseJson(c)}catch(e){return null}d=d&&d[1]&&d[1][0]&&d[1][0][1];if(!d||typeof d!="string")return null;return d};function GTB_HoverTranslateConfig(){this.debugZone="GTB_HoverTranslateConfig";this.methods_={};this.languagePairs_={};this.localMethod_=null;this.defaultMethods_=[];var b=Cc["@google.com/toolbar/components;1"].getService().wrappedJSObject;b.register(GTB_HoverTranslateConfig.COMPONENT_NAME,BindToObject(this.update_,this),[]);this.update_()}GTB_HoverTranslateConfig.COMPONENT_NAME="dictionaries_config.json";
GTB_HoverTranslateConfig.prototype.update_=function(){var b=Cc["@google.com/toolbar/components;1"].getService().wrappedJSObject;if((b=b.getFile(GTB_HoverTranslateConfig.COMPONENT_NAME))&&b.exists()){var c=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);c.charset="UTF-8";try{var d=GTB_parseJson(c.ConvertToUnicode(G_FileReader.readAll(b)));this.methods_={};var e=d.translation_methods,f;for(b=0;f=e[b];b++){c=null;if(f.name=="local"){if(this.localMethod_)this.localMethod_.updateConfig(f.request);
else this.localMethod_=new GTB_HoverTranslateLocal(f.request);c=this.localMethod_}else c=new GTB_HoverTranslateRemote(f);this.methods_[f.name]=c}this.languagePairs_={};var g=d.language_pairs;for(b=0;f=g[b];b++){var h=f.from+"2"+f.to;this.languagePairs_[h]=f.methods}this.defaultMethods_=[];if(d.default_methods)this.defaultMethods_=d.default_methods}catch(i){}}};
GTB_HoverTranslateConfig.prototype.getMethods=function(b,c){var d=this.languagePairs_[b.google+"2"+c.google]||this.languagePairs_[b.google+"2*"]||this.languagePairs_["*2"+c.google]||this.defaultMethods_;if(!d||d.length==0)return null;for(var e=[],f,g=0;f=d[g];g++)(f=this.methods_[f])&&e.push(f);return e};GTB_HoverTranslateConfig.prototype.getSelectionMethods=function(){var b=this.methods_.selection;return b?[b]:null};
GTB_HoverTranslateConfig.prototype.getUnknownSourceMethods=function(){var b=this.methods_.unknown_source;return b?[b]:null};GTB_HoverTranslateConfig.instance_=null;GTB_HoverTranslateConfig.getInstance=function(){if(!GTB_HoverTranslateConfig.instance_)GTB_HoverTranslateConfig.instance_=new GTB_HoverTranslateConfig;return GTB_HoverTranslateConfig.instance_};function GTB_HoverTranslate(b){this.debugZone="GTB_HoverTranslate";this.document_=b;this.popup_=new GTB_HoverTranslatePopup(b,this);this.showWordInPopupBound_=BindToObject(this.showWordInPopup_,this);this.showSelectionInPopupBound_=BindToObject(this.showSelectionInPopup_,this);this.prefs_=new G_Preferences("google.toolbar.");b=BindToObject(this.onEnabledPrefChanged_,this);this.prefs_.addObserver("button_option.gtbTranslate",b);this.prefs_.addObserver("translate.hover",b);this.onEnabledPrefChanged_();
b=BindToObject(this.onLanguagePrefChanged_,this);this.prefs_.addObserver("translate.target_lang",b);this.prefs_.addObserver("translate.hover.understand_list",b);this.onLanguagePrefChanged_();this.prefs_.addObserver("translate.hover.hold_shift",BindToObject(this.onHoldShiftPrefChanged_,this));this.onHoldShiftPrefChanged_();this.langDetector_=null;if(!this.isPpcArchitecture_()&&Cc["@google.com/lang-detect;1"]){this.langDetector_=Cc["@google.com/lang-detect;1"].getService(Ci.GTBILangDetect);if("not-bundled"==
this.langDetector_.detectLanguage("",true))this.langDetector_=null}this.config_=GTB_HoverTranslateConfig.getInstance();b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.DISABLE_TOOLTIP=b.GetStringFromName("google-translate.disable");this.ENABLE_TOOLTIP=b.GetStringFromName("google-translate.disable");this.TRANSLATE_TERM=b.GetStringFromName("google-translate.translateTerm")}a=GTB_HoverTranslate.prototype;
a.hoverEnabled_=false;a.translateEnabled_=false;a.understand_=[];a.targetLanguage_=null;a.holdShift=false;a.isPpcArchitecture_=function(){var b=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULRuntime);try{var c=b.XPCOMABI.toUpperCase();return c.substring(0,3)=="PPC"}catch(d){}return false};a.onHoldShiftPrefChanged_=function(){this.holdShift=this.prefs_.getPref("translate.hover.hold_shift")};
a.onEnabledPrefChanged_=function(){this.hoverEnabled_=(this.translateEnabled_=this.prefs_.getPref("button_option.gtbTranslate",false))&&this.prefs_.getPref("translate.hover",false)};a.onLanguagePrefChanged_=function(){this.targetLanguage_=GTB_languages.byGoogle(this.prefs_.getPref("translate.target_lang"));this.understand_=[];var b=this.prefs_.getPref("translate.hover.understand_list");b=b?b.split(","):[];for(var c,d=0;c=b[d];d++)(c=GTB_languages.byGoogle(c))&&this.understand_.push(c)};
a.disable=function(){this.prefs_.setPref("translate.hover",false)};a.updateMenuItem=function(b){b.setAttribute("checked",this.hoverEnabled_);b.setAttribute("tooltiptext",this.hoverEnabled_?this.DISABLE_TOOLTIP:this.ENABLE_TOOLTIP)};goog.exportSymbol("GTB_HoverTranslate.prototype.updateMenuItem",GTB_HoverTranslate.prototype.updateMenuItem);
GTB_HoverTranslate.prototype.toggle=function(b){this.prefs_.setPref("translate.hover",!this.hoverEnabled_);b.stopPropagation();b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);b.notifyObservers(null,"GTB_WT_TOGGLE",null)};goog.exportSymbol("GTB_HoverTranslate.prototype.toggle",GTB_HoverTranslate.prototype.toggle);GTB_HoverTranslate.getTargetLang=function(){var b=new G_Preferences("google.toolbar.");b=b.getPref("translate.target_lang");return GTB_languages.byGoogle(b)};a=GTB_HoverTranslate.prototype;
a.extract_=function(b,c,d,e){if(c.nodeType!=c.TEXT_NODE)return null;var f=b.createRange();try{f.selectNode(c)}catch(g){return null}c=f.toString();f={text:"",from:null,to:null,before:"",after:"",truncated:""};var h=null;if(e){h=e;e=0;for(var i=h.length;e<h.length&&!GTB_IsAlpha(h[e]);)e++;for(;i>e&&!GTB_IsAlpha(h[i-1]);)i--;if(e<i){h=h.substring(e,i);d=c.indexOf(h);if(d!=-1){f.before=c.substring(0,d);f.after=c.substring(d+h.length,c.length)}}else h=null;f.text=h}else{if(d<0||d>=c.length)return null;
e=d;i=d+1;if(!GTB_IsAlpha(c[d]))return null;for(;e>0&&GTB_IsAlpha(c[e-1]);)e--;for(;i<c.length&&GTB_IsAlpha(c[i]);)i++;h=c.substring(e,i);f.text=c.substring(d,d+1);f.before=c.substring(e,d);f.after=c.substring(d+1,i)}if(!h)return null;(d=this.detectLanguage_(h))||(d=this.detectLanguage_(c));if(!d&&b.gtbAutoPageTranslateLangDetected_)d=GTB_languages.byGoogle(b.gtbAutoPageTranslateLangDetected_);f.from=d;if(!d||!GTB_languages.isIdeographic(d))f.text=h;f.truncated=GTB_truncateWithElipsis(f.text,84);
return f};a.isEnabledForDocument_=function(b){return!GTB_IsPrivateBrowsing()&&b.location.protocol!="https:"&&GTB_isGoogleToolbarActive(this.document_)};
a.maybeTranslate=function(b,c,d){if(this.hoverEnabled_&&this.targetLanguage_)if(this.isEnabledForDocument_(b)){var e=this.document_.getElementById("content").selectedBrowser.contentWindow,f;if(e.frames.length==0)f=e.getSelection();else try{f=this.document_.commandDispatcher.focusedWindow.getSelection()}catch(g){f=null}e=e=null;if(f)for(var h=0;h<f.rangeCount;h++){var i=f.getRangeAt(h);try{if(i.comparePoint(c,d)==0)e=i}catch(j){}}if(e=(f=e&&e.toString())?this.extract_(b,e.startContainer,e.startOffset,
f):this.extract_(b,c,d)){e.to=this.targetLanguage_;if(!(this.understand_.indexOf(e.from)!=-1||e.from==e.to)){b=!!e.from;d=c=null;if(f){c=this.config_.getSelectionMethods(e.from,e.to);d=this.showSelectionInPopupBound_}else{c=e.from?this.config_.getMethods(e.from,e.to):this.config_.getUnknownSourceMethods(e.to);d=this.showWordInPopupBound_}if(c){this.popup_.setDirection(e.to.direction);this.popup_.setTranslating(e.truncated);b&&this.popup_.showPopup();this.translate_(e,c,d)}}}}};
a.showWordInPopup_=function(b,c){if(c){c=GTB_truncateWithElipsis(c,84);this.popup_.setTranslationText(b.truncated+": "+c);this.popup_.isVisible()||this.popup_.showPopup()}else this.popup_.setNoTranslation(b.truncated)};
a.showSelectionInPopup_=function(b,c){if(c){if(c.length>=84){var d="http://translate.google.com/?hl={hl}&tl={tl}".replace(/{hl}/g,GTB_getLangCode()).replace(/{tl}/g,b.to.google);this.popup_.showFullLink(d,"source=tbht&q="+b.text);c=GTB_truncateWithElipsis(c,84)}this.popup_.setTranslationText(c);this.popup_.isVisible()||this.popup_.showPopup()}else this.popup_.setNoTranslation(b.truncated)};a.detectLanguage_=function(b){if(this.langDetector_){b=this.langDetector_.detectLanguage(b,true);return GTB_languages.byCLD(b)}return null};
a.translate_=function(b,c,d){if(c.length==0)d(b,null);else{var e=c.shift();e.translate(b,BindToObject(this.onTranslationComplete_,this,b,c,d))}};a.onTranslationComplete_=function(b,c,d,e){e?d(b,e):this.translate_(b,c,d)};
a.maybeShowTranslateMenuItem=function(b){var c=this.document_.getElementById("gtbHoverTranslateMenuItem");if(c){c.hidden=true;if(this.translateEnabled_&&GTB_isGoogleToolbarActive(this.document_)){var d=this.document_.getElementById("content").selectedBrowser.contentWindow,e;if(d.frames.length==0)e=d.getSelection();else try{var f=b.view.document;e=f.commandDispatcher.focusedWindow.getSelection()}catch(g){e=null}if(!(!e||e.rangeCount!=1)){b=e.getRangeAt(0);if(d=this.extract_(d.document,b.startContainer,
b.startOffset,e.toString())){d.to=this.targetLanguage_;if(!(this.understand_.indexOf(d.from)!=-1||d.from==d.to))if(e=this.config_.getSelectionMethods(d.from,d.to)){e={info:d,methods:e};c.setUserData("translatedata",e,null);c.label=this.TRANSLATE_TERM.replace("&term;",d.truncated);c.hidden=false}}}}}};goog.exportSymbol("GTB_HoverTranslate.prototype.maybeShowTranslateMenuItem",GTB_HoverTranslate.prototype.maybeShowTranslateMenuItem);
GTB_HoverTranslate.prototype.translateSelectedText=function(b){var c=b.getUserData("translatedata");b.setUserData("translatedata",null,null);this.popup_.setDirection(c.info.to.direction);this.popup_.setTranslating(c.info.truncated);this.popup_.showPopup();this.translate_(c.info,c.methods,this.showSelectionInPopupBound_)};goog.exportSymbol("GTB_HoverTranslate.prototype.translateSelectedText",GTB_HoverTranslate.prototype.translateSelectedText);
GTB_HoverTranslate.createInstance=function(b){return GTB_GeckoVersion.isFirefox2()?new GTB_HoverTranslateFake(b):new GTB_HoverTranslate(b)};goog.exportSymbol("GTB_HoverTranslate.createInstance",GTB_HoverTranslate.createInstance);function GTB_HoverTranslateFake(b){this.document_=b}GTB_HoverTranslateFake.prototype.toggle=function(){};goog.exportSymbol("GTB_HoverTranslateFake.prototype.toggle",GTB_HoverTranslateFake.prototype.toggle);
GTB_HoverTranslateFake.prototype.updateMenuItem=function(b){b.hidden=true};goog.exportSymbol("GTB_HoverTranslateFake.prototype.updateMenuItem",GTB_HoverTranslateFake.prototype.updateMenuItem);GTB_HoverTranslateFake.prototype.maybeShowTranslateMenuItem=function(){var b=this.document_.getElementById("gtbHoverTranslateMenuItem");if(b)b.hidden=true};goog.exportSymbol("GTB_HoverTranslateFake.prototype.maybeShowTranslateMenuItem",GTB_HoverTranslateFake.prototype.maybeShowTranslateMenuItem);function GTB_BookmarkHighlightCreator(b,c){this.debugZone="bookmark highlight creator";this.doc_=b;this.selection_=c}a=GTB_BookmarkHighlightCreator.prototype;a.process=function(){var b=this.serializeRange_(this.selection_);b=this.truncateSelection_(b.split(/[<>]/),4E4,4E3);this.truncSelectionText_=this.sections2text_(b);for(var c=[],d=0;d<b.length;d+=2)c.push(b[d]);this.guide_=this.selectGuide_(c,100);this.occurrence_=this.findOccurrence_()};a.guide=function(){return this.guide_};a.occur=function(){return this.occurrence_};
a.htext=function(){return this.truncSelectionText_};a.sections2text_=function(b){for(var c="",d=0;d<b.length;d+=2){c+=b[d];if(d+1<b.length)c+="<"+b[d+1]+">"}return c};a.truncateSelection_=function(b,c,d){for(var e=[],f=0,g=0,h=0;h<b.length;h++){var i=b[h].length;if(h%2){if(b[h][0]!="/"){var j=b[h].match(/^(\w+)/)[0].length;i+=5+j;if(f+i>c)break;f+=i}e.push(b[h])}else if(f+i<=c&&g+i<=d){e.push(b[h]);f+=i;g+=i}else{c=Math.min(c-f,d-g);b=b[h].substring(0,c);e.push(b);break}}return e};
a.serializeRange_=function(b){this.convertImagesPathToAbsolute_(b);b=b.cloneContents();var c=this.doc_.createRange();c.selectNodeContents(b);this.stripCData_(c.commonAncestorContainer);return G_SelectionRangeUtils.SerializeRange(this.doc_,this.selection_)};var GTB_HL_TYPES_TO_BE_STRIPPED=[Ci.nsIDOMNode.CDATA_SECTION_NODE,Ci.nsIDOMNode.ENTITY_REFERENCE_NODE,Ci.nsIDOMNode.PROCESSING_INSTRUCTION_NODE,Ci.nsIDOMNode.COMMENT_NODE];
GTB_BookmarkHighlightCreator.prototype.stripCData_=function(b){if(b.nodeType==b.ELEMENT_NODE||b.nodeType==b.ENTITY_REFERENCE_NODE)for(var c=b.firstChild;c;){var d=c.nextSibling;if(GTB_HL_TYPES_TO_BE_STRIPPED.indexOf(c.nodeType)>=0||c.nodeType==b.ELEMENT_NODE&&c.nodeName.toLowerCase()=="script"){var e=b.ownerDocument.createElement("span");b.replaceChild(e,c)}else c.nodeType==b.ELEMENT_NODE&&this.stripCData_(c);c=d}};
GTB_BookmarkHighlightCreator.prototype.selectGuide_=function(b,c){for(var d="",e=0;e<b.length;e++){var f=/^\s*(\S|\S.*\S)\s*$/.exec(b[e]);if(f){f=f[1];if(f.length>d.length){d=f.substring(0,c);if(d.length===c)return d}}}return d.length?d:null};
GTB_BookmarkHighlightCreator.prototype.findOccurrence_=function(){var b=1,c=this.doc_.createRange();c.selectNodeContents(this.doc_.body);c=new GTB_RangeTextElements(c);for(var d=this.doc_.createRange(),e;e=c.nextText();)for(var f=e.nodeValue,g=0;;){g=f.indexOf(this.guide_,g);if(g==-1)break;d.selectNode(e);d.setStart(e,g);d.setEnd(e,g+this.guide_.length);if(this.selection_.compareBoundaryPoints(Ci.nsIDOMRange.START_TO_START,d)<=0)return b;else{b++;g++}}return 1};
GTB_BookmarkHighlightCreator.prototype.convertImagesPathToAbsolute_=function(b){for(var c=b.commonAncestorContainer;c&&!c.getElementsByTagName;)c=c.parent;if(c){c=c.getElementsByTagName("IMG");for(var d=this.doc_.createRange(),e=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(this.doc_.location.toString(),null,null),f=0;f<c.length;++f){var g=c[f];d.selectNode(g);if(b.compareBoundaryPoints(b.START_TO_START,d)<=0&&b.compareBoundaryPoints(b.END_TO_END,d)>=0){var h=g.getAttribute("src");
h&&h.indexOf("://")==-1&&g.setAttribute("src",e.resolve(h))}}}};function GTB_BookmarkHighlightArea(){this.guides_=[];this.regexps_=[]}
GTB_BookmarkHighlightArea.prototype.createFromDom=function(b){this.tooltip_=GTB_BookmarkHighlightArea.getText("./tooltip/text()",b);this.text_=GTB_BookmarkHighlightArea.getText("./text/text()",b);b=b.ownerDocument.evaluate("./guides/guide",b,null,Ci.nsIDOMXPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var c=b.iterateNext();if(!c){var d={offset_:0,length_:this.text_.length,occurrence_:1};this.guides_.push(d);this.regexps_.push(this.guide2regexp_(d))}for(;c;){d={};d.offset_=Number(GTB_BookmarkHighlightArea.getText("./offset/text()",
c));d.length_=Number(GTB_BookmarkHighlightArea.getText("./length/text()",c));d.occurrence_=Number(GTB_BookmarkHighlightArea.getText("./occurrence/text()",c));this.guides_.push(d);this.regexps_.push(this.guide2regexp_(d));c=b.iterateNext()}};GTB_BookmarkHighlightArea.prototype.guide2regexp_=function(b){b=this.text_.substring(b.offset_,b.offset_+b.length_);b=b.replace(/(\W)/g,"\\$1");return RegExp(b,"g")};
GTB_BookmarkHighlightArea.prototype.find=function(b){for(var c=this.guides_[0].occurrence_,d=0;d<b.length;d++)for(var e;e=this.regexps_[0].exec(b[d].nodeValue);){c-=1;if(!c){this.regexps_[0].lastIndex=0;c=d;for(var f=e.index,g=this.guides_[0].offset_,h=this.text_.length-this.guides_[0].offset_;g>0&&(c>0||f>0);){var i=Math.min(f,g);g-=i;f-=i;if(f==0&&g>0&&c>0){c--;f=b[c].nodeValue.length}}d=d;for(e=e.index;h>0&&d<b.length;){i=Math.min(h,b[d].nodeValue.length-e);h-=i;e+=i;if(e==b[d].nodeValue.length){d++;
e=0}}if(d==b.length){d--;e=b[d].nodeValue.length}return{startNode:c,startOffset:f,endNode:d,endOffset:e}}}return null};GTB_BookmarkHighlightArea.getText=function(b,c){var d=c.ownerDocument.evaluate(b,c,null,Ci.nsIDOMXPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return d&&d.nodeValue};
function GTB_RangeTextElements(b){this.range_=b;for(var c=b.startContainer,d=b.startOffset;c.hasChildNodes();){c=c.childNodes.item(d);d=0}this.startNode_=c;this.startOffset_=d;this.currentNode_=c;this.firstNode_=true;this.frameRecursive_=null;c=b.endContainer;b=b.endOffset;this.eatEndNode_=false;if(c.hasChildNodes()){b=c.childNodes.item(b);if(b==null){this.endNode_=c;this.eatEndNode_=true}else{this.endNode_=b;this.endOffset_=0}}else if(c.nodeType==Ci.nsIDOMElement.TEXT_NODE){this.endNode_=c;this.eatEndNode_=
true;this.endOffset_=b}}
GTB_RangeTextElements.prototype.nextText=function(){if(this.frameRecursive_){var b=this.frameRecursive_.nextText();if(b)return b;else this.frameRecursive_=null}if(this.firstNode_)this.firstNode_=false;else this.next_();for(;this.currentNode_&&this.currentNode_.nodeType!=Ci.nsIDOMNode.TEXT_NODE&&(this.currentNode_.nodeType!=Ci.nsIDOMNode.ELEMENT_NODE||!this.currentNode_.contentDocument);)this.next_();if(!this.currentNode_||this.currentNode_.nodeType==Ci.nsIDOMNode.TEXT_NODE)return this.currentNode_;else if(this.currentNode_.contentDocument){b=
this.currentNode_.contentDocument;var c=b.createRange();c.selectNodeContents(b.body);this.frameRecursive_=new GTB_RangeTextElements(c);return this.nextText()}};GTB_RangeTextElements.prototype.toArray=function(){for(var b=[],c=this.nextText();c;){b.push(c);c=this.nextText()}return b};
GTB_RangeTextElements.prototype.next_=function(){var b=this.currentNode_;if(!b||b==this.endNode_)this.currentNode_=null;else{for(;b!=null&&b!=this.endNode_&&!b.nextSibling;)b=b.parentNode;if(b==null||b==this.endNode_)this.currentNode_=null;else{for(b=b.nextSibling;!b.contentDocument&&(b.nodeType!=Ci.nsIDOMNode.ELEMENT_NODE||b.nodeName.toLowerCase()!="script"&&b.nodeName.toLowerCase()!="style"&&b.nodeName.toLowerCase()!="noscript")&&b.hasChildNodes()&&(b!=this.endNode_||this.eatEndNode_);)b=b.firstChild;
if(b==this.endNode_&&!this.eatEndNode_)b=null;this.currentNode_=b;if(b.nodeType==Ci.nsIDOMNode.ELEMENT_NODE&&(b.nodeName.toLowerCase()=="script"||b.nodeName.toLowerCase()=="style"||b.nodeName.toLowerCase()=="noscript"))this.next_()}}};goog.array={};goog.array.ArrayLike=goog.typedef;goog.array.peek=function(b){return b[b.length-1]};goog.array.ARRAY_PROTOTYPE_=Array.prototype;
goog.array.indexOf=goog.array.ARRAY_PROTOTYPE_.indexOf?function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return goog.array.ARRAY_PROTOTYPE_.indexOf.call(b,c,d)}:function(b,c,d){d=d==null?0:d<0?Math.max(0,b.length+d):d;if(goog.isString(b)){if(!goog.isString(c)||c.length!=1)return-1;return b.indexOf(c,d)}for(d=d;d<b.length;d++)if(d in b&&b[d]===c)return d;return-1};
goog.array.lastIndexOf=goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);d=d==null?b.length-1:d;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(b,c,d)}:function(b,c,d){d=d==null?b.length-1:d;if(d<0)d=Math.max(0,b.length+d);if(goog.isString(b)){if(!goog.isString(c)||c.length!=1)return-1;return b.lastIndexOf(c,d)}for(d=d;d>=0;d--)if(d in b&&b[d]===c)return d;return-1};
goog.array.forEach=goog.array.ARRAY_PROTOTYPE_.forEach?function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);goog.array.ARRAY_PROTOTYPE_.forEach.call(b,c,d)}:function(b,c,d){for(var e=b.length,f=goog.isString(b)?b.split(""):b,g=0;g<e;g++)g in f&&c.call(d,f[g],g,b)};goog.array.forEachRight=function(b,c,d){var e=b.length,f=goog.isString(b)?b.split(""):b;for(e=e-1;e>=0;--e)e in f&&c.call(d,f[e],e,b)};
goog.array.filter=goog.array.ARRAY_PROTOTYPE_.filter?function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return goog.array.ARRAY_PROTOTYPE_.filter.call(b,c,d)}:function(b,c,d){for(var e=b.length,f=[],g=0,h=goog.isString(b)?b.split(""):b,i=0;i<e;i++)if(i in h){var j=h[i];if(c.call(d,j,i,b))f[g++]=j}return f};
goog.array.map=goog.array.ARRAY_PROTOTYPE_.map?function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return goog.array.ARRAY_PROTOTYPE_.map.call(b,c,d)}:function(b,c,d){for(var e=b.length,f=Array(e),g=goog.isString(b)?b.split(""):b,h=0;h<e;h++)if(h in g)f[h]=c.call(d,g[h],h,b);return f};goog.array.reduce=function(b,c,d,e){if(b.reduce)return e?b.reduce(goog.bind(c,e),d):b.reduce(c,d);var f=d;goog.array.forEach(b,function(g,h){f=c.call(e,f,g,h,b)});return f};
goog.array.reduceRight=function(b,c,d,e){if(b.reduceRight)return e?b.reduceRight(goog.bind(c,e),d):b.reduceRight(c,d);var f=d;goog.array.forEachRight(b,function(g,h){f=c.call(e,f,g,h,b)});return f};
goog.array.some=goog.array.ARRAY_PROTOTYPE_.some?function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return goog.array.ARRAY_PROTOTYPE_.some.call(b,c,d)}:function(b,c,d){for(var e=b.length,f=goog.isString(b)?b.split(""):b,g=0;g<e;g++)if(g in f&&c.call(d,f[g],g,b))return true;return false};
goog.array.every=goog.array.ARRAY_PROTOTYPE_.every?function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return goog.array.ARRAY_PROTOTYPE_.every.call(b,c,d)}:function(b,c,d){for(var e=b.length,f=goog.isString(b)?b.split(""):b,g=0;g<e;g++)if(g in f&&!c.call(d,f[g],g,b))return false;return true};goog.array.find=function(b,c,d){c=goog.array.findIndex(b,c,d);return c<0?null:goog.isString(b)?b.charAt(c):b[c]};
goog.array.findIndex=function(b,c,d){for(var e=b.length,f=goog.isString(b)?b.split(""):b,g=0;g<e;g++)if(g in f&&c.call(d,f[g],g,b))return g;return-1};goog.array.findRight=function(b,c,d){c=goog.array.findIndexRight(b,c,d);return c<0?null:goog.isString(b)?b.charAt(c):b[c]};goog.array.findIndexRight=function(b,c,d){var e=b.length,f=goog.isString(b)?b.split(""):b;for(e=e-1;e>=0;e--)if(e in f&&c.call(d,f[e],e,b))return e;return-1};goog.array.contains=function(b,c){return goog.array.indexOf(b,c)>=0};
goog.array.isEmpty=function(b){return b.length==0};goog.array.clear=function(b){if(!goog.isArray(b))for(var c=b.length-1;c>=0;c--)delete b[c];b.length=0};goog.array.insert=function(b,c){goog.array.contains(b,c)||b.push(c)};goog.array.insertAt=function(b,c,d){goog.array.splice(b,d,0,c)};goog.array.insertArrayAt=function(b,c,d){goog.partial(goog.array.splice,b,d,0).apply(null,c)};
goog.array.insertBefore=function(b,c,d){var e;arguments.length==2||(e=goog.array.indexOf(b,d))<0?b.push(c):goog.array.insertAt(b,c,e)};goog.array.remove=function(b,c){var d=goog.array.indexOf(b,c),e;if(e=d>=0)goog.array.removeAt(b,d);return e};goog.array.removeAt=function(b,c){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return goog.array.ARRAY_PROTOTYPE_.splice.call(b,c,1).length==1};
goog.array.removeIf=function(b,c,d){c=goog.array.findIndex(b,c,d);if(c>=0){goog.array.removeAt(b,c);return true}return false};goog.array.concat=function(){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.clone=function(b){if(goog.isArray(b))return goog.array.concat(b);else{for(var c=[],d=0,e=b.length;d<e;d++)c[d]=b[d];return c}};goog.array.toArray=function(b){if(goog.isArray(b))return goog.array.concat(b);return goog.array.clone(b)};
goog.array.extend=function(b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(goog.isArray(d)||(e=goog.isArrayLike(d))&&d.hasOwnProperty("callee"))b.push.apply(b,d);else if(e)for(var f=b.length,g=d.length,h=0;h<g;h++)b[f+h]=d[h];else b.push(d)}};goog.array.splice=function(b){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return goog.array.ARRAY_PROTOTYPE_.splice.apply(b,goog.array.slice(arguments,1))};
goog.array.slice=function(b,c,d){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);return arguments.length<=2?goog.array.ARRAY_PROTOTYPE_.slice.call(b,c):goog.array.ARRAY_PROTOTYPE_.slice.call(b,c,d)};goog.array.removeDuplicates=function(b,c){for(var d=c||b,e={},f=0,g=0;g<b.length;){var h=b[g++],i=goog.isObject(h)?goog.getUid(h):h;if(!Object.prototype.hasOwnProperty.call(e,i)){e[i]=true;d[f++]=h}}d.length=f};
goog.array.binarySearch=function(b,c,d){return goog.array.binarySelect(b,goog.partial(d||goog.array.defaultCompare,c))};goog.array.binarySelect=function(b,c,d){for(var e=0,f=b.length,g;e<f;){var h=e+f>>1,i=c.call(d,b[h],h,b);if(i>0)e=h+1;else{f=h;g=!i}}return g?e:~e};goog.array.sort=function(b,c){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);goog.array.ARRAY_PROTOTYPE_.sort.call(b,c||goog.array.defaultCompare)};
goog.array.stableSort=function(b,c){function d(g,h){return f(g.value,h.value)||g.index-h.index}for(var e=0;e<b.length;e++)b[e]={index:e,value:b[e]};var f=c||goog.array.defaultCompare;goog.array.sort(b,d);for(e=0;e<b.length;e++)b[e]=b[e].value};goog.array.sortObjectsByKey=function(b,c,d){var e=d||goog.array.defaultCompare;goog.array.sort(b,function(f,g){return e(f[c],g[c])})};
goog.array.equals=function(b,c,d){if(!goog.isArrayLike(b)||!goog.isArrayLike(c)||b.length!=c.length)return false;var e=b.length;d=d||goog.array.defaultCompareEquality;for(var f=0;f<e;f++)if(!d(b[f],c[f]))return false;return true};goog.array.compare=function(b,c,d){return goog.array.equals(b,c,d)};goog.array.defaultCompare=function(b,c){return b>c?1:b<c?-1:0};goog.array.defaultCompareEquality=function(b,c){return b===c};
goog.array.binaryInsert=function(b,c,d){d=goog.array.binarySearch(b,c,d);if(d<0){goog.array.insertAt(b,c,-(d+1));return true}return false};goog.array.binaryRemove=function(b,c,d){c=goog.array.binarySearch(b,c,d);return c>=0?goog.array.removeAt(b,c):false};goog.array.bucket=function(b,c){for(var d={},e=0;e<b.length;e++){var f=b[e],g=c(f,e,b);if(goog.isDef(g)){g=d[g]||(d[g]=[]);g.push(f)}}return d};goog.array.repeat=function(b,c){for(var d=[],e=0;e<c;e++)d[e]=b;return d};
goog.array.flatten=function(){for(var b=[],c=0;c<arguments.length;c++){var d=arguments[c];goog.isArray(d)?b.push.apply(b,goog.array.flatten.apply(null,d)):b.push(d)}return b};goog.array.rotate=function(b,c){goog.asserts.assert(b||goog.isString(b));goog.asserts.assertNumber(b.length);if(b.length){c%=b.length;if(c>0)goog.array.ARRAY_PROTOTYPE_.unshift.apply(b,b.splice(-c,c));else c<0&&goog.array.ARRAY_PROTOTYPE_.push.apply(b,b.splice(0,-c))}return b};function GTB_DomTranslator(b,c,d){this.textCache_={};this.documentTranslated_=false;this.document=b;this.secure=c;this.transModule=new SimplePageTranslator(this);this.prefs_=new G_Preferences("google.toolbar.");b.gtbDomTranslator=this;this.finishCallback=d}a=GTB_DomTranslator.prototype;a.debugZone="GTB_DomTranslator";
a.reset=function(){this.nodes=[];this.knownNodes_=[];this.submittedStrings_={};this.duplicateNodes_=[];this.frames=[];this.numNodesQueued=0;this.isErrorHandled=false;this.transCount=this.totalReplaced=0;this.transModule.reset()};a.clean=function(){this.frames=this.duplicateNodes_=this.submittedStrings_=this.knownNodes_=this.nodes=null};a.log=function(b){this.logMessage(b,true)};a.logError=function(b){this.logMessage(b,false)};
a.handleError=function(b,c){if(this.nodes&&!this.isErrorHandled){this.revert();this.finishCallback&&this.finishCallback(false,null,b,c);this.isErrorHandled=true}};a.logMessage=function(){};a.isButton=function(b){return b.type=="button"||b.type=="submit"};a.getTextCache_=function(){var b=this.srcLang+"|"+this.dstLang,c=this.textCache_[b];c||(c=this.textCache_[b]={});return c};
a.push=function(b){if(this.getTextCache_()[b.originalValue])this.knownNodes_.push(b);else if(b.originalValue in this.submittedStrings_)this.duplicateNodes_.push(b);else{if(this.transModule.isOverflown()){this.translateNodes(true);this.transModule.reset();this.transModule.announce(this.nodes[this.nodes.length-1].originalValue)}this.transModule.announce(b.originalValue);this.nodes.push(b);this.submittedStrings_[b.originalValue]=true}};
a.traverse=function(b,c,d,e){if(b=b.childNodes)for(var f,g,h=0;h<b.length;h++){f=b[h];g=null;if(f.tagName=="INPUT"){if(this.isButton(f))g=f.value}else g=f.nodeValue;if(f.title){var i=this.document.createTextNode("");i.originalValue=f.title;i.forLink=f;this.push(i)}if(f.nodeType!=Ci.nsIDOMNode.COMMENT_NODE&&g&&GTB_HasAlpha(g)){f.originalValue=g;this.push(f)}else if(f.childNodes)if(!c&&f.contentDocument)this.frames.push(f.contentDocument);else{g=f.tagName?f.tagName.toLowerCase():null;if(g!="script"&&
g!="noscript"&&g!="style")f.contentDocument?this.traverse(f.contentDocument,c,d+1,++e):this.traverse(f,c,d+1,++e)}}};
a.translateNode=function(b,c){if(c[0]&&!c.match)c=c[0];if(b.originalValue.match(/\s+$/)&&!c.match(/\s+$/))c+=" ";this.getTextCache_()[b.originalValue]=c;if(b.forLink)b.forLink.title=c;else if(b.parentNode&&b.parentNode.tagName=="TITLE"){b.isDocumentTitle=true;b.ownerDocument.title=c}else if(b.tagName=="INPUT")if(this.isButton(b))b.value=c;else this.logError("strange node to translate: "+b+":"+c);else b.nodeValue=c};
a.processResponse=function(b,c,d,e,f){try{this.log(">>> processing response");var g=this.nodes,h=GTB_parseJson(b.responseText),i=this.srcLang&&this.srcLang!="un"?null:{},j={},k=f.parseResponse(h,this.document,g,d,e,i,j);if(k){this.totalReplaced+=e-d;this.log(">>> response processed, replaced: "+this.totalReplaced);if(this.totalReplaced==g.length){this.translateNodesUsingCache_(this.duplicateNodes_);this.log("total time: "+((new Date).getTime()-this.startTimeMs));this.finishCallback&&this.finishCallback(true,
this.dstLang)}}else{this.log("for: "+c);this.log("bad translate data received: "+b.responseText)}if(i)this.srcLang=i.value}catch(l){this.logError("Exception: "+l);this.handleError()}};
a.translateNodes=function(b){var c=this.numNodesQueued,d=this.nodes.length;b&&d--;this.log(">>> making form for "+c+"-"+d+"("+b+")");if(c!=d){var e=this.transModule.buildForm(this.document,this.nodes,c,d);this.transCount++;b=this.prefs_.getPref("button_option.gtbPageRank",false)&&!this.secure?this.document.location:null;var f=this.transModule.buildUrl(this.srcLang,this.dstLang,this.secure,this.transType,this.sticky,this.transCount,b);this.log("  <<< making form finished, form.length is: "+e.length);
var g=BindToObject(function(p){this.log("  <<< translate: end: "+c+"-"+d);if(p.status==200)this.processResponse(p,e,c,d,this.transModule);else{this.logError("translate: bad request: "+p.status);this.handleError(!p.status,p.status)}},this);this.log(">>> translate: start: "+c+"-"+d);var h=new G_XMLFetcher;if(!Cc["@mozilla.org/streamconv;1"]||!this.prefs_.getPref(GTB_PageTranslator.USE_GZIP_PREF,true))h.post(f,e,g);else{var i=Cc["@mozilla.org/pipe;1"].createInstance(Ci.nsIPipe);i.init(true,true,0,0,
null);var j=Cc["@mozilla.org/binaryoutputstream;1"].createInstance(Ci.nsIBinaryOutputStream);j.setOutputStream(i.outputStream);var k=Cc["@mozilla.org/network/buffered-output-stream;1"].createInstance(Ci.nsIBufferedOutputStream);k.init(i.outputStream,e.length);var l=this.toggleEndianness32_((new Date).getTime()/1E3),m=this.toggleEndianness32_(this.utf8ToCrc32_(e)),n=this.toggleEndianness32_(e.length),o={onStartRequest:function(){j.write32(529205249);j.write32(l);j.write16(255)},onDataAvailable:function(p,
r,q,s,u){k.writeFrom(q,u);k.flush()},onStopRequest:function(){j.write32(m);j.write32(n);i.outputStream.close();h.setRequestHeader("Content-Encoding","gzip");h.post(f,i.inputStream,g)}};b=Cc["@mozilla.org/streamconv;1?from=uncompressed&to=deflate"].createInstance(Ci.nsIStreamConverter);b.asyncConvertData("uncompressed","gzip",o,null);b.onStartRequest(null,null);o=Cc["@mozilla.org/io/string-input-stream;1"].createInstance(Ci.nsIStringInputStream);for(o.setData(e,e.length);o.available()!=0;)b.onDataAvailable(null,
null,o,0,o.available());o={};b.onStopRequest(null,null,o)}this.numNodesQueued=d}else{this.log("nothing to translate");this.finishCallback(true,this.dstLang,null,null,this.knownNodes_.length==0)}};a.toggleEndianness32_=function(b){return b>>24&255|b>>8&65280|b<<8&16711680|b<<24&4278190080};
GTB_DomTranslator.CRC_TABLE_=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,
1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,
1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,
2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,
733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,
3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];GTB_DomTranslator.prototype.utf8ToCrc32_=function(b){var c=0,d=0;d=0;c^=-1;for(var e=0,f=b.length;e<f;e++){d=(c^b.charCodeAt(e))&255;d=GTB_DomTranslator.CRC_TABLE_[d];c=c>>>8^d}return c^-1};
GTB_DomTranslator.prototype.translateDoc=function(b,c,d,e,f){try{var g=this.document;this.log("translating: "+g.location);if(this.documentTranslated_)this.revert();else{this.reset();this.startTimeMs=(new Date).getTime();this.srcLang=b;this.dstLang=c;this.transType=e;this.sticky=f;this.log(">>> fill");this.traverse(g,d,0,0);this.log("<<< fill finished");this.transModule.isOverflown()&&this.translateNodes(true);this.translateNodes(false);this.translateNodesUsingCache_(this.knownNodes_);this.documentTranslated_=
true}}catch(h){this.logError("Excpetion: "+h);this.handleError()}};GTB_DomTranslator.prototype.translateNodesUsingCache_=function(b){for(var c=0;c<b.length;c++){var d=b[c];this.translateNode(d,this.getTextCache_()[d.originalValue])}};
GTB_DomTranslator.prototype.revert=function(){this.log(">>> reverting: "+this.document.location);if(this.documentTranslated_){for(var b=this.nodes.concat(this.knownNodes_).concat(this.duplicateNodes_),c=0;c<b.length;c++){var d=b[c];if(d.forLink)d.forLink.title=d.originalValue;else if(d.isDocumentTitle)d.ownerDocument.title=d.originalValue;else if(d.tagName=="INPUT")d.value=d.originalValue;else d.nodeValue=d.originalValue;d.originalValue=null}for(var e in this.frames)(b=this.frames[e].gtbDomTranslator)&&
b.documentTranslated_&&b.revert();this.clean();this.documentTranslated_=false;this.log("<<< reverted: "+this.document.location)}else this.log("document not translated")};function GTB_WebTranslator(b,c,d){this.document_=b;b.gtbDomTranslator=this;this.secure_=c;this.finishCallback_=d;this.libError_=this.libReady_=this.libLoaded_=this.documentTranslated_=false;this.progressCallback_=BindToObject(this.onProgress_,this);this.libLoadCallback_=BindToObject(this.onLibLoad_,this);this.libReadyCallback_=BindToObject(this.onLibReady_,this);this.requestTranslationCallback_=BindToObject(this.requestTranslation_,this);this.checkLoadCallback_=BindToObject(this.checkLoad_,this);
this.frameCount_=0;this.forceCompletion_=null}GTB_WebTranslator.prototype.debugZone="GTB_WebTranslator";GTB_WebTranslator.prototype.sharedData={scriptCallbacks:[],scriptLoading:false,scriptCode:null};GTB_WebTranslator.prototype.CODE={};GTB_WebTranslator.prototype.CODE.SCRIPT_ID="gtbTranslateElementCode";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.SCRIPT_ID",GTB_WebTranslator.prototype.CODE.SCRIPT_ID);GTB_WebTranslator.prototype.CODE.FN_LOADED="gtbTranslateOnElementLoaded";
goog.exportSymbol("GTB_WebTranslator.prototype.CODE.FN_LOADED",GTB_WebTranslator.prototype.CODE.FN_LOADED);GTB_WebTranslator.prototype.CODE.EVT_READY="gtbTranslateLibReady";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.EVT_READY",GTB_WebTranslator.prototype.CODE.EVT_READY);GTB_WebTranslator.prototype.CODE.EVT_CHECK_READY="gtbTranslateCheckReady";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.EVT_CHECK_READY",GTB_WebTranslator.prototype.CODE.EVT_CHECK_READY);
GTB_WebTranslator.prototype.CODE.EVT_PROGRESS="gtbTranslateOnProgress";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.EVT_PROGRESS",GTB_WebTranslator.prototype.CODE.EVT_PROGRESS);GTB_WebTranslator.prototype.CODE.ATTR_PROGRESS="gtbTranslateProgress";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.ATTR_PROGRESS",GTB_WebTranslator.prototype.CODE.ATTR_PROGRESS);GTB_WebTranslator.prototype.CODE.ATTR_FINISHED="gtbTranslateFinished";
goog.exportSymbol("GTB_WebTranslator.prototype.CODE.ATTR_FINISHED",GTB_WebTranslator.prototype.CODE.ATTR_FINISHED);GTB_WebTranslator.prototype.CODE.ATTR_ERROR="gtbTranslateError";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.ATTR_ERROR",GTB_WebTranslator.prototype.CODE.ATTR_ERROR);GTB_WebTranslator.prototype.CODE.EVT_TRANSLATE="gtbTranslate";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.EVT_TRANSLATE",GTB_WebTranslator.prototype.CODE.EVT_TRANSLATE);
GTB_WebTranslator.prototype.CODE.ATTR_ORIG="gtbOriginalLang";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.ATTR_ORIG",GTB_WebTranslator.prototype.CODE.ATTR_ORIG);GTB_WebTranslator.prototype.CODE.ATTR_TARGET="gtbTargetLang";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.ATTR_TARGET",GTB_WebTranslator.prototype.CODE.ATTR_TARGET);GTB_WebTranslator.prototype.CODE.EVT_REVERT="gtbTranslateRevert";goog.exportSymbol("GTB_WebTranslator.prototype.CODE.EVT_REVERT",GTB_WebTranslator.prototype.CODE.EVT_REVERT);
GTB_WebTranslator.buildNotifiers=function(b){if(GTB_WebTranslator.prototype.notifiers_)return GTB_WebTranslator.prototype.notifiers_;var c='var {FN_LOADED};(function(){var lib = null;var checkReadyCount = 0;function sendMessage(message, attrs) {  var data = document.getElementById("{SCRIPT_ID}");  for (var p in attrs) {    data.removeAttribute(p);  }  for (var p in attrs) {    if ("undefined" != typeof attrs[p]) {      data.setAttribute(p, attrs[p]);    }  }  var evt = document.createEvent("Events");  evt.initEvent(message, true, false);  document.dispatchEvent(evt);}function checkLibReady (){  var ready = lib.isAvailable();  if (ready) {    sendMessage("{EVT_READY}", {"{ATTR_ERROR}" : false});    return;  }  if (checkReadyCount++ > 5) {    sendMessage("{EVT_READY}", {"{ATTR_ERROR}" : true});    return;  }  setTimeout(checkLibReady, 100);}{FN_LOADED} = function () {  lib = google.translate.TranslateService({});  sendMessage("{EVT_LOADED}", {}, []);  var data = document.getElementById("{SCRIPT_ID}");  data.addEventListener("{EVT_TRANSLATE}", onTranslateRequest, true);  data.addEventListener("{EVT_CHECK_READY}", onCheckReady, true);  data.addEventListener("{EVT_REVERT}", onRevert, true);  checkLibReady();};function onCheckReady() {  var ready = lib.isAvailable();  sendMessage("{EVT_READY}", {"{ATTR_ERROR}" : !ready});}function onTranslateRequest() {  var data = document.getElementById("{SCRIPT_ID}");  var orig = data.getAttribute("{ATTR_ORIG}");  var target = data.getAttribute("{ATTR_TARGET}");  lib.translatePage(orig, target, onProgress);}function onProgress(progress, opt_finished, opt_error) {  sendMessage("{EVT_PROGRESS}", {"{ATTR_PROGRESS}" : progress,       "{ATTR_FINISHED}" : opt_finished, "{ATTR_ERROR}" : opt_error});}function onRevert() {  lib.restore();}})(); {ELEMENT_CODE}',
d=GTB_WebTranslator.prototype.CODE;for(var e in d)c=c.replace("{"+e+"}",d[e],"g");c=c.replace("{ELEMENT_CODE}",b,"g");return GTB_WebTranslator.prototype.notifiers_=c};a=GTB_WebTranslator.prototype;a.LIB_URL="https://translate.google.com/translate_a/element.js?cb="+GTB_WebTranslator.prototype.CODE.FN_LOADED;a.LIB_HEADER=["Google-Translate-Element-Mode","library"];
a.translateDoc=function(b,c){this.srcLang=b;this.dstLang=c;this.frameCount_=0;var d=[];gtbRecurseFrames(this.document_,function(g,h){if(g.body&&GTB_HasAlpha(g.body.textContent)){if(h&&h.className){var i=/^\s+|\s+$/g;i=h.className.replace(i,"").split(/\s+/);if(i.indexOf("skiptranslate")>=0)return}d.push(g)}});for(var e;e=d.pop();)this.translateSubframe(e);var f=this;this.forceCompletion_=new G_Alarm(function(){if(f.frameCount_>0){f.forceCompletion_=null;f.revert();f.finishCallback_(false,this.dstLang)}},
3E4)};a.translateSubframe=function(b){function c(){d.frameCompleted_(b)}var d=this,e=b.gtbDomTranslator||new GTB_WebTranslator(b,this.secure_,c);this.frameStarted_(b);e.srcLang=this.srcLang;e.dstLang=this.dstLang;e.requestTranslation_()};
a.requestTranslation_=function(){if(this.libLoaded_){if(this.libReady_){this.document_.addEventListener(this.CODE.EVT_PROGRESS,this.progressCallback_,true);var b=this.document_.getElementById(this.CODE.SCRIPT_ID);b.setAttribute(this.CODE.ATTR_ORIG,this.srcLang);b.setAttribute(this.CODE.ATTR_TARGET,this.dstLang);c=this.document_.createEvent("Events");c.initEvent(this.CODE.EVT_TRANSLATE,true,false);b.dispatchEvent(c)}}else if(this.scriptLoaded_()){this.document_.addEventListener(this.CODE.FN_LOADED,
this.libLoadCallback_,true);this.document_.addEventListener(this.CODE.EVT_READY,this.libReadyCallback_,true);this.checker_=new G_Alarm(this.checkLoadCallback_,1500);if((b=this.document_.getElementById(this.CODE.SCRIPT_ID))&&b.textContent==this.getScriptText_()){this.libLoaded_=true;var c=this.document_.createEvent("Events");c.initEvent(this.CODE.EVT_CHECK_READY,true,false);this.document_.addEventListener(this.CODE.EVT_READY,this.libReadyCallback_,true);b.dispatchEvent(c)}else{b=this.document_.createElement("script");
b.setAttribute("id",this.CODE.SCRIPT_ID);b.textContent=this.getScriptText_();this.document_.body.appendChild(b)}}else this.loadScript_(this.requestTranslationCallback_)};a.frameStarted_=function(){this.frameCount_++};a.frameCompleted_=function(){this.frameCount_--;if(this.frameCount_<=0){if(this.forceCompletion_){try{this.forceCompletion_.cancel()}catch(b){}this.forceCompletion_=null}this.finishCallback_(this.documentTranslated_,this.dstLang)}};
a.revert=function(){var b=this,c=[];gtbRecurseFrames(this.document_,function(e){e.gtbDomTranslator&&c.push(e.gtbDomTranslator)});for(var d;d=c.pop();){d.srcLang=b.srcLang;d.dstLang=b.dstLang;d.revertPage&&d.revertPage()}};a.revertPage=function(){var b=this.document_.getElementById(this.CODE.SCRIPT_ID),c=this.document_.createEvent("Events");c.initEvent(this.CODE.EVT_REVERT,true,false);b.dispatchEvent(c);this.documentTranslated_=false};a.onLibLoad_=function(){this.libLoded_=true};
a.onLibReady_=function(){if(this.checker_){this.checker_.cancel();this.checker_=null}var b=this.document_.getElementById(this.CODE.SCRIPT_ID);b=b.getAttribute(this.CODE.ATTR_ERROR);if(this.libReady_="true"!=b){this.document_.removeEventListener(this.CODE.EVT_READY,this.libReadyCallback_,true);this.requestTranslation_()}else this.finishCallback_(false,this.dstLang)};a.checkLoad_=function(){this.libReady_||this.finishCallback_(false,this.dstLang)};
a.onProgress_=function(){var b=this.document_.getElementById(this.CODE.SCRIPT_ID),c=b.getAttribute(this.CODE.ATTR_FINISHED);b=b.getAttribute(this.CODE.ATTR_ERROR);if("true"==c){this.documentTranslated_="true"!=b;this.frameCompleted_(this.document_)}};
a.loadScript_=function(b){b&&this.sharedData.scriptCallbacks.push(b);if(!this.sharedData.scriptLoading){this.sharedData.scriptLoading=true;b=new G_XMLFetcher;b.setRequestHeader(this.LIB_HEADER[0],this.LIB_HEADER[1]);b.get(this.LIB_URL,BindToObject(this.onScriptLoad_,this))}};a.onScriptLoad_=function(b){this.sharedData.scriptLoading=false;if(b.status==200)try{this.sharedData.scriptCode=GTB_WebTranslator.buildNotifiers(b.responseText);for(b=null;b=this.sharedData.scriptCallbacks.shift();)b()}catch(c){}};
a.scriptLoaded_=function(){return!!this.sharedData.scriptCode};a.getScriptText_=function(){return this.sharedData.scriptCode};function GTB_PageTranslator(b){this.prefs_=new G_Preferences("google.toolbar.");this.mprefs_=new GTB_MachinePrefs;this.chromeWindowDocument_=b;this.loadPrefs_();new G_Alarm(BindToObject(this.updateGoogleTranslateLangs_,this),1E3);b=BindToObject(this.loadPrefs_,this);this.prefs_.addObserver(GTB_PageTranslator.WHITELIST_PREF,b);this.prefs_.addObserver(GTB_PageTranslator.BLACKLIST_PREF,b);this.prefs_.addObserver(GTB_PageTranslator.EXCEPTSITES_PREF,b);this.serviceRecoveryTime_=this.lastFailureTime_=0;
b=BindToObject(this.enabledPrefChanged_,this);this.prefs_.addObserver(GTB_PageTranslator.MENU_ENABLED_PREF,b);this.prefs_.addObserver(GTB_PageTranslator.ENABLED_PREF,b);this.langDetector_=null;if(Cc["@google.com/lang-detect;1"]){this.langDetector_=Cc["@google.com/lang-detect;1"].getService(Ci.GTBILangDetect);if("not-bundled"==this.langDetector_.detectLanguage("",true))this.langDetector_=null}this.translatorConatructor_=GTB_WebTranslator}GTB_PageTranslator.prototype.debugZone="GTB_PageTranslator";
GTB_PageTranslator.SecurityZones={HTTPS:1,INTRANET:2,LOCAL_FILE:3,OTHERS:4};GTB_PageTranslator.NEVER_HITS_MAX_COUNTER=1;GTB_PageTranslator.ALWAYS_HITS_MAX_COUNTER=1;GTB_PageTranslator.UI_PREF="auto_page_translate.notification.ui";GTB_PageTranslator.ENABLED_PREF="auto_page_translate";GTB_PageTranslator.BLACKLIST_COUNTERS="auto_page_translate.blacklist.counter";GTB_PageTranslator.WHITELIST_COUNTERS="auto_page_translate.whitelist.counter";GTB_PageTranslator.MENU_ENABLED_PREF="button_option.gtbTranslate";
GTB_PageTranslator.WHITELIST_PREF="auto_page_translate.rules.whitelist";GTB_PageTranslator.BLACKLIST_PREF="auto_page_translate.rules.blacklist";GTB_PageTranslator.EXCEPTSITES_PREF="auto_page_translate.rules.exceptsites";GTB_PageTranslator.TARGET_LANG_PREF="translate.target_lang";GTB_PageTranslator.QUEUE_LEN_LIMIT_PREF="auto_page_translate.queue.len.limit";GTB_PageTranslator.QUEUE_SIZE_LIMIT_PREF="auto_page_translate.queue.size.limit";GTB_PageTranslator.USE_GZIP_PREF="auto_page_translate.use_gzip";
GTB_PageTranslator.REMOVING_STATUS_DELAY=3E3;GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS_LOCALE=null;GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS=null;GTB_PageTranslator.LANG_LIST="ar,bg,ca,cs,da,de,el,en,es,fi,fr,iw,hu,it,ja,ko,lt,no,nl,pl,pt,ro,ru,sk,sl,sv,tr,uk,zh-CN,zh-TW".split(",");
GTB_PageTranslator.TC2FF_MAP={en:"en-US",cs:"cs-CZ",da:"da-DK",de:"de-DE",es:"es-ES",fi:"fi-FI",fr:"fr-FR",iw:"he-IL",hu:"hu-HU",it:"it-IT",ja:"ja-JP",ko:"ko-KR",no:"nb-NO",nl:"nl-NL",pl:"pl-PL",ru:"ru-RU",sk:"sk-SK",sv:"sv-SE",tr:"tr-TR",pt:"pt-PT"};GTB_PageTranslator.LOGO_URL="chrome://google-toolbar/skin/google.png";a=GTB_PageTranslator.prototype;
a.updateGoogleTranslateLangs_=function(){if(GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS_LOCALE!=GTB_getLangCode()){var b="http://clients3.google.com/translate_a/l?client=tb-ff&hl=en&version=1.0&cb=a&hl="+GTB_getLangCode(),c=new G_XMLFetcher;c.post(b,"",BindToObject(function(d){if(d.status==200){d=d.responseText;d=GTB_parseJson(d.substring(2,d.length-1)).tl;GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS=d;GTB_PageTranslator.LANG_LIST=[];var e="";for(var f in d){GTB_PageTranslator.LANG_LIST.push(f);var g=
d[f];e+=f+":"+g+"; "}GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS_LOCALE=GTB_getLangCode()}},this))}};
a.loadPrefs_=function(){var b=function(f,g,h){if(g){g=g.split(",");for(var i=0;i<g.length;i++)f[g[i]]=h}},c=this.prefs_.getPref(GTB_PageTranslator.WHITELIST_PREF,null),d=this.prefs_.getPref(GTB_PageTranslator.BLACKLIST_PREF,null),e=this.prefs_.getPref(GTB_PageTranslator.EXCEPTSITES_PREF,null);if(c===null||d===null){d=GTB_getFirefoxLocalPreference("intl.accept_languages");d=this.ff2tc_(d);c=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;if(c=c.getPref("auto_page_translate_not_from_langs"))d+=
(d?",":"")+c;c="";this.prefs_.setPref(GTB_PageTranslator.WHITELIST_PREF,c);this.prefs_.setPref(GTB_PageTranslator.BLACKLIST_PREF,d)}this.autotranslationRules_={};b(this.autotranslationRules_,c,"always");b(this.autotranslationRules_,d,"never");this.autotranslationExceptSites_={};b(this.autotranslationExceptSites_,e,"site")};
a.ff2tc_=function(b){var c={};for(var d in GTB_PageTranslator.TC2FF_MAP){var e=GTB_PageTranslator.TC2FF_MAP[d];c[e.toLowerCase()]=d}for(d=0;d<GTB_PageTranslator.LANG_LIST.length;d++){e=GTB_PageTranslator.LANG_LIST[d];e in c||(c[e.toLowerCase()]=e)}var f=[];b=b?b.split(","):[];for(d=0;d<b.length;d++)(e=c[b[d].trim().toLowerCase()])&&f.indexOf(e)<0&&f.push(e);return f.join(",")};
a.savePrefs_=function(){for(var b=GTB_PageTranslator.LANG_LIST,c=[],d=[],e=0;e<b.length;e++){var f=b[e];if(f in this.autotranslationRules_)(this.autotranslationRules_[f]=="always"?d:c).push(f)}b=[];for(var g in this.autotranslationExceptSites_)b.push(g);this.prefs_.setPref(GTB_PageTranslator.WHITELIST_PREF,d.join(","));this.prefs_.setPref(GTB_PageTranslator.BLACKLIST_PREF,c.join(","));this.prefs_.setPref(GTB_PageTranslator.EXCEPTSITES_PREF,b.join(","));Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService).notifyObservers(null,
"google-toolbar-customized",null)};a.tc2ff_=function(b){return GTB_PageTranslator.TC2FF_MAP[b]||b};a.detectLanguage_=function(b){var c="un";if(this.langDetector_){GTB_EventProfiler.timestamp("+GTBILangDetect.detectLanguage");c=this.langDetector_.detectLanguage(b.body.innerHTML,false);GTB_EventProfiler.timestamp("-GTBILangDetect.detectLanguage: "+c)}return c};a.isTranslated=function(b){return b.gtbDomTranslator&&b.gtbDomTranslator.documentTranslated_};
a.isSafeToTranslate_=function(b){return!!b.gtbSecurityZone&&(b.gtbSecurityZone==GTB_PageTranslator.SecurityZones.OTHERS||!this.mprefs_.getLocalMachineString("auto_page_translate.safe"))};
a.translateDocument=function(b,c,d,e,f,g){if(b.body&&GTB_HasAlpha(b.body.textContent))if(this.isSafeToTranslate_(b)){this.isTranslated(b)&&this.revertDocument(b);this.showProgress_(b);var h=g||this.getTargetLanguage_(),i=b.gtbDomTranslator;if(!i){i=function(k,l,m,n,o){if(k){this.lastFailureTime_=0;if(o){k=GTB_getTabbrowserForDoc(b);k=k.getNotificationBox(k.getBrowserForDocument(b));this.hideNotification_(k)}else this.showConfirmationNotification_(b,c,l||h)}else if(this.translatorConatructor_==GTB_WebTranslator){b.gtbDomTranslator=
null;this.translatorConatructor_=GTB_DomTranslator;this.translateDocument(b,c,d,e,f,g)}else{if(!m&&n==503){this.serviceRecoveryTime_=this.lastFailureTime_?Math.min(this.serviceRecoveryTime_*2,GTB_PageTranslator.SERVICE_RECOVERY_TIME_MAX):GTB_PageTranslator.SERVICE_RECOVERY_TIME_MIN;this.lastFailureTime_=Date.now()}this.showErrorNotification_(b,!!m)}};var j=b.gtbSecurityZone;j=!j||j!=GTB_PageTranslator.SecurityZones.OTHERS;i=new this.translatorConatructor_(b,j,BindToObject(i,this))}i.documentTranslated_||
i.translateDoc(c,h,d,e,f)}};
a.translateActiveTab=function(b,c){if(!b.currentTarget.id.startsWith("gtbChevronMenu")){var d=c.document.getElementById("content"),e=d.selectedBrowser,f=e.contentDocument;if(this.isTranslated(f)){d=d.getNotificationBox(e);this.revertDocument(f);this.hideNotification_(d)}else if(this.isSafeToTranslate_(f))if(f.gtbSecurityZone==GTB_PageTranslator.SecurityZones.OTHERS){var g=this.detectLanguage_(f);this.translateDocument(f,g,true,SimplePageTranslator.TRANS_TYPE.FULL,false)}else{g=this.detectLanguage_(f);
d=d.getNotificationBox(e);this.showTranslateSuggestion_(d,g,f.gtbSecurityZone)}}};goog.exportSymbol("GTB_PageTranslator.prototype.translateActiveTab",GTB_PageTranslator.prototype.translateActiveTab);GTB_PageTranslator.prototype.updateMenuItem=function(b){b.setAttribute("label",this.getMenuLabel());b.setAttribute("tooltiptext",this.getTooltipText())};goog.exportSymbol("GTB_PageTranslator.prototype.updateMenuItem",GTB_PageTranslator.prototype.updateMenuItem);
GTB_PageTranslator.prototype.getMenuLabel=function(){var b=this.chromeWindowDocument_.getElementById("content");b=b.selectedBrowser;b=b.contentDocument;var c=this.getStringBundle();return b=this.isTranslated(b)?c.GetStringFromName("prop.gtb.trans.button.show-original"):c.GetStringFromName("prop.gtb.trans.menu.label").replace("&lang;",this.getTargetLanguageStr_())};
GTB_PageTranslator.prototype.getTooltipText=function(){var b=this.chromeWindowDocument_.getElementById("content");b=b.selectedBrowser;b=b.contentDocument;var c=this.getStringBundle();return b=this.isTranslated(b)?c.GetStringFromName("prop.gtb.trans.button.show-original"):c.GetStringFromName("prop.info.translate.tooltip").replace("&lang;",this.getTargetLanguageStr_())};goog.exportSymbol("GTB_PageTranslator.prototype.getTooltipText",GTB_PageTranslator.prototype.getTooltipText);a=GTB_PageTranslator.prototype;
a.getTargetLanguageStr_=function(b){b=b||this.getTargetLanguage_();return this.getLanguageName_(b)};a.getLanguageName_=function(b){var c=this.getStringBundle(),d=null;if(GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS){this.updateGoogleTranslateLangs_();d=GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS[b]}if(!d)try{d=c.GetStringFromName("prop.gtb.trans.options.language-pref."+this.tc2ff_(b))}catch(e){"No name for "+b+"/"+this.tc2ff_(b);d=""}return d};
a.fixGoogleLogo_=function(b){var c=b.ownerDocument;b=c.getAnonymousElementByAttribute(b,"anonid","messageImage");b.setAttribute("width",48);b.setAttribute("height",16)};
a.showConfirmationNotification_=function(b,c,d){var e=GTB_getTabbrowserForDoc(b);e=e.getNotificationBox(e.getBrowserForDocument(b));var f=this.getStringBundle(),g={label:f.GetStringFromName("prop.gtb.trans.button.show-original"),anonid:"gtbTranslateShowOriginal",accessKey:f.GetStringFromName("prop.gtb.trans.button.show-original.accesskey"),callback:BindToObject(function(p,r){this.revertDocument(p);var q=p.location&&p.location.host,s=false;if(GTB_PageTranslator.isEnabled())if(!this.isInBlackList_(r)&&
!(q&&this.isException_(q))){this.showSuggestion_(p,r,p.gtbSecurityZone);s=true}return s},this,b,c)},h=[g],i=e.ownerDocument,j=G_FirefoxXMLUtils.XUL_NAMESPACE,k=i.createElementNS(j,"menulist");k.style.marginTop="0";k.style.marginBottom="0";var l=i.createElementNS(j,"hbox");l.setAttribute("align","center");f=f.GetStringFromName("prop.gtb.trans.info.translated.with.link").split("%s");var m=function(p,r){var q=i.createElementNS(j,"label");q.setAttribute("class","text-link gtbTranslateBarLink");q.setAttribute("href",
p);q.appendChild(i.createTextNode(r));return q},n=function(p){var r=i.createElementNS(j,"description");r.setAttribute("class","gtbTranslateBarText");r.setAttribute("flex","1");p=p.split(/\$begin_link;|\$end_link;/);for(var q=0;q<p.length;q++){var s=p[q];if(s)q%2?r.appendChild(m(GTB_Links.moreLink("translate_faq"),s)):r.appendChild(i.createTextNode(s))}return r};l.appendChild(n(f[0]));l.appendChild(k);l.appendChild(n(f[1]||""));e=this.showNotification_(e,l,h,g.callback);if(c&&c!="un"&&GTB_PageTranslator.isEnabled()){g=
i.createElementNS(j,"checkbox");g.setAttribute("label",this.getStringBundle().GetStringFromName("prop.gtb.trans.button.always-translate.lang").replace(/\$language_name;/,this.getLanguageName_(c)));h=this.autotranslationRules_[c]=="always"?"true":"false";g.setAttribute("checked",h);e.appendChild(g);var o=this;g.addEventListener("command",function(p){p.target.getAttribute("checked")=="true"?o.addToWhiteList_(c):o.removeFromWhiteList_(c)},true)}this.fillWithLanguages_(k);if(d.length>2&&d.substring(0,
2)!="zh")d=d.substring(0,2);k.value=d;d=function(){this.revertDocument(b);this.translateDocument(b,c,true,SimplePageTranslator.TRANS_TYPE.BANNER,false,k.value)};k.addEventListener("ValueChange",BindToObject(d,this),true)};a.fillWithLanguages_=function(b){var c=this.getLanguageMap_();for(var d in c)b.appendItem(c[d],d)};
a.getLanguageMap_=function(){if(GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS)return GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS;else{var b={},c=goog.array.map(GTB_PageTranslator.LANG_LIST,BindToObject(function(d){return{code:d,name:this.getTargetLanguageStr_(d)}},this));goog.array.sortObjectsByKey(c,"name");goog.array.forEach(c,function(d){b[d.code]=d.name});return b}};
a.showErrorNotification_=function(b,c){var d=this.getStringBundle(),e=GTB_getTabbrowserForDoc(b);e=e.getNotificationBox(e.getBrowserForDocument(b));d=c?d.GetStringFromName("prop.gtb.trans.error.network"):d.GetStringFromName("prop.gtb.trans.error.general");var f=[];this.showNotification_(e,d,f)};a.revertDocument=function(b){this.isTranslated(b)&&b.gtbDomTranslator.revert()};GTB_PageTranslator.TRANSLATE_NOTIFICATION_ID="GoogleToolbarTranslate";GTB_PageTranslator.SERVICE_RECOVERY_TIME_MIN=1E3;
GTB_PageTranslator.SERVICE_RECOVERY_TIME_MAX=3E5;GTB_PageTranslator.isEnabled=function(b,c){b=b||new G_Preferences("google.toolbar.");return b.getPref(GTB_PageTranslator.MENU_ENABLED_PREF,false)&&b.getPref(GTB_PageTranslator.ENABLED_PREF,false)&&GTB_isGoogleToolbarActive(c)};
GTB_PageTranslator.prototype.enabledPrefChanged_=function(){if(!GTB_PageTranslator.isEnabled(this.prefs_,this.chromeWindowDocument_)){var b=this.chromeWindowDocument_.getElementById("content");b=b.getNotificationBox(b.selectedBrowser);this.hideNotification_(b)}};
GTB_PageTranslator.prototype.doPageLoad=function(b){GTB_EventProfiler.timestamp("+GTB_PageTranslator.doPageLoad");b=b.target;if(b.body)if(b.nodeName=="#document"){var c=b.defaultView.top!=b.defaultView;if(!c){b.gtbTranslateAlarm_=new G_Alarm(BindToObject(this.onTopDocumentLoad,this,b),100);GTB_EventProfiler.timestamp("-GTB_PageTranslator.doPageLoad")}}};goog.exportSymbol("GTB_PageTranslator.prototype.doPageLoad",GTB_PageTranslator.prototype.doPageLoad);a=GTB_PageTranslator.prototype;
a.onTopDocumentLoad=function(b){GTB_EventProfiler.timestamp("+GTB_PageTranslator.onTopDocumentLoad");for(var c=b.getElementsByTagName("meta"),d=0,e;e=c[d];++d)if("google"==e.getAttribute("name")&&("notranslate"==e.getAttribute("value")||"notranslate"==e.getAttribute("content"))){this.onHostResolved_(b,"un","");return}b.gtbTranslateAlarm_=null;c=this.detectLanguage_(b);if(b.location.protocol!="http:"&&b.location.protocol!="https:")this.onHostResolved_(b,c,"");else{b.gtbDnsResolving_=GTB_resolveIp(b.location.host,
BindToObject(this.onHostResolved_,this,b,c));GTB_EventProfiler.timestamp("-GTB_PageTranslator.onTopDocumentLoad")}};a.doPageRestore=function(b){b=b.target;if(this.isTranslated(b)){var c=b.gtbDomTranslator;this.showConfirmationNotification_(b,c.srcLang,c.dstLang)}};
a.onHostResolved_=function(b,c,d){if(b.gtbDnsResolving_)b.gtbDnsResolving_=null;var e=null,f=b.location&&b.location.host;try{e=GTB_getTabbrowserForDoc(b);var g=this.getSecurityContext_(b,d);b.gtbSecurityZone=g;if(!GTB_PageTranslator.isEnabled(this.prefs_,this.chromeWindowDocument_)||!this.isSafeToTranslate_(b))throw Error("skipping translation");if(this.isInBlackList_(c)||f&&this.isException_(f))throw Error("skipping translation");var h=this.getTargetLanguage_();if(c==h||c==h.substring(0,2))throw Error("skipping translation");
if(!e)throw Error("skipping translation");var i=e.getBrowserForDocument(b);if(this.lastFailureTime_&&Date.now()-this.lastFailureTime_<this.serviceRecoveryTime_){this.stickTranslation_(i,null);throw Error("skipping translation");}if(G_FirefoxXMLUtils.selectSingleNode(b.documentElement,'//head/meta[@name="google" and @value="notranslate"]'))throw Error("skipping translation");}catch(j){if(e)(b=e.getNotificationBox(e.getBrowserForDocument(b)))&&this.hideNotification_(b);return}if((d=g==GTB_PageTranslator.SecurityZones.OTHERS)&&
!(f&&this.isException_(f)))if(this.isSticky_(i,c)){this.translateDocument(b,c,false,SimplePageTranslator.TRANS_TYPE.FULL,true);return}else if(this.isInWhiteList_(c)){this.translateDocument(b,c,false,SimplePageTranslator.TRANS_TYPE.WHITELIST,false);return}this.stickTranslation_(i,null);i.contentDocument.gtbAutoPageTranslateLangDetected_=c;this.showSuggestion_(b,c,g)};
a.showSuggestion_=function(b,c,d){var e=GTB_getTabbrowserForDoc(b);if(e){b=e.getBrowserForDocument(b);e=e.getNotificationBox(b);this.showTranslateSuggestion_(e,c,d)}};
a.doPageUnload=function(b){b=b.target;if(!(!b.body||b.nodeName!="#document"||b.defaultView.top!=b.defaultView)){if(b.gtbTranslateAlarm_){b.gtbTranslateAlarm_.cancel();b.gtbTranslateAlarm_=null}if(b.gtbDnsResolving_){b.gtbDnsResolving_.cancel();b.gtbDnsResolving_=null}var c=GTB_getTabbrowserForDoc(b),d=c.getBrowserForDocument(b);c=c.getNotificationBox(d);if(c=c.getNotificationWithValue(GTB_PageTranslator.TRANSLATE_NOTIFICATION_ID))c.indecisionTimeout_=b.defaultView.setTimeout(BindToObject(this.onPageLoadingTimeout_,
this,c),GTB_PageTranslator.REMOVING_STATUS_DELAY)}};goog.exportSymbol("GTB_PageTranslator.prototype.doPageUnload",GTB_PageTranslator.prototype.doPageUnload);GTB_PageTranslator.prototype.onPageLoadingTimeout_=function(b){!b.control||b.control._closedNotification==b||b.close()};
GTB_PageTranslator.prototype.showTranslateSuggestion_=function(b,c,d){var e=this.getStringBundle(),f=e.GetStringFromName("prop.gtb.trans.info.this-page-is-in.lang").split("$language_name;"),g=f[0],h=f[1];switch(d){case GTB_PageTranslator.SecurityZones.HTTPS:h+=" "+e.GetStringFromName("prop.gtb.trans.info.secure-page");break;case GTB_PageTranslator.SecurityZones.INTRANET:h+=" "+e.GetStringFromName("prop.gtb.trans.info.intranet-page");break;case GTB_PageTranslator.SecurityZones.LOCAL_FILE:h+=" "+e.GetStringFromName("prop.gtb.trans.info.local-page");
break}d=function(){this.updateCandidates_(1,-GTB_PageTranslator.ALWAYS_HITS_MAX_COUNTER,c)};var i=G_FirefoxXMLUtils.XUL_NAMESPACE,j=b.ownerDocument;if(!(j.defaultView.innerWidth<400)){var k=j.createElementNS(i,"hbox");k.setAttribute("align","center");var l=function(t){var v=j.createElementNS(i,"description");v.setAttribute("class","gtbTranslateBarText");v.appendChild(j.createTextNode(t));v.setAttribute("flex","1");return v};f=function(t,v,A){var x=j.createElementNS(i,"menuitem");x.setAttribute("label",
v);x.addEventListener("command",A,false);t.appendChild(x)};k.appendChild(l(g));var m=this;g=this.prefs_.getPref(GTB_PageTranslator.UI_PREF,"toolbarbutton");var n=j.createElementNS(i,g);if(g=="menulist"){new G_Alarm(function(){var t=m.getLanguageName_(c);n.appendItem(t,c);n.value=c},0);n.addEventListener("select",function(){c=n.value;m.updateLanguageUI_(w,y,c);m.updateCandidates_(0,0,c,k)},false);n.addEventListener("popupshowing",function(){m.fillWithLanguages_(n);n.removeItemAt(0);n.value=c},false);
n.addEventListener("popuphiding",function(){m.getLanguageName_(c);for(var t=n.itemCount-1;t>0;--t)n.getItemAtIndex(t).value!=c&&n.removeItemAt(t)},false)}else{n.className="gtbTranslateBarToolbarbutton";n.setAttribute("type","menu");n.setAttribute("label",this.getLanguageName_(c));n.style.MozUserFocus="normal";g=j.createElementNS(i,"menupopup");n.appendChild(g);var o=this.getLanguageMap_();for(var p in o){var r=BindToObject(function(t,v){c=t;m.updateLanguageUI_(w,y,c);m.updateCandidates_(0,0,c,k);
n.setAttribute("label",v)},null,p,o[p]);f(g,o[p],r)}}k.appendChild(n);k.appendChild(l(h));p=j.createElementNS(i,"spacer");p.setAttribute("width","8px");k.appendChild(p);g=function(){var t=j.defaultView.gBrowser.contentDocument;m.onTranslateClick_(c,t)};p=function(){m.updateCandidates_(1,-GTB_PageTranslator.ALWAYS_HITS_MAX_COUNTER,c);m.hideNotification_(b)};h=function(){m.addToBlackList_(c);m.hideNotification_(b)};l=function(){var t=j.defaultView.gBrowser.contentDocument;m.onTranslateClick_(c,t);m.addToWhiteList_(c)};
var q=function(){var t=j.defaultView.gBrowser.contentDocument;m.addToExceptSites_(t);m.hideNotification_(b)};r=function(){GTB_OpenOptionsWindow(j.defaultView,"gtbOptionsFeaturesPane",{gtbToolPaneId:"gtbOptionsTranslateImages"})};o=function(){var t=j.defaultView.gBrowser.contentDocument;t.defaultView.open(GTB_Links.moreLink("translatebar"),"_blank")};var s=j.createElementNS(i,"toolbarbutton");s.className="gtbTranslateBarToolbarbutton";s.setAttribute("type","menu");var u=e.GetStringFromName("prop.gtb.trans.button.options");
s.setAttribute("label",u);s.style.MozUserFocus="normal";u=j.createElementNS(i,"menupopup");s.appendChild(u);f(u,"",h);f(u,"",l);var z=e.GetStringFromName("prop.gtb.trans.option.never-translate-site");f(u,z,q);q=e.GetStringFromName("prop.gtb.trans.option.translate-options");f(u,q,r);e=e.GetStringFromName("prop.gtb.trans.option.about-translate");f(u,e,o);e=function(){var t=m.getLanguageName_(c),v=m.getStringBundle(),A=v.GetStringFromName("prop.gtb.trans.button.never-translate.lang").replace(/\$language_name;/,
t);t=v.GetStringFromName("prop.gtb.trans.button.always-translate.lang").replace(/\$language_name;/,t);v=s.firstChild.firstChild;var x=v.nextSibling;v.setAttribute("label",A);x.setAttribute("label",t)};s.addEventListener("popupshowing",e,false);e=this.makeTranslateButton_(j);e.addEventListener("command",g,false);k.appendChild(e);e=this.makeNoTranslateButton_(j);e.addEventListener("command",p,false);k.appendChild(e);var w=this.makeButton_(j,"gtbNeverTranslateButton");w.addEventListener("command",h,
false);k.appendChild(w);var y=this.makeButton_(j,"gtbAlwaysTranslateButton");y.addEventListener("command",l,false);k.appendChild(y);this.updateLanguageUI_(w,y,c);this.updateCandidates_(0,0,c,k);d=this.showNotification_(b,k,null,BindToObject(d,this));d.appendChild(s)}};
GTB_PageTranslator.prototype.updateCandidates_=function(b,c,d,e){b=GTB_PageTranslator.updateCandidatesList_(b,d,GTB_PageTranslator.BLACKLIST_COUNTERS,GTB_PageTranslator.BLACKLIST_PREF,GTB_PageTranslator.NEVER_HITS_MAX_COUNTER,"never",e);c=GTB_PageTranslator.updateCandidatesList_(c,d,GTB_PageTranslator.WHITELIST_COUNTERS,GTB_PageTranslator.WHITELIST_PREF,GTB_PageTranslator.ALWAYS_HITS_MAX_COUNTER,"always",e);if(b||c)Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService).notifyObservers(null,
"google-toolbar-customized",null)};GTB_PageTranslator.updateCandidatesList_=function(b,c,d,e,f,g,h){var i=new G_Preferences("google.toolbar."),j=i.getPref(d,"");j=j?GTB_parseJson(j):{};var k=j[c]||0,l=k;k+=b;if(h){e=(e=i.getPref(e,""))?e.split(","):[];e=e.indexOf(c)<0;h.setAttribute(g,k>=f&&e)}if(b){if(k>f)k=f;else if(k<0)k=0;if(k!=l){if(k)j[c]=k;else delete j[c];i.setPref(d,GTB_unparseJson(j))}}return!!b};a=GTB_PageTranslator.prototype;
a.hideNotification_=function(b){var c=b.getNotificationWithValue(GTB_PageTranslator.TRANSLATE_NOTIFICATION_ID);if(c){b.removeNotification(c);GTB_PageTranslator.fixNotificationBox(b)}};
a.showNotification_=function(b,c,d,e){var f=b.ownerDocument,g=c instanceof f.defaultView.Node,h=b.getNotificationWithValue(GTB_PageTranslator.TRANSLATE_NOTIFICATION_ID);if(!h||h==b._closedNotification){h=b.appendNotification(g?"":c,GTB_PageTranslator.TRANSLATE_NOTIFICATION_ID,GTB_PageTranslator.LOGO_URL,b.PRIORITY_INFO_HIGH,null);this.fixGoogleLogo_(h);this.hookCloseClick_(h,function(){if(this.onClodeHandler_)return this.onClodeHandler_()});if(g){for(b=f.getAnonymousElementByAttribute(h,"anonid",
"messageText");b.firstChild;)b.removeChild(b.lastChild);b.appendChild(c)}}else{if(h.indecisionTimeout_){h.ownerDocument.defaultView.clearTimeout(h.indecisionTimeout_);delete h.indecisionTimeout_}b=f.getAnonymousElementByAttribute(h,"anonid","messageText");if(typeof c=="string")c=f.createTextNode(c);for(;b.firstChild;)b.removeChild(b.lastChild);for(b.appendChild(c);h.firstChild;)h.removeChild(h.firstChild)}c=f.getAnonymousElementByAttribute(h,"anonid","messageImage");c.setAttribute("width",48);c.setAttribute("height",
16);c.setAttribute("src",GTB_PageTranslator.LOGO_URL);h.setAttribute("class","gtbTranslateBar");if(d){c=G_FirefoxXMLUtils.XUL_NAMESPACE;for(b=0;b<d.length;b++){g=d[b];var i=f.createElementNS(c,"button");i.setAttribute("label",g.label);i.setAttribute("accesskey",g.accessKey);i.setAttribute("anonid",g.anonid);h.appendChild(i);i.buttonInfo=g}}h.onClodeHandler_=e;return h};
a.makeTranslateButton_=function(b){b=this.makeButton_(b);var c=this.getStringBundle(),d=c.GetStringFromName("prop.gtb.trans.button.translate");c=c.GetStringFromName("prop.gtb.trans.button.translate.accesskey");b.setAttribute("label",d);b.setAttribute("accesskey",c);return b};
a.makeNoTranslateButton_=function(b){b=this.makeButton_(b);var c=this.getStringBundle(),d=c.GetStringFromName("prop.gtb.trans.button.no-thanks");c=c.GetStringFromName("prop.gtb.trans.button.no-thanks.accesskey");b.setAttribute("label",d);b.setAttribute("accesskey",c);return b};a.makeButton_=function(b,c){var d=b.createElementNS(G_FirefoxXMLUtils.XUL_NAMESPACE,"button");d.className="gtbTranslateBarButton";if(c)d.className+=" "+c;return d};
a.updateLanguageUI_=function(b,c,d){var e=this.getLanguageName_(d);d=this.getStringBundle();var f=d.GetStringFromName("prop.gtb.trans.button.never-translate.lang").replace(/\$language_name;/,e);b.setAttribute("label",f);f=d.GetStringFromName("prop.gtb.trans.button.never-translate.accesskey");b.setAttribute("accesskey",f);b=d.GetStringFromName("prop.gtb.trans.button.always-translate.lang").replace(/\$language_name;/,e);c.setAttribute("label",b);b=d.GetStringFromName("prop.gtb.trans.button.always-translate.accesskey");
c.setAttribute("accesskey",b)};a.onTranslateClick_=function(b,c){this.updateCandidates_(-GTB_PageTranslator.NEVER_HITS_MAX_COUNTER,1,b);this.translateDocument(c,b,true,SimplePageTranslator.TRANS_TYPE.BANNER,false);var d=GTB_getTabbrowserForDoc(c);(d=d&&d.getBrowserForDocument(c))&&this.stickTranslation_(d,b);return true};
a.showProgress_=function(b){var c=GTB_getTabbrowserForDoc(b);b=c.getNotificationBox(c.getBrowserForDocument(b));var d=this.getStringBundle();d=d.GetStringFromName("prop.gtb.trans.info.translating");b=this.showNotification_(b,d,null,null);c=c.ownerDocument.getAnonymousElementByAttribute(b,"anonid","messageImage");c.setAttribute("src","chrome://global/skin/icons/loading_16.png");c.removeAttribute("width");c.removeAttribute("height")};
a.addToBlackList_=function(b){if(!(GTB_PageTranslator.LANG_LIST.indexOf(b)<0))if(this.autotranslationRules_[b]!=="never"){this.autotranslationRules_[b]="never";this.updateCandidates_(-GTB_PageTranslator.NEVER_HITS_MAX_COUNTER,-GTB_PageTranslator.ALWAYS_HITS_MAX_COUNTER,b);this.savePrefs_()}};a.addToExceptSites_=function(b){if(b=b.location&&b.location.host){this.autotranslationExceptSites_[b]="site";this.savePrefs_()}};
a.addToWhiteList_=function(b){if(!(GTB_PageTranslator.LANG_LIST.indexOf(b)<0))if(this.autotranslationRules_[b]!=="always"){this.autotranslationRules_[b]="always";this.updateCandidates_(-GTB_PageTranslator.NEVER_HITS_MAX_COUNTER,-GTB_PageTranslator.ALWAYS_HITS_MAX_COUNTER,b);this.savePrefs_()}};
a.removeFromWhiteList_=function(b){if(this.autotranslationRules_[b]=="always"){delete this.autotranslationRules_[b];this.updateCandidates_(-GTB_PageTranslator.NEVER_HITS_MAX_COUNTER,-GTB_PageTranslator.ALWAYS_HITS_MAX_COUNTER,b);this.savePrefs_()}};a.isSticky_=function(b,c){var d=b.contentDocument;return d&&d.referrer&&c==b.gtbAutotranslateLang_};a.stickTranslation_=function(b,c){b.gtbAutotranslateLang_=c};a.isInWhiteList_=function(b){return this.autotranslationRules_[b]=="always"};
a.isInBlackList_=function(b){return!b||b=="un"||this.autotranslationRules_[b]=="never"};a.isException_=function(b){return!!this.autotranslationExceptSites_[b]};a.getTargetLanguage_=function(){var b=this.prefs_.getPref(GTB_PageTranslator.TARGET_LANG_PREF,"");if(!b||GTB_PageTranslator.LANG_LIST.indexOf(b)<0)b=GTB_getLangCode();return b};a.setTargetLanguage_=function(b){this.prefs_.setPref(GTB_PageTranslator.TARGET_LANG_PREF,b)};
a.getSecurityContext_=function(b,c){switch(b.location.protocol){case "file:":return GTB_PageTranslator.SecurityZones.LOCAL_FILE;case "https:":return GTB_PageTranslator.SecurityZones.HTTPS;case "http:":if(c&&GTB_isLocalIP(c))return GTB_PageTranslator.SecurityZones.INTRANET;break}return GTB_PageTranslator.SecurityZones.OTHERS};
a.hookCloseClick_=function(b,c){var d=b.close,e=b._doButtonCommand;b.close=function(){c.call(this);d.call(this);this.control&&GTB_PageTranslator.fixNotificationBox(this.control)};b._doButtonCommand=function(f){var g=f.target.buttonInfo;if(!g||g.popup)return e.call(this,f);else{var h=g.callback;if(h){(g=h(this,g))||d.call(this);f.stopPropagation()}}}};a.getStringBundle=function(){var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);return b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties")};
GTB_PageTranslator.fixNotificationBox=function(b){if(b._closedNotification&&!b._closedNotification.parentNode)b._closedNotification=null};function SimplePageTranslator(b){this.caller=b;this.prefs_=new G_Preferences("google.toolbar.")}SimplePageTranslator.TRANS_TYPE={};SimplePageTranslator.TRANS_TYPE.FULL="p";SimplePageTranslator.TRANS_TYPE.BANNER="pa";SimplePageTranslator.TRANS_TYPE.WHITELIST="pw";a=SimplePageTranslator.prototype;
a.reset=function(){this.queueSize_=this.queueLen_=0;this.queueLenLimit_=this.prefs_.getPref(GTB_PageTranslator.QUEUE_LEN_LIMIT_PREF,512);this.queueSizeLimit_=this.prefs_.getPref(GTB_PageTranslator.QUEUE_SIZE_LIMIT_PREF,16384)};a.announce=function(b){this.queueLenLimit_&&this.queueLen_++;if(this.queueSizeLimit_)this.queueSize_+=3+encodeURIComponent(b).length};a.isOverflown=function(){return this.queueLenLimit_&&this.queueLen_>this.queueLenLimit_||this.queueSizeLimit_&&this.queueSize_>this.queueSizeLimit_};
a.buildUrl=function(b,c,d,e,f,g,h){var i=d?"https":"http";return i+"://clients3.google.com/translate_a/t?&client=tb-ff&langpair="+b+"%7C"+c+"&format=text&ie=utf8&oe=utf8&hl="+GTB_getLangCode()+"&tt="+e+"&tc="+g+(f?"&ctt=1":"")+"&v=1.0"+(d?"&ssl=1":"")+(h?"&url="+h.hostname+h.pathname:"")+""};a.buildForm=function(b,c,d,e){b="";for(d=d;d<e;d++)b+="q="+encodeURIComponent(c[d].originalValue)+"&";return b};
a.parseResponse=function(b,c,d,e,f,g,h){var i=false,j=f-e==1?[b]:b;b={};var k;c=0;if(j.length==f-e){for(i=0;i<j.length;i++){this.caller.translateNode(d[e+i],j[i]);if(g){k=j[i][1];k in b||(b[k]=0);f=d[e+i].originalValue.length;b[k]+=f;c+=f}}i=true}if(g){d=0;e="un";for(k in b){f=b[k];if(f>d){d=f;e=k}}g.value=e;h.value=d/c}return i};goog.object={};goog.object.forEach=function(b,c,d){for(var e in b)c.call(d,b[e],e,b)};goog.object.filter=function(b,c,d){var e={};for(var f in b)if(c.call(d,b[f],f,b))e[f]=b[f];return e};goog.object.map=function(b,c,d){var e={};for(var f in b)e[f]=c.call(d,b[f],f,b);return e};goog.object.some=function(b,c,d){for(var e in b)if(c.call(d,b[e],e,b))return true;return false};goog.object.every=function(b,c,d){for(var e in b)if(!c.call(d,b[e],e,b))return false;return true};
goog.object.getCount=function(b){var c=0;for(var d in b)c++;return c};goog.object.getAnyKey=function(b){for(var c in b)return c};goog.object.getAnyValue=function(b){for(var c in b)return b[c]};goog.object.contains=function(b,c){return goog.object.containsValue(b,c)};goog.object.getValues=function(b){var c=[],d=0;for(var e in b)c[d++]=b[e];return c};goog.object.getKeys=function(b){var c=[],d=0;for(var e in b)c[d++]=e;return c};goog.object.containsKey=function(b,c){return c in b};
goog.object.containsValue=function(b,c){for(var d in b)if(b[d]==c)return true;return false};goog.object.findKey=function(b,c,d){for(var e in b)if(c.call(d,b[e],e,b))return e};goog.object.findValue=function(b,c,d){return(c=goog.object.findKey(b,c,d))&&b[c]};goog.object.isEmpty=function(b){for(var c in b)return false;return true};goog.object.clear=function(b){for(var c=goog.object.getKeys(b),d=c.length-1;d>=0;d--)goog.object.remove(b,c[d])};
goog.object.remove=function(b,c){var d;if(d=c in b)delete b[c];return d};goog.object.add=function(b,c,d){if(c in b)throw Error('The object already contains the key "'+c+'"');goog.object.set(b,c,d)};goog.object.get=function(b,c,d){if(c in b)return b[c];return d};goog.object.set=function(b,c,d){b[c]=d};goog.object.setIfUndefined=function(b,c,d){return c in b?b[c]:(b[c]=d)};goog.object.clone=function(b){var c={};for(var d in b)c[d]=b[d];return c};
goog.object.transpose=function(b){var c={};for(var d in b)c[b[d]]=d;return c};goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.object.extend=function(b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)b[c]=d[c];for(var f=0;f<goog.object.PROTOTYPE_FIELDS_.length;f++){c=goog.object.PROTOTYPE_FIELDS_[f];if(Object.prototype.hasOwnProperty.call(d,c))b[c]=d[c]}}};
goog.object.create=function(){var b=arguments.length;if(b==1&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c};goog.object.createSet=function(){var b=arguments.length;if(b==1&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=true;return c};function GTB_SharingManager(b){this.document_=b;this.service_=Cc["@google.com/toolbar/sharing-service;1"].getService().wrappedJSObject;(this.providerListElement_=this.document_.getElementById("gtbSharePinnedProvidersList"))&&this.updatePinnedProvidersList_();this.pinnedProvidersListChangeHandler_=BindToObject(this.handlePinnedProvidersListChange_,this);this.service_.addEventListener("pinned-providers-change",this.pinnedProvidersListChangeHandler_);this.enabledChangeHandler_=BindToObject(this.handleEnabledChange_,
this);this.service_.addEventListener("enabled-change",this.enabledChangeHandler_);this.handleEnabledChange_();this.toolbarCustomizeObserver_=new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.onCustomize_,this));this.promoters_=[new GTB_SharingButtonPromotion(this.document_),new GTB_SharingProviderPromotion(this.document_)]}GTB_SharingManager.PROVIDER_ID_ATTRIBUTE="providerId";GTB_SharingManager.SHARE_COMMAND_ID="gtbShareCommand";GTB_SharingManager.MAX_ICONS_ON_TOOLBAR=8;
GTB_SharingManager.MENU_LIMIT=10;GTB_SharingManager.prototype.SHORTENING_SERVICE_URL="http://goo.gl/api/url";GTB_SharingManager.prototype.shutdown=function(){this.promoters_.forEach(function(b){b.shutdown()});this.service_.removeEventListener("pinned-providers-change",this.pinnedProvidersListChangeHandler_);this.service_.removeEventListener("enabled-change",this.enabledChangeHandler_);this.toolbarCustomizeObserver_.unregister()};goog.exportSymbol("GTB_SharingManager.prototype.shutdown",GTB_SharingManager.prototype.shutdown);
GTB_SharingManager.prototype.updateServiceListPopupMenu=function(b){function c(o,p,r){for(;;){var q=r?r.previousSibling:p.lastChild;if(!q||!q.hasAttribute(GTB_SharingManager.PROVIDER_ID_ATTRIBUTE))break;p.removeChild(q)}for(q=0;q<o.length;q++){var s;s=o[q];var u=h.getProviderInfo(s);if(u){var z=u.name||s,w=g.createElement("menuitem");w.setAttribute("tooltiptext",z);w.setAttribute("label",z);w.setAttribute(GTB_SharingManager.PROVIDER_ID_ATTRIBUTE,s);w.setAttribute("class","menuitem-iconic");w.setAttribute("image",
"data:image/x-icon;base64,"+u.icon);w.setAttribute("command",GTB_SharingManager.SHARE_COMMAND_ID);s=w}else s=null;if(s)r?p.insertBefore(s,r):p.appendChild(s)}}for(var d=b.getElementsByAttribute("anonid","moreNetworks")[0],e=b.getElementsByAttribute("anonid","pinnedNetworksSeparator")[0],f=d.firstChild,g=b.ownerDocument,h=this.service_,i=this.service_.getPinnedProviders(),j=[],k=[],l=this.service_.getMostValuableProviders(),m=0;m<l.length;m++){var n=l[m];i.indexOf(n)>=0||(j.length+i.length<GTB_SharingManager.MENU_LIMIT?
j.push(n):k.push(n))}e.hidden=i.length==0||j.length==0;this.service_.sortProvidersByName(i);c(i,b,e);this.service_.sortProvidersByName(j);c(j,b,d);this.service_.sortProvidersByName(k);c(k,f,null);d.hidden=k.length==0};goog.exportSymbol("GTB_SharingManager.prototype.updateServiceListPopupMenu",GTB_SharingManager.prototype.updateServiceListPopupMenu);GTB_SharingManager.prototype.openOptionsDialog=function(){this.logEvent_("*","show-options");GTB_OpenOptionsWindow(this.document_.defaultView,"gtbOptionsSharingPane")};
goog.exportSymbol("GTB_SharingManager.prototype.openOptionsDialog",GTB_SharingManager.prototype.openOptionsDialog);
GTB_SharingManager.prototype.share=function(b){b=b.target.id==GTB_SharingManager.SHARE_COMMAND_ID?b.sourceEvent.target:b.target.originalItem;var c=b.getAttribute(GTB_SharingManager.PROVIDER_ID_ATTRIBUTE),d=this.document_.getElementById("content");if(d=d.selectedBrowser&&d.selectedBrowser.contentDocument)if(d.location.protocol!="http:")this.declineSharing_();else{this.logEvent_(c,"share-from-"+b.localName+(this.service_.getPinnedProviders().indexOf(c)>=0?"-pinned":""));GTB_resolveIp(d.location.host,
BindToObject(this.onHostResolved_,this,d,c))}};goog.exportSymbol("GTB_SharingManager.prototype.share",GTB_SharingManager.prototype.share);
GTB_SharingManager.prototype.onHostResolved_=function(b,c,d){if(!d||GTB_isLocalIP(d))this.declineSharing_();else if(d=this.service_.getProviderInfo(c)){var e=b.location.href;if("url_limit"in d&&e.length>d.url_limit)try{var f=new G_XMLFetcher;f.post(this.SHORTENING_SERVICE_URL,this.getUrlShorteningRequestParams_(e),BindToObject(this.processUrlShorteningResponse_,this,c,b))}catch(g){this.showSharePopupWindow_(c,b,e)}else this.showSharePopupWindow_(c,b,e)}};
GTB_SharingManager.prototype.getUrlShorteningRequestParams_=function(b){function c(){for(var m=0,n=0;n<arguments.length;n++)m=m+arguments[n]&4294967295;return m}function d(m){m=m=String(m>0?m:m+4294967296);var n;n=m;for(var o=0,p=false,r=n.length-1;r>=0;--r){var q=Number(n.charAt(r));if(p){q*=2;o+=Math.floor(q/10)+q%10}else o+=q;p=!p}n=n=o%10;o=0;if(n!=0){o=10-n;if(m.length%2==1){if(o%2==1)o+=9;o/=2}}n=String(o);n+=m;return m=n}function e(m){for(var n=5381,o=0;o<m.length;o++)n=c(n<<5,n,m.charCodeAt(o));
return n}function f(m){for(var n=0,o=0;o<m.length;o++)n=c(m.charCodeAt(o),n<<6,n<<16,-n);return n}var g={byteArray_:GTB_StringToUTF8(b),charCodeAt:function(m){return this.byteArray_[m]}};g.length=g.byteArray_.length;var h="au",i=e(g);h+="th";i=i>>2&1073741823;var j="7";h+="_";i=i>>4&67108800|i&63;h+="to";i=i>>4&4193280|i&1023;h+="k";i=i>>4&245760|i&16383;h+="en";g=f(g);var k="user=",l=(i>>2&15)<<4|g&15;k+="toolbar@google.com";l|=(i>>6&15)<<12|(g>>8&15)<<8;k+="&url=";l|=(i>>10&15)<<20|(g>>16&15)<<
16;k+=encodeURIComponent(b);l|=(i>>14&15)<<28|(g>>24&15)<<24;k+="&";j+=d(l);k+=h;k+="=";k+=j;return k};GTB_SharingManager.prototype.processUrlShorteningResponse_=function(b,c,d){var e=c.location.href;if(!d||!(d.status>=200&&d.status<300))this.showSharePopupWindow_(b,c,e);else{try{var f=GTB_parseJson(d.responseText),g=f.short_url}catch(h){this.showSharePopupWindow_(b,c,e);return}this.showSharePopupWindow_(b,c,g)}};
GTB_SharingManager.getSelection_=function(b){var c=b&&b.getSelection();if(c)c=c.toString();else return"";if(c)return c;b=b.frames;for(var d=0;d<b.length;++d)if(c=GTB_SharingManager.getSelection_(b[d].document.defaultView))return c;return""};a=GTB_SharingManager.prototype;
a.showSharePopupWindow_=function(b,c,d){var e=this.service_.getProviderInfo(b);if(e){var f=c.title||"",g=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties"),h=GTB_SharingManager.getSelection_(c.defaultView);g=g.GetStringFromName("prop.gtb.sendto.gmailsubject").replace("%S","").trim();var i="";if(h)(i=e.separator)||(i="\n\n");var j=e.url.replace("%(u)",this.encodeUrl_(d)).replace("%(t)",this.encodeTitle_(f)).replace("%(x)",
this.encodeText_(h)).replace("%(s)",encodeURIComponent(i)).replace("%(n)",this.encodeTitle_(g)),k=e.postData;e=!!k;if(j.startsWith("mailto:"))this.document_.defaultView.loadURI(j,null,null);else{var l=["chrome","dialog=no","status=yes","resizable=yes","scrollbars=yes","minimizeable=yes","width=800","height=550"];if(e)if(b=="Gmail"){c="{------------"+Math.floor(Math.random()*32767)+Math.floor(Math.random()*32767)+Math.floor(Math.random()*32767)+"}";k=k.replace(/%\(b\)/g,c).replace(/%\(u\)/g,d).replace(/%\(t\)/g,
f).replace(/%\(x\)/g,h).replace(/%\(s\)/g,i).replace(/%\(n\)/g,g);this.document_.defaultView.GTB_getToolbar().xThis.showComposeMailWindow("window",k)}else{c=c.defaultView.openDialog("about:blank","gtbSharingComposeWindow",l.join(","));k=k.replace(/%\(u\)/g,encodeURIComponent(d)).replace(/%\(t\)/g,encodeURIComponent(f)).replace(/%\(x\)/g,encodeURIComponent(h)).replace(/%\(s\)/g,encodeURIComponent(i)).replace(/%\(n\)/g,encodeURIComponent(g));c.addEventListener("load",function(m){m=m.target.defaultView;
m=m.QueryInterface(Ci.nsIInterfaceRequestor);m=m.getInterface(Ci.nsIWebNavigation);m.loadURI(j,Ci.nsIWebNavigation.LOAD_FLAGS_NONE,null,GTB_createPostDataStream(k),null)},false)}else c.defaultView.openDialog(j,"gtbSharingComposeWindow",l.join(","))}this.encountSharing_(b)}};
a.encountSharing_=function(b){var c=this.service_.getProviderUsageFlags(b);if(c&GTB_SharingService.UsageFlags.WAS_SHARED)if(c&GTB_SharingService.UsageFlags.WAS_SHARED_TWICE)c&GTB_SharingService.UsageFlags.WAS_PINNED||this.service_.pin(b)&&this.logEvent_(b,"pinned-automatically");else this.service_.addProviderUsageFlags(b,GTB_SharingService.UsageFlags.WAS_SHARED_TWICE);else this.service_.addProviderUsageFlags(b,GTB_SharingService.UsageFlags.WAS_SHARED)};
a.declineSharing_=function(){var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.document_.defaultView.alert(b.GetStringFromName("prop.gtb.sharing.nonpublic-sharing-alert"),b.GetStringFromName("prop.gtb.messagebox.title"))};
a.onCustomize_=function(){var b=this.providerListElement_;this.providerListElement_=this.document_.getElementById("gtbSharePinnedProvidersList");b!=this.providerListElement_&&this.providerListElement_&&this.updatePinnedProvidersList_()};a.handlePinnedProvidersListChange_=function(){if(this.providerListElement_){this.updatePinnedProvidersList_();var b=this.document_.defaultView.GTB_getToolbar();b&&b.chevron.doResize()}};
a.handleEnabledChange_=function(){var b=this.document_.getElementById("gtbSharingContextMenu");if(b){var c=new G_Preferences("google.toolbar.button_option.");c=c.getPref("gtbShare");b.style.display=c?null:"none"}};
a.updatePinnedProvidersList_=function(){for(;this.providerListElement_.lastChild;)this.providerListElement_.removeChild(this.providerListElement_.lastChild);var b=this.service_.getPinnedProviders();b.length=Math.min(b.length,GTB_SharingManager.MAX_ICONS_ON_TOOLBAR);for(var c=0;c<b.length;c++){var d=b[c],e=this.service_.getProviderInfo(d);if(e){var f=e.name||d,g=this.document_.createElement("toolbarbutton");g.setAttribute("tooltiptext",f);g.setAttribute("label",f);g.setAttribute("class","gtb-toolbarbutton gtb-iconicbutton");
g.setAttribute(GTB_SharingManager.PROVIDER_ID_ATTRIBUTE,d);g.setAttribute("gtb-show-text","never");g.setAttribute("gtb-show-icon","always");g.setAttribute("image","data:image/x-icon;base64,"+e.icon);g.setAttribute("command",GTB_SharingManager.SHARE_COMMAND_ID);g.setAttribute("id","gtbSharePinned"+f);this.providerListElement_.appendChild(g)}}};a.handleHideServiceCommand=function(b){this.logEvent_(b,"unpin-from-context-menu");this.service_.unpin(b);this.notifyCustomized_()};
a.notifyCustomized_=function(){Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService).notifyObservers(null,"google-toolbar-customized",null)};a.encodeUrl_=function(b){return this.safeEncodeURIComponent_(b,1024)};a.encodeTitle_=function(b){return this.safeEncodeURIComponent_(b,256)};a.encodeText_=function(b){return this.safeEncodeURIComponent_(b,1024)};
a.safeEncodeURIComponent_=function(b,c){var d=encodeURIComponent(b);if(d.length<c)return d;d="";for(var e=0;e<b.length;e++){var f=encodeURIComponent(b[e]);if(d.length+f.length<=c)d+=f;else break}return d};a.logEvent_=function(b,c){GTB_SharingManager.logEvent(this.document_,"gtbShareUI",b,c)};GTB_SharingManager.logEvent=function(b,c,d,e){var f=b.createElement("command");f.setAttribute("id",c+":"+d+":"+e);b.documentElement.appendChild(f);f.doCommand();b.documentElement.removeChild(f)};function GTB_SharingOptions(){this.optionsWindow_=null;this.service_=Cc["@google.com/toolbar/sharing-service;1"].getService().wrappedJSObject}GTB_SharingOptions.prototype.debugZone="GTB_SharingOptions";GTB_SharingOptions.PROVIDER_ID_ATTRIBUTE="providerId";GTB_SharingOptions.SHARE_ICON_INKS={1:"http://www.openshareicons.com/",2:"http://creativecommons.org/licenses/by-sa/3.0/"};
GTB_SharingOptions.prototype.onLoad=function(b){this.optionsWindow_=b;this.updateSettingsVisibility();this.updateProviderList();this.wasPinned_=this.optionsWindow_.document.getElementById("gtbPrefSharePinnedProviders").value;this.attributeShareIcon_()};
GTB_SharingOptions.prototype.attributeShareIcon_=function(){var b=this.optionsWindow_.document,c=b.getElementById("gtbShareIconAttribute"),d=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);d=d.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");d=d.GetStringFromName("prop.gtb.sharing.icon-attribute");var e=/\$(BEGIN|END)_LINK_(\d)\;/g,f=0;c=c;for(var g=e.exec(d);g;g=e.exec(d)){f=d.substring(f,e.lastIndex-g[0].length);c.appendChild(b.createTextNode(f));
if(g[1]=="BEGIN"){f=GTB_SharingOptions.SHARE_ICON_INKS[g[2]];g=b.createElement("label");g.setAttribute("class","gtbLink");g.setAttribute("style","margin-left:0px; margin-right:0px;");c.appendChild(g);c=g;g.addEventListener("click",BindToObject(this.navigate_,this,f),false)}else c=c.parentNode;f=e.lastIndex}f=d.substring(f,d.length);c.appendChild(b.createTextNode(f))};GTB_SharingOptions.prototype.navigate_=function(b){var c=this.optionsWindow_.document;c.defaultView.open(b,null,"")};
GTB_SharingOptions.prototype.updateSettingsVisibility=function(){var b=this.optionsWindow_.document,c=b.getElementById("gtbPrefShareButton");b=b.getElementById("gtbOptionsSharingPreferences");b.hidden=!c.value};goog.exportSymbol("GTB_SharingOptions.prototype.updateSettingsVisibility",GTB_SharingOptions.prototype.updateSettingsVisibility);
GTB_SharingOptions.prototype.updatePinnedProviders=function(){var b=this.optionsWindow_.document,c=b.getElementById("gtbPrefSharePinnedProviders").value,d=c&&typeof c=="string"?c.split(","):[];c=b.getElementById("gtbSharingProvidersContainer");b=b.getElementById("gtbOthersSharingProvidersContainer");var e=function(f){var g=f.getAttribute(GTB_SharingOptions.PROVIDER_ID_ATTRIBUTE);g=d.indexOf(g)>=0;f.setAttribute("checked",g)};for(c=c.firstChild;c;c=c.nextSibling)e(c);for(c=b.firstChild;c;c=c.nextSibling)e(c)};
goog.exportSymbol("GTB_SharingOptions.prototype.updatePinnedProviders",GTB_SharingOptions.prototype.updatePinnedProviders);
GTB_SharingOptions.prototype.addRemovePinnedProvider=function(b){var c=this.optionsWindow_.document;for(b=b.sourceEvent.target;!b.hasAttribute(GTB_SharingOptions.PROVIDER_ID_ATTRIBUTE);)b=b.parentNode;var d=b.getAttribute(GTB_SharingOptions.PROVIDER_ID_ATTRIBUTE);c=c.getElementById("gtbPrefSharePinnedProviders");var e=c.value?c.value.split(","):[];goog.array.remove(e,d);b.checked&&e.push(d);c.value=e.sort().join(",")};goog.exportSymbol("GTB_SharingOptions.prototype.addRemovePinnedProvider",GTB_SharingOptions.prototype.addRemovePinnedProvider);
GTB_SharingOptions.prototype.updateProviderList=function(){for(var b=this.optionsWindow_.document,c=b.getElementById("gtbSharingProvidersContainer"),d=b.getElementById("gtbOthersSharingProvidersContainer");c.lastChild;)c.removeChild(c.lastChild);for(;d.lastChild;)d.removeChild(d.lastChild);var e=this.service_.getAllProviders();this.service_.sortProvidersByName(e);for(var f=this.service_.getMostValuableProviders(this.getSearchDomain_()),g=0;g<e.length;g++){var h=e[g],i=this.service_.getProviderInfo(h),
j=i.name||h,k=b.createElement("checkbox");k.setAttribute(GTB_SharingOptions.PROVIDER_ID_ATTRIBUTE,h);k.setAttribute("label",j);k.setAttribute("src","data:image/x-icon;base64,"+i.icon);k.setAttribute("command","gtbSharingAddRemovePinnedProvider");f.indexOf(h)!=-1?c.appendChild(k):d.appendChild(k)}this.updatePinnedProviders()};GTB_SharingOptions.prototype.getSearchDomain_=function(){var b=this.optionsWindow_.document;b=b.getElementById("gtbPrefGoogleHome").value||"";return b.replace(/.*google\./,"")};
GTB_SharingOptions.prototype.onBeforeAccept=function(){var b=function(f){return f?f.split(","):[]},c=b(this.wasPinned_);b=b(this.optionsWindow_.document.getElementById("gtbPrefSharePinnedProviders").value);G_Debug(this,"Was pinned: "+c.join(", "));G_Debug(this,"Getting pinned: "+b.join(", "));for(var d=0;d<c.length;d++){var e=c[d];b.indexOf(e)==-1&&this.logEvent_(e,"unpinned-from-options")}for(d=0;d<b.length;d++){e=b[d];c.indexOf(e)==-1&&this.logEvent_(e,"pinned-from-options")}};
GTB_SharingOptions.prototype.logEvent_=function(b,c){GTB_SharingManager.logEvent(this.optionsWindow_.document,"gtbShareUI",b,c)};function GTB_SharingPromotionBase(b){this.doc_=b;this.prefs_=new G_Preferences(GTB_SharingService.PREF_BASE);this.attached_=false;this.prefs_.addObserver(this.SHOWN_COUNT_PREF,BindToObject(this.onShowCountChange_,this));if(this.getShowCount_()<this.MAXIMUM_SHOWS){this.attach_();this.attached_=true}}GTB_SharingPromotionBase.lastShowTime_=0;a=GTB_SharingPromotionBase.prototype;a.MAXIMUM_SHOWS=3;a.TIMEOUT=3E5;a.attach_=function(){throw Error("Not implemented");};
a.detach_=function(){throw Error("Not implemented");};a.onShowCountChange_=function(){var b=this.getShowCount_()<this.MAXIMUM_SHOWS;if(!this.attached_&&b){this.attach_();this.attached_=true}else if(this.attached_&&!b){this.detach_();this.attached_=false}};a.isShareButtonVisible_=function(){var b=this.doc_.getElementById("gtbShare");if(!b)return false;if(b.hidden)return false;b=GTB_findToolbar(b);if(!b)return false;return GTB_isToolbarVisible(b)};
a.incrementShowCount_=function(){var b=this.getShowCount_();b<this.MAXIMUM_SHOWS&&this.setShowCount_(b+1);GTB_SharingPromotionBase.lastShowTime_=Date.now()};a.setShowCount_=function(b){this.prefs_.setPref(this.SHOWN_COUNT_PREF,b)};a.neverShowTip_=function(){this.setShowCount_(this.MAXIMUM_SHOWS)};a.getShowCount_=function(){var b=this.prefs_.getPref(this.SHOWN_COUNT_PREF,0);return Number(b)};a.shutdown=function(){this.prefs_.removeAllObservers();if(this.attached_){this.detach_();this.attached_=false}};
a.showPromotion_=function(){var b=this.getPromotedElement_();if(b){b=new GTB_PromotionTooltip(b,this.TIP_CONTENT_URL,this.getLocalizations_());var c=this;b.onCloseClick=function(){c.neverShowTip_();c.logEvent_("close")};b.show();this.logEvent_("show");this.incrementShowCount_()}};a.getPromotedElement_=function(){throw Error("Not implemented");};a.getLocalizations_=function(){throw Error("Not implemented");};
a.hasShownRecently_=function(){var b=GTB_SharingPromotionBase.lastShowTime_;return!!b&&Date.now()-b<this.TIMEOUT};a.logEvent_=function(b){GTB_SharingManager.logEvent(this.doc_,"gtbShareUI","*","promotion:"+this.LOG_ID+":"+b)};function GTB_SharingButtonPromotion(b){this.wrapper_=null;GTB_SharingPromotionBase.call(this,b)}GTB_SharingButtonPromotion.inherits(GTB_SharingPromotionBase);GTB_SharingButtonPromotion.prototype.SHOWN_COUNT_PREF="button-promotion-shown";
goog.exportSymbol("GTB_SharingButtonPromotion.prototype.SHOWN_COUNT_PREF",GTB_SharingButtonPromotion.prototype.SHOWN_COUNT_PREF);GTB_SharingButtonPromotion.prototype.TIP_CONTENT_URL="chrome://google-toolbar/content/share-promotion-tip.html";goog.exportSymbol("GTB_SharingButtonPromotion.prototype.TIP_CONTENT_URL",GTB_SharingButtonPromotion.prototype.TIP_CONTENT_URL);a=GTB_SharingButtonPromotion.prototype;a.LOG_ID="copyurl";a.debugZone="GTB_SharingButtonPromotion";a.getInputField_=function(){return this.doc_.getElementById("urlbar").inputField};
a.attach_=function(){var b=this.getInputField_(),c=b.controllers.getControllerForCommand("cmd_copy");if(c){c=new GTB_SharingButtonPromotion.Wrapper(c,BindToObject(this.onCommand_,this));b.controllers.insertControllerAt(0,c);this.wrapper_=b.controllers.getControllerAt(0)}};a.detach_=function(){if(this.wrapper_){var b=this.getInputField_();b.controllers.removeController(this.wrapper_);this.wrapper_=null}};
a.onCommand_=function(b){if("cmd_copy"==b)if(this.isShareButtonVisible_())if(!this.hasShownRecently_()){b=this.getInputField_();if(!(b.selectionStart!=0||b.selectionEnd!=b.textLength||b.textLength==0)){var c;try{var d=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService),e=d.newURI(b.value,null,null);if(e.scheme!="http")return;c=e.host}catch(f){return}var g=this;d=function(h){!h||GTB_isLocalIP(h)||g.showPromotion_()};GTB_resolveIp(c,d)}}};a.getPromotedElement_=function(){return this.doc_.getElementById("gtbSharePopupButton")};
a.getLocalizations_=function(){var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");return{content:b.GetStringFromName("prop.gtb.sharing.button-promo")}};
GTB_SharingButtonPromotion.Wrapper=function(b,c){this.originalController=b;this.callback_=c;this.wrappedJSObject=this;this.supportsCommand=BindToObject(b.supportsCommand,b);this.isCommandEnabled=BindToObject(b.isCommandEnabled,b);this.onEvent=BindToObject(b.onEvent,b)};GTB_SharingButtonPromotion.Wrapper.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIController))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};
goog.exportSymbol("GTB_SharingButtonPromotion.Wrapper.prototype.QueryInterface",GTB_SharingButtonPromotion.Wrapper.prototype.QueryInterface);GTB_SharingButtonPromotion.Wrapper.prototype.doCommand=function(b){this.originalController.doCommand(b);this.callback_(b)};goog.exportSymbol("GTB_SharingButtonPromotion.Wrapper.prototype.doCommand",GTB_SharingButtonPromotion.Wrapper.prototype.doCommand);
function GTB_SharingProviderPromotion(b){GTB_SharingPromotionBase.call(this,b);this.listeners_=null;this.menuUsageCounter_=0;this.service_=Cc["@google.com/toolbar/sharing-service;1"].getService().wrappedJSObject}GTB_SharingProviderPromotion.inherits(GTB_SharingPromotionBase);GTB_SharingProviderPromotion.prototype.SHOWN_COUNT_PREF="providers-promotion-shown";goog.exportSymbol("GTB_SharingProviderPromotion.prototype.SHOWN_COUNT_PREF",GTB_SharingProviderPromotion.prototype.SHOWN_COUNT_PREF);
GTB_SharingProviderPromotion.prototype.debugZone="GTB_SharingProviderPromotion";GTB_SharingProviderPromotion.prototype.TIP_CONTENT_URL="chrome://google-toolbar/content/share-provider-promotion-tip.html";goog.exportSymbol("GTB_SharingProviderPromotion.prototype.TIP_CONTENT_URL",GTB_SharingProviderPromotion.prototype.TIP_CONTENT_URL);a=GTB_SharingProviderPromotion.prototype;a.LOG_ID="menuusing";a.MUNU_CLICKS_TO_SHOW_PROMOTION=3;
a.attach_=function(){var b=this.doc_.getElementById(GTB_SharingManager.SHARE_COMMAND_ID),c=this.doc_.getElementById("gtbSharingPopup");if(b&&c){this.listeners_=[{element:b,event:"command",handler:BindToObject(this.handleShareClick_,this)},{element:c,event:"popupshowing",handler:BindToObject(this.handlePupupShowing_,this)}];this.listeners_.forEach(function(d){d.element.addEventListener(d.event,d.handler,false)})}};
a.detach_=function(){if(this.listeners_){this.listeners_.forEach(function(b){b.element.removeEventListener(b.event,b.handler,false)});this.listeners_=null}};a.handleShareClick_=function(b){b=b.sourceEvent.target.nodeName;b=="toolbarbutton"&&this.neverShowTip_()};a.handlePupupShowing_=function(){if(this.service_.getPinnedProviders().length!=0)if(!(++this.menuUsageCounter_<this.MUNU_CLICKS_TO_SHOW_PROMOTION))if(this.isShareButtonVisible_())this.hasShownRecently_()||this.showPromotion_()};
a.getPromotedElement_=function(){var b=this.doc_.getElementById("gtbShare");return b&&b.getElementsByAttribute(GTB_SharingManager.PROVIDER_ID_ATTRIBUTE,"*")[0]};
a.getLocalizations_=function(){var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties"),c=b.GetStringFromName("prop.gtb.sharing.provider-promo.header");b=b.GetStringFromName("prop.gtb.sharing.provider-promo.content").split("&providericon;");return{header:c,"content-before-icon":b[0],"content-after-icon":b[1],providericon:{src:this.getPromotedElement_().getAttribute("image")}}};
function GTB_PromotionTooltip(b,c,d){this.promotedElement_=b;this.contentUrl_=c;this.localizations_=d;this.doc_=this.promotedElement_.ownerDocument;b=this.doc_.getElementById("gtbToolbar");this.direction_=b.getAttribute("chromedir");this.container_=this.buildXul_();this.uiEventHandlerBound_=BindToObject(this.uiEventHandler_,this);this.documentLoadListener_=new GTB_PromotionTooltip.DocumentLoadListener(BindToObject(this.handleDocumentComplete_,this));this.onCloseClick=null}
GTB_PromotionTooltip.prototype.debugZone="GTB_PromotionTooltip";GTB_PromotionTooltip.activeInstance_=null;GTB_PromotionTooltip.CONTENT_URL="chrome://google-toolbar/content/promotion-tip.html";
GTB_PromotionTooltip.prototype.show=function(){GTB_PromotionTooltip.activeInstance_&&GTB_PromotionTooltip.activeInstance_.hide();GTB_PromotionTooltip.activeInstance_=this;this.doc_.documentElement.appendChild(this.container_);var b=this.doc_.defaultView;b.addEventListener("keypress",this.uiEventHandlerBound_,false);b.addEventListener("mousedown",this.uiEventHandlerBound_,false);this.browser_.addProgressListener(this.documentLoadListener_,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT);this.browser_.loadURI(this.contentUrl_)};
GTB_PromotionTooltip.prototype.hide=function(){GTB_PromotionTooltip.activeInstance_=null;var b=this.doc_.defaultView;b.removeEventListener("keypress",this.uiEventHandlerBound_,false);b.removeEventListener("mousedown",this.uiEventHandlerBound_,false);this.browser_.removeProgressListener(this.documentLoadListener_);this.doc_.documentElement.removeChild(this.container_);this.container_=null};
GTB_PromotionTooltip.prototype.uiEventHandler_=function(b){var c=this.container_.firstChild;b.target.ownerDocument!=c.contentDocument&&GTB_PromotionTooltip.activeInstance_.hide()};
GTB_PromotionTooltip.prototype.buildXul_=function(){var b=this.doc_.createElement("vbox"),c=this.doc_.createElement("browser");b.appendChild(c);var d=b.style;b.collapsed=true;d.dislpay="block";d.position="fixed";d.backgroundColor="white";d.border="none";d.margin="0";d.padding="0";d.overflow="-moz-scrollbars-none";d.height="0";d.width="0";d.zIndex="20";d=c.style;d.border="none";d.overflow="-moz-scrollbars-none";d.height="0";d.width="0";return b};
GTB_PromotionTooltip.prototype.__defineGetter__("browser_",function(){return this.container_.firstChild});
GTB_PromotionTooltip.prototype.handleDocumentComplete_=function(){var b=this.browser_.contentDocument,c=b.getElementById("close-button");if(c){var d=BindToObject(function(){this.hide();this.onCloseClick&&this.onCloseClick()},this);c.addEventListener("click",d,false)}for(var e in this.localizations_)if(c=b.getElementById(e)){d=this.localizations_[e];switch(typeof d){case "string":c.appendChild(b.createTextNode(d));break;case "object":for(var f in d)c.setAttribute(f,d[f]);break}}b=b.defaultView.getComputedStyle(b.body,
"");e=b.width;e=this.calculatePosition_(parseInt(e,10));this.container_.style.left=e.left+"px";this.container_.style.top=e.top+"px";this.container_.style.width=b.width;this.container_.style.height=b.height;this.browser_.style.width=b.width;this.browser_.style.height=b.height;this.container_.collapsed=false};
GTB_PromotionTooltip.prototype.calculatePosition_=function(b){var c=this.promotedElement_.boxObject,d=this.doc_.defaultView,e={left:0,top:c.y+c.height+1};e.left=this.direction_=="rtl"?c.x+e.width>d.innerWidth?Math.max(d.innerWidth-b,0):c.x:c.x+c.width<b?0:c.x+c.width-b;return e};GTB_PromotionTooltip.DocumentLoadListener=function(b){this.documentCompleteCallback_=b};
GTB_PromotionTooltip.DocumentLoadListener.prototype.onStateChange=function(b,c,d){d&Ci.nsIWebProgressListener.STATE_STOP&&d&Ci.nsIWebProgressListener.STATE_IS_DOCUMENT&&this.documentCompleteCallback_()};goog.exportSymbol("GTB_PromotionTooltip.DocumentLoadListener.prototype.onStateChange",GTB_PromotionTooltip.DocumentLoadListener.prototype.onStateChange);GTB_PromotionTooltip.DocumentLoadListener.prototype.onProgressChange=function(){};
GTB_PromotionTooltip.DocumentLoadListener.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};goog.exportSymbol("GTB_PromotionTooltip.DocumentLoadListener.prototype.QueryInterface",GTB_PromotionTooltip.DocumentLoadListener.prototype.QueryInterface);function GTB_SharingService(){this.wrappedJSObject=this;this.upToDate_=false;this.providers_={};this.initialized_=false;this.defaultProvidersBySearchDomain_={};this.defaultProvidersAnyLocale_=[];this.listeners_={"enabled-change":[],"pinned-providers-change":[],"data-change":[]};this.pinnedProvidersInfo_=null}GTB_SharingService.PROVIDERS_LIST_FILE="share_providers.json";GTB_SharingService.PREF_BASE="google.toolbar.sharing.";GTB_SharingService.USAGE_PREF_BASE="usage.";
GTB_SharingService.PINNED_SERVICES_PREF="pinned-providers";GTB_SharingService.MAX_PROVIDERS=10;
GTB_SharingService.prototype.init=function(){this.prefs_=new G_Preferences(GTB_SharingService.PREF_BASE);this.toolbarPrefs_=new G_Preferences("google.toolbar.");var b=Cc["@google.com/toolbar/components;1"].getService().wrappedJSObject;b.register(GTB_SharingService.PROVIDERS_LIST_FILE,BindToObject(this.onDataChanged_,this),[]);this.initialized_=true;this.notifyListeners_("pinned-providers-change");this.prefs_.addObserver(GTB_SharingService.PINNED_SERVICES_PREF,BindToObject(this.onPinnedServicesPrefChange_,
this));this.toolbarPrefs_.addObserver("google_home",BindToObject(this.onGoogleHomeChange_,this));this.toolbarPrefs_.addObserver("button_option.gtbShare",BindToObject(this.notifyListeners_,this,"enabled-change"));this.searchDomain_=GTB_getGoogleDomain()};GTB_SharingService.prototype.addEventListener=function(b,c){this.listeners_[b].push(c)};goog.exportSymbol("GTB_SharingService.prototype.addEventListener",GTB_SharingService.prototype.addEventListener);
GTB_SharingService.prototype.removeEventListener=function(b,c){goog.array.remove(this.listeners_[b],c)};goog.exportSymbol("GTB_SharingService.prototype.removeEventListener",GTB_SharingService.prototype.removeEventListener);a=GTB_SharingService.prototype;a.notifyListeners_=function(b){this.listeners_[b].forEach(function(c){c()})};
a.getPinnedProviders=function(){if(!this.initialized_)return[];if(!this.pinnedProvidersInfo_)this.pinnedProvidersInfo_=this.collectPinnedProvidersInfo_();return goog.array.map(this.pinnedProvidersInfo_,function(b){return b.id})};
a.collectPinnedProvidersInfo_=function(){this.ensureUpToDate_();var b=this.prefs_.getPref(GTB_SharingService.PINNED_SERVICES_PREF);b=typeof b=="string"&&b?b.split(","):[];for(var c=this.getDefaultServices_(),d=[],e=0;e<b.length;e++){var f=b[e],g=this.getProviderUsageFlags(f),h=this.getProviderInfo(f),i=c.indexOf(f)>=0;d.push({id:f,name:h&&h.name||f,isDefault:i,rank:this.calcProviderRank_(g,i)})}d.sort(GTB_SharingService.ProviderComparator);return d};
a.updatePinnedProviderCacheOnUsageChange_=function(b,c){if(this.pinnedProvidersInfo_){var d=goog.array.find(this.pinnedProvidersInfo_,function(f){return f.id==b});if(d){var e=this.calcProviderRank_(c,d.isDefault);if(e!=d.rank){d.rank=e;this.pinnedProvidersInfo_.sort(GTB_SharingService.ProviderComparator);this.notifyListeners_("pinned-providers-change")}}}};
a.onPinnedServicesPrefChange_=function(){var b=this.pinnedProvidersInfo_;this.pinnedProvidersInfo_=null;var c=this.prefs_.getPref(GTB_SharingService.PINNED_SERVICES_PREF);c=typeof c=="string"&&c?c.split(","):[];for(var d=0;d<c.length;d++)this.addProviderUsageFlags(c[d],GTB_SharingService.UsageFlags.WAS_PINNED);b&&this.notifyListeners_("pinned-providers-change")};a.onDataChanged_=function(){this.upToDate_=false;this.notifyListeners_("data-change")};
a.onGoogleHomeChange_=function(){var b=GTB_getGoogleDomain();if(this.searchDomain_!=b){this.searchDomain_=b;if(this.pinnedProvidersInfo_){this.pinnedProvidersInfo_=null;this.notifyListeners_("pinned-providers-change")}}};
a.ensureUpToDate_=function(){if(!(this.upToDate_||!this.initialized_)){var b=Cc["@google.com/toolbar/components;1"].getService().wrappedJSObject;if((b=b.getFile(GTB_SharingService.PROVIDERS_LIST_FILE))&&b.exists()){var c=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);c.charset="UTF-8";c=GTB_parseJson(c.ConvertToUnicode(G_FileReader.readAll(b)));this.providers_=c.providers;b=GTB_getLangCode();this.defaultProvidersBySearchDomain_={};this.defaultProvidersAnyLocale_=
[];c=c.defaults;for(var d=0;d<c.length;d++){var e=c[d][0],f=c[d][1],g=c[d][2];if(e){if(e==b)this.defaultProvidersBySearchDomain_[f]=g}else this.defaultProvidersAnyLocale_=g}this.upToDate_=true}}};a.notifyCustomized_=function(){Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService).notifyObservers(null,"google-toolbar-customized",null)};a.getAllProviders=function(){this.ensureUpToDate_();return goog.object.getKeys(this.providers_)};
a.sortProvidersByName=function(b){for(var c={},d=0;d<b.length;d++){var e=b[d];c[e]=this.getProviderInfo(e).name||e}b.sort(function(f,g){return c[f].localeCompare(c[g])})};a.getProviderInfo=function(b){this.ensureUpToDate_();return this.providers_[b]};
a.getMostValuableProviders=function(b){this.ensureUpToDate_();b=this.getDefaultServices_(b);var c=[];for(var d in this.providers_){var e=this.providers_[d],f=this.getProviderUsageFlags(d),g=b.indexOf(d)>=0;if(f=this.calcProviderRank_(f,g))c.push({id:d,name:e.name||d,rank:f})}c.sort(GTB_SharingService.ProviderComparator);return goog.array.map(c,function(h){return h.id})};
a.calcProviderRank_=function(b,c){var d=0;if(b&GTB_SharingService.UsageFlags.WAS_SHARED)d|=4;if(b&GTB_SharingService.UsageFlags.WAS_VISITED)d|=2;if(c)d|=1;return d};a.getDefaultServices_=function(b){b=b||this.searchDomain_;return this.defaultProvidersBySearchDomain_[b]||this.defaultProvidersBySearchDomain_[""]||this.defaultProvidersAnyLocale_};
a.addProviderUsageFlags=function(b,c){var d=GTB_SharingService.USAGE_PREF_BASE+b,e=this.prefs_.getPref(d,0),f=e|c;if(e!=f){this.prefs_.setPref(d,f);this.updatePinnedProviderCacheOnUsageChange_(b,f)}};a.getProviderUsageFlags=function(b){b=GTB_SharingService.USAGE_PREF_BASE+b;return Number(this.prefs_.getPref(b,0))};
a.pin=function(b){var c=this.getPinnedProviders();if(c.indexOf(b)>=0)return false;c.push(b);c.sort();this.prefs_.setPref(GTB_SharingService.PINNED_SERVICES_PREF,c.join(","));this.notifyCustomized_();return true};a.unpin=function(b){var c=this.getPinnedProviders();goog.array.remove(c,b);this.prefs_.setPref(GTB_SharingService.PINNED_SERVICES_PREF,c.join(","))};GTB_SharingService.ProviderComparator=function(b,c){return b.rank!=c.rank?c.rank-b.rank:GTB_LocaleCompare(b.name,c.name)};
GTB_SharingService.UsageFlags={WAS_VISITED:1,WAS_SHARED:2,WAS_PINNED:4,WAS_SHARED_TWICE:8};function GTB_SharingPageLoadListener(b){this.service_=b;this.prefs_=new G_Preferences;this.prefs_.addObserver(GTB_SharingPageLoadListener.FEATURE_PREF,BindToObject(this.updateState_,this));this.hostToProviderIdMap_={};this.visitedServices_={};this.serviceDataChangeHandler_=BindToObject(this.updateProvidersMap_,this);this.listening_=false;this.updateState_()}GTB_SharingPageLoadListener.FEATURE_PREF="google.toolbar.button_option.gtbShare";
GTB_SharingPageLoadListener.prototype.updateState_=function(){var b=!!this.prefs_.getPref(GTB_SharingPageLoadListener.FEATURE_PREF);if(!this.listening_&&b)this.start_();else this.listening_&&!b&&this.stop_();this.listening_=b};
GTB_SharingPageLoadListener.prototype.start_=function(){var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT);this.service_.addEventListener("data-change",this.serviceDataChangeHandler_);this.updateProvidersMap_()};
GTB_SharingPageLoadListener.prototype.stop_=function(){var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.removeProgressListener(this,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT);this.service_.removeEventListener("data-change",this.serviceDataChangeHandler_)};
GTB_SharingPageLoadListener.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};goog.exportSymbol("GTB_SharingPageLoadListener.prototype.QueryInterface",GTB_SharingPageLoadListener.prototype.QueryInterface);
GTB_SharingPageLoadListener.prototype.onStateChange=function(b,c,d){if(d&Ci.nsIWebProgressListener.STATE_STOP&&c instanceof Ci.nsIHttpChannel)try{var e=c.QueryInterface(Ci.nsIHttpChannel);if(e.responseStatus==200){var f=e.URI;if(!(f.scheme!="http"&&f.scheme!="https")){var g=this.whatServiceIsIt_(f);if(g&&!this.visitedServices_[g]){this.service_.addProviderUsageFlags(g,GTB_SharingService.UsageFlags.WAS_VISITED);this.visitedServices_[g]=1}}}}catch(h){}};
goog.exportSymbol("GTB_SharingPageLoadListener.prototype.onStateChange",GTB_SharingPageLoadListener.prototype.onStateChange);GTB_SharingPageLoadListener.prototype.whatServiceIsIt_=function(b){for(var c=b.host.split("."),d=c[c.length-1],e=this.hostToProviderIdMap_[d],f=c.length-2;!e&&f>=0;f--){d=c[f]+"."+d;e=this.hostToProviderIdMap_[d]}if(!e)return"";b=b.path||"/";for(var g in e)if(b.startsWith(g))return e[g];return""};
GTB_SharingPageLoadListener.prototype.updateProvidersMap_=function(){var b=this.service_.getAllProviders(),c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService),d={},e=function(m,n,o){m in d||(d[m]={});d[m][n]=o},f=0;for(;f<b.length;f++){var g=b[f],h=this.service_.getProviderInfo(g);try{if("pattern"in h){var i=h.pattern;for(h=0;h<i.length;h++){var j=i[h].split("/",2);e(j[0],"/"+(j[1]||""),g)}}else{var k=c.newURI(h.url,null,null);k.scheme!="mailto"&&e(k.host,"/",g)}}catch(l){}}this.hostToProviderIdMap_=
d};function GTB_About_CopyVersions(b){var c=[];c.push(b.getElementById("gtbProductVersion").value);(b=b.getElementById("gtbDictionaryCompressionVersion").value)&&c.push(b);b=Cc["@mozilla.org/widget/clipboardhelper;1"].getService(Ci.nsIClipboardHelper);b.copyString(c.join("\r\n"))}
function GTB_About_AddExtraVersions(b){if(Cc["@google.com/dictionarycompression;1"]&&Ci.GIDictionaryCompressionService){var c="Dictionary Compression Version "+Cc["@google.com/dictionarycompression;1"].getService(Ci.GIDictionaryCompressionService).version;b.getElementById("gtbDictionaryCompressionVersion").value=c}};function GTB_AF_StringMap(){this.stringBundle_=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties")}GTB_AF_StringMap.prototype.getString_=function(b){return this.stringBundle_.GetStringFromName("prop.gtb.autofill2."+b)};GTB_AF_StringMap.prototype.createMap=function(b){var c={};for(var d in b)c[d]=this.getString_(b[d]);return c};
function GTB_AutoFillFieldDef(b,c,d){this.defaultValue=b;this.encrypt=!!c;this.afTypes=d||null}
var GTB_AutoFillProfileFieldDefs={id:new GTB_AutoFillFieldDef(0),isDefault:new GTB_AutoFillFieldDef(false),label:new GTB_AutoFillFieldDef(""),firstName:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.NAME_FIRST]),middleName:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.NAME_MIDDLE]),lastName:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.NAME_LAST]),eMail:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.EMAIL_ADDRESS]),companyName:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.COMPANY_NAME]),
billingIsShipping:new GTB_AutoFillFieldDef(true),billingCountry:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_BILLING_COUNTRY]),billingAddr1:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_BILLING_LINE1]),billingAddr2:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_BILLING_LINE2]),billingCity:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_BILLING_CITY]),billingState:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_BILLING_STATE]),billingZip:new GTB_AutoFillFieldDef("",
false,[GTB_AF_FieldType.ADDRESS_BILLING_ZIP]),shippingCountry:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_HOME_COUNTRY]),shippingAddr1:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_HOME_LINE1]),shippingAddr2:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_HOME_LINE2]),shippingCity:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_HOME_CITY]),shippingState:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.ADDRESS_HOME_STATE]),shippingZip:new GTB_AutoFillFieldDef("",
false,[GTB_AF_FieldType.ADDRESS_HOME_ZIP]),phoneCountry:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.PHONE_HOME_COUNTRY_CODE]),phoneArea:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.PHONE_HOME_CITY_CODE]),phoneNumber:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.PHONE_HOME_NUMBER]),faxCountry:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.PHONE_FAX_COUNTRY_CODE]),faxArea:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.PHONE_FAX_CITY_CODE]),faxNumber:new GTB_AutoFillFieldDef("",
false,[GTB_AF_FieldType.PHONE_FAX_NUMBER])},GTB_AutoFillCreditCardFieldDefs={id:new GTB_AutoFillFieldDef(0),isDefault:new GTB_AutoFillFieldDef(false),label:new GTB_AutoFillFieldDef(""),nameOnCard:new GTB_AutoFillFieldDef("",false,[GTB_AF_FieldType.CREDIT_CARD_NAME]),number:new GTB_AutoFillFieldDef("",true,[GTB_AF_FieldType.CREDIT_CARD_NUMBER]),expMonth:new GTB_AutoFillFieldDef("",true,[GTB_AF_FieldType.CREDIT_CARD_EXP_MONTH]),expYear:new GTB_AutoFillFieldDef("",true,[GTB_AF_FieldType.CREDIT_CARD_EXP_4_DIGIT_YEAR,
GTB_AF_FieldType.CREDIT_CARD_EXP_2_DIGIT_YEAR]),cvc:new GTB_AutoFillFieldDef("",true,[GTB_AF_FieldType.CREDIT_CARD_VERIFICATION_CODE]),data:new GTB_AutoFillFieldDef("")},GTB_AutoFillPwdState={ENTER_PASSWORD:0,NO_PASSWORD:1,PASSWORD_ENTERED:2};function GTB_AutoFillValuesList(b,c){this.id_=b;this.propsList_=c;for(var d in c)this[d]=c[d].defaultValue;this.dirty_=true}a=GTB_AutoFillValuesList.prototype;
a.loadFromPrefs=function(b,c){var d=c+"."+this.id_+".";for(var e in this.propsList_)this[e]=b.getPref(d+e,this.propsList_[e].defaultValue);this.dirty_=false};a.saveToPrefs=function(b,c){if(this.dirty_){var d=c+"."+this.id_+".";for(var e in this.propsList_)b.setPref(d+e,this[e])}};a.isEmpty=function(){for(var b in this.propsList_)if(!(b=="isDefault"||b=="billingIsShipping"||b=="id"||b=="data"))if(this[b])return false;return true};a.getValue=function(b){return this[b]};
a.setValue=function(b,c){this[b]=c;this.makeDirty()};a.encryptData=function(b,c){if(this.dirty_){var d=[];for(var e in this.propsList_)if(this.propsList_[e].encrypt){d.push(e+"\u0001"+this[e]);this.obfuscate_(e)}if(d.length)this.data=b.encrypt(c,d.join("\u0000"))}};a.obfuscate_=function(b){var c=this[b];if(c){var d=c.length>>2;if(d==1)d=0;d=c.length-d;this[b]=c.substring(0,d).replace(/./g,"*")+c.substr(d)}};
a.decryptData=function(b,c){if(this.data){var d="";try{d=b.decrypt(c,this.data).split("\u0000")}catch(e){}var f={};if(d[0])for(var g=0;g<d.length;++g){var h=d[g].split("\u0001");f[h[0]]=h[1]}for(var i in this.propsList_)if(this.propsList_[i].encrypt){this[i]="";if(f[i])this[i]=f[i]}}};a.makeDirty=function(){this.dirty_=true};
function GTB_AutoFillDataCluster(b,c,d){this.debugZone="auto-fill data cluster";this.prefPrefix_=b;this.propList_=c;this.comboId_=d;this.currentIndex_=-1;this.valueList_=[];this.strings_=(new GTB_AF_StringMap).createMap({DEFAULT_PROFILE_LABEL:"profile",DEFAULT_CARD_LABEL:"card"})}a=GTB_AutoFillDataCluster.prototype;a.getPropertiesList=function(){return this.propList_};a.getComboId=function(){return this.comboId_};a.getIndex=function(){return this.currentIndex_};
a.setIndex=function(b){this.currentIndex_=b;if(b>=this.valueList_.length)this.currentIndex_=-1};a.getList=function(){return this.valueList_};a.getValue=function(b){return this.currentIndex_==-1?null:this.valueList_[this.currentIndex_].getValue(b)};a.setValue=function(b,c){this.currentIndex_!=-1&&this.valueList_[this.currentIndex_].setValue(b,c)};a.isEmpty=function(){return this.valueList_.length==0};a.length=function(){return this.valueList_.length};
a.addNewItem=function(){for(var b=this.valueList_.unshift(new GTB_AutoFillValuesList(0,this.propList_)),c=1;c<b;++c){this.valueList_[c].id_=c;this.valueList_[c].makeDirty()}var d=0,e;do{++d;e=false;for(c=1;!e&&c<b;++c)if(this.valueList_[c].id==d)e=true}while(e);this.valueList_[0].id=d;this.currentIndex_=0};a.removeItem=function(b){this.valueList_.splice(b,1);for(b=b;b<this.valueList_.length;++b){this.valueList_[b].id_=b;this.valueList_[b].makeDirty()}};
a.getDefaultValue=function(b){return this.propList_[b]&&this.propList_[b].defaultValue};a.loadFromPrefs=function(b){var c=b.getPref(this.prefPrefix_+"s",0);this.valueList_=[];for(var d=0;d<c;++d){this.valueList_[d]=new GTB_AutoFillValuesList(d,this.propList_);this.valueList_[d].loadFromPrefs(b,this.prefPrefix_)}this.currentIndex_=c-1};a.encryptData=function(b,c){for(var d=this.valueList_.length,e=0;e<d;++e)this.valueList_[e].encryptData(b,c)};
a.decryptData=function(b,c){for(var d=this.valueList_.length,e=0;e<d;++e)this.valueList_[e].decryptData(b,c)};a.clearEmptyLists_=function(){for(var b=false,c=0;this.valueList_[c];){var d=this.valueList_[c];if(d.isEmpty()){if(d.isDefault)b=true;this.valueList_.splice(c,1)}else{if(c!=d.id_){d.id_=c;d.dirty_=true}c++}}if(b&&this.valueList_.length>0){this.valueList_[0].isDefault=true;this.valueList_[0].dirty_=true}};
a.saveToPrefs=function(b){this.clearEmptyLists_();var c=b.getPref(this.prefPrefix_+"s",0);if(c>this.valueList_.length)for(var d=this.valueList_.length;d<c;++d)for(var e=b.getChildNames(this.prefPrefix_+"."+d),f=0;f<e.length;++f)b.clearPref(e[f]);b.setPref(this.prefPrefix_+"s",this.valueList_.length);for(c=0;c<this.valueList_.length;++c)this.valueList_[c].saveToPrefs(b,this.prefPrefix_)};
a.loadCombobox=function(b){b=b.getElementById(this.comboId_);b.removeAllItems();var c=0;if(this.valueList_.length==0)b.appendItem("",-1);else for(var d=this.getLabels_(),e=0;e<this.valueList_.length;++e){b.appendItem(d[e],e);if(this.valueList_[e].isDefault)c=e}b.selectedIndex=c};a.getBoundControl_=function(b,c){var d=b.getElementsByAttribute("gtbAutoFillField",c);return d&&d[0]};
a.loadFields=function(b){var c=this.valueList_[this.currentIndex_];for(var d in this.propList_){var e=this.getBoundControl_(b,this.prefPrefix_+":"+d);if(e)switch(e.tagName){case "textbox":e.value=c.getValue(d);break;case "checkbox":e.checked=c.getValue(d);break;case "radio":e.radioGroup.selectedIndex=c.getValue(d)?0:-1;break;default:break}}};a.clearList=function(){this.valueList_=[];this.currentIndex_=-1};a.makeDirty=function(){for(var b=0;b<this.valueList_.length;++b)this.valueList_[b].makeDirty()};
a.getLabel=function(){if(this.currentIndex_==-1)return"";else{var b=this.getLabels_();return b[this.currentIndex_]}};
a.getLabels_=function(){for(var b=[],c=0,d=0;d<this.valueList_.length;++d){var e=this.valueList_[d],f=e.getValue("label")||"";if(!f)if(this.propList_.firstName){e=[e.getValue("firstName"),e.getValue("middleName"),e.getValue("lastName")];for(var g=0;g<e.length;++g)if(e[g]){if(f)f+=" ";f+=e[g]}f||(f=this.strings_.DEFAULT_PROFILE_LABEL+" "+ ++c)}else(f=e.getValue("nameOnCard"))||(f=this.strings_.DEFAULT_CARD_LABEL+" "+ ++c);if(b.indexOf(f)>=0){for(e=0;b.indexOf(f+" "+ ++e)>=0;);f+=" "+e}b.push(f)}return b};
function GTB_AutoFillCrypto(){this.crypto_=Cc["@google.com/toolbar/crypto;1"].getService(Ci.GTBICrypto);this.b64_=new G_Base64}GTB_AutoFillCrypto.prototype.encrypt=function(b,c){var d=this.crypto_.encrypt(b,c);d=this.b64_.arrayifyString(d);return this.b64_.encodeByteArray(d)};GTB_AutoFillCrypto.prototype.decrypt=function(b,c){var d=this.b64_.decodeString(c);d=this.b64_.stringifyArray(d);return this.crypto_.decrypt(b,d)};
function GTB_AutoFillOptions(b){this.debugZone="auto-fill options";this.win_=b;this.prefs_=new G_Preferences("google.toolbar.autofill.");this.profilesList_=new GTB_AutoFillDataCluster("profile",GTB_AutoFillProfileFieldDefs,"gtbOptionsAutoFillProfilesMenu");this.cardsList_=new GTB_AutoFillDataCluster("card",GTB_AutoFillCreditCardFieldDefs,"gtbOptionsAutoFillCreditCardsMenu");this.crypto_=GTB_AutoFillOptions.createCrypto();this.pwdEncrypted_=this.dataEncrypted_=null;this.strings_=(new GTB_AF_StringMap).createMap({WARNING:"warning",
NO_PASSWORD_SET:"no-password-set",INVALID_PASSWORD:"invalid-password",WRONG_PASSWORD:"wrong-password",PASSWORD_WILL_BE_CLEARED:"password-will-be-cleared",PASSWORD_CLEARED:"password-cleared",EMPTY_PASSWORD:"empty-password",REMOVE_PASSWORD:"remove-password",NOT_MATCHED_PWD:"not-matched-pwd",PASSWORD_NOT_CHANGED:"password-not-changed",PASSWORD_LEFT_BLANK:"password-left-blank"});this.autoProfile_=null;if(b=b.arguments)for(var c=0;c<b.length;++c)if(b[c]&&b[c].gtbAutofillAutoProfile){this.autoProfile_=
b[c];break}}GTB_AutoFillOptions.createCrypto=function(){var b=null;try{b=new GTB_AutoFillCrypto}catch(c){}return b};GTB_AutoFillOptions.sameAddresses_=function(b){return b.billingCountry==b.shippingCountry&&b.billingAddr1==b.shippingAddr1&&b.billingAddr2==b.shippingAddr2&&b.billingCity==b.shippingCity&&b.billingState==b.shippingState&&b.billingZip==b.shippingZip};a=GTB_AutoFillOptions.prototype;
a.loadOptions=function(){this.dataEncrypted_=true;this.loadPwd_();this.loadProfiles_();this.loadCreditCards_();this.pwd_==""&&this.decryptData_();this.onPwdStateChanged_();this.autoProfile_&&this.addProfile(this.autoProfile_);if(!this.crypto_){var b=this.win_.document.getElementById("gtbOptionsAutoFillCardsTab");b.style.display="none"}};a.saveOptions=function(){this.saveProfiles_();this.saveCreditCards_();this.savePwd_()};
a.onSelectProfilesCombo_=function(){this.onSelectCombo_(this.profilesList_);this.profilesList_.isEmpty()?this.hideProfileFields_():this.showProfileFields_()};a.onCommandProfilesCombo=function(){this.onSelectProfilesCombo_();var b=this.win_.document;b=b.getElementById("gtbOptionsAutoFillProfileFirstName");b.focus()};a.onFocusProfilesCombo=function(){var b=this.win_.document;b=b.getElementById("gtbOptionsAutoFillProfilesMenu");b.label=this.profilesList_.getValue("label")};
a.onChangedLabel=function(){var b=this.win_.document;b=b.getElementById("gtbOptionsAutoFillProfilesMenu");var c=b.label;this.profilesList_.setValue("label",c);this.refillCombo(b,this.profilesList_)};goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedLabel",GTB_AutoFillOptions.prototype.onChangedLabel);GTB_AutoFillOptions.prototype.onKeyPress=function(b,c){if(b.keyCode==Ci.nsIDOMKeyEvent.DOM_VK_RETURN){b.preventDefault();this.win_.document.getElementById(c).focus()}};
GTB_AutoFillOptions.prototype.onChangedName=function(){var b=this.win_.document;this.refillCombo(b.getElementById("gtbOptionsAutoFillProfilesMenu"),this.profilesList_)};goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedName",GTB_AutoFillOptions.prototype.onChangedName);GTB_AutoFillOptions.prototype.onChangedCCName=function(){var b=this.win_.document;this.refillCombo(b.getElementById("gtbOptionsAutoFillCreditCardsMenu"),this.cardsList_)};
goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedCCName",GTB_AutoFillOptions.prototype.onChangedCCName);GTB_AutoFillOptions.prototype.refillCombo=function(b,c){b.removeAllItems();for(var d=c.getLabels_(),e=0;e<d.length;++e)b.appendItem(d[e],e+"");b.selectedIndex=c.getIndex()};GTB_AutoFillOptions.prototype.onChangedDefault=function(){this.changedDefaultItem_(this.profilesList_,"gtbOptionsAutoFillProfileDefault")};goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedDefault",GTB_AutoFillOptions.prototype.onChangedDefault);
GTB_AutoFillOptions.prototype.onChangedBEqS=function(){var b=this.win_.document;b=b.getElementById("gtbOptionsAutoFillProfileBEqS").checked;this.profilesList_.setValue("billingIsShipping",b);b?this.hideBillingAddressFields_():this.showBillingAddressFields_()};goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedBEqS",GTB_AutoFillOptions.prototype.onChangedBEqS);GTB_AutoFillOptions.prototype.onChangedProfileField=function(b){this.onChangedField_(b,this.profilesList_)};
goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedProfileField",GTB_AutoFillOptions.prototype.onChangedProfileField);GTB_AutoFillOptions.prototype.addProfile=function(b){this.addItem_(this.profilesList_,b);this.onSelectProfilesCombo_();b=this.win_.document.getElementById("gtbOptionsAutoFillProfilesMenu");b.focus();b.select()};goog.exportProperty(GTB_AutoFillOptions.prototype,"addProfile",GTB_AutoFillOptions.prototype.addProfile);
GTB_AutoFillOptions.prototype.removeProfile=function(){this.removeItem_(this.profilesList_);this.onSelectProfilesCombo_()};goog.exportProperty(GTB_AutoFillOptions.prototype,"removeProfile",GTB_AutoFillOptions.prototype.removeProfile);
GTB_AutoFillOptions.prototype.addCreditCard=function(b){var c=this.cardsList_.isEmpty()&&this.pwdState_==GTB_AutoFillPwdState.NO_PASSWORD;this.addItem_(this.cardsList_,b);this.onSelectCreditCardCombo_();if(c){b=this.strings_.WARNING;c=this.strings_.NO_PASSWORD_SET;alert(c,b)}b=this.win_.document.getElementById("gtbOptionsAutoFillCreditCardsMenu");b.focus();b.select()};goog.exportProperty(GTB_AutoFillOptions.prototype,"addCreditCard",GTB_AutoFillOptions.prototype.addCreditCard);
GTB_AutoFillOptions.prototype.removeCreditCard=function(){this.removeItem_(this.cardsList_);this.onSelectCreditCardCombo_()};goog.exportProperty(GTB_AutoFillOptions.prototype,"removeCreditCard",GTB_AutoFillOptions.prototype.removeCreditCard);a=GTB_AutoFillOptions.prototype;
a.addItem_=function(b,c){var d=this.win_.document;b.addNewItem();b.length()==1&&b.setValue("isDefault",true);if(c){for(var e in c)b.setValue(e,c[e]);b.getValue("billingIsShipping")&&!GTB_AutoFillOptions.sameAddresses_(c)&&b.setValue("billingIsShipping",false)}d=d.getElementById(b.getComboId());this.refillCombo(d,b)};
a.removeItem_=function(b){var c=b.getValue("isDefault"),d=this.win_.document;d=d.getElementById(b.getComboId());var e=d.selectedIndex;b.removeItem(e);this.refillCombo(d,b);b.isEmpty()&&d.appendItem("",-1);c&&!b.isEmpty()&&b.getList()[0].setValue("isDefault",true);e&&e>=b.getList().length&&--e;d.selectedIndex=e};a.onSelectCombo_=function(b){var c=this.win_.document;c=c.getElementById(b.getComboId());b.setIndex(c.selectedIndex)};
a.onChangedField_=function(b,c){var d=b.target,e=d.value,f=d.getAttribute("charsAllowed");if(f){f=e.replace(RegExp("[^"+f+"]","g"),"");if(e!=f){e=f;f=d.selectionStart;var g=d.selectionEnd;d.value=e;d.setSelectionRange(f,g)}}if(f=d.getAttribute("gtbAutoFillField"))if(f=f.split(":")[1]){switch(d.tagName){case "checkbox":e=d.checked;break;case "radio":e=d.selected;break}c.setValue(f,e)}};
a.loadProfiles_=function(){this.profilesList_.loadFromPrefs(this.prefs_);this.profilesList_.loadCombobox(this.win_.document);this.onSelectProfilesCombo_()};
a.showProfileFields_=function(){var b=this.win_.document,c=b.getElementById("gtbOptionsAutoFillProfileData");c.hidden=false;c=b.getElementById("gtbOptionsAutoFillRemoveProfile");c.disabled=false;c=b.getElementById("gtbOptionsAutoFillProfilesMenu");c.disabled=false;this.profilesList_.loadFields(b);this.profilesList_.getValue("billingIsShipping")?this.hideBillingAddressFields_():this.showBillingAddressFields_()};
a.hideProfileFields_=function(){var b=this.win_.document,c=b.getElementById("gtbOptionsAutoFillProfileData");c.hidden=true;c=b.getElementById("gtbOptionsAutoFillRemoveProfile");c.disabled=true;b=b.getElementById("gtbOptionsAutoFillProfilesMenu");b.disabled=true};a.hideBillingAddressFields_=function(){var b=this.win_.document;b.getElementById("gtbOptionsAutoFillProfileBillingGrid").hidden=true;b.getElementById("gtbOptionsAutoFillProfileBillingLabel").hidden=true};
a.showBillingAddressFields_=function(){var b=this.win_.document;b.getElementById("gtbOptionsAutoFillProfileBillingGrid").hidden=false;b.getElementById("gtbOptionsAutoFillProfileBillingLabel").hidden=false};a.saveProfiles_=function(){this.correctAddressData_();this.profilesList_.saveToPrefs(this.prefs_)};
a.correctAddressData_=function(){for(var b=this.profilesList_.getList(),c=0,d;d=b[c];++c)if(d.billingIsShipping){d.billingCountry="";d.billingAddr1="";d.billingAddr2="";d.billingCity="";d.billingState="";d.billingZip=""}};a.loadCreditCards_=function(){this.cardsList_.loadFromPrefs(this.prefs_);this.cardsList_.loadCombobox(this.win_.document)};a.encryptData_=function(){if(!this.dataEncrypted_){this.crypto_&&this.cardsList_.encryptData(this.crypto_,this.pwd_);this.dataEncrypted_=true}};
a.decryptData_=function(){if(this.dataEncrypted_){this.crypto_&&this.cardsList_.decryptData(this.crypto_,this.pwd_);this.dataEncrypted_=false}this.onSelectCreditCardCombo_()};a.saveCreditCards_=function(){this.encryptData_();this.cardsList_.saveToPrefs(this.prefs_)};a.onSelectCreditCardCombo_=function(){this.onSelectCombo_(this.cardsList_);this.cardsList_.isEmpty()?this.hideCreditCardFields_():this.showCreditCardFields_()};
a.onCommandCCCombo=function(){this.onSelectCreditCardCombo_();var b=this.win_.document;b=b.getElementById("gtbOptionsAutoFillCCName");b.focus()};a.onFocusCCCombo=function(){var b=this.win_.document;b=b.getElementById("gtbOptionsAutoFillCreditCardsMenu");b.label=this.cardsList_.getValue("label")};a.onChangedCCLabel=function(){var b=this.win_.document;b=b.getElementById("gtbOptionsAutoFillCreditCardsMenu");var c=b.label;this.cardsList_.setValue("label",c);this.refillCombo(b,this.cardsList_)};
goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedCCLabel",GTB_AutoFillOptions.prototype.onChangedCCLabel);GTB_AutoFillOptions.prototype.onChangedCCDefault=function(){this.changedDefaultItem_(this.cardsList_,"gtbOptionsAutoFillDefaultCC")};goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedCCDefault",GTB_AutoFillOptions.prototype.onChangedCCDefault);
GTB_AutoFillOptions.prototype.changedDefaultItem_=function(b,c){for(var d=b.getList(),e=0;e<d.length;++e)if(d[e].isDefault){d[e].setValue("isDefault",false);break}d=this.win_.document;b.setValue("isDefault",d.getElementById(c).selected)};GTB_AutoFillOptions.prototype.onChangedCCField=function(b){this.onChangedField_(b,this.cardsList_)};goog.exportProperty(GTB_AutoFillOptions.prototype,"onChangedCCField",GTB_AutoFillOptions.prototype.onChangedCCField);a=GTB_AutoFillOptions.prototype;
a.showCreditCardFields_=function(){var b=this.win_.document,c=b.getElementById("gtbOptionsAutoFillCardsData");c.hidden=false;c=b.getElementById("gtbOptionsAutoFillRemoveCreditCard");c.disabled=false;c=b.getElementById("gtbOptionsAutoFillCreditCardsMenu");c.disabled=false;this.cardsList_.loadFields(b)};
a.hideCreditCardFields_=function(){var b=this.win_.document,c=b.getElementById("gtbOptionsAutoFillCardsData");c.hidden=true;c=b.getElementById("gtbOptionsAutoFillRemoveCreditCard");c.disabled=true;b=b.getElementById("gtbOptionsAutoFillCreditCardsMenu");b.disabled=true};a.loadPwd_=function(){this.pwd_=this.prefs_.getPref("ccpwd","");this.pwdEncrypted_=this.pwd_!="";this.pwdState_=this.pwd_?GTB_AutoFillPwdState.ENTER_PASSWORD:GTB_AutoFillPwdState.NO_PASSWORD};
a.encrypt_=function(b,c){return this.crypto_?this.crypto_.encrypt(b,c):""};a.decrypt_=function(b,c){return this.crypto_?this.crypto_.decrypt(b,c):""};a.savePwd_=function(){if(this.pwd_!=""&&!this.pwdEncrypted_){this.pwd_=this.encrypt_(this.pwd_,this.pwd_);this.pwdEncrypted_=true}this.prefs_.setPref("ccpwd",this.pwd_)};
a.onPwdStateChanged_=function(){var b=this.win_.document,c=this.pwdState_==GTB_AutoFillPwdState.ENTER_PASSWORD;b.getElementById("gtbOptionsAutoFillPasswordDeck").selectedIndex=this.pwdState_;b.getElementById("gtbOptionsAutoFillCardsCombobox").hidden=c;b.getElementById("gtbOptionsAutoFillCardsData").hidden=c;if(!c&&this.cardsList_.isEmpty())b.getElementById("gtbOptionsAutoFillCardsData").hidden=true};a.onTestPasswordEntered=function(b){if(b.keyCode==b.DOM_VK_RETURN){this.onConfirmPwd();b.preventDefault()}};
goog.exportProperty(GTB_AutoFillOptions.prototype,"onTestPasswordEntered",GTB_AutoFillOptions.prototype.onTestPasswordEntered);
GTB_AutoFillOptions.prototype.onConfirmPwd=function(){var b=this.win_.document,c=b.getElementById("gtbOptionsAutoFillCurrentPwd"),d="";try{d=this.decrypt_(c.value,this.pwd_)}catch(e){}if(d){this.pwd_=c.value;this.pwdEncrypted_=false;if(this.prefs_.getPref("imported")){c=this.decrypt_("",this.cardsList_.getValue("data").toString());c=c.split("\u0000");c.push("number\u0001"+d);this.cardsList_.setValue("data",this.encrypt_(this.pwd_,c.join("\u0000")));this.prefs_.clearPref("imported")}this.decryptData_();
this.pwdState_=GTB_AutoFillPwdState.PASSWORD_ENTERED;this.onPwdStateChanged_();b.getElementById("gtbOptionsAutoFillCardsCombobox").focus()}else{alert(this.strings_.WRONG_PASSWORD,this.strings_.INVALID_PASSWORD);c.focus();c.select()}};goog.exportProperty(GTB_AutoFillOptions.prototype,"onConfirmPwd",GTB_AutoFillOptions.prototype.onConfirmPwd);
GTB_AutoFillOptions.prototype.onForgotPwd=function(){var b=this.strings_.WARNING,c="";if(this.cardsList_.isEmpty()){c=this.strings_.PASSWORD_CLEARED;alert(c,b)}else{c=this.strings_.PASSWORD_WILL_BE_CLEARED;if(!this.okCancelPrompt(c,b))return}this.cardsList_.clearList();this.dataEncrypted_=null;this.cardsList_.loadCombobox(this.win_.document);this.onSelectCreditCardCombo_();this.pwd_="";this.pwdState_=GTB_AutoFillPwdState.NO_PASSWORD;this.pwdEncrypted_=false;this.onPwdStateChanged_()};
goog.exportProperty(GTB_AutoFillOptions.prototype,"onForgotPwd",GTB_AutoFillOptions.prototype.onForgotPwd);GTB_AutoFillOptions.prototype.onEditPwd=function(b){this.win_.openDialog("chrome://google-toolbar/content/auto-fill-pwd.xul","gtbGoogleOptionsAutoFillPwd","modal,centerscreen,chrome,dialog,resizable=no",this,b)};goog.exportProperty(GTB_AutoFillOptions.prototype,"onEditPwd",GTB_AutoFillOptions.prototype.onEditPwd);
GTB_AutoFillOptions.prototype.onRemovePwd=function(){if(!this.cardsList_.isEmpty()){var b=this.strings_.WARNING,c=this.strings_.REMOVE_PASSWORD;if(!this.okCancelPrompt(c,b))return}this.pwd_="";this.pwdEncrypted_=false;this.pwdState_=GTB_AutoFillPwdState.NO_PASSWORD;this.onPwdStateChanged_();this.cardsList_.makeDirty()};goog.exportProperty(GTB_AutoFillOptions.prototype,"onRemovePwd",GTB_AutoFillOptions.prototype.onRemovePwd);
GTB_AutoFillOptions.prototype.onSetPasswordOK=function(b){b=b.document;b=b.getElementById("gtbAutofillNewPassword").value;if(!b&&this.pwd_){b=this.strings_.WARNING;var c=this.strings_.EMPTY_PASSWORD;alert(c,b)}else this.setNewPassword_(b)};goog.exportProperty(GTB_AutoFillOptions.prototype,"onSetPasswordOK",GTB_AutoFillOptions.prototype.onSetPasswordOK);
GTB_AutoFillOptions.prototype.onPwdInput=function(b){b=b.document;var c=b.getElementById("gtbGoogleOptionsAutoFillPwd");c=c.getButton("accept");var d=b.getElementById("gtbAutofillNewPassword").value,e=b.getElementById("gtbAutofillConfirmPassword").value,f=b.getElementById("gtbOptionsAutoFillPwdMessage");b=b.createTextNode("");b.nodeValue=d!=e?this.strings_.NOT_MATCHED_PWD:d?"":this.pwd_?this.strings_.PASSWORD_NOT_CHANGED:this.strings_.PASSWORD_LEFT_BLANK;f.firstChild!=null&&f.removeChild(f.firstChild);
f.appendChild(b);c.disabled=d!=e};goog.exportProperty(GTB_AutoFillOptions.prototype,"onPwdInput",GTB_AutoFillOptions.prototype.onPwdInput);GTB_AutoFillOptions.prototype.okCancelPrompt=function(b,c){var d=Cc["@mozilla.org/embedcomp/prompt-service;1"].getService(Ci.nsIPromptService),e=d.BUTTON_POS_0*d.BUTTON_TITLE_OK+d.BUTTON_POS_1*d.BUTTON_TITLE_CANCEL;return!d.confirmEx(null,c,b,e,"","","",null,{})};
GTB_AutoFillOptions.prototype.setNewPassword_=function(b){this.pwd_=b;this.pwdEncrypted_=false;this.pwdState_=b?GTB_AutoFillPwdState.PASSWORD_ENTERED:GTB_AutoFillPwdState.NO_PASSWORD;this.onPwdStateChanged_();this.cardsList_.makeDirty()};var GTB_DefaultPreferences={};GTB_DefaultPreferences.debugZone="GTB_DefaultPreferences";GTB_DefaultPreferences.prefsMap_=null;GTB_DefaultPreferences.getDefaultValue=function(b){GTB_DefaultPreferences.init_();return GTB_DefaultPreferences.getDefaultValueImpl_(b)};GTB_DefaultPreferences.getDefaultValueImpl_=function(b){return b in GTB_DefaultPreferences.prefsMap_?GTB_DefaultPreferences.prefsMap_[b]:null};
GTB_DefaultPreferences.init_=function(){var b=new GTB_PrefsLoader_;try{Cc["@mozilla.org/moz/jssubscript-loader;1"].getService(Ci.mozIJSSubScriptLoader).loadSubScript("chrome://google-toolbar-default-prefs/content/options.js",b);GTB_DefaultPreferences.prefsMap_=b.prefsMap}catch(c){GTB_DefaultPreferences.prefsMap_={}}GTB_DefaultPreferences.getDefaultValue=GTB_DefaultPreferences.getDefaultValueImpl_};
GTB_DefaultPreferences.isButtonOptionPref=function(b){return b.indexOf("google.toolbar.button_option.")==0};GTB_DefaultPreferences.isFeaturePref=function(b){if(!GTB_DefaultPreferences.isButtonOptionPref(b))return false;b=b.substr(0,29);return GTB_TB_DefaultSet.indexOf(b)!=-1};function GTB_PrefsLoader_(){this.debugZone="GTB_PrefsLoader_";this.prefsMap={}}GTB_PrefsLoader_.prototype.pref=function(b,c){this.prefsMap[b]=c};goog.exportSymbol("GTB_PrefsLoader_.prototype.pref",GTB_PrefsLoader_.prototype.pref);function GTB_FirstRun(){this.debugZone="first-run";this.prefs_=new G_Preferences("google.toolbar.",false,true);this.onTabSwitchClosure_=BindToObject(this.onTabSwitch_,this);this.isMac_=GetPlatform()==2;this.isFF3_=GTB_GeckoVersion.isFirefox3();var b=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;this.homepagesToSuggest_=b.getPref("homepages_suggest_google")||"";this.homepageUri_="";this.timer_=null;this.update_=!GTB_FreshInstall();this.iframeBox_=null}
GTB_FirstRun.instance_=null;GTB_FirstRun.getInstance=function(){if(!GTB_FirstRun.instance_)GTB_FirstRun.instance_=new GTB_FirstRun;return GTB_FirstRun.instance_};goog.exportSymbol("GTB_FirstRun.getInstance",GTB_FirstRun.getInstance);GTB_FirstRun.prototype.removeTabWatcherListeners_=function(){if(this.tabWatcher_){this.tabWatcher_.removeListener("tabswitch",this.onTabSwitchClosure_);this.tabWatcher_.removeListener("load",this.onTabSwitchClosure_);this.tabWatcher_.removeListener("unload",this.onTabSwitchClosure_)}};
GTB_FirstRun.prototype.onPageScroll_=function(){this.iframeBox_&&this.increaseZIndex_()};GTB_FirstRun.prototype.setPreferredWidth=function(b){if(this.iframeBox_){var c=this.win_.getComputedStyle(this.iframeBox_,null);c=parseInt(c.width,10);var d=this.win_.screen;b=Math.max(c,Math.min(b,1E3,d.availWidth))+"px";this.iframeBox_.firstChild.style.width=b;this.iframeBox_.style.width=b;this.onContentLoaded_()}};goog.exportSymbol("GTB_FirstRun.prototype.setPreferredWidth",GTB_FirstRun.prototype.setPreferredWidth);
a=GTB_FirstRun.prototype;
a.updateIframeHeight_=function(){if(this.iframeBox_){var b=this.iframeBox_.firstChild.contentDocument,c=b.body,d=c.scrollHeight+3;this.iframeBox_.firstChild.style.height=d+"px";this.iframeBox_.style.height=d+"px";c=this.doc_.defaultView.screen;var e=parseInt(this.iframeBox_.style.top,10);if(c.availTop+e+d>c.availHeight){d=c.availTop+e+d-c.availHeight;if((e-=d)<0)e=0;this.iframeBox_.style.top=e+"px"}e=parseInt(this.iframeBox_.style.left,10);d=parseInt(this.iframeBox_.style.width,10);if(c.availLeft+
e+d>c.availWidth){d=c.availLeft+e+d-c.availWidth;if((e-=d)<0)e=0;this.iframeBox_.style.left=e+"px"}b.defaultView.scrollTo(0,0)}};a.onTabSwitch_=function(){if(GetPlatform()!=1&&!this.isFF3_)this.increaseZIndex_();else this.iframeBox_&&new G_Alarm(BindToObject(this.reattachIFrame_,this),50)};a.saveIFrameState_=function(){var b={},c=this.iframeBox_.firstChild.contentDocument;if(!c)return b;c=this.getElementsByClassName_(c,"preference");for(var d=0,e;e=c[d];++d)b[e.id]=e.checked;return b};
a.restoreIFrameState_=function(b){if(this.iframeBox_){var c=this.iframeBox_.firstChild.contentDocument;if(c){c=this.getElementsByClassName_(c,"preference");for(var d=0,e;e=c[d];++d)e.checked=b[e.id];this.increaseZIndex_()}}};a.onFlagsLoaded_=function(b){var c=false;for(var d in b)if(GTB_FirstRunFlagCollector.ASKNOT!=b[d]){c=true;break}if(c){c="first-run-license.html?";for(var e in b)c+=e+"="+b[e]+"&";this.openNewIFrame_("chrome://google-toolbar/content/"+c)}else{this.saveSettings({});this.complete()}};
a.openNewIFrame_=function(b){this.prefs_.setPref("firstrun.entered",true);var c=this.doc_.getElementById("main-window"),d=this.createIFrameBox_(),e=this.doc_.createElement("browser");e.setAttribute("type","content");e.id="gtbFirstRunIFrame";e.gtbFirstRun=this;e.style.width=d.style.width;e.style.border="none";e.style.overflow="hidden";e.style.backgroundColor="white";d.appendChild(e);c.appendChild(d);e.setAttribute("src",b);e.addEventListener("load",BindToObject(this.onContentLoaded_,this),true);if(this.isMac_&&
this.isFF3_)this.timer_=this.win_.setInterval(BindToObject(this.onTimer_,this),50)};a.onContentLoaded_=function(){new G_Alarm(BindToObject(this.updateIframeHeight_,this),50)};a.increaseZIndex_=function(){this.browserBox_.style.zIndex=++this.zIndex_;this.iframeBox_.style.zIndex=++this.zIndex_};a.onTimer_=function(){this.iframeBox_&&this.increaseZIndex_()};
a.closeIFrame_=function(){if(this.iframeBox_){this.iframeBox_.parentNode.removeChild(this.iframeBox_);this.iframeBox_=null;if(this.timer_){this.win_.clearInterval(this.timer_);this.timer_=null}new G_Alarm(GTB_CB_Manager.checkInstallCookie,0)}};
a.createIFrameBox_=function(){if(this.iframeBox_)return this.iframeBox_;var b=this.prefs_.getPref("firstrun.done",false);b=b?"370px":this.sidewikiAvailable_?"610px":"710px";var c=this.doc_.getElementById("gtbToolbar"),d=GTB_getBoxObjectFor(c),e=this.doc_.createElement("box");e.style.overflow="hidden";e.style.position="fixed";c=this.win_.getComputedStyle(c,"");if(c.direction=="ltr")e.style.left=d.x+60+"px";else e.style.right=d.x+60+"px";e.style.top=d.y+20+"px";e.style.width=b;e.style.height="1px";
e.style.zIndex=this.zIndex_;this.iframeBox_=e;this.browserBox_=this.doc_.getElementById("browser");return e};a.reattachIFrame_=function(){var b=this.iframeBox_.style.height,c=this.iframeBox_.style.width,d=this.saveIFrameState_(),e=this.doc_.getElementById("main-window");e.removeChild(this.iframeBox_);var f=this.iframeBox_.firstChild;this.iframeBox_=null;var g=this.createIFrameBox_();g.appendChild(f);e.appendChild(g);g.style.width=c;g.style.height=b;this.restoreIFrameState_(d)};
a.createFirstRunFrame=function(b,c,d,e){if(!this.iframeBox_){this.win_=b;this.doc_=b.document;this.toolbar_=c;this.tabWatcher_=d;this.flagCollector_=new GTB_FirstRunFlagCollector(this.prefs_,this.win_,this.toolbar_);this.sidewikiAvailable_=GTB_buttonAvailableInLocale(GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID);if(this.prefs_.hasUserValue("annotations.first.run")){this.prefs_.setPref("sidewiki.first.run",this.prefs_.getPref("annotations.first.run"));this.prefs_.clearPref("annotations.first.run")}GTB_FreshInstall()||
this.prefs_.setPref("firstrun.done",true);var f=this.sidewikiAvailable_&&!this.prefs_.hasUserValue("sidewiki.first.run");b=this.prefs_.getPref("opted_into_advanced_features_1");var g=this.prefs_.getPref("button_option.gtbPageRank",b),h=this.prefs_.getPref("done_page_shown",""),i=h&&h.indexOf("AU_")==0;h=!i?h:h.substring(3);if(this.sidewikiAvailable_){i="boolean"==typeof g;f&&i&&this.prefs_.setPref(GTB_SidewikiApplication.ENABLED_PREF,g);if(!f){f=this.prefs_.getPref(GTB_SidewikiApplication.ENABLED_PREF);
if("6.1.20091119"==h){f=this.prefs_.getPref("opted_into_advanced_features_1");this.prefs_.setPref(GTB_SidewikiApplication.ENABLED_PREF,!!f)}else"undefined"==typeof f&&this.prefs_.setPref(GTB_SidewikiApplication.ENABLED_PREF,true)}this.prefs_.setPref("sidewiki.first.run",false);(f=this.prefs_.getPref("enhanced_features.week"))||this.prefs_.setPref("enhanced_features.week",-1)}f=this.prefs_.getPref("firstrun.entered",false);if(e=e||!f&&GTB_FreshInstall()){if(d){d.registerListener("tabswitch",this.onTabSwitchClosure_);
d.registerListener("load",this.onTabSwitchClosure_);d.registerListener("unload",this.onTabSwitchClosure_)}this.isMac_&&this.isFF3_&&this.doc_.getElementById("content").addEventListener("scroll",BindToObject(this.onPageScroll_,this),false);this.zIndex_=20;d=G_FirefoxXMLUtils.newXML("image",G_FirefoxXMLUtils.XUL_NAMESPACE);GTB_localizeLogo(d.documentElement,"toolbar_logo_sm.gif");if(this.sidewikiAvailable_){d=G_FirefoxXMLUtils.newXML("image",G_FirefoxXMLUtils.XUL_NAMESPACE);GTB_localizeLogo(d.documentElement,
"sidewiki_logo.gif")}if(this.prefs_.getPref("firstrun.done",false)){this.resumeSearchDomainCheck_();c=g?"?ef=asknot":"";this.openNewIFrame_("chrome://google-toolbar/content/first-run-update.html"+c)}else{this.prefs_.setPref("button_option.gtbPageRank",!!b);b||c.layout.removeButton("gtbPageRank");this.prefs_.setPref(GTB_SidewikiApplication.ENABLED_PREF,!!b);c="google.toolbar.google_home";c=GTB_getLocaleDefaultForPref(c);this.setGoogleHomePref_(c);this.scheduleSearchDomainCheck_(0,5,36E5);this.collectDefaultsAndShowFrame_()}}else{this.resumeSearchDomainCheck_();
this.saveSettings({});this.complete();this.maybeNavigateToDonePage_()}}};goog.exportSymbol("GTB_FirstRun.prototype.createFirstRunFrame",GTB_FirstRun.prototype.createFirstRunFrame);a=GTB_FirstRun.prototype;a.setGoogleHomePref_=function(b){GTB_GOOGLE_HOME_DICT[b]||(b="www.google.com");if(!this.update_){this.prefs_.setPref("google_home",b);this.prefs_.setPref("google_home.default",b)}};
a.isSearchDomainSetToDefault_=function(){var b="google.toolbar.google_home";return this.prefs_.getPref("google_home")==GTB_getLocaleDefaultForPref(b)};
a.resumeSearchDomainCheck_=function(){if(this.isSearchDomainSetToDefault_()){var b=this.prefs_.getPref("searchdomaincheck.retry.count",0);if(b>0){var c=parseFloat(this.prefs_.getPref("searchdomaincheck.retry.time")),d=this.prefs_.getPref("searchdomaincheck.retry.interval");this.scheduleSearchDomainCheck_(Math.max(0,c-Date.now()),b,d)}else this.prefs_.getPref("searchdomaincheck.done",false)||this.scheduleSearchDomainCheck_(0,5,36E5)}else this.cancelSearchDomainCheckRetries_()};
a.scheduleSearchDomainCheck_=function(b,c,d){this.prefs_.setPref("searchdomaincheck.retry.time",(Date.now()+b).toString());this.prefs_.setPref("searchdomaincheck.retry.count",c);this.prefs_.setPref("searchdomaincheck.retry.interval",d);new G_Alarm(BindToObject(this.querySearchDomainCheck_,this,c,d),b)};
a.cancelSearchDomainCheckRetries_=function(){this.prefs_.clearPref("searchdomaincheck.retry.time");this.prefs_.clearPref("searchdomaincheck.retry.count");this.prefs_.clearPref("searchdomaincheck.retry.interval");this.prefs_.setPref("searchdomaincheck.done",true)};
a.querySearchDomainCheck_=function(b,c){if(this.isSearchDomainSetToDefault_()){var d=new G_XMLFetcher;d.get("https://www.google.com/searchdomaincheck?format=domain&sourceid=navclient-ff",BindToObject(this.onSearchDomainCheckResponse_,this,b,c))}else this.cancelSearchDomainCheckRetries_()};
a.onSearchDomainCheckResponse_=function(b,c,d){if(this.isSearchDomainSetToDefault_())if(d.status==200&&d.responseText&&d.responseText.match(/^\.google\./))this.setGoogleHomePref_("www"+d.responseText.replace(/\s*/g,""));else if(b>1){c=Math.round(c*(0.5+Math.random()));this.scheduleSearchDomainCheck_(c,b-1,c*2);return}this.cancelSearchDomainCheckRetries_()};a.collectDefaultsAndShowFrame_=function(){this.flagCollector_.collect(2E3,BindToObject(this.onFlagsLoaded_,this))};
a.saveSettings=function(b){if(!this.update_){GTB_GlobalPrefs.setPref("metrics.upload.enable",true);this.prefs_.setPref("usage_stats.default",true)}this.flagCollector_.save(b)};goog.exportSymbol("GTB_FirstRun.prototype.saveSettings",GTB_FirstRun.prototype.saveSettings);GTB_FirstRun.prototype.complete=function(){this.closeIFrame_();this.removeTabWatcherListeners_();this.prefs_.setPref("firstrun.done",true);this.prefs_.clearPref("firstrun.entered");this.maybeNavigateToDonePage_()};
goog.exportSymbol("GTB_FirstRun.prototype.complete",GTB_FirstRun.prototype.complete);GTB_FirstRun.prototype.onToolbarPrivacyPolicy=function(){var b="http://www.google.com/tools/service/npredir?r=tb_hc_privacy&hl={LANG}";b=b.replace("{LANG}",GTB_getLangCode());GTB_Links.openHelpWindow(b,"gtbToolbarPrivacyPolicy")};goog.exportSymbol("GTB_FirstRun.prototype.onToolbarPrivacyPolicy",GTB_FirstRun.prototype.onToolbarPrivacyPolicy);
GTB_FirstRun.prototype.onGooglePrivacyPolicy=function(){var b="http://"+GTB_getGoogleHome()+"/privacy.html";GTB_Links.openHelpWindow(b,"gtbGooglePrivacyPolicy")};
GTB_FirstRun.prototype.maybeNavigateToDonePage_=function(){var b=new GTB_PrefFile;if(b.getPref("eulaAccepted"))if(b=this.doc_.getElementById("gtbToolbar")){b=this.win_.getComputedStyle(b,"");if(!(b.visibility!="visible"||b.display=="none")){b=this.prefs_;var c=b.getPref("never_show_done_page","");if(!c){var d=b.getPref("done_page_shown","");c=GTB_version;if(d&&c){var e=d.split("."),f=c.split(".");if(e[0].substring(0,3)=="AU_")e[0]=e[0].substring(3);if(e[0]==f[0]&&(e.length==1&&f.length==1||e[1]==
f[1]))return}d=(d=d&&d.indexOf("AU_")==0)?"http://tools.google.com/service/npredir?r=ff_tb_au&hl={LANG}&v={VERSION}":"http://tools.google.com/service/npredir?r=ff_tb_di&hl={LANG}&v={VERSION}";d=d.replace("{LANG}",GTB_getLangCode());d=d.replace("{VERSION}",GTB_version);b.setPref("done_page_shown",c);b=this.toolbar_.tabBrowser;c=b.addTab(d);b.selectedTab=c}}}};
GTB_FirstRun.prototype.localize=function(b,c){var d=GTB_getChromeWindow(b.defaultView);d=d.document;var e=d.getElementById("gtbToolbar");d=d.defaultView.getComputedStyle(e,"");b.body.setAttribute("dir",d.direction);e=this.getElementsByClassName_(b,"localized-text");for(var f=c||"prop.gtb.first-run.",g=new GTB_HtmlLocalization,h=0,i=e[h];i;i=e[++h])try{var j=i.getAttribute("gtb-i18n-key")||i.id,k=g.getLocalized(f+j,{begin_link:'<label class="gtbLink" onclick="firstRunObject.onToolbarPrivacyPolicy();">',
begin_link_g:'<label class="gtbLink" onclick="firstRunObject.onGooglePrivacyPolicy();">',end_link:"</label>"},true);i.innerHTML=k}catch(l){}if("rtl"==d.direction){e=this.getElementsByClassName_(b,"rtl-align-left");h=0;for(i=e[h];i;i=e[++h])i.style.textAlign="left"}e=this.getElementsByClassName_(b,"localized-logo");h=0;for(i=e[h];i;i=e[++h])GTB_localizeLogo(i)};goog.exportSymbol("GTB_FirstRun.prototype.localize",GTB_FirstRun.prototype.localize);
GTB_FirstRun.prototype.getElementsByClassName_=function(b,c){return this.isFF3_?b.getElementsByClassName(c):this.getElementsByClassNameRec_(b.documentElement,c)};GTB_FirstRun.prototype.getElementsByClassNameRec_=function(b,c){var d=[];if(b.nodeType==Ci.nsIDOMNode.ELEMENT_NODE){b.className.indexOf(c)>=0&&d.push(b);for(var e=b.firstChild;e;e=e.nextSibling){var f=this.getElementsByClassNameRec_(e,c);d=d.concat(f)}}return d};function GTB_FirstRunFlagCollector(b,c,d){this.prefs_=b;this.win_=c;this.doc_=c.document;this.toolbar_=d;b=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;this.homepagesToSuggest_=b.getPref("homepages_suggest_google")||"";this.flagValues_={};this.flagStates_={}}GTB_FirstRunFlagCollector.prototype.debugZone="first-run";GTB_FirstRunFlagCollector.ASKNOT="asknot";GTB_FirstRunFlagCollector.OPTIN="optin";GTB_FirstRunFlagCollector.OPTOUT="optout";a=GTB_FirstRunFlagCollector.prototype;
a.collect=function(b,c){this.flagValues_={};this.flagStates_={};this.alarm_=new G_Alarm(BindToObject(this.reportFlags_,this,c),b);this.loadLicense();this.loadSearch();this.loadPagerank();this.loadSidewiki();this.loadHome()};
a.loadLicense=function(){var b=new GTB_PrefFile,c=this.prefs_.getPref("showEula",false);if(c&&b.getPref("eulaAccepted"))c=false;if(c)this.flagStates_.license=GTB_FirstRunFlagCollector.OPTIN;else{this.flagStates_.license=GTB_FirstRunFlagCollector.ASKNOT;this.flagValues_.license=true}};
a.loadSearch=function(){var b=null==this.prefs_.getPref("firstrun.setsearch",null);if(b)if(this.isFF3_)b=(b=GTB_getFirefoxSearchBar(this.doc_))&&b.textbox.emptyText!="Google";else{b=new G_Preferences("browser.search.");b=(b=b.getPref("selectedEngine",""))&&b!="Google"}b=b?GTB_FirstRunFlagCollector.OPTOUT:GTB_FirstRunFlagCollector.ASKNOT;this.flagStates_.search=b;this.flagValues_.search=this.prefs_.getPref("firstrun.setsearch")};
a.loadHome=function(){var b=this.prefs_.getPref("firstrun.sethome",null);b===null?this.checkFirefoxHomepage_():this.homeCheckDone_(GTB_FirstRunFlagCollector.ASKNOT,b)};a.loadPagerank=function(){var b=this.prefs_.getPref("opted_into_advanced_features_1");if("boolean"==typeof b){this.flagStates_.pagerank=GTB_FirstRunFlagCollector.ASKNOT;this.flagValues_.pagerank=b}else this.flagStates_.pagerank=this.getPagerankDefault()};
a.loadSidewiki=function(){var b=this.prefs_.getPref("opted_into_advanced_features_1");if(b=b&&this.prefs_.getPref("button_option.gtbPageRank")){this.flagStates_.sidewiki=GTB_FirstRunFlagCollector.ASKNOT;this.flagValues_.sidewiki=true}else this.flagStates_.sidewiki=this.getSidewikiDefault()};
a.getPagerankDefault=function(){var b=this.prefs_.getPref("opted_into_advanced_features_1");if(b)return GTB_FirstRunFlagCollector.ASKNOT;else return(b=GTB_buttonAvailableInLocale(GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID))?GTB_FirstRunFlagCollector.ASKNOT:GTB_FirstRunFlagCollector.OPTIN};
a.getSidewikiDefault=function(){var b=this.prefs_.getPref("opted_into_advanced_features_1");if(b)return GTB_FirstRunFlagCollector.ASKNOT;else return(b=GTB_buttonAvailableInLocale(GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID))?GTB_FirstRunFlagCollector.OPTIN:GTB_FirstRunFlagCollector.ASKNOT};
a.checkFirefoxHomepage_=function(){var b=GTB_GlobalPrefs;b=b.getPref("browser.startup.homepage");for(var c=0;c<3;++c){if(!b){this.homeCheckDone_(GTB_FirstRunFlagCollector.OPTOUT);return}var d=null;try{d=uri_parse(b)}catch(e){break}var f=d.GetScheme();if(f=="about")break;else if(f=="http"){if(GTB_isGoogleDomain(d.GetDomain())){this.homeCheckDone_(GTB_FirstRunFlagCollector.ASKNOT);return}if(this.toSuggestHome_(d.toString())){this.homeCheckDone_(GTB_FirstRunFlagCollector.OPTOUT);return}c=G_NewXMLHttpRequest();
c.open("GET",b,true);c.onreadystatechange=BindToObject(this.checkHomepageResponse_,this,c);c.send(null);return}else if(f=="resource"||f=="data"&&0==d.GetPath().indexOf("text/plain,")){d=G_NewXMLHttpRequest();d.open("GET",b,false);d.overrideMimeType("text/plain");d.send(null);b=null;f=d.status;if(f!=0)break;d=d.responseText.split("\n");for(f=0;f<d.length;++f){var g=/\s*browser\.startup\.homepage\s*=\s*(\S.*\S)\s*/;if(g=g.exec(d[f])){b=g[1];break}}}else{this.homeCheckDone_(GTB_FirstRunFlagCollector.OPTIN);
return}}this.homeCheckDone_(GTB_FirstRunFlagCollector.ASKNOT)};a.toSuggestHome_=function(b){this.homepageUri_=b;return!!(this.homepagesToSuggest_&&RegExp(this.homepagesToSuggest_,"i").test(b))};a.checkHomepageResponse_=function(b){if(b.readyState==4){b=b.channel.URI;if(GTB_isGoogleDomain(b.host))this.homeCheckDone_(GTB_FirstRunFlagCollector.ASKNOT);else{b=(b=this.toSuggestHome_(b.spec))?GTB_FirstRunFlagCollector.OPTOUT:GTB_FirstRunFlagCollector.OPTIN;this.homeCheckDone_(b)}}};
a.save=function(b){this.saveLicense(this.selectValue(b,"license"));this.saveSearch(this.selectValue(b,"search"));this.saveHome(this.selectValue(b,"home"));this.savePagerank(this.selectValue(b,"pagerank"));this.saveSidewiki(this.selectValue(b,"sidewiki"))};a.selectValue=function(b,c){return c in b?b[c]:this.flagValues_[c]};a.saveLicense=function(b){if(typeof b=="boolean"){var c=new GTB_PrefFile;c.setPref("eulaAccepted",b);b||GTB_Uninstall_uninstall(this.win_)}};
a.saveSearch=function(b){if(b){GTB_SearchEngineService.makeGoogleDefaultSearch();this.prefs_.setPref("keep_search_google.default",true)}};a.saveHome=function(b){if(b){b=this.prefs_.getPref("google_home.default");GTB_GlobalPrefs.setPref("browser.startup.homepage","http://"+b+"/");(new GTB_Pinging).recordGoogleHomepageInstall()}};a.savePagerank=function(b){b&&this.prefs_.setPref("enhanced_features.week",GTB_GetCurrentWeekNum());"boolean"==typeof b&&this.toolbar_.updatePageRankOptions(b)};
a.saveSidewiki=function(b){if(GTB_buttonAvailableInLocale(GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID)){b&&this.prefs_.setPref("enhanced_features.week",GTB_GetCurrentWeekNum());"boolean"==typeof b&&this.prefs_.setPref(GTB_SidewikiApplication.ENABLED_PREF,b)}};a.homeCheckDone_=function(b,c){this.flagStates_.home=b;if("undefined"!=typeof c)this.flagValues_.home=c;try{this.alarm_.notify(null)}catch(d){}};
a.reportFlags_=function(b){if(!("home"in this.flagStates_))this.flagStates_.home=GTB_FirstRunFlagCollector.ASKNOT;b(this.flagStates_)};var AdvancedFeaturesDefaults={"google.toolbar.button_option.gtbPageRank":"google.toolbar.opted_into_advanced_features_1","metrics.upload.enable":"google.toolbar.usage_stats.default","google.toolbar.google_home":"google.toolbar.google_home.default","google.toolbar.keep_search_google":"google.toolbar.keep_search_google.default"};GTB_Options.OPTIONS_DIALOG_APPLIED="on-options-dialog-apply";
function GTB_Options(b){this.debugZone="options";this.oldLayout_="classic";this.layouts_=b.GTB_GoogleToolbarOverlay.layout;this.customButtonOptions=new GTB_CB_Options(b);goog.exportProperty(GTB_Options.prototype,"customButtonOptions",this.customButtonOptions);this.mainWindow_=b;this.optionsWindow_=null;this.sharing=new GTB_SharingOptions;goog.exportProperty(GTB_Options.prototype,"sharing",this.sharing);b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);this.stringBundle_=
b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");b=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;this.docsSpreadsheetsAvailable_=b.getBoolPref("docs_spreadsheets_available");var c=Cc["@google.com/toolbar/application;1"].getService().wrappedJSObject;this.translateAvailable_=!c.GTB_GeckoVersion.isFirefox2();this.personalLayout_=b.getPref("autofill-personal-layout");this.addressLayout_=b.getPref("autofill-address-layout");this.phoneLayout_=
b.getPref("autofill-phone-layout");this.cardLayout_=b.getPref("autofill-creditcard-layout");this.expDateLayout_=b.getPref("autofill-expdate-layout")}
GTB_Options.LTR_IN_RTL_FIELDS_=[{id:"gtbOptionsAutoFillMonthYear"},{id:"gtbOptionsAutoFillProfileEmail"},{id:"gtbOptionsPhoneBox"},{id:"gtbOptionsFaxBox"},{id:"gtb-filetypes-doc",attrName:"class",attrValue:"checkbox-label"},{id:"gtb-filetypes-rtf",attrName:"class",attrValue:"checkbox-label"},{id:"gtb-filetypes-odt",attrName:"class",attrValue:"checkbox-label"},{id:"gtb-filetypes-sxw",attrName:"class",attrValue:"checkbox-label"},{id:"gtb-filetypes-xls",attrName:"class",attrValue:"checkbox-label"},{id:"gtb-filetypes-ppt",
attrName:"class",attrValue:"checkbox-label"},{id:"gtb-filetypes-ods",attrName:"class",attrValue:"checkbox-label"},{id:"gtb-filetypes-csv",attrName:"class",attrValue:"checkbox-label"}];GTB_Options.IMAGE_DECKS=["gtbOptionsBrowsingBookmarksImages","gtbOptionsBrowsingDocsSpreadsheetsImages","gtbOptionsBrowsingSpellImages","gtbOptionsTranslateImages"];GTB_Options.EditState={OPEN:0,CLOSE:1,DISABLED:2};
GTB_Options.AUTOFILL_PERSONAL_DATA_LAYOUT_MAP={firstName:"gtbFirstNameFieldContainer",middleName:"gtbMiddleNameFieldContainer",lastName:"gtbLastNameFieldContainer",email:"gtbEmailFieldContainer",company:"gtbCompanyFieldContainer"};GTB_Options.AUTOFILL_SADDRESS_LAYOUT_MAP={address1:"gtbSAddress1FieldContainer",address2:"gtbSAddress2FieldContainer",city:"gtbSCityFieldContainer",country:"gtbSCountryFieldContainer",zip:"gtbSZipFieldContainer",state:"gtbSStateFieldContainer"};
GTB_Options.AUTOFILL_BADDRESS_LAYOUT_MAP={address1:"gtbBAddress1FieldContainer",address2:"gtbBAddress2FieldContainer",city:"gtbBCityFieldContainer",country:"gtbBCountryFieldContainer",zip:"gtbBZipFieldContainer",state:"gtbBStateFieldContainer"};GTB_Options.AUTOFILL_PHONES_LAYOUT_MAP={country:"gtbOptionsPhoneBoxCountry",area:"gtbOptionsPhoneBoxArea",number:"gtbOptionsPhoneBoxNumber"};
GTB_Options.AUTOFILL_FAX_LAYOUT_MAP={country:"gtbOptionsAutoFillProfileFaxCountry",area:"gtbOptionsAutoFillProfileFaxArea",number:"gtbOptionsAutoFillProfileFaxNumber"};GTB_Options.AUTOFILL_CREDITCARD_LAYOUT_MAP={name:"gtbOptionsAutoFillCardNameRow",number:"gtbOptionsAutoFillCardNumberRow",exp:"gtbOptionsAutoFillExpDateRow",cvc:"gtbOptionsAutoFillCvcRow"};GTB_Options.AUTOFILL_EXP_DATE_LAYOUT_MAP={month:"gtbOptionsAutoFillCCExpMonth",sep:"gtbOptionsAutoFillCCExpSeparator",year:"gtbOptionsAutoFillCCExpYear"};
GTB_Options.prototype.populateGoogleHomeMenulist_=function(b){for(var c=b.getElementById("gtbOptionsSearchWhichGoogleList"),d=b.getElementById("gtbOptionsSearchWhichGooglePopup"),e=GTB_getGoogleHome(),f=0;f<GTB_GOOGLE_HOME_LIST.length;f++){var g=b.createElement("menuitem"),h=GTB_GOOGLE_HOME_LIST[f];g.setAttribute("value",h);var i=null;i=(i=GTB_GOOGLE_HOME_DICT[h].name)?i+" (."+GTB_GOOGLE_HOME_DICT[h].tld+")":h;g.setAttribute("label",i);d.appendChild(g)}c.value=e};
goog.exportSymbol("GTB_Options.prototype.populateGoogleHomeMenulist_",GTB_Options.prototype.populateGoogleHomeMenulist_);a=GTB_Options.prototype;
a.onLoad=function(b){this.optionsWindow_=b;this.setHeightTimer_=null;this.shutdownObserver=new G_ObserverServiceObserver("quit-application",BindToObject(this.onShutdown,this),true);this.instantApply_=(new G_Preferences).getPref("browser.preferences.instantApply");var c=b.document,d=c.documentElement,e=b.getComputedStyle(d,"");d.setAttribute("chromedir",e.direction);d.setAttribute("gtbPlatform",GetPlatformStr());var f=c.getAnonymousElementByAttribute(d,"pane","gtbOptionsMorePane");f=c.getAnonymousElementByAttribute(f,
"class","paneButtonIcon");f.src="chrome://google-toolbar/skin/options-search-"+e.direction+".png";if(2==GetPlatform()){e=d.getButton("cancel");e.hidden=false;e.setAttribute("icon","close");e.label=c.getElementById("gtbCloseLabel").value;e.accesskey=c.getElementById("gtbCloseAccessKey").value;c.getElementById("gtbPrefShareButton").addEventListener("change",BindToObject(this.fixOptionsDialogHeight_,this,b),false)}d.getButton("help").hidden=false;d.getButton("extra1").hidden=false;this.oldGoogleHome_=
GTB_getGoogleHome();this.oldLayout_=this.layouts_.getCurrentLayout();e=c.getElementById("gtbOptionsLayoutRadio");e.value=this.oldLayout_;this.loadEditPanels_(b);e=null;for(f=0;e=d.preferencePanes[f];++f)for(var g=null,h=0;g=e.preferenceElements[h];++h){this.updateDependentWidget(b,g);var i=d.preferencePanes[f].preferenceForElement(g);if(i.name.indexOf("button_option")!=-1){var j=i.name.replace(/.*button_option\./,"");GTB_buttonAvailableInLocale(j)||this.hideElement_(g,b)}if(i.name.indexOf("contenthandling.enabled")!=
-1)this.docsSpreadsheetsAvailable_||this.hideElement_(g,b)}c.getElementById("gtbOptionsKeepGoogle").style.display="none";d=Cc["@google.com/toolbar/application;1"].getService().wrappedJSObject;if(!d.GTB_GeckoVersion.isFirefox3()){d=c.getElementById("gtbOptionsNewTabFeature");this.hideElement_(d,b)}this.layoutAutoFillFields_(c);this.layoutRtlFields_(c);d=c.getElementById("gtbOptionsAutoFillPane");this.transplateGroupboxCaptionBackground_(d);if(Cc["@google.com/lang-detect;1"]==null){d=c.getElementById("gtbOptionsAutoPageTranslation");
d.style.display="none";c=c.getElementById("gtbOptionsAutoPageTranslationCaption");c.style.display="none"}this.customButtonOptions.onLoad(b);this.sharing.onLoad(b);this.updateSearchButtons(b,GTB_getGoogleHome());this.loadAutoFillOptions_(b);this.fixOptionsDialogHeight_(b);new G_Alarm(BindToObject(this.checkOpenToolsSettings_,this,b),0);this.readPageTranslationRules(b.document);this.readHoverTranslateUnderstandList(b.document)};
a.mineButton_=function(b){if(b&&b.tagName=="toolbarbutton"&&b.getAttribute("hidden")!="true")return b;for(b=b.firstChild;b;b=b.nextSibling){var c=this.mineButton_(b);if(c)return c}return null};
a.layoutAutoFillFields_=function(b){this.personalLayout_&&this.layoutFields_(b,this.personalLayout_,GTB_Options.AUTOFILL_PERSONAL_DATA_LAYOUT_MAP);if(this.addressLayout_){this.layoutFields_(b,this.addressLayout_,GTB_Options.AUTOFILL_SADDRESS_LAYOUT_MAP);this.layoutFields_(b,this.addressLayout_,GTB_Options.AUTOFILL_BADDRESS_LAYOUT_MAP)}if(this.phoneLayout_){this.layoutFields_(b,this.phoneLayout_,GTB_Options.AUTOFILL_PHONES_LAYOUT_MAP);this.layoutFields_(b,this.phoneLayout_,GTB_Options.AUTOFILL_FAX_LAYOUT_MAP)}this.cardLayout_&&
this.layoutFields_(b,this.cardLayout_,GTB_Options.AUTOFILL_CREDITCARD_LAYOUT_MAP);this.expDateLayout_&&this.layoutFields_(b,this.expDateLayout_,GTB_Options.AUTOFILL_EXP_DATE_LAYOUT_MAP)};
a.layoutRtlFields_=function(b){var c=this.mainWindow_.document.getElementById("gtbToolbar");c=c.getAttribute("chromedir");if(c=="rtl")for(c=0;c<GTB_Options.LTR_IN_RTL_FIELDS_.length;++c){var d=GTB_Options.LTR_IN_RTL_FIELDS_[c],e=b.getElementById(d.id);if(d.attrName)e=b.getAnonymousElementByAttribute(e,d.attrName,d.attrValue);e.style.direction="ltr";e.style.textAlign="right"}};
a.layoutFields_=function(b,c,d){c=c.split(/\s*,\s*/);for(var e in d)if(c.indexOf(e)<0)b.getElementById(d[e]).style.display="none";if(c.length>0){e=b.getElementById(d[c.pop()]);for(var f=e.parentNode,g=0;g<c.length;++g)f.insertBefore(b.getElementById(d[c[g]]),e)}};
a.transplateGroupboxCaptionBackground_=function(b){for(var c=b.getElementsByTagName("groupbox"),d=0;d<c.length;++d){var e=c[d].firstChild;if(e&&e.tagName=="caption")for(var f=e.parentNode;f&&f!=b.parentNode;f=f.parentNode){var g=this.optionsWindow_.getComputedStyle(f,"");if(g.backgroundColor&&g.backgroundColor!="transparent"){e.style.backgroundColor=g.backgroundColor;break}}}};
a.checkOpenToolsSettings_=function(b){if(b.arguments)for(var c=0;c<b.arguments.length;++c){var d=b.arguments[c];if(d){var e=d.gtbToolPaneId;if(e){this.openToolsSettings(e);return}if(e=d.gtbCallback){d=d.gtbCallbackArguments||[];e.apply(this,d)}}}};a.focusElement=function(b){(b=this.optionsWindow_.document.getElementById(b))&&b.focus()};
a.closeEditPanels_=function(){for(var b=this.stringBundle_.GetStringFromName("prop.gtb.options.edit"),c=this.optionsWindow_.document,d=0;d<GTB_Options.IMAGE_DECKS.length;++d){var e=c.getElementById(GTB_Options.IMAGE_DECKS[d]),f=c.getElementById(e.getAttribute("gtbEditLabel"));if(f){var g=c.getElementById(e.getAttribute("gtbEditPanel"));if(g)if(!g.hidden){e.setAttribute("selectedIndex",GTB_Options.EditState.OPEN);f.setAttribute("value",b);g.hidden=true}}}};
a.openToolsSettings=function(b){this.closeEditPanels_();var c=this.optionsWindow_.document;if(b=c.getElementById(b)){var d=c.getElementById(b.getAttribute("gtbEditLabel"));if(d)if(c=c.getElementById(b.getAttribute("gtbEditPanel"))){c.hidden=false;c=this.stringBundle_.GetStringFromName("prop.gtb.options.close");b.setAttribute("selectedIndex",GTB_Options.EditState.CLOSE);d.setAttribute("label",c);d.focus()}}};a.openCustomButtonEditor=function(b){this.openToolsSettings("gtbOptionsSearchPane");this.customButtonOptions.openEditorFor(b)};
a.fillLanguagesMenuPopup_=function(b,c){for(var d=b.ownerDocument,e=c||"",f=GTB_languages.all(),g,h=0;g=f[h];h++){var i=d.createElement("menuitem");i.setAttribute("id",e+g.google);i.setAttribute("value",g.google);i.setAttribute("label",g.capitalized);b.appendChild(i)}};
a.fillSearchLocaleList_=function(b){var c=b.getElementById("gtbOptionsSearchLocaleMenuPopup");this.fillLanguagesMenuPopup_(c,"gtbSearchLocale-");var d=GTB_languages.osLanguage();if(d){d=d.google;(d=b.getElementById("gtbSearchLocale-"+d))&&d!=c.childNodes[1]&&c.insertBefore(d,c.childNodes[1])}d=GTB_getLangCode();(d=b.getElementById("gtbSearchLocale-"+d))&&d!=c.childNodes[1]&&c.insertBefore(d,c.childNodes[1]);var e=GTB_getSearchLocale();d=b.getElementById("gtbOptionsSearchLocaleList");(e=b.getElementById("gtbSearchLocale-"+
e))||(e=b.getElementById("gtbSearchLocale-none"));for(b=0;b<c.childNodes.length;b++)c.childNodes[b].removeAttribute("selected");d.selectedItem=e};
a.loadEditPanels_=function(b){var c=b.document;this.populateGoogleHomeMenulist_(c);var d=c.getElementById("gtbOptionsTranslateTargetLangMenuPopup");this.fillLanguagesMenuPopup_(d,"");var e=GTB_HoverTranslate.getTargetLang()||GTB_languages.getDefault(),f=e.google;e=c.getElementById("gtbOptionsTranslateTargetLangMenulist");b=b.document.getElementById(f);for(f=0;f<d.childNodes.length;f++)d.childNodes[f].removeAttribute("selected");e.selectedItem=b;this.fillSearchLocaleList_(c);try{Cc["@google.com/fileassociation;1"].createInstance(Ci.GTBIFileAssociation)}catch(g){c=
c.getElementById("gtb-fileactions-associate");c.hidden=true}};a.loadAutoFillOptions_=function(b){this.autoFillOptions_=new GTB_AutoFillOptions(b);this.autoFillOptions_.loadOptions();goog.exportProperty(GTB_Options.prototype,"autoFillOptions_",this.autoFillOptions_)};a.hideElement_=function(b,c){var d=b;if(b.hasAttribute("gtbHideWidget"))d=c.document.getElementById(b.getAttribute("gtbHideWidget"));d.style.display="none"};
a.fixOptionsDialogHeight_=function(b){if(b.screenY<0)b.screenY=0;if(GetPlatform()==2){this.setHeightTimer_&&this.setHeightTimer_.clear();this.setHeightTimer_=new G_Alarm(BindToObject(this.setDialogHeight_,this,b),200)}};
a.setDialogHeight_=function(b){var c=b.document;this.setHeightTimer_=null;b.resizeTo(b.outerWidth,Math.min(b.screen.availHeight-23,600));this.toolsBoxHeight_=c.getElementById("gtbOptionsToolsGroupbox").boxObject.height;var d=c.getAnonymousElementByAttribute(c.documentElement,"class","paneDeckContainer");d=parseFloat(b.getComputedStyle(d,"").height);c.getElementById("gtbOptionsLayoutPaneBox").style.height=d-12+"px";c.getElementById("gtbOptionsSearchPaneBox").style.height=d-12+"px";var e=c.getElementById("gtbOptionsAutoFillUpperBox");
b=parseFloat(b.getComputedStyle(e,"").height);e=10;c.getElementById("gtbOptionsAutoFillTabbox").style.height=d-b-e-12+"px";c.getElementById("gtbOptionsSharePaneBox").style.height=d-12+"px"};
a.onEditToolOptions=function(b,c){var d=b.currentTarget.tagName.toLowerCase(),e=b.currentTarget.id,f;if(d=="label"){e=c.document.getElementById(e);d=c.document.getElementById(e.getAttribute("gtbEditImages"))}else{d=c.document.getElementById(e);e=c.document.getElementById(d.getAttribute("gtbEditLabel"))}f=c.document.getElementById(d.getAttribute("gtbEditPanel"));var g=d.getAttribute("selectedIndex");if(!(g&&g==GTB_Options.EditState.DISABLED)){g=this.stringBundle_.GetStringFromName("prop.gtb.options.edit");
var h=this.stringBundle_.GetStringFromName("prop.gtb.options.close");f.hidden=!f.hidden;if(f.hidden){d.setAttribute("selectedIndex",GTB_Options.EditState.OPEN);e.setAttribute("value",g)}else{d.setAttribute("selectedIndex",GTB_Options.EditState.CLOSE);e.setAttribute("value",h)}if(GetPlatform()==2)c.document.getElementById("gtbOptionsToolsGroupbox").style.height=""+this.toolsBoxHeight_+"px"}};goog.exportProperty(GTB_Options.prototype,"onEditToolOptions",GTB_Options.prototype.onEditToolOptions);
GTB_Options.prototype.onShowHideClick=function(b){var c=b.currentTarget.tagName.toLowerCase(),d=b.currentTarget.id;b=b.currentTarget.ownerDocument;if(c=="label"){d=b.getElementById(d);c=b.getElementById(d.getAttribute("gtbEditImages"))}else{c=b.getElementById(d);d=b.getElementById(c.getAttribute("gtbEditLabel"))}b=b.getElementById(c.getAttribute("gtbEditPanel"));var e=d.getAttribute(b.hidden?"value":"gtbShowValue"),f=d.getAttribute(b.hidden?"gtbHideValue":"value");b.hidden=!b.hidden;if(b.hidden){c.setAttribute("selectedIndex",
GTB_Options.EditState.OPEN);d.setAttribute("value",e);d.setAttribute("gtbHideValue",f);d.removeAttribute("gtbShowValue")}else{c.setAttribute("selectedIndex",GTB_Options.EditState.CLOSE);d.setAttribute("value",f);d.setAttribute("gtbShowValue",e);d.removeAttribute("gtbHideValue")}};goog.exportSymbol("GTB_Options.prototype.onShowHideClick",GTB_Options.prototype.onShowHideClick);
GTB_Options.prototype.onBeforeAccept=function(b){var c=b.document.getElementById("gtbOptionsLayoutRadio");this.oldLayout_!=c.value&&GTB_LayoutManager.setLayout(c.value);this.customButtonOptions.onBeforeAccept();this.sharing.onBeforeAccept();if(!this.instantApply_){c={};var d=new G_Preferences;b=b.document.documentElement;for(var e=null,f=0;e=b.preferencePanes[f];++f)if(e.id!="gtbOptionsSearchPane")for(var g,h=0;g=e.preferenceElements[h];++h){g=e.preferenceForElement(g);var i=d.getPref(g.name),j=g.value;
if(g.name.indexOf("button_option")>0&&i!=j)c[g.name.replace(/.*button_option\./,"")]=j}GTB_LayoutManager.updateButtonsToPrefs(c)}this.autoFillOptions_.saveOptions()};goog.exportProperty(GTB_Options.prototype,"onBeforeAccept",GTB_Options.prototype.onBeforeAccept);GTB_Options.prototype.onAfterAccept=function(){var b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);b.notifyObservers(null,"google-toolbar-customized",GTB_Options.OPTIONS_DIALOG_APPLIED)};
GTB_Options.prototype.onCancel=function(b){if(this.instantApply_){this.onBeforeAccept(b);this.onDialogAccept()}else{GTB_getGoogleHome()!=this.oldGoogleHome_&&this.updateSearchButtons(b,this.oldGoogleHome_);this.customButtonOptions.restoreRemovedButtons();this.customButtonOptions.restoreChangedButtons()}};goog.exportSymbol("GTB_Options.prototype.onCancel",GTB_Options.prototype.onCancel);
GTB_Options.prototype.setOptionsMenuList_=function(b,c){var d=b.getElementById("gtbOptionsSearchWhichGoogleList");d.value=c};GTB_Options.prototype.onDialogAccept=function(){this.layouts_.persistToolbars();new G_Alarm(BindToObject(this.onAfterAccept,this),0)};GTB_Options.prototype.onOptionButtonChanged=function(b,c){if(this.instantApply_){var d=c.target,e=b.getElementById(d.getAttribute("preference"));e=e.name.replace(/.*button_option\./,"");var f={};f[e]=d.checked;GTB_LayoutManager.updateButtonsToPrefs(f)}};
goog.exportProperty(GTB_Options.prototype,"onOptionButtonChanged",GTB_Options.prototype.onOptionButtonChanged);GTB_Options.prototype.onRestoreDefaults=function(b){b.openDialog("chrome://google-toolbar/content/restore-defaults.xul","gtbRestoreDefaults","modal,centerscreen,chrome,resizable=no",BindToObject(this.onRestoreDefaultsAccept,this))};goog.exportProperty(GTB_Options.prototype,"onRestoreDefaults",GTB_Options.prototype.onRestoreDefaults);
GTB_Options.prototype.onRestoreDefaultsAccept=function(b){var c=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;this.closeEditPanels_();for(var d=b.document.documentElement,e=new G_Preferences,f=null,g=0;f=d.preferencePanes[g];++g){for(var h=null,i=0;h=f.preferences[i];++i)if(this.hasDefault_(h)){if(AdvancedFeaturesDefaults[h.name]){var j=e.getPref(AdvancedFeaturesDefaults[h.name],null);goog.isNull(j)?GTB_resetPrefToLocaleDefault(h.name):e.setPref(h.name,j)}else{j=
h.name.split(".");if(j.length>0){j=j[j.length-1];if(c.getButton(j))continue}GTB_resetPrefToLocaleDefault(h.name)}h.value=GTB_getPrefWithLocaleDefault(h.name)}GTB_LayoutManager.restoreDefaultLayout();h=null;for(i=0;h=f.preferenceElements[i];++i)this.updateDependentWidget(b,h)}c=b.document.getElementById("gtbOptionsLayoutRadio");this.oldLayout_=c.value="classic";c=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);c.notifyObservers(null,"google-toolbar-options-restoredefaults",
null);this.updateSearchButtons(b,GTB_getGoogleHome());c.notifyObservers(null,"google-toolbar-customized",GTB_Options.OPTIONS_DIALOG_APPLIED)};GTB_Options.prototype.hasDefault_=function(b){return b.id!="gtbPrefSharePinnedProviders"};GTB_Options.prototype.onHelp=function(b){var c="http://www.google.com/tools/service/npredir?r=tb_hc_support_home&hl={LANG}".replace("{LANG}",GTB_getLangCode());b.open(c,"gtbOptionsDialogHelpWindow","width=800,height=600,resizable=yes,scrollbars=yes")};
GTB_Options.prototype.onCommand=function(b,c){if(b.originalTarget.tagName=="radio"){c.document.documentElement.getButton("help").hidden=false;GetPlatform()==2&&this.fixOptionsDialogHeight_(c)}};goog.exportSymbol("GTB_Options.prototype.onCommand",GTB_Options.prototype.onCommand);GTB_Options.prototype.updateSearchButtons=function(b,c){var d=new G_Preferences("google.toolbar.");d.setPref("google_home",c);this.setOptionsMenuList_(b.document,c)};
GTB_Options.prototype.updateGoogleHome=function(b){var c=b.document.getElementById("gtbOptionsSearchWhichGoogleList");this.updateSearchButtons(b,c.value)};goog.exportProperty(GTB_Options.prototype,"updateGoogleHome",GTB_Options.prototype.updateGoogleHome);GTB_Options.prototype.moreLink=function(b){GTB_Links.showMore(null,b)};GTB_Options.prototype.privacyLink=function(b){GTB_Links.showPrivacy(null,b)};goog.exportProperty(GTB_Options.prototype,"privacyLink",GTB_Options.prototype.privacyLink);
GTB_Options.prototype.subDialog=function(b,c,d){var e="chrome,titlebar,toolbar,centerscreen,modal,resizable=no";b?c.document.documentElement.openSubDialog(d,e,null):c.openDialog(d,"Google Toolbar Options Subdialog",e)};
GTB_Options.prototype.updateDependentWidget=function(b,c){var d=c.getAttribute("gtbDependentElement");if(d)if(d=b.document.getElementById(d))d.hidden=!c.checked;if(d=c.getAttribute("gtbDependentWidget")){d=b.document.getElementById(d);var e=b.document.getElementById(d.getAttribute("gtbEditLabel"));e.value=this.stringBundle_.GetStringFromName("prop.gtb.options.edit");if(c.checked){d.selectedIndex=GTB_Options.EditState.OPEN;e.setAttribute("gtbDisabled",false)}else{d.selectedIndex=GTB_Options.EditState.DISABLED;
e.setAttribute("gtbDisabled",true);if(d=d.getAttribute("gtbEditPanel"))b.document.getElementById(d).hidden=true}}};goog.exportSymbol("GTB_Options.prototype.updateDependentWidget",GTB_Options.prototype.updateDependentWidget);GTB_Options.prototype.setLabelFocusStyle=function(b,c,d){b=b.document.getElementById(c);b.style.margin=d?"0":"1px";b.style.border=d?"dotted 1px black":"none"};goog.exportProperty(GTB_Options.prototype,"setLabelFocusStyle",GTB_Options.prototype.setLabelFocusStyle);
GTB_Options.prototype.updateOnLabelClick=function(b,c){var d=b.document,e=d.getElementById(c);d=d.getElementById(e.getAttribute("preference"));e.focus();d.value=!e.checked;e.hasAttribute("oncommand")&&this.updateDependentWidget(b,e);if(this.instantApply_&&d.name.indexOf("button_option")>=0){e=d.name.replace(/.*button_option\./,"");var f={};f[e]=d.value;GTB_LayoutManager.updateButtonsToPrefs(f)}};goog.exportProperty(GTB_Options.prototype,"updateOnLabelClick",GTB_Options.prototype.updateOnLabelClick);
GTB_Options.prototype.readHoverTranslateUnderstandList=function(b){if(this.translateAvailable_){var c=b.getElementById("gtbPrefHoverTranslateUnderstandList").value;c=c?c.split(","):[];var d=b.getElementById("gtbPrefTranslateTargetLang").value,e=c.indexOf(d);e!=-1&&c.splice(e,1);c.splice(0,0,d);for(var f=b.getElementById("gtbOptionsHoverTranslateUnderstandList");f.childNodes.length>1;)f.removeChild(f.lastChild);for(e=0;d=GTB_languages.byGoogle(c[e]);e++){var g=b.createElement("richlistitem");g.value=
d.google;var h=b.createElement("label");h.setAttribute("value",d.capitalized);g.appendChild(h);f.appendChild(g)}for(f=b.getElementById("gtbOptionsHoverTranslateAddLanguageMenuPopup");f.childNodes.length>1;)f.removeChild(f.lastChild);g=GTB_languages.all();for(e=0;d=g[e];e++)if(c.indexOf(d.google)==-1){h=b.createElement("menuitem");h.setAttribute("label",d.capitalized);h.setAttribute("value",d.google);f.appendChild(h)}b=b.getElementById("gtbOptionsHoverTranslateAddLanguageMenulist");b.selectedIndex=
0}};goog.exportSymbol("GTB_Options.prototype.readHoverTranslateUnderstandList",GTB_Options.prototype.readHoverTranslateUnderstandList);
GTB_Options.prototype.readPageTranslationRules=function(b){for(var c=b.getElementById("gtbOptionsTranslationRuleList");c.hasChildNodes();)c.removeChild(c.firstChild);var d=this.stringBundle_,e=function(h,i){var j=[],k=b.getElementById(h).value;k=k?k.split(","):[];for(var l=0;l<k.length;l++){var m=k[l],n=null;if(GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS)n=GTB_PageTranslator.GOOGLE_TRANSLATE_LANGS[m];if(!n)try{n=d.GetStringFromName("prop.gtb.trans.options.language-pref."+GTB_PageTranslator.prototype.tc2ff_(m))}catch(o){}n&&
j.push({langCode:m,langName:n,type:i})}return j},f=e("gtbPrefAutoPageTranslationRulesWhitelist",GTB_Options.TRANSLATION_RULE_TYPE.WHITELIST);f=f.concat(e("gtbPrefAutoPageTranslationRulesBlacklist",GTB_Options.TRANSLATION_RULE_TYPE.BLACKLIST));b.getElementById("gtbOptionsAutoPageTranslateTargetContainer").hidden=f.length==0;goog.array.sortObjectsByKey(f,"langName");goog.array.map(f,function(h){var i=c.ownerDocument.createElement("listitem");i.value=h.langCode+":"+h.type;var j=h.type=="whitelist"?d.GetStringFromName("prop.gtb.trans.options.translate-automatically"):
d.GetStringFromName("prop.gtb.trans.options.never-offer");i.setAttribute("label",h.langName+": "+j);c.appendChild(i)});e=(e=b.getElementById("gtbPrefAutoPageTranslationRulesExceptSites").value)?e.split(","):[];for(f=0;f<e.length;++f){var g=e[f];c.appendItem(g+": Never translate this site",GTB_Options.TRANSLATION_RULE_TYPE.EXCEPTION+":"+g)}};goog.exportSymbol("GTB_Options.prototype.readPageTranslationRules",GTB_Options.prototype.readPageTranslationRules);
GTB_Options.TRANSLATION_RULE_TYPE={WHITELIST:"whitelist",BLACKLIST:"blacklist",EXCEPTION:"site"};GTB_Options.prototype.addUnderstandLanguage=function(b){var c=b.getElementById("gtbOptionsHoverTranslateAddLanguageMenulist");if(c.selectedIndex>0){c=c.selectedItem.value;b=b.getElementById("gtbPrefHoverTranslateUnderstandList");var d=b.value?b.value.split(","):[];d.indexOf(c)==-1&&d.push(c);b.value=d.join(",")}};goog.exportSymbol("GTB_Options.prototype.addUnderstandLanguage",GTB_Options.prototype.addUnderstandLanguage);
GTB_Options.prototype.removeUnderstandLanguage=function(b){var c=b.getElementById("gtbOptionsHoverTranslateUnderstandList");c=c.selectedItem.value;b=b.getElementById("gtbPrefHoverTranslateUnderstandList");var d=b.value?b.value.split(","):[];c=d.indexOf(c);c!=-1&&d.splice(c,1);b.value=d.join(",")};goog.exportSymbol("GTB_Options.prototype.removeUnderstandLanguage",GTB_Options.prototype.removeUnderstandLanguage);
GTB_Options.prototype.removeSelectedItems=function(b){var c=b.getElementById("gtbOptionsTranslationRuleList"),d={},e={},f={};c=c.selectedItems;for(var g=0;g<c.length;g++){var h=c[g].value.split(":"),i=h[0];h=h[1];if(i=="site")f[h]=true;else(h=="whitelist"?d:e)[i]=true}c=function(j,k){var l=b.getElementById(j),m=l.value?l.value.split(","):[];for(var n in k)goog.array.removeIf(m,function(o){return o==n});l.value=m.join(",")};c("gtbPrefAutoPageTranslationRulesWhitelist",d);c("gtbPrefAutoPageTranslationRulesBlacklist",
e);c("gtbPrefAutoPageTranslationRulesExceptSites",f)};goog.exportSymbol("GTB_Options.prototype.removeSelectedItems",GTB_Options.prototype.removeSelectedItems);GTB_Options.prototype.onShutdown=function(b,c){c=="quit-application"&&this.optionsWindow_&&this.optionsWindow_.close()};function GTB_SearchEngineService(){this.debugZone="SearchEngineService";this.checkedOnInit_=false;this.timer_=null;this.prefs_=new G_Preferences}GTB_SearchEngineService.KEYWORD_URL="keyword.URL";GTB_SearchEngineService.KEYWORD_ENABLED="keyword.enabled";GTB_SearchEngineService.SELECTED_ENGINE="browser.search.selectedEngine";GTB_SearchEngineService.DEFAULT_ENGINE_NAME="browser.search.defaultenginename";GTB_SearchEngineService.KEEP_DEFAULT_SEARCH="google.toolbar.keep_search_google";
GTB_SearchEngineService.REGEXP_SEARCH_GOOGLE_URL=/http:\/\/www\.google\..*\/search/i;GTB_SearchEngineService.REGEXP_CHROME_PROPERTIES_URL=/chrome:\/\/.*\.properties/i;GTB_SearchEngineService.isSettingEngine=false;GTB_SearchEngineService.searchEngineInstance=null;GTB_SearchEngineService.getInstance=function(){if(!GTB_SearchEngineService.searchEngineInstance)GTB_SearchEngineService.searchEngineInstance=new GTB_SearchEngineService;return GTB_SearchEngineService.searchEngineInstance};
GTB_SearchEngineService.isGoogleDefault_=function(){var b=Cc["@mozilla.org/browser/search-service;1"].getService(Ci.nsIBrowserSearchService);return b.currentEngine&&b.currentEngine.name=="Google"&&GTB_SearchEngineService.isGoogleKeywordSearch_()};
GTB_SearchEngineService.isGoogleKeywordSearch_=function(){var b=new G_Preferences;if(!b.getPref(GTB_SearchEngineService.KEYWORD_ENABLED,false))return true;if((b=b.getPref(GTB_SearchEngineService.KEYWORD_URL,null))&&b.search(GTB_SearchEngineService.REGEXP_CHROME_PROPERTIES_URL)==0){b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle(b);b=b.GetStringFromName(GTB_SearchEngineService.KEYWORD_URL)}return b&&b.search(GTB_SearchEngineService.REGEXP_SEARCH_GOOGLE_URL)==
0};
GTB_SearchEngineService.makeGoogleDefaultSearch=function(){GTB_SearchEngineService.isSettingEngine=true;var b=new G_Preferences,c=Cc["@mozilla.org/browser/search-service;1"].getService(Ci.nsIBrowserSearchService),d=c.currentEngine;if(!d||d.name!="Google"){if(d=c.getEngineByName("Google")){if(d.hidden)d.hidden=false}else{(d=b.getPref("google.toolbar.search-icon",""))||(d="chrome://google-toolbar/skin/favicon-default.png");c.addEngineWithDetails("Google",d,"","Google Search","GET","http://www.google.com/search");d=
c.getEngineByName("Google");d.addParam("q","{searchTerms}",null);d.addParam("hl",GTB_getLangCode(),null)}c.currentEngine=d;(new GTB_FFSearchBox).setInstallEvent()}(c=b.getPref(GTB_SearchEngineService.DEFAULT_ENGINE_NAME,""))&&c!="Google"&&b.setPref(GTB_SearchEngineService.DEFAULT_ENGINE_NAME,"Google");c=b.getPref(GTB_SearchEngineService.KEYWORD_URL,"");if(!b.getPref(GTB_SearchEngineService.KEYWORD_ENABLED,true)||!c||c.search(GTB_SearchEngineService.REGEXP_SEARCH_GOOGLE_URL)!=0){b.setPref(GTB_SearchEngineService.KEYWORD_URL,
"http://www.google.com/search?sourceid=navclient&hl="+GTB_getLangCode()+"&q=");b.setPref(GTB_SearchEngineService.KEYWORD_ENABLED,true)}b.setPref(GTB_SearchEngineService.KEEP_DEFAULT_SEARCH,true);GTB_SearchEngineService.isSettingEngine=false};GTB_SearchEngineService.prototype.onPrefChange_=function(){if(!GTB_SearchEngineService.isSettingEngine){var b=this.prefs_.getPref(GTB_SearchEngineService.KEEP_DEFAULT_SEARCH,true);b&&this.askToSetGoogleSearchEngine_()}};
GTB_SearchEngineService.prototype.onKeepGoogleChange_=function(){this.prefs_.getPref(GTB_SearchEngineService.KEEP_DEFAULT_SEARCH,false)&&GTB_SearchEngineService.makeGoogleDefaultSearch()};GTB_SearchEngineService.prototype.init=function(){};goog.exportSymbol("GTB_SearchEngineService.prototype.init",GTB_SearchEngineService.prototype.init);GTB_SearchEngineService.prototype.tearDown=function(){};goog.exportSymbol("GTB_SearchEngineService.prototype.tearDown",GTB_SearchEngineService.prototype.tearDown);
GTB_SearchEngineService.prototype.onSearchMenuPopupShowing_=function(){GTB_SearchEngineService.isSettingEngine=true};GTB_SearchEngineService.prototype.onSearchMenuPopupHidden_=function(){GTB_SearchEngineService.isSettingEngine=false};GTB_SearchEngineService.prototype.checkGoogleDefaultOnInit=function(){};goog.exportSymbol("GTB_SearchEngineService.prototype.checkGoogleDefaultOnInit",GTB_SearchEngineService.prototype.checkGoogleDefaultOnInit);
GTB_SearchEngineService.prototype.askToSetGoogleSearchEngine_=function(){if(!GTB_SearchEngineService.isGoogleDefault_()){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator),c=b.getMostRecentWindow("navigator:browser");b=c.GTB_getToolbar()._getCurrentBrowser();c=c.document.getElementById("content");b=c.getNotificationBox(b);c="Your search engine settings have been changed. Use Google as a default search engine";var d={label:"OK",accessKey:"O",callback:GTB_SearchEngineService.makeGoogleDefaultSearch},
e={label:"Cancel",accessKey:"C",callback:BindToObject(this.stopKeepingGoogleAsDefault_,this)};this.closeNotification_(b,"GoogleToolbarDefaultSearchMessage");b.appendNotification(c,"GoogleToolbarDefaultSearchMessage","chrome://google-toolbar/skin/search.png",b.PRIORITY_INFO_HIGH,[d,e]);this.timer_=new G_Alarm(BindToObject(this.closeNotification_,this,b,"GoogleToolbarDefaultSearchMessage"),15E3)}};
GTB_SearchEngineService.prototype.closeNotification_=function(b,c){var d=b&&b.getNotificationWithValue&&b.getNotificationWithValue(c);d&&b.removeNotification(d);this.timer_=null};GTB_SearchEngineService.prototype.stopKeepingGoogleAsDefault_=function(){this.prefs_.setPref(GTB_SearchEngineService.KEEP_DEFAULT_SEARCH,false)};function GTB_Settings(b,c){this.debugZone="settings";this.win_=b;this.toolbar_=c;this.gaia_=new GTB_GaiaSettings(b);this.gaiaService_=Cc["@google.com/toolbar/gaia-service;1"].getService().wrappedJSObject}
function GTB_OpenOptionsWindow(b,c,d){var e=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator),f=e.getMostRecentWindow("GoogleToolbar:Options");if(f){b=f;var g=e.getEnumerator("");for(e=[];g.hasMoreElements();)e.push(g.getNext());b=b;a:for(;;)b:{for(g=0;g<e.length;g++){var h=e[g];if(h.opener==b){b=h;break b}}break a}e=b;try{f.opener.focus()}catch(i){}try{f.focus()}catch(j){}try{e.focus()}catch(k){}c=f.document.getElementById(c);f.document.documentElement.showPane(c);d&&
f.processOptionalArg(d)}else b.openDialog("chrome://google-toolbar/content/options.xul","Google Toolbar Options","chrome,titlebar,toolbar,centerscreen,modal,resizable=no",c,new GTB_Options(b),d)}GTB_Settings.prototype.getGaiaSettings=function(){return this.gaia_};
GTB_Settings.prototype.shutdown=function(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator),c=b.getMostRecentWindow("GoogleToolbar:Uninstall");if(c)(b=b.getMostRecentWindow("navigator:browser"))||c.close();this.gaia_.shutdown()};GTB_Settings.prototype.onGaia=function(b){b.eventPhase==Ci.nsIDOMEvent.BUBBLING_PHASE&&b.target.id!="gtbSignings"||this.gaia_.handleMenuitemClick()};goog.exportProperty(GTB_Settings.prototype,"onGaia",GTB_Settings.prototype.onGaia);
GTB_Settings.prototype.onOptions=function(b){b.eventPhase==Ci.nsIDOMEvent.BUBBLING_PHASE&&b.currentTarget.id=="gtbChevronMenugtbSettings"||b.currentTarget.id!="gtbSettings"&&b.currentTarget.id!="gtbOptions"&&b.currentTarget.id!="gtbOptionsCompact"||GTB_OpenOptionsWindow(this.win_,"gtbOptionsMorePane")};goog.exportProperty(GTB_Settings.prototype,"onOptions",GTB_Settings.prototype.onOptions);GTB_Settings.prototype.onToolbarSync=function(b){b.stopPropagation();this.gaiaService_.toggleToolbarSync()};
goog.exportProperty(GTB_Settings.prototype,"onToolbarSync",GTB_Settings.prototype.onToolbarSync);GTB_Settings.prototype.onRefreshSync=function(b){b.stopPropagation();this.gaiaService_.doRefreshSync()};goog.exportProperty(GTB_Settings.prototype,"onRefreshSync",GTB_Settings.prototype.onRefreshSync);GTB_Settings.prototype.onHelp=function(b){var c="http://www.google.com/tools/service/npredir?r=tb_hc_support_home&hl={LANG}".replace("{LANG}",GTB_getLangCode());this.toolbar_.loadUrlWithModifiers(c,b)};
goog.exportProperty(GTB_Settings.prototype,"onHelp",GTB_Settings.prototype.onHelp);GTB_Settings.prototype.onPrivacy=function(){GTB_Links.showPrivacy(this.win_,"usage")};goog.exportProperty(GTB_Settings.prototype,"onPrivacy",GTB_Settings.prototype.onPrivacy);GTB_Settings.prototype.onUninstall=function(){GTB_ShowUninstallDialog(this.win_)};goog.exportProperty(GTB_Settings.prototype,"onUninstall",GTB_Settings.prototype.onUninstall);
GTB_Settings.prototype.onAbout=function(){this.win_.openDialog("chrome://google-toolbar/content/about.xul","gtbAbout","modal,centerscreen,chrome,resizable=no",GTB_localizeLogo)};goog.exportProperty(GTB_Settings.prototype,"onAbout",GTB_Settings.prototype.onAbout);
GTB_Settings.prototype.onOptionsMenupopup=function(b){var c=Cc["@mozilla.org/extensions/manager;1"].getService(Ci.nsIExtensionManager);try{var d=c.getInstallLocation("{3112ca9c-de6d-4884-a869-9855de68056c}"),e=d.canAccess,f=d.name,g=this.win_.document,h=g.getElementById(b);h.disabled=!e&&!f.startsWith("winreg")}catch(i){}};goog.exportProperty(GTB_Settings.prototype,"onOptionsMenupopup",GTB_Settings.prototype.onOptionsMenupopup);
GTB_Settings.prototype.onSigningMenupopup=function(){this.toolbar_.webhistoryManager.updateUI();this.onOptionsMenupopup("gtbOptionsUninstallMenuCompact")};goog.exportProperty(GTB_Settings.prototype,"onSigningMenupopup",GTB_Settings.prototype.onSigningMenupopup);function GTB_ToolbarContextMenuController(b,c,d){this.gtb_=b;this.doc_=c;this.win_=d;this.cbService_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);this.stringBundle_=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");Cc["@google.com/autotranslate;1"]||(this.BUTTON_PARAMETERS.gtbTranslate.toolParam={gtbCallback:GTB_Options.prototype.focusElement,gtbCallbackArguments:["gtbOptionsTranslateMenuCheckbox"]})}
GTB_ToolbarContextMenuController.prototype.debugZone="GTB_ToolbarContextMenuController";
GTB_ToolbarContextMenuController.prototype.BUTTON_PARAMETERS={gtbGoogleMenu:{paneId:"gtbOptionsMorePane"},gtbSearchButton:{paneId:"gtbOptionsMorePane"},gtbBookmarks:{paneId:"gtbOptionsFeaturesPane",toolParam:{gtbToolPaneId:"gtbOptionsBrowsingBookmarksImages"}},gtbPageRank:{paneId:"gtbOptionsFeaturesPane",toolParam:{gtbCallback:GTB_Options.prototype.focusElement,gtbCallbackArguments:["gtbOptionsMorePageRankCheckbox"]}},gtbSpellCheck:{paneId:"gtbOptionsFeaturesPane",toolParam:{gtbToolPaneId:"gtbOptionsBrowsingSpellImages"}},
gtbTranslate:{paneId:"gtbOptionsFeaturesPane",toolParam:{gtbToolPaneId:"gtbOptionsTranslateImages"}},gtbAutoFill:{paneId:"gtbOptionsAutoFillPane"},gtbGoUp:{paneId:"gtbOptionsMorePane",toolParam:{gtbCallback:GTB_Options.prototype.focusElement,gtbCallbackArguments:["gtbOptionsMoreUpCheckbox"]}},gtbShare:{paneId:"gtbOptionsSharingPane"},gtbHighlight:{paneId:"gtbOptionsMorePane",toolParam:{gtbCallback:GTB_Options.prototype.focusElement,gtbCallbackArguments:["gtbOptionsMoreHighlightCheckbox"]}},gtbSidewiki:{paneId:"gtbOptionsFeaturesPane",
toolParam:{gtbToolPaneId:"gtbOptionsBrowsingSidewikiImages"}},gtbFindTerms:{paneId:"gtbOptionsMorePane",toolParam:{gtbCallback:GTB_Options.prototype.focusElement,gtbCallbackArguments:["gtbOptionsMoreWordFindCheckbox"]}}};GTB_ToolbarContextMenuController.prototype.ALWAYS_VISIBLE_BUTTONS={gtbSettings:true,gtbSignings:true,gtbGoogleMenu:true,gtbSearchButton:true};
GTB_ToolbarContextMenuController.prototype.handlePopupShowing=function(){this.doc_.getElementById("gtbToolbarContext");var b=this.doc_.popupNode,c=this.getNodeId_(b),d=null;if(c=="gtbFindTerms")d=this.stringBundle_.GetStringFromName("gtb.contextMenu.findWordsOptions");else if(c=="gtbShare"){d=this.doc_.getElementById("gtbSharePopupButton");d=this.stringBundle_.formatStringFromName("gtb.contextMenu.showFeatureOptions",[d.label],1)}else d=this.BUTTON_PARAMETERS[c]?this.stringBundle_.formatStringFromName("gtb.contextMenu.showFeatureOptions",
[b.label],1):this.cbService_.getButton(c)?this.stringBundle_.formatStringFromName("gtb.contextMenu.customButtonOptions",[b.label],1):this.stringBundle_.GetStringFromName("gtb.contextMenu.googleToolbarOptions");b=this.doc_.getElementById("gtbButtonOptionsItem");b.label=d;c=this.BUTTON_PARAMETERS[c]&&!this.ALWAYS_VISIBLE_BUTTONS[c]||this.cbService_.getButton(c);b=this.doc_.getElementById("gtbHideButtonItem");b.hidden=!c};
goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handlePopupShowing",GTB_ToolbarContextMenuController.prototype.handlePopupShowing);GTB_ToolbarContextMenuController.prototype.handleGetMoreButtons=function(b){var c=GTB_CB_Options.getButtonGalleryUrl();this.gtb_.loadUrlWithModifiers(c,b)};goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handleGetMoreButtons",GTB_ToolbarContextMenuController.prototype.handleGetMoreButtons);
GTB_ToolbarContextMenuController.prototype.handleHideButton=function(){var b=this.doc_.popupNode,c=this.getNodeId_(b);if(c=="gtbShare"&&b.hasAttribute(GTB_SharingManager.PROVIDER_ID_ATTRIBUTE)){b=b.getAttribute(GTB_SharingManager.PROVIDER_ID_ATTRIBUTE);this.gtb_.sharing.handleHideServiceCommand(b)}else GTB_LayoutManager.hideOneButton(c)};goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handleHideButton",GTB_ToolbarContextMenuController.prototype.handleHideButton);
GTB_ToolbarContextMenuController.prototype.handleShowButton=function(b){(b=b.target.value)&&GTB_LayoutManager.showOneButton(b)};goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handleShowButton",GTB_ToolbarContextMenuController.prototype.handleShowButton);
GTB_ToolbarContextMenuController.prototype.handleButtonOptions=function(){var b=null,c="gtbOptionsMorePane",d=this.getNodeId_(this.doc_.popupNode),e=this.BUTTON_PARAMETERS[d];if(e){c=e.paneId;b=e.toolParam}else if(e=this.cbService_.getButton(d)){c="gtbOptionsSearchPane";b={gtbCallback:GTB_Options.prototype.openCustomButtonEditor,gtbCallbackArguments:[d]}}GTB_OpenOptionsWindow(this.win_,c,b)};goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handleButtonOptions",GTB_ToolbarContextMenuController.prototype.handleButtonOptions);
GTB_ToolbarContextMenuController.prototype.handleTextLevelPopupShowing=function(b){var c=GTB_GlobalPrefs.getPref("google.toolbar.button_text_level");b=b.target;for(b=b.firstChild;b;b=b.nextSibling)b.setAttribute("checked",b.value==c)};goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handleTextLevelPopupShowing",GTB_ToolbarContextMenuController.prototype.handleTextLevelPopupShowing);
GTB_ToolbarContextMenuController.prototype.handleButtonTextLevel=function(b){b=b.target.value;GTB_GlobalPrefs.setPref("google.toolbar.button_text_level",b)};goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handleButtonTextLevel",GTB_ToolbarContextMenuController.prototype.handleButtonTextLevel);
GTB_ToolbarContextMenuController.prototype.handleShowButtonMenuShowing=function(){for(var b=this.doc_.getElementById("gtbShowButtonMenuPopup"),c=false,d=null,e=b.lastChild;e;e=e.previousSibling){var f=e.value;if(f){var g="google.toolbar.button_option."+f;f=GTB_GlobalPrefs.getPref(g,false)||!GTB_buttonAvailableInLocale(f);e.hidden=f;if(!f){if(d){d.hidden=false;d=null}c=true}}else if(e.nodeName=="menuseparator"){e.hidden=true;if(c)d=e}if(e.id=="gtbFeatureItemsTopSeparator")break}for(;b.firstChild&&
b.firstChild.id!="gtbFeatureItemsTopSeparator";)b.removeChild(b.firstChild);c=b.firstChild;f=this.cbService_.getAllButtons();for(var h in f){e=f[h];if(!(e.isVisible()||e.isSearchTypeWithoutButton())){e=this.createMenuItem_(h,e.getName(),e.getIcon());b.insertBefore(e,c);if(d){d.hidden=false;d=null}}}};goog.exportProperty(GTB_ToolbarContextMenuController.prototype,"handleShowButtonMenuShowing",GTB_ToolbarContextMenuController.prototype.handleShowButtonMenuShowing);
GTB_ToolbarContextMenuController.prototype.createMenuItem_=function(b,c,d){var e=this.doc_.createElement("menuitem");e.setAttribute("class","menuitem-iconic");e.setAttribute("label",c);e.setAttribute("value",b);e.setAttribute("image",d);return e};GTB_ToolbarContextMenuController.prototype.getNodeId_=function(b){b=b.id||"";if(b=="gtbBookmarksMenu")return"gtbBookmarks";if(b.startsWith("gtbFindTerm"))return"gtbFindTerms";if(b.startsWith("gtbShare"))return"gtbShare";return b};var GTB_NT_KNOWN_DEFAULTS=["BtUOXLMuIKRUq7oSdDntSJ42Keo=","suAKo4qNilL+FK6ejwhzxIgNtWQ=","2LCPDaz3+mqQICoXUeDEAjUOIqE="];
function GTB_NewTabFeature(b){this.debugZone="newtab";this.document_=b;b=this.getFirefoxGlobalContext_();this.ownHandler_=BindToObject(this.browserOpenTab_,this);this.originalHandler_=b.BrowserOpenTab;GTB_NewTabFeature.checkForConflicts(b.BrowserOpenTab);b.BrowserOpenTab=this.ownHandler_;b.gBrowser.removeEventListener("NewTab",this.originalHandler_,false);b.gBrowser.addEventListener("NewTab",this.ownHandler_,false);if(b=this.getUrlBar_())this.unhookUrlBar_=this.hookUrlBar_(b);this.prefs_=new G_Preferences("google.toolbar.")}
GTB_NewTabFeature.isActive=function(b){return GTB_GeckoVersion.isFirefox3()&&(new G_Preferences("google.toolbar.")).getPref("newtab")&&b&&GTB_isGoogleToolbarActive(b)};GTB_NewTabFeature.isOwnPage=function(b){b=b.split("?")[0];return b=="chrome://google-toolbar/content/new-tab.html"||b=="toolbar:newtab"};
GTB_NewTabFeature.checkForConflicts=function(b){var c=new G_Preferences("google.toolbar."),d=c.getPref("newtab-hash",""),e=d?d.split(","):[],f=GTB_NewTabFeature.hash(b);b=false;for(d=0;d<GTB_NT_KNOWN_DEFAULTS.length;++d)if(f==GTB_NT_KNOWN_DEFAULTS[d]){b=true;break}var g=false;if(!b)if(e.indexOf(f)>=0)g=b=true;else{e.push(f);d=e.join(",");c.setPref("newtab-hash",d)}if(b){e=(d=c.getPref("newtab-extension",""))?d.split(","):[];d=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;
d=d.getPref("newtab_conflicts");f=!d?[]:d.split(/\s*,\s*/);var h=Cc["@mozilla.org/extensions/manager;1"].getService(Ci.nsIExtensionManager);for(d=0;d<f.length;++d){var i=!!h.getItemForID(f[d])&&!GTB_NewTabFeature.isDisabled(h,f[d]);if(i&&e.indexOf(f[d])<0){b=g;e.push(f[d])}}if(!b){d=e.join(",");c.setPref("newtab-extension",d)}}b||c.setPref("newtab",false)};
GTB_NewTabFeature.hash=function(b){var c=GTB_StringToUTF8(b.toSource());b=Cc["@mozilla.org/security/hash;1"].createInstance(Ci.nsICryptoHash);b.init(Ci.nsICryptoHash.SHA1);b.update(c,c.length);c=true;return b.finish(c)};GTB_NewTabFeature.getItemProperty=function(b,c,d){var e=Cc["@mozilla.org/rdf/rdf-service;1"].getService(Ci.nsIRDFService);if(c=e.GetResource("urn:mozilla:item:"+c)){d=e.GetResource("http://www.mozilla.org/2004/em-rdf#"+d);return(b=b.datasource.GetTarget(c,d,true))&&b.QueryInterface(Ci.nsIRDFLiteral).Value}return null};
GTB_NewTabFeature.isDisabled=function(b,c){var d=GTB_NewTabFeature.getItemProperty(b,c,"isDisabled");return"true"==d};a=GTB_NewTabFeature.prototype;
a.hookUrlBar_=function(b){function c(g){if(g===this.__googleToolbarData__.valueToHide){this.__googleToolbarData__.overlayedValue=g;g=""}else delete this.__googleToolbarData__.overlayedValue;return this.__googleToolbarData__.originalSetter.call(this,g)}function d(){var g=this.__googleToolbarData__.originalGetter.call(this);return g===""&&"overlayedValue"in this.__googleToolbarData__?this.__googleToolbarData__.overlayedValue:g}function e(){b.__defineSetter__("value",f.originalSetter);b.__defineGetter__("value",
f.originalGetter)}var f={valueToHide:"chrome://google-toolbar/content/new-tab.html"};f.originalGetter=b.__lookupGetter__("value");f.originalSetter=b.__lookupSetter__("value");b.__googleToolbarData__=f;b.__defineSetter__("value",c);b.__defineGetter__("value",d);return e};
a.shutdown=function(){this.unhookUrlBar_&&this.unhookUrlBar_();var b=this.getFirefoxGlobalContext_();b.gBrowser.removeEventListener("NewTab",this.ownHandler_,false);b.gBrowser.addEventListener("NewTab",this.originalHandler_,false);b.BrowserOpenTab=this.originalHandler_;this.document_=null};a.getBrowser_=function(){return this.document_.defaultView.gBrowser};a.getUrlBar_=function(){return this.document_.defaultView.gURLBar};a.getFirefoxGlobalContext_=function(){return this.document_.defaultView};
a.browserOpenTab_=function(){if(GTB_NewTabFeature.isActive(this.document_)){var b=this.getBrowser_(),c=b.addTab("about:blank"),d=b.getBrowserForTab(c),e=Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_HISTORY;d.loadURIWithFlags("chrome://google-toolbar/content/new-tab.html",e,null,null);b.selectedTab=c;(b=this.getUrlBar_())&&b.focus()}else this.originalHandler_.call(this.getFirefoxGlobalContext_())};function GTB_NewTabBookmraks(b){this.bookmarksService_=Cc["@google.com/toolbar/bookmarks;1"].getService().wrappedJSObject;this.newTabService_=b;b=Cc["@mozilla.org/browser/nav-bookmarks-service;1"].getService(Ci.nsINavBookmarksService);b.addObserver(this,false);this.livemarkService_=Cc["@mozilla.org/browser/livemark-service;2"].getService(Ci.nsILivemarkService);this.googleBookmarksObserver_=new G_ObserverServiceObserver("GTB_BOOKMARKS_UPDATE_UI",BindToObject(this.handleGoogleBookmarksChange_,this))}
GTB_NewTabBookmraks.prototype.debugZone="GTB_NewTabBookmraks";GTB_NewTabBookmraks.MAX_BOOKMARKS=9;a=GTB_NewTabBookmraks.prototype;a.getBookmarks=function(){var b=this.bookmarksService_.mapBookmarks(GTB_NewTabBookmraks.gtbBookmarkToNewTabData);this.getFirefoxBookmarks_(b);b.sort(GTB_NewTabBookmraks.isNewer);if(b.length>GTB_NewTabBookmraks.MAX_BOOKMARKS)b.length=GTB_NewTabBookmraks.MAX_BOOKMARKS;return b};
a.getFirefoxBookmarks_=function(b){Cc["@mozilla.org/browser/nav-history-service;1"]&&Cc["@mozilla.org/browser/nav-bookmarks-service;1"]&&Cc["@mozilla.org/browser/livemark-service;2"]&&this.getFirefox3Bookmarks_(b)};
a.getFirefox3Bookmarks_=function(b){var c=Cc["@mozilla.org/browser/nav-bookmarks-service;1"].getService(Ci.nsINavBookmarksService),d=Cc["@mozilla.org/browser/nav-history-service;1"].getService(Ci.nsINavHistoryService),e=d.getNewQuery();e.setFolders([c.placesRoot],1);c=d.executeQuery(e,d.getNewQueryOptions()).root;this.getFirefox3BookmarksFromFolder_(c,b)};
a.getFirefox3BookmarksFromFolder_=function(b,c){b.QueryInterface(Ci.nsINavHistoryContainerResultNode);b.containerOpen=true;for(var d=0;d<b.childCount;++d){var e=b.getChild(d);if(e.type==Ci.nsINavHistoryResultNode.RESULT_TYPE_URI&&e.itemId!=-1&&GTB_LooksLikeUrl(e.uri)){var f=e.time||e.dateAdded;f=Math.floor(f/1E3);var g=e.icon;if(typeof g!="string")g=g&&g.spec;c.push(GTB_NewTabBookmraks.createBookmarkData_(e.title,e.uri,g,f))}else this.isFolder_(e)&&e.uri.indexOf("folder=TAGS")==-1&&this.getFirefox3BookmarksFromFolder_(e,
c)}b.containerOpen=false};a.isFolder_=function(b){return b.type==Ci.nsINavHistoryResultNode.RESULT_TYPE_FOLDER&&!this.livemarkService_.isLivemark(b.itemId)};a.QueryInterface=function(b){if(b.equals(Ci.nsINavBookmarkObserver)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};a.onBeginUpdateBatch=function(){};a.onEndUpdateBatch=function(){this.handleFirefox3BookmarksChange_("onEndUpdateBatch",null)};
a.onItemAdded=function(b){this.handleFirefox3BookmarksChange_("add",b)};a.onItemChanged=function(b){this.handleFirefox3BookmarksChange_("changed",b)};a.onItemMoved=function(){};a.onBeforeItemRemoved=function(){};a.onItemRemoved=function(b){this.handleFirefox3BookmarksChange_("removed",b)};a.onItemVisited=function(b){this.handleFirefox3BookmarksChange_("visited",b)};a.handleFirefox3BookmarksChange_=function(){this.newTabService_.onBookmarksChanged()};a.handleGoogleBookmarksChange_=function(){this.newTabService_.onBookmarksChanged()};
GTB_NewTabBookmraks.gtbBookmarkToNewTabData=function(b){return GTB_NewTabBookmraks.createBookmarkData_(b.getTitle(),b.getUrl(),b.getFaviconUrl(),b.getTimestamp())};GTB_NewTabBookmraks.createBookmarkData_=function(b,c,d,e){return{title:b,url:c,iconUrl:d,timestamp:e}};GTB_NewTabBookmraks.isNewer=function(b,c){return c.timestamp-b.timestamp};function GTB_ClosedTabs(){this.sessionStore_=Cc["@mozilla.org/browser/sessionstore;1"].getService(Ci.nsISessionStore);this.purgeHistoryObserver_=null;this.viewRegistry_=[]}GTB_ClosedTabs.prototype.debugZone="GTB_ClosedTabs";GTB_ClosedTabs.MAX_ENTRIES=3;a=GTB_ClosedTabs.prototype;a.getClosedTabs=function(b){this.registerView_(b);return this.collectData_(b)};
a.unregisterView=function(b){for(var c=null,d=0;d<this.viewRegistry_.length;++d)if(this.viewRegistry_[d].window==b){c=this.viewRegistry_[d];this.viewRegistry_.splice(d,1);break}if(c){b=this.contentToChromeWindow_(b);b.removeEventListener("TabOpen",c.eventHandler,true);b.removeEventListener("TabClose",c.eventHandler,true);if(this.viewRegistry_.length==0)this.purgeHistoryObserver_=null}};
a.registerView_=function(b){for(var c=0;c<this.viewRegistry_.length;++c)if(this.viewRegistry_[c].window==b)return;c={window:b};this.viewRegistry_.push(c);var d=this.contentToChromeWindow_(b);if(!this.purgeHistoryObserver_){var e=BindToObject(this.onPurgeHistory_,this);this.purgeHistoryObserver_=new G_ObserverServiceObserver("browser:purge-session-history",e)}c.eventHandler=BindToObject(this.onTabEvent_,this,b);d.addEventListener("TabOpen",c.eventHandler,true);d.addEventListener("TabClose",c.eventHandler,
true)};a.collectData_=function(b){var c=[];b=this.contentToChromeWindow_(b);if(!b)return c;b=eval("("+this.sessionStore_.getClosedTabData(b)+")");for(var d=0;d<b.length&&c.length<GTB_ClosedTabs.MAX_ENTRIES;d++){var e=b[d].state,f=e.entries;e=e.index-1;e=f[e].url;if(!GTB_NewTabFeature.isOwnPage(e)||f.length>1)c.push({title:b[d].title,url:e,iconUrl:b[d].image,index:d})}return c};a.onPurgeHistory_=function(){new G_Alarm(BindToObject(this.updateAllPages_,this),0)};
a.updateAllPages_=function(){for(var b=0;b<this.viewRegistry_.length;++b)this.updateOnePage_(this.viewRegistry_[b].window)};a.onTabEvent_=function(b){b=this.contentToChromeWindow_(b);new G_Alarm(BindToObject(this.updatePagesInWindow_,this,b),0)};a.updatePagesInWindow_=function(b){for(var c=0;c<this.viewRegistry_.length;++c){var d=this.contentToChromeWindow_(this.viewRegistry_[c].window);d==b&&this.updateOnePage_(this.viewRegistry_[c].window)}};a.updateOnePage_=function(b){b.recentlyClosedTabs(this.collectData_(b))};
a.undoCloseTab=function(b,c){var d=this.contentToChromeWindow_(b);this.sessionStore_.undoCloseTab(d,c);var e=d.getBrowser();d=e.getBrowserIndexForDocument(b.document);var f=e.mTabs[d];d=e.getBrowserForTab(f);var g=Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_HISTORY;d.loadURIWithFlags("about:blank",g,null,null);new G_Alarm(function(){e.removeTab(f)},0)};a.contentToChromeWindow_=function(b){try{return GTB_getChromeWindow(b)}catch(c){return null}};function GTB_NewTabMostVisited(){}GTB_NewTabMostVisited.prototype.debugZone="GTB_NewTabMostVisited";
GTB_NewTabMostVisited.getHistory=function(b){var c=Cc["@mozilla.org/browser/nav-history-service;1"].getService(Ci.nsINavHistoryService),d=c.getNewQueryOptions();d.sortingMode=Ci.nsINavHistoryQueryOptions.SORT_BY_VISITCOUNT_DESCENDING;d.maxResults=b;d.queryType=Ci.nsINavHistoryQueryOptions.QUERY_TYPE_HISTORY;d.resultType=Ci.nsINavHistoryQueryOptions.RESULTS_AS_URI;b=c.getNewQuery();return c.executeQuery(b,d).root};
GTB_NewTabMostVisited.prototype.getMostVisitedPages=function(b){function c(){this.results=[];this.lastVisitTime=this.totalVisitCount=0;this.firstResultWithThumbnail=null;this.name=""}for(var d=this.getBrowserHistory_(100),e={},f=0;f<d.length;++f){var g=d[f];if(!GTB_NewTabFeature.isOwnPage(g.url)){var h=this.getSegmentName(g.url);if(h){var i=e[h]||new c;i.results.push(g);i.totalVisitCount+=g.visitCount;i.lastVisitTime=Math.max(g.lastVisitTime,i.lastVisitTime||g.lastVisitTime);i.name=h;if(!i.firstResultWithThumbnail&&
g.hasThumbnail)i.firstResultWithThumbnail=g;e[h]=i}}}f=Date.now();g=[];for(h in e){i=e[h];i.score=this.calcSegmentScore_(f-i.lastVisitTime,i.totalVisitCount);g.push(i)}g.sort(GTB_NewTabMostVisited.compareSegmentsByScore_);for(f=d.length=0;f<g.length&&d.length<9;f++){e=g[f].firstResultWithThumbnail||g[f].results[0];h=b&&b.document;this.isInNoShowList_(g[f].name,h)||d.push(e)}this.attachThumbnails_(d);return d};
GTB_NewTabMostVisited.prototype.getSegmentName=function(b){var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);try{var d=c.newURI(b,null,null)}catch(e){return""}return this.computeSegmentName_(d)};GTB_NewTabMostVisited.prototype.isInNoShowList_=function(b,c){if(c&&c.tempNoshowList&&c.tempNoshowList[b])return true;return!!GTB_NewTabService.instance.getNoshowList()[b]};
GTB_NewTabMostVisited.compareSegmentsByScore_=function(b,c){return c.firstResultWithThumbnail&&!b.firstResultWithThumbnail?1:!c.firstResultWithThumbnail&&b.firstResultWithThumbnail?-1:c.score-b.score};GTB_NewTabMostVisited.prototype.calcSegmentScore_=function(b,c){var d=b/864E5,e=1+Math.log(c);d=d<1?3:d<7?2:d<21?1.5:1;return e*d};GTB_NewTabMostVisited.prototype.computeSegmentName_=function(b){try{var c=b.host.toLowerCase().replace(/^www\./,""),d=b.scheme;return d+"://"+c}catch(e){return b.spec}};
GTB_NewTabMostVisited.prototype.attachThumbnails_=function(b){for(var c=new GTB_ThumbnailProvider,d=0;d<b.length;d++)b[d].thumbnailUrl=c.getBase64Encoded(b[d].url)};
GTB_NewTabMostVisited.prototype.getBrowserHistory_=function(b){var c=new GTB_ThumbnailProvider,d=new GTB_NewTabSecurityManager.BanChecker;b=GTB_NewTabMostVisited.getHistory(b);b.containerOpen=true;for(var e=[],f=0;f<b.childCount;f++){var g=b.getChild(f);if(!d.isBanned(g.uri)){var h=g.icon;if(typeof h!="string")h=h&&h.spec;e.push({url:g.uri,title:g.title,iconUrl:h,visitCount:g.accessCount,lastVisitTime:g.time/1E3,hasThumbnail:c.hasThumbnail(g.uri)})}}return e};function GTB_NewTabPage(b){this.win_=b;this.doc_=b.document;this.service_=GTB_NewTabService.instance;this.dirtyMostVisited_=false;this.undoTimer_=null;this.unprocessedData_={mostVisitedPages:false,searchURLs:false,recentlyBookmarked:false,recentlyClosedTabs:false}}GTB_NewTabPage.prototype.debugZone="GTB_NewTabPage";GTB_NewTabPage.DEFAULT_THUMBNAIL_URL="chrome://google-toolbar/skin/thumbnail-default.png";GTB_NewTabPage.DEFAULT_FAVICON_URL="chrome://google-toolbar/skin/favicon-default.png";
GTB_NewTabPage.prototype.handleWindowResize=function(){var b=this.doc_.body;if(!(!b||b.clientWidth<10))if(b.className=="small"&&b.clientWidth>=885)b.className="";else if(b.className==""&&b.clientWidth<=865)b.className="small"};goog.exportSymbol("GTB_NewTabPage.prototype.handleWindowResize",GTB_NewTabPage.prototype.handleWindowResize);
GTB_NewTabPage.prototype.processData=function(){var b=this.doc_.getElementById("main"),c=b.className;b.className="";if(this.unprocessedData_.mostVisitedPages){this.renderMostVisitedPages(this.unprocessedData_.mostVisitedPages);this.unprocessedData_.mostVisitedPages=false}if(this.unprocessedData_.recentlyBookmarked){this.renderRecentlyBookmarked(this.unprocessedData_.recentlyBookmarked);this.unprocessedData_.recentlyBookmarked=false}if(this.unprocessedData_.recentlyClosedTabs){this.renderRecentlyClosedTabs(this.unprocessedData_.recentlyClosedTabs);
this.unprocessedData_.recentlyClosedTabs=false}b.className=c};goog.exportSymbol("GTB_NewTabPage.prototype.processData",GTB_NewTabPage.prototype.processData);a=GTB_NewTabPage.prototype;a.mostVisitedPages=function(b){this.win_.logEvent("received most visited pages");this.unprocessedData_.mostVisitedPages=b;this.processData()};a.searchURLs=function(b){this.win_.logEvent("received search URLs");this.unprocessedData_.searchURLs=b;this.processData()};
a.recentlyBookmarked=function(b){this.win_.logEvent("received recently bookmarked data");this.unprocessedData_.recentlyBookmarked=b;this.processData()};a.recentlyClosedTabs=function(b){this.win_.logEvent("received recently closed tabs");this.unprocessedData_.recentlyClosedTabs=b;this.processData()};
a.renderMostVisitedPages=function(b){this.win_.logEvent("renderMostVisitedPages called: "+b.length);var c=this.reCreateTable("mostvisitedtable");if(0==b.length)this.doc_.getElementById("mostvisitedintro").style.display="block";else{this.doc_.getElementById("mostvisitedintro").style.display="none";this.fillTable(c,b);this.win_.logEvent("renderMostVisitedPages done")}};
a.renderRecentlyBookmarked=function(b){this.win_.logEvent("renderRecentlyBookmarked called: "+b.length);var c=this.doc_.getElementById("recentlyBookmarked"),d=this.doc_.getElementById("recentlyBookmarkedContainer");c.style.display="none";d.innerHTML="";if(b.length>0){c.style.display="block";c=0;for(var e=b[0];e=b[c];++c){var f=this.DOM("a",{href:e.url,className:"recent-bookmark",title:e.title,id:"gtbNtRecentBookmark"+c});f.setAttribute("onclick","logIdOf(event.currentTarget);");f.appendChild(this.makeTitleDOM(e.title,
e.iconUrl,c));d.appendChild(f)}}this.win_.logEvent("renderRecentlyBookmarked done")};
a.renderRecentlyClosedTabs=function(b){this.win_.logEvent("renderRecentlyClosedTabs begin");var c=this.doc_.getElementById("recentlyClosedTabs"),d=this.doc_.getElementById("recentlyClosedContainer");c.style.display="none";d.innerHTML="";if(b.length>0){c.style.display="block";c=0;for(var e;e=b[c];++c){var f=this.DOM("a",{href:e.url,onclick:BindToObject(this.handleRecentlyClosedLinkClick,this),className:"recent-bookmark",title:e.title,id:"gtbNtRecentlyClosed"+c});f.setAttribute("gtbEntryIndex",e.index);
f.appendChild(this.makeTitleDOM(e.title,e.iconUrl,c));d.appendChild(f)}}this.win_.logEvent("renderRecentlyClosedTabs done")};a.handleRecentlyClosedLinkClick=function(b){this.win_.logIdOf(b.currentTarget);var c=b.currentTarget.getAttribute("gtbEntryIndex");this.service_.undoCloseTab(this.win_,c);b.preventDefault()};goog.exportSymbol("GTB_NewTabPage.prototype.handleRecentlyClosedLinkClick",GTB_NewTabPage.prototype.handleRecentlyClosedLinkClick);
GTB_NewTabPage.prototype.handleEditThumbnails=function(){this.hideUndoEditing();this.enterEditMode()};goog.exportSymbol("GTB_NewTabPage.prototype.handleEditThumbnails",GTB_NewTabPage.prototype.handleEditThumbnails);GTB_NewTabPage.prototype.handleRestoreThumbnails=function(){this.exitEditMode();this.service_.clearMarkedItems(this.doc_);this.service_.deleteNoShowList(false);this.dirtyMostVisited_=false};goog.exportSymbol("GTB_NewTabPage.prototype.handleRestoreThumbnails",GTB_NewTabPage.prototype.handleRestoreThumbnails);
GTB_NewTabPage.prototype.enterEditMode=function(){this.doc_.getElementById("main").className="edit-mode"};GTB_NewTabPage.prototype.exitEditMode=function(){this.doc_.getElementById("main").className=""};
GTB_NewTabPage.prototype.handleDoneEditing=function(){this.exitEditMode();this.service_.markNoShowListDone(this.doc_);if(this.dirtyMostVisited_){this.service_.writeNoShowList();this.doc_.getElementById("undosaved").style.display="inline";this.undoTimer_=this.win_.setTimeout(BindToObject(this.hideUndoEditing,this),6E4)}this.dirtyMostVisited_=false};goog.exportSymbol("GTB_NewTabPage.prototype.handleDoneEditing",GTB_NewTabPage.prototype.handleDoneEditing);
GTB_NewTabPage.prototype.handleCancelEditing=function(){this.exitEditMode();this.service_.clearMarkedItems(this.doc_);this.service_.onMostVisitedChanged();this.dirtyMostVisited_=false};goog.exportSymbol("GTB_NewTabPage.prototype.handleCancelEditing",GTB_NewTabPage.prototype.handleCancelEditing);GTB_NewTabPage.prototype.hideUndoEditing=function(){if(this.undoTimer_){this.win_.clearTimeout(this.undoTimer_);this.undoTimer_=null}this.doc_.getElementById("undosaved").style.display="none";this.service_.clearUndoFlags(this.doc_)};
GTB_NewTabPage.prototype.handleUndoEditing=function(){this.service_.clearMarkedItems(this.doc_);this.service_.onMostVisitedChanged();this.hideUndoEditing();this.service_.writeNoShowList()};goog.exportSymbol("GTB_NewTabPage.prototype.handleUndoEditing",GTB_NewTabPage.prototype.handleUndoEditing);GTB_NewTabPage.prototype.inEditMode=function(){return this.doc_.getElementById("main").className=="edit-mode"};goog.exportSymbol("GTB_NewTabPage.prototype.inEditMode",GTB_NewTabPage.prototype.inEditMode);
GTB_NewTabPage.prototype.handleDeleteThumbnail=function(b,c){this.exitEditMode();this.service_.addNoShowSegment(b,this.doc_,c);this.service_.onMostVisitedChanged();this.enterEditMode();this.dirtyMostVisited_=true};goog.exportSymbol("GTB_NewTabPage.prototype.handleDeleteThumbnail",GTB_NewTabPage.prototype.handleDeleteThumbnail);GTB_NewTabPage.prototype.handleShowHistory=function(){var b=GTB_getChromeWindow(this.win_);"PlacesCommandHook"in b&&b.PlacesCommandHook.showPlacesOrganizer("History")};
goog.exportSymbol("GTB_NewTabPage.prototype.handleShowHistory",GTB_NewTabPage.prototype.handleShowHistory);a=GTB_NewTabPage.prototype;a.handleShowSettings=function(){GTB_OpenOptionsWindow(GTB_getChromeWindow(this.win_),"gtbOptionsMorePane",{gtbCallback:GTB_Options.prototype.focusElement,gtbCallbackArguments:["gtbOptionsNewTabCheckbox"]})};a.DOM=function(b,c){var d=this.doc_.createElement(b);for(var e in c)d[e]=c[e];return d};
a.makeTitleDOM=function(b,c,d){var e=this.DOM("div",{className:"item-title"}),f=this.DOM("img",{className:"favicon"});f.setAttribute("src",GTB_NewTabPage.DEFAULT_FAVICON_URL);if(c){var g=function(i){i.status==200&&f.setAttribute("src",c)},h=function(){var i=GTB_convertToUrl(c);if(i&&i.asciiHost){i=new G_NoAuthXMLFetcher;i.get(c,g)}else f.setAttribute("src",c)};this.win_.setTimeout(h,d*10)}d=this.DOM("div",{className:"favicon-box"});d.appendChild(f);e.appendChild(d);d=this.DOM("div",{className:"item-title-text"});
if(b)d.appendChild(this.doc_.createTextNode(b));else d.innerHTML="&nbsp;";e.appendChild(d);return e};
a.makeMostVisitedDOM=function(b,c){var d;if(b.url){d=this.DOM("a",{href:b.url,className:"most-visited-item",title:b.title,id:"gtbNtMostVisited"+c});d.setAttribute("onclick","logIdOf(event.currentTarget); if (page.inEditMode()) { event.preventDefault(); }")}else d=this.DOM("span");var e=this.DOM("img",{className:"thumbnail"});e.setAttribute("onload","logEvent('image loaded');");e.src=b.thumbnailUrl||GTB_NewTabPage.DEFAULT_THUMBNAIL_URL;var f=this.makeTitleDOM(b.title,b.iconUrl,c);d.appendChild(f);
d.appendChild(e);d.appendChild(this.createOverlappingPicture(c));return d};a.createOverlappingPicture=function(b){b=this.DOM("div",{id:"gtbNtDeleteMostVisited"+b,className:"edit-cross"});b.setAttribute("onclick","event.preventDefault(); logIdOf(event.currentTarget); page.handleDeleteThumbnail(this.parentNode, event.shiftKey);");return b};a.reCreateTable=function(b){var c=this.doc_.getElementById(b),d=c.parentNode;b=this.DOM("table",{id:b});d.replaceChild(b,c);return b};
a.fillTable=function(b,c){for(var d=[],e=-1,f=0,g;g=c[f];++f){if(f%3==0){e+=1;d[e]=this.DOM("tr")}var h=this.makeMostVisitedDOM(g,f);g=this.DOM("div",{className:"pos-relative"});g.appendChild(h);h=this.DOM("td");h.appendChild(g);d[e].appendChild(h);this.win_.logEvent("mostVisitedPage : "+f)}if(c.length<3)for(f=c.length;f<3;++f)d[0].appendChild(this.DOM("td",{className:"empty-cell"}));for(f=0;e=d[f];f++)b.appendChild(e)};function GTB_ToolbarProtocolHandler(){this.scheme="toolbar";this.defaultPort=-1;this.protocolFlags=Ci.nsIProtocolHandler.URI_NORELATIVE|Ci.nsIProtocolHandler.URI_NOAUTH}GTB_ToolbarProtocolHandler.prototype.allowPort=function(){return false};GTB_ToolbarProtocolHandler.prototype.newURI=function(b,c,d){if(d)return d;c=Cc["@mozilla.org/network/simple-uri;1"].createInstance(Ci.nsIURI);c.spec=b;return c};
GTB_ToolbarProtocolHandler.prototype.newChannel=function(b){var c=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);if((c=c.getMostRecentWindow("navigator:browser"))&&GTB_NewTabFeature.isActive(c.document)&&GTB_NewTabFeature.isOwnPage(b.spec)){c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);c=c.newChannel("chrome://google-toolbar/content/new-tab.html",null,null);c.originalURI=b;return c}else throw Cr.NS_ERROR_MALFORMED_URI;};
GTB_ToolbarProtocolHandler.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIProtocolHandler)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};function GTB_NewTabSecurityManager(){var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT);this.annotationService_=Cc["@mozilla.org/browser/annotation-service;1"].getService(Ci.nsIAnnotationService)}GTB_NewTabSecurityManager.BAN_ANNOTATION_ID="google-toolbar/security-ban";a=GTB_NewTabSecurityManager.prototype;a.debugZone="GTB_NewTabSecurityManager";
a.shutdown=function(){var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.removeProgressListener(this)};a.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsIInterfaceRequestor)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};
a.onStateChange=function(b,c,d){if(d&Ci.nsIWebProgressListener.STATE_TRANSFERRING&&d&Ci.nsIWebProgressListener.STATE_IS_DOCUMENT){var e=b.DOMWindow.document,f;a:{f=e;var g=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);for(g=g.getEnumerator("navigator:browser");g.hasMoreElements();){var h=g.getNext();h=h.gBrowser;for(var i=0;i<h.browsers.length;++i){var j=h.getBrowserAtIndex(i).currentURI;if(j&&f.URL==j.spec){f=true;break a}}}f=false}if(!f)(e=GTB_convertToUrl(e.URL))&&
!this.hasMark_(e)&&this.setMark_(e,true)}if(d&Ci.nsIWebProgressListener.STATE_START)if((b=b.QueryInterface(Ci.nsIDocShell).loadType)||b&Ci.nsIDocShell.LOAD_CMD_NORMAL)if(e=this.getRequestURL_(c)){c=b>>16;if(c==Ci.nsIWebNavigation.LOAD_FLAGS_STOP_CONTENT||c==Ci.nsIWebNavigation.LOAD_FLAGS_REPLACE_HISTORY)this.hasMark_(e)||this.setMark_(e,true);else if(c==Ci.nsIWebNavigation.LOAD_FLAGS_NONE||c==Ci.nsIWebNavigation.LOAD_FLAGS_IS_LINK)if(!this.hasMark_(e)||this.getMark_(e))this.setMark_(e,false)}};
a.getRequestURL_=function(b){var c;try{c=b.QueryInterface(Ci.nsIHttpChannel)}catch(d){return null}return c.URI};a.setMark_=function(b,c){this.annotationService_.setPageAnnotation(b,GTB_NewTabSecurityManager.BAN_ANNOTATION_ID,c,0,Ci.nsIAnnotationService.EXPIRE_MONTHS)};a.getMark_=function(b){return!!this.annotationService_.getPageAnnotation(b,GTB_NewTabSecurityManager.BAN_ANNOTATION_ID)};a.hasMark_=function(b){return this.annotationService_.pageHasAnnotation(b,GTB_NewTabSecurityManager.BAN_ANNOTATION_ID)};
GTB_NewTabSecurityManager.BanChecker=function(){this.annotationService_=Cc["@mozilla.org/browser/annotation-service;1"].getService(Ci.nsIAnnotationService);this.ios_=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService)};
GTB_NewTabSecurityManager.BanChecker.prototype.isBanned=function(b){try{var c=this.ios_.newURI(b,null,null)}catch(d){return false}return this.annotationService_.pageHasAnnotation(c,GTB_NewTabSecurityManager.BAN_ANNOTATION_ID)&&!!this.annotationService_.getPageAnnotation(c,GTB_NewTabSecurityManager.BAN_ANNOTATION_ID)};function GTB_HistoryObserver(){this.historyService_=Cc["@mozilla.org/browser/nav-history-service;1"].getService(Ci.nsIBrowserHistory)}a=GTB_HistoryObserver.prototype;a.QueryInterface=function(b){if(b.equals(Ci.nsINavHistoryObserver)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};a.onBeforeDeleteURI=function(){};a.onBeginUpdateBatch=function(){};a.onClearHistory=function(){};a.onDeleteURI=function(){};a.onEndUpdateBatch=function(){};a.onPageChanged=function(){};
a.onPageExpired=function(){};a.onTitleChanged=function(){};a.onVisit=function(b){b.scheme=="toolbar"&&this.historyService_.removePage(b)};
function GTB_NewTabService(){this.instances_=[];this.bookmarkProvider_=new GTB_NewTabBookmraks(this);this.closedTabsProvider_=new GTB_ClosedTabs;this.mostvisitedProvider_=new GTB_NewTabMostVisited;new G_ObserverServiceObserver("browser:purge-session-history",BindToObject(this.deleteNoShowList,this,true));this.vacuumFlag_=false;new G_ObserverServiceObserver("xpcom-shutdown",BindToObject(this.shutdown_,this));this.securityManager_=new GTB_NewTabSecurityManager;var b=Cc["@mozilla.org/browser/nav-history-service;1"].getService(Ci.nsINavHistoryService);
b.addObserver(new GTB_HistoryObserver,false);this.wrappedJSObject=this}GTB_NewTabService.prototype.debugZone="GTB_NewTabService";GTB_NewTabService.GTB_NOSHOW_FILENAME="newtablist.xml";a=GTB_NewTabService.prototype;a.setVacuumFlag=function(){this.vacuumFlag_=true};a.shutdown_=function(){this.securityManager_.shutdown();this.compactPlacesDatabase_()};a.getNoshowList=function(){this.noshowList_||this.readNoShowList_();return this.noshowList_};
a.compactPlacesDatabase_=function(){if(this.vacuumFlag_){var b=Cc["@mozilla.org/storage/service;1"].getService(Ci.mozIStorageService),c=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties);try{var d=c.get("ProfD",Ci.nsIFile);d.append("places.sqlite");var e=b.openDatabase(d);e.executeSimpleSQL("vacuum;");e.close()}catch(f){}}};
a.readNoShowList_=function(){this.noshowList_={};var b=GTB_getDataDir();b.append(GTB_NewTabService.GTB_NOSHOW_FILENAME);if(!(!b.exists()||b.isDirectory())){var c;try{c=G_FirefoxXMLUtils.loadXML(b)}catch(d){return}if(c){b=c.documentElement.getElementsByTagName("mostvisited");var e;for(c=0;e=b[c];++c){var f=e.getElementsByTagName("segmentname");if(!(!f||f.length!=1)){e=f[0].firstChild.nodeValue;f=f[0].getAttribute("norestore");this.noshowList_[e]={norestore:!!f}}}}}};
a.clearNoShowList=function(b){if(b||!this.noshowList_)this.noshowList_={};else for(var c in this.noshowList_)this.noshowList_[c].norestore||delete this.noshowList_[c];this.writeNoShowList()};a.noShowListLength=function(){return this.noshowList_?this.noshowList_.__count__:0};
a.writeNoShowList=function(){var b=GTB_getDataDir();GTB_ensureDirectoryExists(b);b.append(GTB_NewTabService.GTB_NOSHOW_FILENAME);if(this.noShowListLength()==0)try{b.remove(true)}catch(c){}else{var d=G_FirefoxXMLUtils.newXML(),e=d.createElement("newtablist");for(var f in this.noshowList_){var g=d.createElement("mostvisited"),h=d.createElement("segmentname"),i=d.createTextNode(f);h.appendChild(i);if(this.noshowList_[f].norestore){i=d.createAttribute("norestore");i.nodeValue="1";h.setAttributeNode(i)}g.appendChild(h);
e.appendChild(g)}d.appendChild(e);e=Cc["@mozilla.org/network/file-output-stream;1"].createInstance(Ci.nsIFileOutputStream);e.init(b,G_File.PR_WRONLY|G_File.PR_CREATE_FILE|G_File.PR_TRUNCATE,-1,0);b=Cc["@mozilla.org/xmlextras/xmlserializer;1"].createInstance(Ci.nsIDOMSerializer);b.serializeToStream(d.documentElement,e,"UTF-8");e.close()}};a.deleteNoShowList=function(b){this.clearNoShowList(b);this.onMostVisitedChanged()};
a.markNoShowListDone=function(b){var c=this.getNoshowList();for(var d in b.tempNoshowList)c[d]=b.tempNoshowList[d]};a.clearUndoFlags=function(b){b.tempNoshowList={}};a.clearMarkedItems=function(b){var c=this.getNoshowList();for(var d in b.tempNoshowList)delete c[d];b.tempNoshowList={}};a.addNoShowSegment=function(b,c,d){b=this.mostvisitedProvider_.getSegmentName(b.href);c.tempNoshowList[b]={norestore:!!d}};
a.registerNewTabInstance=function(b){this.instances_.push(b);try{var c=this.bookmarkProvider_.getBookmarks();b.recentlyBookmarked(c)}catch(d){}try{var e=this.closedTabsProvider_.getClosedTabs(b);b.recentlyClosedTabs(e)}catch(f){}try{var g=this.mostvisitedProvider_.getMostVisitedPages(b);b.mostVisitedPages(g)}catch(h){}};goog.exportSymbol("GTB_NewTabService.prototype.registerNewTabInstance",GTB_NewTabService.prototype.registerNewTabInstance);
GTB_NewTabService.prototype.getMostVisitedHosts=function(){for(var b=[],c=this.mostvisitedProvider_.getMostVisitedPages(null),d,e=0;d=c[e];e++)(d=(d=GTB_convertToUrl(d.url))&&d.asciiHost)&&b.push(d);return b};goog.exportSymbol("GTB_NewTabService.prototype.getMostVisitedHosts",GTB_NewTabService.prototype.getMostVisitedHosts);GTB_NewTabService.prototype.undoCloseTab=function(b,c){this.closedTabsProvider_.undoCloseTab(b,c)};
GTB_NewTabService.prototype.unregisterNewTabInstance=function(b){var c=this.instances_.indexOf(b);if(c!=-1){this.instances_.splice(c,1);this.closedTabsProvider_.unregisterView(b)}};goog.exportSymbol("GTB_NewTabService.prototype.unregisterNewTabInstance",GTB_NewTabService.prototype.unregisterNewTabInstance);GTB_NewTabService.prototype.onBookmarksChanged=function(){if(this.instances_.length!=0)for(var b=this.bookmarkProvider_.getBookmarks(),c=0;c<this.instances_.length;c++)this.instances_[c].recentlyBookmarked(b)};
GTB_NewTabService.prototype.onMostVisitedChanged=function(){if(this.instances_.length!=0)for(var b=0;b<this.instances_.length;b++){var c=this.instances_[b],d=this.mostvisitedProvider_.getMostVisitedPages(c);c.mostVisitedPages(d)}};GTB_NewTabService.instance=null;goog.exportSymbol("GTB_NewTabService.instance",GTB_NewTabService.instance);function GTB_ThumbnailGrabber(b){this.tabbrowser_=b;this.onPageLoadBound_=null;this.annotationService_=Cc["@mozilla.org/browser/annotation-service;1"].getService(Ci.nsIAnnotationService);this.historyService_=Cc["@mozilla.org/browser/nav-history-service;1"].getService(Ci.nsIGlobalHistory2);this.ioService_=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);this.prefs_=new G_Preferences("google.toolbar.");this.checkPreferenceBound_=BindToObject(this.checkPreference_,this);this.prefs_.addObserver(GTB_ThumbnailGrabber.PREF_ENABLE,
this.checkPreferenceBound_);this.prefs_.addObserver(GTB_ThumbnailGrabber.PREF_WORK_INVISIBLE,this.checkPreferenceBound_);this.active_=false;this.checkPreference_();this.cleanAlarm_=null;this.interval_=Number(this.prefs_.getPref("thumbnail.interval",GTB_ThumbnailGrabber.THUMBNAIL_CLEAR_INTERVAL));this.batch_=Number(this.prefs_.getPref("thumbnail.batch",GTB_ThumbnailGrabber.THUMBNAIL_BATCH_NUMBER));this.delay_=Number(this.prefs_.getPref("thumbnail.delay",GTB_ThumbnailGrabber.THUMBNAIL_DELAY));this.limit_=
Number(this.prefs_.getPref("thumbnail.limit",GTB_ThumbnailGrabber.THUMBNAIL_LIMIT));this.vacuumCounter_=Number(this.prefs_.getPref("thumbnail.vacuum-counter",GTB_ThumbnailGrabber.THUMBNAIL_VACUUM_COUNTER))}GTB_ThumbnailGrabber.PREF_WORK_INVISIBLE="work_when_invisible";GTB_ThumbnailGrabber.PREF_ENABLE="newtab";GTB_ThumbnailGrabber.THUMBNAIL_WIDTH=196;GTB_ThumbnailGrabber.THUMBNAIL_HEIGHT=136;GTB_ThumbnailGrabber.THUMBNAIL_GRAB_INTERVALS=[1,5,25,125];GTB_ThumbnailGrabber.THUMBNAIL_CLEAR_INTERVAL=1E3;
GTB_ThumbnailGrabber.THUMBNAIL_BATCH_NUMBER=10;GTB_ThumbnailGrabber.THUMBNAIL_DELAY=100;GTB_ThumbnailGrabber.THUMBNAIL_VACUUM_COUNTER=1;GTB_ThumbnailGrabber.THUMBNAIL_LIMIT=100;GTB_ThumbnailGrabber.prototype.debugZone="GTB_ThumbnailGrabber";GTB_ThumbnailGrabber.prototype.shutdown=function(){this.prefs_.removeObserver("newtab",this.checkPreferenceBound_);this.active_&&this.deactivate_();this.cleanAlarm_&&this.cleanAlarm_.cancel()};GTB_ThumbnailGrabber.prototype.onToolbarVisibilityChanged=function(){this.checkPreference_()};
goog.exportSymbol("GTB_ThumbnailGrabber.prototype.onToolbarVisibilityChanged",GTB_ThumbnailGrabber.prototype.onToolbarVisibilityChanged);a=GTB_ThumbnailGrabber.prototype;a.checkPreference_=function(){var b=this.prefs_.getPref(GTB_ThumbnailGrabber.PREF_ENABLE)&&GTB_isGoogleToolbarActive(this.tabbrowser_.ownerDocument);if(!this.active_&&b)this.activate_();else this.active_&&!b&&this.deactivate_()};
a.activate_=function(){var b=this.tabbrowser_.mTabBox;this.onPageLoadBound_=GTB_AddEventListener(b,"load",this.onPageLoad_,this);this.active_=true};a.deactivate_=function(){var b=this.tabbrowser_.mTabBox;b.removeEventListener("load",this.onPageLoadBound_,true);this.onPageLoadBound_=null;this.active_=false};a.doesThumbnailExist_=function(b){return this.annotationService_.pageHasAnnotation(b,"google-toolbar/thumbnail")};
a.onPageLoad_=function(b){try{b.target.QueryInterface(Ci.nsIDOMHTMLDocument)}catch(c){return}b=b.target.defaultView;if(b.top==b){var d=b.document.documentURIObject;if(this.historyService_.isVisited(d)){b.setTimeout(BindToObject(this.clearUnusedThumbnails_,this),0);var e=this.getBestThumbnailScore_(d),f=GTB_ThumbnailGrabber.THUMBNAIL_GRAB_INTERVALS[0]*1E3;b.setTimeout(BindToObject(this.doGrabThumbnail_,this,b,d,1,e),f)}}};
a.clearUnusedThumbnails_=function(){var b=this.prefs_.getPref("thumbnail.clearing",0);if(++b<this.interval_)this.prefs_.setPref("thumbnail.clearing",b);else{this.prefs_.setPref("thumbnail.clearing",0);b=GTB_NewTabMostVisited.getHistory(0);b.containerOpen=true;var c=b.childCount;b.containerOpen=false;this.cleanAlarm_&&this.cleanAlarm_.cancel();if(this.limit_<c)this.cleanAlarm_=new G_Alarm(BindToObject(this.clearThumbnails_,this,b,this.limit_,c),this.delay_)}};
a.clearThumbnails_=function(b,c,d){var e=c+this.batch_;if(e>d)e=d;b.containerOpen=true;for(c=c;c<e;c++){var f=b.getChild(c);f=this.ioService_.newURI(f.uri,null,null);this.annotationService_.removePageAnnotation(f,"google-toolbar/thumbnail")}b.containerOpen=false;if(e<d)this.cleanAlarm_=new G_Alarm(BindToObject(this.clearThumbnails_,this,b,e,d),this.delay_);else this.addCleanerCounter_()};
a.addCleanerCounter_=function(){var b=this.prefs_.getPref("thumbnail.clean-counter",0);if(++b<this.vacuumCounter_)this.prefs_.setPref("thumbnail.clean-counter",b);else{this.prefs_.setPref("thumbnail.clean-counter",0);GTB_NewTabService.instance.setVacuumFlag()}};
a.doGrabThumbnail_=function(b,c,d,e){var f=this.captureThumbnail_(b);if(f)if(!e||f.score.isBetter(e)){this.storeThumbnail_(c,f);e=f.score}if(d<GTB_ThumbnailGrabber.THUMBNAIL_GRAB_INTERVALS.length){f=GTB_ThumbnailGrabber.THUMBNAIL_GRAB_INTERVALS[d]*1E3;b.setTimeout(BindToObject(this.doGrabThumbnail_,this,b,c,d+1,e),f)}};
a.storeThumbnail_=function(b,c){this.annotationService_.setPageAnnotation(b,"google-toolbar/thumbnail",c.image,0,Ci.nsIAnnotationService.EXPIRE_MONTHS);this.annotationService_.setPageAnnotation(b,"google-toolbar/thumbnail-score",c.score.toString(),0,Ci.nsIAnnotationService.EXPIRE_WITH_HISTORY)};
a.captureThumbnail_=function(b){var c=b.document.createElement("canvas");c.width=GTB_ThumbnailGrabber.THUMBNAIL_WIDTH;c.height=GTB_ThumbnailGrabber.THUMBNAIL_HEIGHT;var d=c.getContext("2d");d.clearRect(0,0,GTB_ThumbnailGrabber.THUMBNAIL_WIDTH,GTB_ThumbnailGrabber.THUMBNAIL_HEIGHT);d.save();var e=GTB_ThumbnailGrabber.THUMBNAIL_WIDTH/Math.max(GTB_ThumbnailGrabber.THUMBNAIL_WIDTH,b.innerWidth),f=GTB_ThumbnailGrabber.THUMBNAIL_HEIGHT/Math.max(GTB_ThumbnailGrabber.THUMBNAIL_HEIGHT,b.innerHeight);e=Math.max(e,
f);f=GTB_ThumbnailGrabber.THUMBNAIL_WIDTH/e;f=(b.innerWidth-f)/2;var g=0;d.scale(e,e);try{d.drawWindow(b,f,g,b.innerWidth,b.innerHeight,"white")}catch(h){return null}finally{d.restore()}return{image:c.toDataURL("image/png"),score:GTB_ThumbnailScore.calculate(c,b)}};a.getBestThumbnailScore_=function(b){var c=this.annotationService_;try{if(c.pageHasAnnotation(b,"google-toolbar/thumbnail-score")){var d=c.getPageAnnotation(b,"google-toolbar/thumbnail-score");return GTB_ThumbnailScore.parse(d)}}catch(e){}return null};
function GTB_ThumbnailProvider(){this.annotationService_=Cc["@mozilla.org/browser/annotation-service;1"].getService(Ci.nsIAnnotationService);this.ioService_=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService)}GTB_ThumbnailProvider.prototype.debugZone="GTB_ThumbnailProvider";
GTB_ThumbnailProvider.prototype.getBase64Encoded=function(b){var c=this.annotationService_,d=this.ioService_;try{var e=d.newURI(b,null,null);return c.pageHasAnnotation(e,"google-toolbar/thumbnail")&&c.getPageAnnotation(e,"google-toolbar/thumbnail")}catch(f){return null}};GTB_ThumbnailProvider.prototype.hasThumbnail=function(b){var c=this.annotationService_,d=this.ioService_;b=d.newURI(b,null,null);return c.pageHasAnnotation(b,"google-toolbar/thumbnail")};
function GTB_ThumbnailScore(b,c,d,e){this.visualScore=b;this.creationTime=c;this.isVScrolled=d;this.isHScrolled=e}GTB_ThumbnailScore.debugZone="GTB_ThumbnailScore";GTB_ThumbnailScore.prototype.debugZone=GTB_ThumbnailScore.debugZone;GTB_ThumbnailScore.calculate=function(b,c){return new GTB_ThumbnailScore(GTB_ThumbnailScore.calcVisualScore_(b),Date.now(),c.scrollY>0,c.scrollX>0)};
GTB_ThumbnailScore.parse=function(b){b=b.split(",",4);return new GTB_ThumbnailScore(Number(b[0]||0),Number(b[1]||Date.now()),!!b[2],!!b[3])};GTB_ThumbnailScore.prototype.toString=function(){var b=[this.visualScore,this.creationTime,Number(this.isVScrolled),Number(this.isHScrolled)];return b.join(",")};
GTB_ThumbnailScore.prototype.isBetter=function(b){var c=0.1/36E5;return this.visualScore-b.visualScore+(Number(this.isVScrolled)-Number(b.isVScrolled))*-0.1+(Number(this.isHScrolled)-Number(b.isHScrolled))*-0.3+(this.creationTime-b.creationTime)*c>0.01};GTB_ThumbnailScore.calcVisualScore_=function(b){b=b.toDataURL("image/jpeg");b=(b.length-b.indexOf(",")-1)*6/8;return b<1095?0:b<4662?Math.sqrt((b-1095)/3567):b<1E4?Math.sqrt((1E4-b)/5338):0};function GTB_SearchObserver(b,c){this.debugZone="search-dragdrop-observer";this.flavourSet_=c;this.searchBox_=b}GTB_SearchObserver.prototype.getSupportedFlavours=function(){return this.flavourSet_};GTB_SearchObserver.prototype.onDragOver=function(){};GTB_SearchObserver.prototype.onDrop=function(b,c){!c||!c.data||c.data==""||b.target==this.searchBox_&&this.loadSearch_(c.data)};
GTB_SearchObserver.prototype.loadSearch_=function(b){b=StripHTML(b);b=b.replace(/[\r\n]/g,"");b=b.trim();if(b.length>0){if(b[0]!='"'&&b[0]!="'")b=b[b.length-1]=="'"?"'"+b:'"'+b;if(b[b.length-1]!=b[0])b+=b[0]}this.searchBox_.value=b;b=this.searchBox_;var c=b.searchTypesPopup.searchType;b.mSearchBox.doGoogleSearchType(c,false,null)};function GTB_SetSearchBoxHotkey(b){var c=b=b.document,d=new G_Preferences("google.toolbar.",false,true);c=c.getElementById("gtbSearchKey");var e=d.getPref("searchkey","G");(d=d.getPref("searchkey.modifiers"))||(d=GetPlatform()==2?"control":"alt");c.setAttribute("key",e);c.setAttribute("modifiers",d);(d=(b=b.getElementById("Tools:Search"))&&b.getAttribute("oncommand"))&&b.setAttribute("oncommand","GTB_getToolbar().appContext.GTB_WrapDefaultSearchKey(window);")}
goog.exportSymbol("GTB_SetSearchBoxHotkey",GTB_SetSearchBoxHotkey);function GTB_WrapDefaultSearchKey(b){var c=b.document,d=c.getElementById("searchbar");if(d&&(d.parentNode.parentNode.collapsed||b.getComputedStyle(d.parentNode,"").display=="none"))d=null;if(d||!c.getElementById("gtbSearchBox")){b=b;if(b.BrowserSearch)b.BrowserSearch.webSearch();else b.WebSearch&&b.WebSearch()}else GTB_OnSearchBoxFocusKey(b.document)}goog.exportSymbol("GTB_WrapDefaultSearchKey",GTB_WrapDefaultSearchKey);
function GTB_OnSearchBoxFocusKey(b){var c=b.getElementById("gtbToolbar");if(c)if(b=b.getElementById("gtbGoogleSearchBox")){for(c=b;;){c=c.parentNode;if(!c||c.collapsed)return;if(c.nodeName=="toolbar")break}c=b.inputField;if(!c.selectionStart||!c.selectionEnd||c.selectionStart==c.selectionEnd)b.select();c.mIgnoreClick=true;b.focus()}}goog.exportSymbol("GTB_OnSearchBoxFocusKey",GTB_OnSearchBoxFocusKey);function GTB_SearchBoxOverlay(b,c,d){this.debugZone="search-box-overlay";for(var e,f=0;e=GTB_SearchBoxOverlay.overlays[f];f++)if(e.searchBox_==b){f--;GTB_SearchBoxOverlay.overlays.splice(f,1);e.shutdown()}GTB_SearchBoxOverlay.overlays.push(this);this.searchBox_=b;this.onKeyDownBound_=BindToObject(this.onKeyDown_,this);this.onKeyPressBound_=BindToObject(this.onKeyPress_,this);this.onFocusBound_=BindToObject(this.onFocus_,this);this.onBlurBound_=BindToObject(this.onBlur_,this);this.searchBox_.addEventListener("keydown",
this.onKeyDownBound_,false);this.searchBox_.addEventListener("keypress",this.onKeyPressBound_,false);this.searchBox_.addEventListener("focus",this.onFocusBound_,false);this.searchBox_.addEventListener("blur",this.onBlurBound_,false);this.searchTypePopup_=c;this.searchService_=Cc["@google.com/toolbar/search-service;1"].getService().wrappedJSObject;this.prefs_=new G_Preferences("google.toolbar.",false,true);this.keyPressFilter_=null;this.originalQuery_="";this.observers_=[new G_ObserverServiceObserver("GTB_CLEAR_HISTORY",
BindToObject(this.clearHistory_,this)),new G_ObserverServiceObserver("private-browsing",BindToObject(this.onPBModeChanged_,this)),new G_ObserverServiceObserver("google-toolbar-customize-restoredefaults",BindToObject(this.onCustomizeRestoreDefaults_,this)),new G_ObserverServiceObserver("google-toolbar-options-restoredefaults",BindToObject(this.onOptionsRestoreDefaults_,this))];this.win_=d;this.browser_=b.ownerDocument.getElementById("browser")}GTB_SearchBoxOverlay.overlays=[];
GTB_SearchBoxOverlay.SUGGEST_LOG_TYPES={gtbSearchGoogle:true,gtbSearchSite:true,gtbCountrySearch:true,gtbFeelingLucky:true,gtbSearchImages:true};a=GTB_SearchBoxOverlay.prototype;
a.shutdown=function(){this.searchBox_.removeEventListener("keydown",this.onKeyDownBound_,false);this.searchBox_.removeEventListener("keypress",this.onKeyPressBound_,false);this.searchBox_.removeEventListener("focus",this.onFocusBound_,false);this.searchBox_.removeEventListener("blur",this.onBlurBound_,false);for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.searchBox_=this.win_=null;b=GTB_SearchBoxOverlay.overlays.indexOf(this);b!=-1&&GTB_SearchBoxOverlay.overlays.splice(b)};
a.onKeyDown_=function(){this.ignoreFocus_=true};a.setKeyPressFilter=function(b){this.keyPressFilter_=b};
a.onKeyPress_=function(b){if(!(this.keyPressFilter_&&this.keyPressFilter_(b))){var c=GetPlatform()==2?b.metaKey:b.ctrlKey;switch(b.keyCode){case b.DOM_VK_UP:c&&this.searchTypePopup_.mSearchTypes.select(-1);break;case b.DOM_VK_DOWN:if(c)this.searchTypePopup_.mSearchTypes.select(+1);else if(b.altKey){b.preventDefault();this.searchTypePopup_.open=true;this.searchTypePopup_.popup.focus()}break;case b.DOM_VK_RETURN:this.doSearch(b,false);this.browser_.focus();GTB_logTargetId(this.searchBox_);break;case b.DOM_VK_ESCAPE:this.searchTypePopup_.mSearchTypes.setSearchButton_("gtbSearchGoogle");
this.searchBox_.value="";break}this.ignoreFocus_=false}};a.onFocus_=function(){var b=this.win_.document.getElementById("main-window");this.searchBox_.value.trim()?b.setAttribute("gtbSearchBox","focused"):b.setAttribute("gtbSearchBox","focusedNoText");if(!this.ignoreFocus_){this.clearSuggestIndex();this.searchService_.tryPreconnect(this.searchTypePopup_.searchType)}};a.onBlur_=function(){var b=this.win_.document.getElementById("main-window");b.removeAttribute("gtbSearchBox")};
a.doSearch=function(b,c){var d=this.searchTypePopup_.searchType,e=false;if(b&&b.altKey||c)e=true;if(b&&b.shiftKey)d="gtbFeelingLucky";this.doGoogleSearchType(d,e,b)};
a.doGoogleSearchType=function(b,c,d){var e=this.getSearchText(),f=e;if(!GTB_LooksLikeUrl(e)&&b=="gtbFFSearch"){var g=Cc["@mozilla.org/browser/search-service;1"].getService(Ci.nsIBrowserSearchService).defaultEngine;e=g.getSubmission(e,null).uri.spec}if(GTB_LooksLikeUrl(e)&&(b=="gtbSearchGoogle"||b=="gtbFFSearch")){this.searchService_.loadSearchUrl(this.win_,e,c,d);this.searchService_.broadcastSearch(f,e,"url")}else{f="";if(this.suggestIndex_>=0&&GTB_SearchBoxOverlay.SUGGEST_LOG_TYPES[b]){f="&aq="+
this.suggestIndex_;g=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;if(g=g.getButton(b))f+="&oq="+g.encodeQuery(this.originalQuery_)}this.searchService_.executeSearch(this.win_,b,e,"",f,c,d);this.clearSuggestIndex();this.prefs_.getPref("first_search",false)||this.prefs_.setPref("first_search",true);d&&d.preventBubble()}};
a.loadHistory=function(b,c,d){var e=b.uri;this.searchService_.broadcastSearch(b.query,e,b.searchType);if(GTB_SearchBoxOverlay.SUGGEST_LOG_TYPES[b.searchType]){b="&aq="+d;d=e.indexOf("&aq=");if(d==-1)e+=b;else e=e.replace(/&aq=(\w+)/,b)}this.searchService_.loadSearchUrl(this.win_,e,c,null);this.clearSuggestIndex()};a.loadUrl=function(b,c,d){this.searchService_.loadSearchUrl(this.win_,b,c,d);this.clearSuggestIndex()};a.getSearchText=function(){return this.searchBox_.value.replace(/^\s+/g,"")};
a.setSuggestIndex=function(b){this.suggestIndex_=b};a.getSuggestIndex=function(){return this.suggestIndex_};a.clearSuggestIndex=function(){this.suggestIndex_=-1};a.rememberOriginalQuery=function(b){this.originalQuery_=b};a.restoreOriginalQuery=function(){this.searchBox_.value=this.originalQuery_;this.clearSuggestIndex()};a.suggestQuery=function(b,c){this.searchBox_.value=b;this.setSuggestIndex(c)};a.onPBModeChanged_=function(b,c,d){"exit"==d&&this.clearHistory_()};
a.clearHistory_=function(){this.searchBox_.value=""};a.onOptionsRestoreDefaults_=function(){this.onRestoreDefaults_()};a.onCustomizeRestoreDefaults_=function(b){b==this.win_&&this.onRestoreDefaults_()};
a.onRestoreDefaults_=function(){this.prefs_.clearPref("suggest.width");this.prefs_.clearPref("suggest.height");var b=this.win_.document,c=b.getElementById("gtbSearchBox");if(c)c.width=250+b.getElementById("gtbSearchButton").boxObject.width+b.getElementById("gtbSearchBoxResizeLeft").boxObject.width+b.getElementById("gtbSearchBoxResizeRight").boxObject.width;if(b=b.getElementById("gtbPopupAutoComplete")){b.mMaxRows=null;b.width=null;b.height=null}};function GTB_SearchTypeOverlay(b,c){this.debugZone="search-type-overlay";for(var d,e=0;d=GTB_SearchTypeOverlay.overlays[e];e++)if(d.menubutton_==b){e--;GTB_SearchTypeOverlay.overlays.splice(e,1);d.shutdown()}GTB_SearchTypeOverlay.overlays.push(this);this.doc_=c;this.menubutton_=b;this.onCommandClosure_=BindToObject(this.onCommand_,this);this.menubutton_.addEventListener("command",this.onCommandClosure_,false);this.onClickClosure_=BindToObject(this.onClick_,this);this.menubutton_.addEventListener("click",
this.onClickClosure_,false);this.observers_=[new G_ObserverServiceObserver("google-toolbar-customize-restoredefaults",BindToObject(this.onCustomizeRestoreDefaults_,this)),new G_ObserverServiceObserver("GTB_CB_REMOVE",BindToObject(this.observeButtonRemove_,this))];this.prefs_=new G_Preferences("google.toolbar.");this.cbService_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject}GTB_SearchTypeOverlay.overlays=[];
GTB_SearchTypeOverlay.prototype.shutdown=function(){for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.menubutton_.removeEventListener("command",this.onCommandClosure_,false);this.menubutton_.removeEventListener("click",this.onClickClosure_,false);this.menubutton_=this.doc_=null;b=GTB_SearchTypeOverlay.overlays.indexOf(this);b!=-1&&GTB_SearchTypeOverlay.overlays.splice(b)};
GTB_SearchTypeOverlay.prototype.setSearchButton_=function(b){var c=this.cbService_.getButton(b);if(c){this.menubutton_.image=c.getIconDefault();this.menubutton_.tooltipText=c.getTooltipText();this.menubutton_.searchType=b}else if(b=="gtbFFSearch"){c=Cc["@mozilla.org/browser/search-service;1"].getService(Ci.nsIBrowserSearchService).defaultEngine;this.menubutton_.image=c.iconURI.spec;this.menubutton_.tooltipText=c.description;this.menubutton_.searchType=b}};
GTB_SearchTypeOverlay.prototype.select=function(b){for(var c=this.getSearchesOrdered_(null),d=this.menubutton_.searchType,e=0,f=null;f=c[e];++e)if(d==f.getID()){if(b<0)b=c.length- -b%c.length;b=c[(e+b)%c.length];this.setSearchButton_(b.getID());return}};GTB_SearchTypeOverlay.maxSearchTypeCount=10;
GTB_SearchTypeOverlay.prototype.onPopupShowing=function(b){var c={},d=this.getSearchesOrdered_(c);c=c.value;for(var e=this.doc_.getElementById("gtbSearchButtonMoreMenu");b.firstChild&&b.firstChild!=e;)b.removeChild(b.firstChild);for(var f=this.doc_.getElementById("gtbSearchButtonMorePopup");f.firstChild;)f.removeChild(f.firstChild);for(var g=c+GTB_SearchTypeOverlay.maxSearchTypeCount,h=false,i=0,j=null;j=d[i];++i){if(c==i){var k=this.doc_.createElement("menuseparator");b.insertBefore(k,e)}k=j.makeMenuItem(this.doc_);
this.addMenuItemEventListeners_(k,j.getID());if(i<g)b.insertBefore(k,e);else{if(!h){this.addFFSearchEngine(b);h=true}f.appendChild(k)}}e.hidden=!f.firstChild;GTB_LayoutUtil.setSearchIcon(this.doc_.getElementById("gtbSearchMenuShowToolbar"));c=this.doc_.getElementById("gtbToolbar");b.setAttribute("toolbarCollapsed",c.collapsed)};
GTB_SearchTypeOverlay.prototype.addMenuItemEventListeners_=function(b,c){b.addEventListener("command",BindToObject(this.onPopupCommand_,this,c),false);b.addEventListener("click",BindToObject(this.onPopupClick_,this,c),false)};
GTB_SearchTypeOverlay.prototype.addFFSearchEngine=function(b){var c=Cc["@mozilla.org/browser/search-service;1"].getService(Ci.nsIBrowserSearchService).defaultEngine;if(!(!c||c.name=="Google"))if(!this.doc_.getElementById("searchbar")){var d=this.doc_.createElement("menuitem");d.id="gtbFFSearchEngine";d.className="menuitem-iconic";d.setAttribute("label",c.name);d.setAttribute("tooltiptext",c.description);d.setAttribute("image",c.iconURI.spec);this.addMenuItemEventListeners_(d,"gtbFFSearch");c=this.doc_.getElementById("gtbSearchButtonMoreMenu");
b.insertBefore(d,c)}};GTB_SearchTypeOverlay.FIXED_SEARCH_TYPES=["gtbSearchGoogle","gtbSearchBookmarks"];a=GTB_SearchTypeOverlay.prototype;a.getSearchesOrdered_=function(b){for(var c=GTB_SearchTypeOverlay.FIXED_SEARCH_TYPES,d=[],e=0;e<c.length;++e){var f=this.cbService_.getButton(c[e]);f&&d.push(f)}f=this.cbService_.getSearchButtons();if(f.length>0){if(b)b.value=d.length;e=0;for(b=null;b=f[e];++e)if(c.indexOf(b.getID())==-1){var g=b.getID();this.prefs_.getPref("button_option.search."+g,true)&&d.push(b)}}return d};
a.onPopupCommand_=function(b,c){var d=c.target.ownerDocument;d=d.getElementById("gtbGoogleSearchBox");d.value.trim()&&d.mSearchBox.doGoogleSearchType(b,false,c);this.prefs_.getPref("reset_search_type",false)||this.setSearchButton_(b);c.preventBubble()};a.onPopupClick_=function(b,c){if(c.button==1){this.onPopupCommand_(b,c);this.menubutton_.popup.hidePopup()}};
a.onCommand_=function(b){var c=this.menubutton_.searchType,d=this.doc_.getElementById("gtbGoogleSearchBox");if(b.target.id=="gtbSearchButton"){if(b.altKey&&c=="gtbSearchGoogle")c="gtbFeelingLucky";d.mSearchBox.doGoogleSearchType(c,false,b)}};a.onClick_=function(b){b.button==1&&this.onCommand_(b)};a.onCustomizeRestoreDefaults_=function(b){this.doc_.defaultView==b&&this.resetDefaultSearchType_()};a.observeButtonRemove_=function(b,c,d){b=this.menubutton_.searchType;b==d&&this.resetDefaultSearchType_()};
a.resetDefaultSearchType_=function(){this.setSearchButton_("gtbSearchGoogle")};function GTB_FFSearchBox(){this.debugZone="GTB_FFSearchBox";var b=Cc["@mozilla.org/browser/search-service;1"].getService(Ci.nsIBrowserSearchService);this.engine_=null;try{this.engine_=b.getEngineByName("Google").wrappedJSObject}catch(c){}this.prefs_=new GTB_PrefFile;this.firstSearchEvent_=null}GTB_FFSearchBox.originalGetSubmission_=null;GTB_FFSearchBox.INSTALL_PREF_="rlz.ffsb.install";GTB_FFSearchBox.FIRST_SEARCH_PREF_="rlz.ffsb.first_search";GTB_FFSearchBox.RLZ_PREF_="rlz.ffsb.rlz";a=GTB_FFSearchBox.prototype;
a.init=function(){var b=this.getRlz();b&&this.setRlz(b)};a.setRlz=function(b){if(this.engine_){this.prefs_.setPref(GTB_FFSearchBox.RLZ_PREF_,b);if(!GTB_FFSearchBox.originalGetSubmission_)GTB_FFSearchBox.originalGetSubmission_=this.engine_.getSubmission;this.engine_.getSubmission=this.getSubmissionOverride_()}};
a.getSubmissionOverride_=function(){var b=this;return function(c,d){var e=GTB_FFSearchBox.originalGetSubmission_.call(this,c,d);if(d&&d!="text/html")return e;b.getFirstSearchEvent()||b.setFirstSearchEvent();var f=e.uri.spec.replace(/&rls=[^&]*/,""),g=f.indexOf("?")>=0;f=f+(g?"&":"?")+"rlz="+b.getRlz();e.uri.spec=f;return e}};a.getRlz=function(){var b=this.prefs_.getPref(GTB_FFSearchBox.RLZ_PREF_);if(typeof b!="string")b="";return b};
a.clearRlz=function(){if(this.engine_&&GTB_FFSearchBox.originalGetSubmission_){this.engine_.getSubmission=GTB_FFSearchBox.originalGetSubmission_;GTB_FFSearchBox.originalGetSubmission_=null}this.prefs_.clearPref(GTB_FFSearchBox.RLZ_PREF_)};
a.reportRls=function(){if(!this.engine_)return"";var b=null;return(b=(b=(b=(b=GTB_FFSearchBox.originalGetSubmission_?GTB_FFSearchBox.originalGetSubmission_.call(this.engine_,"query",null):this.engine_.getSubmission("query",null))&&b.uri.spec)&&b.match(/[?&]rls=([^&]*)/))&&b[1])||""};a.setInstallEvent=function(){this.prefs_.setPref(GTB_FFSearchBox.INSTALL_PREF_,true)};a.getInstallEvent=function(){return!!this.prefs_.getPref(GTB_FFSearchBox.INSTALL_PREF_)};
a.setFirstSearchEvent=function(){this.firstSearchEvent_=true;this.prefs_.setPref(GTB_FFSearchBox.FIRST_SEARCH_PREF_,true)};a.getFirstSearchEvent=function(){if(this.firstSearchEvent_==null)this.firstSearchEvent_=!!this.prefs_.getPref(GTB_FFSearchBox.FIRST_SEARCH_PREF_);return!!this.firstSearchEvent_};function GTB_MachinePrefs(){this.prefs_=new G_Preferences("google.toolbar.",false,true)}GTB_MachinePrefs.prototype.setLocalMachineString=function(b,c){try{var d=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);d.create(Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE,"SOFTWARE\\Google\\Toolbar for Firefox",Ci.nsIWindowsRegKey.ACCESS_ALL);d.writeStringValue(b,c);d.close()}catch(e){d&&d.close();this.prefs_.setPref(b,c)}};
GTB_MachinePrefs.prototype.getLocalMachineString=function(b){var c=null;try{var d=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);d.open(Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE,"SOFTWARE\\Google\\Toolbar for Firefox",Ci.nsIWindowsRegKey.ACCESS_READ);c=d.readStringValue(b);d.close()}catch(e){d&&d.close();c=this.prefs_.getPref(b,null)}return c};var gtbUninstallPingSent=false;function GTB_SendPings(){this.debugZone="GTB_SendPings";this.pinging_=new GTB_Pinging;this.prefs_=new G_Preferences("google.toolbar.");this.mPrefs_=new GTB_MachinePrefs}GTB_SendPings.MIN_MILLISECONDS_BETWEEN_PINGS=864E5;GTB_SendPings.REG_INSTALL="sent";GTB_SendPings.REG_FIRST_SEARCH="sentfs";GTB_SendPings.PREF_FIRST_SEARCH_PING_MAX_RETRIES=14;GTB_SendPings.PREF_INSTALL_PING_ACKED="install_ping_acked";GTB_SendPings.PREF_FIRST_SEARCH_PING_RETRIES="first_search_ping_retires";
GTB_SendPings.PREF_INSTALL_PING_RETRIES="install_ping_retires";GTB_SendPings.LAST_PING_ATTEMPT="last_ping_attempt";GTB_SendPings.PREF_INSTALL_PING_MAX_RETRIES=14;GTB_SendPings.PREF_GOOGLE_HOME="google_home";GTB_SendPings.PREF_DISABLED="toolbar_disabled";GTB_SendPings.userClickedDisable=false;GTB_SendPings.disableStarted=function(){GTB_SendPings.userClickedDisable=true};GTB_SendPings.disableFinished=function(){GTB_SendPings.userClickedDisable=false};a=GTB_SendPings.prototype;
a.firstDaily=function(){if(!this.prefs_.getPref(GTB_SendPings.PREF_INSTALL_PING_ACKED,false)){this.pinging_.recordInstall();if(this.mPrefs_.getLocalMachineString(GTB_SendPings.REG_INSTALL))this.prefs_.setPref(GTB_SendPings.PREF_INSTALL_PING_ACKED,true);else{var b=this.prefs_.getPref(GTB_SendPings.PREF_INSTALL_PING_RETRIES,0);if(b<GTB_SendPings.PREF_INSTALL_PING_MAX_RETRIES){this.prefs_.setPref(GTB_SendPings.PREF_INSTALL_PING_RETRIES,b+1);return true}}}return false};
a.firstSearch=function(){if(this.prefs_.getPref("first_search",false)){this.pinging_.recordFirstSearch();if(this.mPrefs_.getLocalMachineString(GTB_SendPings.REG_FIRST_SEARCH))this.prefs_.setPref("first_search",false);else{var b=this.prefs_.getPref(GTB_SendPings.PREF_FIRST_SEARCH_PING_RETRIES,0);if(b<GTB_SendPings.PREF_FIRST_SEARCH_PING_MAX_RETRIES){this.prefs_.setPref(GTB_SendPings.PREF_FIRST_SEARCH_PING_RETRIES,b+1);return true}}}return false};
a.commonPingParams=function(){var b={};b.as="tbff";b.id=this.pinging_.getToolbarId();b.rlz=this.pinging_.getRLZ();b.version=GTB_version;b.hl=GTB_getLangCode();b.tbbrand=this.pinging_.getBrand();var c=b,d;d=(d=Cc["@mozilla.org/appshell/appShellService;1"].getService(Ci.nsIAppShellService).hiddenDOMWindow)&&d.navigator&&d.navigator.platform||"";c.os=d;c=this.prefs_.getPref(GTB_SendPings.PREF_GOOGLE_HOME,"www.google.com");b.sd=c.replace("www.","").replace("google.","");c=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULAppInfo);
b.browser=c.version;return b};a.composeURL=function(b,c){var d=[];for(var e in c)d.push(e+"="+encodeURIComponent(c[e]));return b+"?"+d.join("&")};a.uninstallPingURL=function(b,c,d){var e=this.commonPingParams();e.source=b;if(c)e.reasons=c.join(" ");b=this.composeURL("http://toolbar.google.com/cgi-bin/uninstall.py",e);if(d)b+="&comments="+encodeURIComponent(d);return b};a.sendUninstallPing=function(b,c,d){b=this.uninstallPingURL(b,c,d);c=new G_XMLFetcher;c.get(b,null)};
a.sendDisablePing=function(){GTB_SendPings.userClickedDisable?this.sendUninstallPing("em-disable"):this.sendUninstallPing("unk-disable");this.prefs_.setPref(GTB_SendPings.PREF_DISABLED,true)};a.dailyPingURL=function(){var b=this.commonPingParams();if(this.firstDaily())b.install="1";if(this.firstSearch())b.fs="1";var c=Cc["@google.com/toolbar/components;1"].getService().wrappedJSObject;c.getVersionInfo(b);c="https://tools.google.com/toolbar/service/update";return this.composeURL(c,b)};
a.onDailyResponse=function(b){if(b.status==200){var c=b.responseText;if(c!=null)b.responseXML?this.parseDailyResponse_(b.responseXML):this.parseProductUpdateResponse_(c)}};
a.parseDailyResponse_=function(b){var c=b.getElementsByTagName("application")[0];this.parseProductUpdateResponse_(c.firstChild.nodeValue);b=b.getElementsByTagName("component");c=0;for(var d;d=b[c];c++){var e=Cc["@google.com/toolbar/components;1"].getService().wrappedJSObject;e.update(d.getAttribute("name"),d.getAttribute("version"),d.firstChild.nodeValue)}};
a.parseProductUpdateResponse_=function(b){var c=null,d=null,e=null;b=b.split(/[\r\n]+/);for(var f=0;f<b.length;++f){var g=b[f];g=g.split(": ");if(g.length==2)switch(g[0]){case "Url":c=g[1];break;case "Version":d=g[1];break;case "rlz":e=g[1];break;case "Protocol":this.prefs_.setPref(GTB_SendPings.PREF_INSTALL_PING_ACKED,true);this.mPrefs_.setLocalMachineString(GTB_SendPings.REG_INSTALL,"1");if(this.prefs_.getPref("first_search",false)){this.prefs_.setPref("first_search",false);this.mPrefs_.setLocalMachineString(GTB_SendPings.REG_FIRST_SEARCH,
"1")}}}e&&this.pinging_.setRLZ(e);if(d&&c){d=GTB_CompareVersions(d,GTB_version);d>0&&GTB_DoXpiInstall(c)}};a.checkTBCookie=function(){var b=Cc["@mozilla.org/cookieService;1"].getService(Ci.nsICookieService),c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);c=c.newURI("http://www.google.com",null,null);b=b.getCookieString(c,null);if(b==null||b.toUpperCase().indexOf("TB=2")==-1){b=new G_XMLFetcher;b.get("http://www.google.com/url?sa=p&pref=tb&pval=2&q=",null)}};
a.sendDailyPing=function(){var b=parseFloat(this.prefs_.getPref(GTB_SendPings.LAST_PING_ATTEMPT,0));if(!(Date.now()-b<GTB_SendPings.MIN_MILLISECONDS_BETWEEN_PINGS))if(GTB_IsOnline()){b=new G_XMLFetcher(true);var c=this.dailyPingURL();b.get(c,BindToObject(this.onDailyResponse,this));this.pinging_.sendPing();this.prefs_.setPref(GTB_SendPings.LAST_PING_ATTEMPT,Date.now().toString());this.checkTBCookie();this.sendSearchIconRequest();this.sendNewButtonRequest();if(this.prefs_.getPref(GTB_SendPings.PREF_DISABLED,
false)){this.sendUninstallPing("reenable");this.prefs_.setPref(GTB_SendPings.PREF_DISABLED,false)}}};a.onSearchIconReceived=function(b){if(b.status==200){b=b.responseText;for(var c=new G_Base64,d=[],e=0;e<b.length;++e)d.push(b.charCodeAt(e)&255);this.prefs_.setPref("search-icon","data:"+this.searchIconFetcher_.getResponseHeader("Content-Type")+";base64,"+c.encodeByteArray(d));this.searchIconFetcher_=null}};
a.sendSearchIconRequest=function(){this.searchIconFetcher_=new G_XMLFetcher;this.searchIconFetcher_.expectBinaryData();this.searchIconFetcher_.get("http://www.google.com/favicon.ico",BindToObject(this.onSearchIconReceived,this))};a.sendNewButtonRequest=function(){var b=new GTB_NewButtonRequester;b.setRequest()};
function GTB_SubmitUninstallFeedback(b,c){if(!(gtbUninstallPingSent||!GTB_IsOnline())){gtbUninstallPingSent=true;try{var d=Cc["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance(Ci.nsIXMLHttpRequest);d.open("GET","http://www.google.com/images/toolbar_uninstall.gif",true);d.channel.loadFlags|=Ci.nsIRequest.LOAD_BYPASS_CACHE;d.send(null)}catch(e){}if(b){d=b.document.getElementById("gtbUninstallOptions");var f=d.firstChild;for(d=[];f;){f.nodeName=="checkbox"&&f.checked&&d.push(f.id);f=f.nextSibling}f=
b.document.getElementById("gtbUninstallComments").value;(new GTB_SendPings).sendUninstallPing("em-uninstall",d,f)}else(new GTB_SendPings).sendUninstallPing(c||"unk-uninstall",null,null)}}function GTB_SendDailyPing(){GTB_StartupProfiler.timestamp("+GTB_SendDailyPing");var b=new GTB_SendPings;b.sendDailyPing();GTB_StartupProfiler.timestamp("-GTB_SendDailyPing")}
function GTB_DoXpiInstall(b){try{var c=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties).get("ProfD",Ci.nsIFile);c.append("extensions");c.append("staged-xpis");c.append("{3112ca9c-de6d-4884-a869-9855de68056c}");c.exists()&&c.remove(true)}catch(d){}c=Cc["@mozilla.org/xpinstall/install-manager;1"].createInstance(Ci.nsIXPInstallManager);if(c!=null){b=[b];var e={onStateChange:function(f,g,h){if(g==Ci.nsIXPIProgressDialog.INSTALL_DONE&&h==0){f=new G_Preferences("google.toolbar.");
f.setPref("done_page_shown","AU_"+GTB_version)}},onProgress:function(){}};c.initManagerFromChrome(b,b.length,e)}};function GTB_StaticComponentRegistry(){this.debugZone="static-components";this.components_={};var b="google.toolbar.component.";this.cashedVersionPref_=new G_Preferences(b+"cached.");this.bundledVersionPref_=new G_Preferences(b+"bundled.");this.wrappedJSObject=this}a=GTB_StaticComponentRegistry.prototype;
a.register=function(b,c,d){if(!this.components_[b]){this.components_[b]={callback:c};c=this.bundledVersionPref_.getPref(b);(c=c!=GTB_version)&&this.bundledVersionPref_.setPref(b,GTB_version);b=this.copyBundled_(b,c||GTB_version.indexOf("DEV")>0);if(d){c=0;for(var e;e=d[c];c++)this.copyBundled_(e,b)}}};a.getFile=function(b){if(!this.components_[b])return null;return this.getVersion(b)?this.getCachedFile_(b):this.getBundledFile_(b)};
a.getUrl=function(b){b=this.getFile(b);b.exists();return"file://"+b.path};a.getVersion=function(b){if(!this.components_[b])return null;var c=this.cashedVersionPref_.getPref(b);if(c){var d=this.getCachedFile_(b);if(!d.exists()){this.cashedVersionPref_.clearPref(b);c=""}}return c};a.getVersionInfo=function(b){var c=0;for(var d in this.components_){c++;b["scn"+c]=d;var e=this.getVersion(d);if(e)b["scv"+c]=e}if(c)b.sccnt=c};
a.update=function(b,c,d){if(this.components_[b])if(this.getVersion(b)!=c)try{var e=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(d,null,null);if(e&&e.scheme=="https"){var f=new G_XMLFetcher;f.get(d,BindToObject(this.onResponse_,this,b,c))}}catch(g){}};a.onResponse_=function(b,c,d){if(d.status==200)(d=d.responseText)&&this.replace_(b,c,d)};
a.replace_=function(b,c,d){GTB_saveBinaryFile(this.getCachedFile_(b),d);this.cashedVersionPref_.setPref(b,c);(b=this.components_[b].callback)&&b()};a.getLocalDir_=function(){var b=GTB_getDataDir();b.append("components");GTB_ensureDirectoryExists(b);return b};a.getLocalFile_=function(b){var c=this.getLocalDir_();c.append(b);return c};a.getBundledFile_=function(b){return this.getLocalFile_(b)};a.getCachedFile_=function(b){return this.getLocalFile_("cached."+b)};
a.copyBundled_=function(b,c){try{var d=this.getLocalFile_(b);c&&d.exists()&&d.remove(false);if(!d.exists()){var e=GTB_getInstallFile("defaults","components",b);e.copyTo(this.getLocalDir_(),d.leafName);return true}}catch(f){}return false};function GTB_Pinging(){this.debugZone="pinging";this.rlzService_=null;try{this.rlzService_=Cc["@google.com/toolbar/rlz;1"].getService(Ci.GTBIRlz)}catch(b){}this.userPrefs_=new GTB_PrefFile;this.mPrefs_=new GTB_MachinePrefs;this.prefs_=new G_Preferences("google.toolbar.",false,true);this.setRLZ(this.getRLZ())}a=GTB_Pinging.prototype;
a.getRLZ=function(){var b=this.rlzService_&&this.rlzService_.getAccessPointRlz(Ci.GTBIRlz.ACCESS_FFTB3_BOX);return(b=(b=(b=b||this.userPrefs_.getPref("rlz"))||this.mPrefs_.getLocalMachineString("rlz"))||this.prefs_.getPref("rlz",null))||""};
a.setRLZ=function(b){var c=this.rlzService_&&this.rlzService_.getAccessPointRlz(Ci.GTBIRlz.ACCESS_FFTB3_BOX);b=c||b;!c&&this.rlzService_&&this.rlzService_.setAccessPointRlz(Ci.GTBIRlz.ACCESS_FFTB3_BOX,b);this.userPrefs_.setPref("rlz",b);this.prefs_.setPref("rlz",b)};a.recordInstall=function(){this.rlzService_&&this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FFTB3_BOX,Ci.GTBIRlz.EVENT_INSTALL)};
a.recordGoogleHomepageInstall=function(){this.rlzService_&&this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FF_HOME_PAGE,Ci.GTBIRlz.EVENT_INSTALL)};a.recordFirstSearch=function(){this.rlzService_&&this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FFTB3_BOX,Ci.GTBIRlz.EVENT_FIRST_SEARCH)};
a.recordRlsIfAny=function(){if(this.rlzService_){var b=this.generateRlsOneTimeOnly_();if(b){this.rlzService_.recordRls(Ci.GTBIRlz.ACCESS_FFTB3_BOX,b);this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FFTB3_BOX,Ci.GTBIRlz.EVENT_REPORT_RLS)}if(!this.userPrefs_.getPref("rlz.ffsb.rls_reported")){this.userPrefs_.setPref("rlz.ffsb.rls_reported",true);b=(b=new GTB_FFSearchBox)&&b.reportRls();this.rlzService_.recordRls(Ci.GTBIRlz.ACCESS_FF_SEARCH_BOX,b);this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FF_SEARCH_BOX,
Ci.GTBIRlz.EVENT_REPORT_RLS)}b=(new G_Preferences).getPref("browser.startup.homepage");var c=b.match("rls=([^&]*)");if(c&&GTB_isGoogleUrl(b)){c=c[1];this.rlzService_.recordRls(Ci.GTBIRlz.ACCESS_FF_HOME_PAGE,c);this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FF_HOME_PAGE,Ci.GTBIRlz.EVENT_REPORT_RLS)}}};
a.recordFirefoxEventsIfAny=function(){if(this.rlzService_){var b=new GTB_FFSearchBox;if(!this.userPrefs_.getPref("rlz.ffsb.install_reported"))if(b.getInstallEvent()){this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FF_SEARCH_BOX,Ci.GTBIRlz.EVENT_INSTALL);this.userPrefs_.setPref("rlz.ffsb.install_reported",true)}if(!this.userPrefs_.getPref("rlz.ffsb.first_search_reported"))if(b.getFirstSearchEvent()){this.rlzService_.recordEvent(Ci.GTBIRlz.ACCESS_FF_SEARCH_BOX,Ci.GTBIRlz.EVENT_FIRST_SEARCH);this.userPrefs_.setPref("rlz.ffsb.first_search_reported",
true)}}};a.updateRlz=function(){if(this.rlzService_){var b=this.rlzService_.getAccessPointRlz(Ci.GTBIRlz.ACCESS_FF_SEARCH_BOX);(new GTB_FFSearchBox).setRlz(b);if(b=this.rlzService_.getAccessPointRlz(Ci.GTBIRlz.ACCESS_FF_HOME_PAGE)){var c=new G_Preferences("browser.startup."),d=c.getPref("homepage"),e=d.match(/rlz=([^&]*)/);e=e&&e[1];b!=e&&GTB_isGoogleUrl(d)&&c.setPref("homepage",d.replace(/rl[sz]=[^&]*/,"rlz="+b))}}};
a.sendPing=function(){if(this.rlzService_){this.recordRlsIfAny();this.recordFirefoxEventsIfAny();this.rlzService_.sendFinancialPing(this.getBrand(),this.getToolbarId(),GTB_getLangCode());this.updateRlz()}};
a.generateRlsOneTimeOnly_=function(){if(this.userPrefs_.getPref("rlz.fftb.rls_reported"))return"";this.userPrefs_.setPref("rlz.fftb.rls_reported",true);var b=this.mPrefs_.getLocalMachineString("installtime");if(!b)return"";b=new Date(parseFloat(b));var c=new Date;c.setFullYear(parseInt(b.getFullYear(),10),1,1);c=b.getTime()-c.getTime();c=Math.floor(c/6048E5)+1;b=b.getFullYear()+"-"+c;c=this.getBrand();return c+","+c+":"+b+","+c+":"+GTB_getLangCode()};
a.getBrand=function(){var b=this.userPrefs_.getPref("brandCode"),c=this.getBrandFromOmaha();if(c==null)c=b;if(c==null)c=this.mPrefs_.getLocalMachineString("brand");if(c==null)c="GGLL";c!=b&&this.userPrefs_.setPref("brandCode",c);return c};
a.getBrandFromOmaha=function(){var b=null;try{var c=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);c.open(Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE,"SOFTWARE\\Google\\Update\\ClientState\\{2CCBABCB-6427-4A55-B091-49864623C43F}",Ci.nsIWindowsRegKey.ACCESS_READ);b=c.readStringValue("brand");c.close()}catch(d){c&&c.close()}return b};
a.getToolbarId=function(){var b=null;if(b=this.mPrefs_.getLocalMachineString("id")){this.prefs_.setPref("install_id",b);return b}try{b=this.prefs_.getPref("install_id")}catch(c){b=null}if(b)return b;b=this.generateId_();this.prefs_.setPref("install_id",b);this.mPrefs_.setLocalMachineString("id",b);return b};
a.generateId_=function(){var b="",c=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];try{var d=Cc["@google.com/toolbar/utils;1"].getService(Ci.GTBIUtils),e=d.getMachineId();if(e)b=e+"Z"}catch(f){}for(b||(b="XZ");b.length<50;)b+=c[Math.floor(Math.random()*c.length)];return b};a.clearAll=function(){this.rlzService_&&this.rlzService_.clearAll()};function GTB_CB_Button(b,c){this.debugZone="GTB_CB_Button";this.xmlDoc_=b;if(!c)throw Error("No button id specified");this.id_=c;this.service_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;this.description_=this.icon_=this.title_=null;this.hasOption_=false;this.legacy_=this.feed_=this.sendCharset_=this.sendMethod_=this.send_=this.searchCharset_=this.searchMethod_=this.search_=this.site_=this.update_=this.optionDefault_=this.optionDescription_=this.optionTitle_=null;
this.preferenceName_="google.toolbar.button_option."+this.id_;this.prefs_=new G_Preferences(this.preferenceName_);this.version_=GTB_CB_XmlUtils.getButtonVersion(b);this.title_=GTB_CB_XmlUtils.getTextContent("title",b);if(!this.title_)throw Error("No title");this.description_=GTB_CB_XmlUtils.getTextContent("description",b);var d=GTB_CB_XmlUtils.getNode("//gtb:icon-url",b);if(d)this.icon_=d.textContent;else if(d=GTB_CB_XmlUtils.getNode("//gtb:icon",b))this.icon_="data:image/x-icon;base64,"+d.textContent.replace(/\s+/g,
"");d=["update","site","search","send","feed"];for(var e=0;e<d.length;e++){var f=d[e],g=GTB_CB_XmlUtils.getNode("//gtb:"+f,b);if(g){this[f+"_"]=g.textContent;var h=g.getAttribute("method");if(h)this[f+"Method_"]=h;if(g=g.getAttribute("charset"))this[f+"Charset_"]=g}}d=GTB_CB_XmlUtils.getNode("//gtb:gadget",b);this.gadgetDescription_=null;if(d)try{this.gadgetDescription_=new GTB_CB_GadgetDescription(d,this.prefs_)}catch(i){}if(d=GTB_CB_XmlUtils.getTextContent("update",b,true))this.update_=d;if(this.site_){d=
Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(this.site_,null,null);if(!d.schemeIs("http")&&!d.schemeIs("https"))throw Error("Unsafe scheme");}if(this.search_&&this.search_.indexOf("{query}")==-1&&this.search_.indexOf("{1}")==-1)throw Error("No {query} or {1} in search URL");if(this.send_&&this.send_.indexOf("{selection}")==-1)throw Error("No {selection} in send URL");d=this.site_||this.search_||this.send_||this.feed_;if(!d)throw Error("Button has no URL");if(d=GTB_CB_XmlUtils.getNode("//gtb:option",
b)){this.hasOption_=true;this.optionTitle_=GTB_CB_XmlUtils.getTextContent("option/gtb:title",b);this.optionDescription_=GTB_CB_XmlUtils.getTextContent("option/gtb:description",b);if(d=GTB_CB_XmlUtils.getNode("//gtb:option/gtb:default",b))this.optionDefault_=d.textContent}this.buttonFeed_=null;if(d=GTB_CB_XmlUtils.getNode("//gtb:legacy",b))this.legacy_=d.textContent.trim();if(d=GTB_CB_XmlUtils.getNode("//gtb:feed",b))this.buttonFeed_=new GTB_ButtonFeed(this,this.prefs_,d,b)}a=GTB_CB_Button.prototype;
a.isStub=function(){return false};a.isAdvancedEditorAvailable=function(){return this.canRemove()};a.canRemove=function(){return!this.isBuiltInSearch()&&!this.isShared()};a.remove=function(){for(var b=this.prefs_.getChildNames(),c=0;c<b.length;c++)this.prefs_.clearPref("."+b[c])};
a.migrateVisibilityFromIE=function(){if(Ci.nsIWindowsRegKey&&Cc["@mozilla.org/windows-registry-key;1"]){var b=this.getIEButtonRegistryKeyName(),c=null,d=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);try{d.open(Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER,"Software\\Google\\Google Toolbar\\4.0\\Options\\Custom Buttons\\"+b,Ci.nsIWindowsRegKey.ACCESS_READ);c=d.readIntValue("ontoolbar");d.close()}catch(e){}0==c&&this.prefs_.setPref("",false)}};
a.getIEButtonRegistryKeyName=function(){throw Error("This method must be implmented in descendants");};a.updateFeed=function(b){this.buttonFeed_&&this.isVisible()&&this.buttonFeed_.updateFeed(b)};a.updateFeedIfOnline=function(){this.buttonFeed_&&this.isVisible()&&this.buttonFeed_.updateFeedIfOnline()};a.stopFeed=function(){this.buttonFeed_&&this.buttonFeed_.stopFeed()};
a.makeMenuItem=function(b){b=b.createElement("menuitem");b.setAttribute("id",this.getID()+"Popup");b.setAttribute("class","menuitem-iconic");var c=this.getName();b.setAttribute("label",c);b.setAttribute("tooltiptext",this.getTooltipText());b.setAttribute("image",this.getIconDefault());return b};
a.getQueryURL=function(b,c,d){var e;if(this.search_&&b.trim()){e=this.search_;c=this.encodeQuery(b);e=e.replace(/\{1\}/g,c);e=e.replace(/\{query\}/g,c)}else if(this.send_&&c.trim()){e=this.send_;c=this.encodeQueryUsingCharset_(c,this.sendCharset_);e=e.replace(/\{selection\}/g,c)}else e=this.site_||this.search_;c=GTB_getGoogleDomain();e=e.replace("{0}",c);e=e.replace("{domain}",c);if(d){e=e.replace("{url}",encodeURIComponent(d.asciiSpec));e=e.replace("{url.noescape}",encodeURIComponent(d.spec));try{e=
e.replace("{url.host}",d.host)}catch(f){}}d=GTB_getSearchLocale();if(d=="none")d="";e=e.replace("{locale}",d);d=this.getOptionValue();e=e.replace("{option1}",encodeURIComponent(d));e=e.replace("{find}",b?"/find":"");e=e.replace("{sourceid}","&sourceid=navclient-ff");if(b=(new GTB_Pinging).getRLZ())e=e.replace("{rlz}","&rlz="+b);return e=e.replace(/[{][^}]*[}]/g,"")};a.encodeQuery=function(b){return this.encodeQueryUsingCharset_(b,this.searchCharset_)};
a.encodeQueryUsingCharset_=function(b,c){var d;if(c&&"UTF-8"!=c.toUpperCase()){var e=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);try{e.charset=c;d=escape(e.ConvertFromUnicode(b)+e.Finish())}catch(f){d=encodeURIComponent(b)}}else d=encodeURIComponent(b);return d.replace(/%20/g,"+")};a.canPerformSearch=function(){var b=this.gadgetDescription_;if(b&&b.isWholeDropdown())return!!b.getQueryPreferenceName();return!!this.getURL("search")};
a.canSendSelection=function(){var b=this.gadgetDescription_;if(b&&b.isWholeDropdown())return!!b.getSelectionPreferenceName();return!!this.getURL("send")};a.getID=function(){return this.id_};a.getVersion=function(){return this.version_};a.isNewerThan=function(b){if(!this.version_)return false;if(!b.version_)return true;return this.version_>b.version_};a.getXmlDoc=function(){return this.xmlDoc_};a.getFile=function(){return null};a.getTitle=function(){return this.title_};
a.getTooltipText=function(){return this.getDescriptionDefault()||this.getTitle()};a.getPreferenceName=function(){return this.preferenceName_};a.getButtonFeed=function(){return this.buttonFeed_};a.getGadgetDescription=function(){return this.gadgetDescription_};a.getName=function(){return this.prefs_.getPref(".name")||this.getTitle()};a.getChangedName=function(){return this.prefs_.getPref(".name")};a.setName=function(b){this.prefs_.setPref(".name",b)};
a.getNameFull=function(){var b=this.getName(),c=this.getOptionValue();if(c){var d=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);d=d.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");d=d.GetStringFromName("prop.gtb.custombuttons.name");b=d.replace("&NAME;",b).replace("&OPTION;",c)}return b};a.getIconDefault=function(){return this.icon_?this.icon_:this.getGadgetDescription()?"chrome://google-toolbar/skin/gadget-blue-ball.png":"chrome://google-toolbar/skin/custom-unknown.png"};
a.getIcon=function(){if(this.buttonFeed_){var b=this.buttonFeed_.getCurrentStateIcon();if(b)return b}return this.getIconDefault()};a.getDescriptionDefault=function(){return this.description_};a.getDescription=function(){if(this.buttonFeed_){var b=this.buttonFeed_.getFeedDescription();if(b)return b}return this.description_};a.getURL=function(b){return this[b+"_"]};a.getSearchMethod=function(){return this.searchMethod_=="post"?this.searchMethod_:"get"};
a.getSearchCharset=function(){return this.searchCharset_||"UTF-8"};a.getSendMethod=function(){return this.sendMethod_=="post"?this.sendMethod_:"get"};a.getSendCharset=function(){return this.sendCharset_||"UTF-8"};a.menuEnabled=function(){return!!(this.buttonFeed_&&this.buttonFeed_.isMenuEnabled())};goog.exportSymbol("GTB_CB_Button.prototype.menuEnabled",GTB_CB_Button.prototype.menuEnabled);a=GTB_CB_Button.prototype;a.getOptionTitle=function(){return this.optionTitle_};a.getOptionDescription=function(){return this.optionDescription_};
a.getOptionDefault=function(){return this.optionDefault_||""};a.getOptionValue=function(){return this.prefs_.getPref(".option")||this.getOptionDefault()};a.setOptionValue=function(b){this.prefs_.setPref(".option",b)};a.hasOption=function(){return this.hasOption_};a.isVisible=function(){return this.prefs_.getPref("")&&!this.isSearchTypeWithoutButton()};a.hide=function(){return this.prefs_.setPref("",false)};a.show=function(){return this.prefs_.setPref("",true)};
a.isShared=function(){return this.id_.charAt(3)=="s"};a.getLegacy=function(){return this.legacy_};a.setTitle=function(b){this.title_=b;var c=GTB_CB_XmlUtils.getNode("//gtb:title",this.xmlDoc_);c.textContent=b};a.setDescription=function(b){this.description_=b;var c=GTB_CB_XmlUtils.getNode("//gtb:description",this.xmlDoc_);c.textContent=b};a.setSearchUrl=function(b){this.search_=b;var c=GTB_CB_XmlUtils.getNode("//gtb:search",this.xmlDoc_);c.textContent=b};a.isBuiltInSearch=function(){return this.service_.isBuiltInUpdateUrl(this.getURL("update"))};
a.isSearchTypeWithoutButton=function(){return false};goog.exportSymbol("GTB_CB_Button.prototype.isSearchTypeWithoutButton",GTB_CB_Button.prototype.isSearchTypeWithoutButton);GTB_CB_Button.prototype.isIconSetInStyleSheet=function(){return false};function GTB_CB_GadgetDescription(b,c){this.debugZone="GTB_CB_GadgetDescription";this.gadgetUrl_=b.textContent.trim();if(!this.gadgetUrl_.startsWith("http://"))throw Error("Unsupported protocol: "+this.gadgetUrl_);this.width_=parseInt(b.getAttribute("width"),10);if(isNaN(this.width_)||this.width_<=0)this.width_=300;this.height_=parseInt(b.getAttribute("height"),10);if(isNaN(this.height_)||this.height_<=0)this.height_=200;this.defaultOptions_=b.getAttribute("default-options");this.isWholeDropdown_=
"true"==b.getAttribute("whole-dropdown");this.urlGadgetPreference_=b.getAttribute("url");this.hostGadgetPreference_=b.getAttribute("host");this.queryGadgetPreference_=b.getAttribute("query");this.selectionGadgetPreference_=b.getAttribute("selection");this.option1GadgetPreference_=b.getAttribute("option1");this.prefs_=c}a=GTB_CB_GadgetDescription.prototype;a.getUrl=function(){return this.gadgetUrl_};a.getWidth=function(){return this.prefs_.getPref(".width",this.width_)};
a.getHeight=function(){return this.prefs_.getPref(".height",this.height_)};a.setUserSize=function(b,c){this.prefs_.setPref(".width",b);this.prefs_.setPref(".height",c)};a.setWidth=function(b){this.width_=b};a.setHeight=function(b){this.height_=b};a.isWholeDropdown=function(){return this.isWholeDropdown_};a.getQueryPreferenceName=function(){return this.queryGadgetPreference_};a.getSelectionPreferenceName=function(){return this.selectionGadgetPreference_};
a.getSyndicationUrl=function(b,c){var d={};GTB_CB_GadgetDescription.parseParamString_(this.defaultOptions_,d);GTB_CB_GadgetDescription.parseParamString_(this.getGadgetOptions(),d);var e=b.GTB_GoogleToolbarOverlay._getCurrentBrowser().currentURI;if(this.urlGadgetPreference_)d["up_"+this.urlGadgetPreference_]=encodeURIComponent(e.spec);if(this.hostGadgetPreference_){var f;try{f=e.host}catch(g){f=""}d["up_"+this.hostGadgetPreference_]=encodeURIComponent(f)}e=!!this.selectionGadgetPreference_;e=GTB_CB_Manager.getQueryAndSelectionText(b.document,
e);f=e.selectedText;if(this.selectionGadgetPreference_&&f)d["up_"+this.selectionGadgetPreference_]=encodeURIComponent(f);else if(this.queryGadgetPreference_){e=encodeURIComponent(e.query);d["up_"+this.queryGadgetPreference_]=e}if(this.option1GadgetPreference_){e=encodeURIComponent(c.getOptionValue());d["up_"+this.option1GadgetPreference_]=e}d.url=encodeURIComponent(this.gadgetUrl_);this.addI18NParameters_(d);d=GTB_CB_GadgetDescription.paramsMapToString_(d);return"http://navclient.gmodules.com/gadgets/ifr?synd=navclient-ff&oe=utf8&view=home&"+
d};a.getGadgetOptionsUrl=function(){var b={};GTB_CB_GadgetDescription.parseParamString_(this.defaultOptions_,b);GTB_CB_GadgetDescription.parseParamString_(this.getGadgetOptions(),b);b.url=encodeURIComponent(this.gadgetUrl_);this.addI18NParameters_(b);b=GTB_CB_GadgetDescription.paramsMapToString_(b);return"http://toolbar.google.com/buttons/gadgetsettings?synd=navclient-ff&oe=utf8&"+b};
a.addI18NParameters_=function(b){b.lang=GTB_getLangCode();var c=GTB_GOOGLE_HOME_DICT[GTB_getGoogleHome()].iso.split(";");b.country=c[0]};a.getGadgetOptions=function(){return this.prefs_.getPref(".gadgetOptions","")};a.setGadgetOptions=function(b){this.prefs_.setPref(".gadgetOptions",b)};GTB_CB_GadgetDescription.parseParamString_=function(b,c){if(b)for(var d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0])c[f[0]]=f.length>1?f[1]:""}};
GTB_CB_GadgetDescription.paramsMapToString_=function(b){var c=[];for(var d in b)c.push(d+"="+b[d]);return c.join("&")};function G_CryptoHasher(){this.debugZone="cryptohasher";this.hasher_=Cc["@mozilla.org/security/hash;1"].createInstance(Ci.nsICryptoHash);this.initialized_=false;if(!G_CryptoHasher.algorithms)G_CryptoHasher.algorithms={MD2:Ci.nsICryptoHash.MD2,MD5:Ci.nsICryptoHash.MD5,SHA1:Ci.nsICryptoHash.SHA1,SHA256:Ci.nsICryptoHash.SHA256,SHA384:Ci.nsICryptoHash.SHA384,SHA512:Ci.nsICryptoHash.SHA512}}a=G_CryptoHasher.prototype;
a.init=function(b){var c=false;for(var d in G_CryptoHasher.algorithms)if(b==G_CryptoHasher.algorithms[d])c=true;if(!c)throw Error("Invalid algorithm: "+b);this.initialized_=true;this.algo_=b;this.reset()};a.reset=function(){this.hasher_.init(this.algo_)};a.updateFromString=function(b){if(!this.initialized_)throw Error("You must initialize the hasher first!");var c=Cc["@mozilla.org/io/string-input-stream;1"].createInstance(Ci.nsIStringInputStream);c.setData(b,b.length);this.updateFromStream(c)};
a.updateFromArray=function(b){if(!this.initialized_)throw Error("You must initialize the hasher first!");this.hasher_.update(b,b.length)};a.updateFromStream=function(b){if(!this.initialized_)throw Error("You must initialize the hasher first!");b.available()&&this.hasher_.updateFromStream(b,b.available())};a.update=function(b){this.updateFromArray(b)};a.digest=function(){for(var b=this.digestRaw(),c=Array(b.length),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return c};a.digestRaw=function(){return this.hasher_.finish(false)};
a.digestBase64=function(){return this.hasher_.finish(true)};a.digestHex=function(){var b=this.digestRaw();return this.toHex_(b)};a.toHex_=function(b){for(var c="0123456789ABCDEF",d=Array(b.length*2),e=0;e<b.length;++e){d[e*2]=c.charAt(b.charCodeAt(e)>>4&15);d[e*2+1]=c.charAt(b.charCodeAt(e)&15)}return d.join("")};var GTB_CB_IdRoutines={};GTB_CB_IdRoutines.debugZone="GTB_CB_IdRoutines";GTB_CB_IdRoutines.MAX_HOST_LENGTH=64;GTB_CB_IdRoutines.suggestButtonFile=function(b,c){var d=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(b,null,null).host;d=GTB_CB_IdRoutines.sanitizeHost_(d);for(var e=b;;){e=GTB_CB_IdRoutines.hashStringUsingIEToolbarAlgorithm_(e);var f=d+"_"+e+".xml",g=c.clone().QueryInterface(Ci.nsILocalFile);g.appendRelativePath(f);if(!g.exists())return g}};
GTB_CB_IdRoutines.generateButtonIdFromFile=function(b){var c=GTB_CustomButtonsService.getUserDirectory();c=c.contains(b,false)?"gtbu":"gtbs";b.QueryInterface(Ci.nsIFile);return c+b.leafName.replace(/\.|,/g,"-")};
GTB_CB_IdRoutines.generateButtonIdFromUrl=function(b){var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(b,null,null).host;c=GTB_CB_IdRoutines.sanitizeHost_(c);b=GTB_CB_IdRoutines.hashStringUsingIEToolbarAlgorithm_(b);c=c+"_"+b+".xml";return c="gtbu"+c.replace(/\.|,/g,"-")};
GTB_CB_IdRoutines.hashStringUsingIEToolbarAlgorithm_=function(b){var c=new G_CryptoHasher;c.init(G_CryptoHasher.algorithms.SHA1);c.updateFromString(b);b=c.digestRaw();c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var d=Array(b.length),e=0;e<b.length;++e)d[e]=c.charAt(b.charCodeAt(e)%36);return d.join("")};
GTB_CB_IdRoutines.sanitizeHost_=function(b){b=b.toLowerCase();b=b.substr(0,GTB_CB_IdRoutines.MAX_HOST_LENGTH);for(var c=[],d=0;d<b.length;d++){var e=b.charAt(d);if("a"<=e&&e<="z")c.push(e);else if("0"<=e&&e<="9")c.push(e);else if("."==e||"-"==e)c.push(e)}return c.join("")};
GTB_CB_IdRoutines.convertButtonDefinitions=function(b){if(b&&b.exists())for(var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService),d=b.directoryEntries;d.hasMoreElements();){var e=d.getNext().QueryInterface(Ci.nsIFile);try{var f=G_FirefoxXMLUtils.loadXML(e),g=GTB_CB_XmlUtils.getUpdateUrl(f);if(g){var h=c.newURI(g,null,null).host;h=GTB_CB_IdRoutines.sanitizeHost_(h);var i=GTB_CB_IdRoutines.hashStringUsingIEToolbarAlgorithm_(g),j=h+"_"+i+".xml";if(j!=e.leafName)try{e.moveTo(b,j)}catch(k){}}}catch(l){}}};function GTB_CB_RegistryButton(b,c){GTB_CB_Button.call(this,b,GTB_CB_RegistryButton.buttonIdFromRegistryKey_(c));this.debugZone="GTB_CB_RegistryButton";this.regKeyName_=c}GTB_CB_RegistryButton.inherits(GTB_CB_Button);GTB_CB_RegistryButton.buttonIdFromRegistryKey_=function(b){if(!b)throw Error("no reg key specified");var c=b.toLowerCase(),d=null;if(c.startsWith("hkcu_"))d="gtbu";else if(c.startsWith("hklm_"))d="gtbs";else throw Error("invalid reg key name");return d+b};
GTB_CB_RegistryButton.prototype.remove=function(){GTB_CB_Button.prototype.remove.call(this);if(Ci.nsIWindowsRegKey&&Cc["@mozilla.org/windows-registry-key;1"]){var b=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey),c=this.regKeyName_.split("_");if(c.length==2){var d=c[0].toLowerCase()=="hklm"?Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE:Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER;try{b.open(d,"Software\\Google\\CustomSearch",Ci.nsIWindowsRegKey.ACCESS_ALL);b.removeChild(c[1]);
b.close()}catch(e){}}}};GTB_CB_RegistryButton.prototype.getIEButtonRegistryKeyName=function(){return"L_"+this.regKeyName_};function GTB_CustomButtonsService(){this.debugZone="custom-buttons-service";this.buttons_={};this.builtInButtons_={};this.prefs_=this.defaultBuiltInOrder_=this.list_=null;this.syncStatus_=this.ignorePrefChanges_=false;this.toolbarPrefs_=null;this.noFade_=0;this.realButtonLoadTimer_=this.cachedButtonsUI_=null;this.wrappedJSObject=this}GTB_CustomButtonsService.GTB_CB_VERSION=1;a=GTB_CustomButtonsService.prototype;
a.init=function(){GTB_StartupProfiler.timestamp("+CustomButtonsService.init");var b=new G_Preferences("google.toolbar.custombuttons.");if(b.getPref("version")!=GTB_CustomButtonsService.GTB_CB_VERSION){GTB_CB_IdRoutines.convertButtonDefinitions(GTB_CustomButtonsService.getUserDirectory());GTB_CB_IdRoutines.convertButtonDefinitions(GTB_CustomButtonsService.getSharedDirectory());b.setPref("version",GTB_CustomButtonsService.GTB_CB_VERSION)}this.observerService_=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);
this.observers_=[new G_ObserverServiceObserver("gaia-signin-change",BindToObject(this.observeSignin_,this)),new G_ObserverServiceObserver("gaia-email-change",BindToObject(this.observeGaiaChangeEmail_,this)),new G_ObserverServiceObserver("GTB_CB_EDIT",BindToObject(this.observeEdit,this)),new G_ObserverServiceObserver("GTB_CB_SAVE",BindToObject(this.observeSave,this)),new G_ObserverServiceObserver("xpcom-shutdown",BindToObject(this.shutdown,this))];this.prefs_=new G_Preferences("google.toolbar.button_option.");
this.prefs_.addObserver("",BindToObject(this.prefChanged_,this));this.toolbarPrefs_=new G_Preferences("google.toolbar.");this.toolbarPrefs_.addObserver("google_home",BindToObject(this.onGoogleHomeChange_,this));this.list_=new GTB_CustomButtonList;GTB_StartupProfiler.timestamp("new GTB_CustomButtonList()");if(this.cachedButtonsUI_=this.loadCachedButtonsUI_()){var c=this.prefs_;for(var d in this.cachedButtonsUI_)this.buttons_[d]={id_:d,getID:function(){return this.id_},isStub:function(){return true},
isVisible:function(){return c.getPref(this.id_)},menuEnabled:function(){return false},getLegacy:function(){return null}};this.realButtonLoadTimer_=new G_Alarm(BindToObject(this.loadButtonsFromDisk,this,true),1E3)}else this.loadButtonsFromDisk(true);GTB_StartupProfiler.timestamp("-CustomButtonsService.init")};a.loadCachedButtonsUI_=function(){var b=this.list_.toArray();if(b.length==0)return null;for(var c={},d=0,e;e=b[d];d++){var f=this.prefs_.getPref("cached."+e,null);if(!f)return null;c[e]=f}return c};
a.getCachedButtonsUI=function(){return this.cachedButtonsUI_};a.releaseCachedButtonsUI=function(){Date.now()+" buttonsCreated";this.cachedButtonsUI_=null};a.buttonsAreLoaded=function(){return this.realButtonLoadTimer_==null};a.forceLoadButtons=function(){if(this.realButtonLoadTimer_){this.realButtonLoadTimer_.cancel();this.loadButtonsFromDisk(true)}};
a.loadButtonsFromDisk=function(b){Date.now()+" loadButtonsFromDisk";GTB_StartupProfiler.timestamp("+loadButtonsFromDisk");this.cachedButtonsUI_=this.realButtonLoadTimer_=null;var c=new G_Preferences("google.toolbar.custombuttons.");this.loadBuiltInButtons_();GTB_StartupProfiler.timestamp("loadBuiltInButtons_");this.loadButtons_(GTB_CustomButtonsService.getSharedDirectory());GTB_StartupProfiler.timestamp("loadFromSharedDirectory");this.loadButtons_(GTB_CustomButtonsService.getUserDirectory());GTB_StartupProfiler.timestamp("loadFromUserDirectory");
this.loadOldCustomSearchButtons_();if(b&&!c.getPref("migrated",false)){this.migrateButtonVisibilityFromIE_();this.migrateButtonVisFromPrevTb_();c.setPref("migrated","true");GTB_StartupProfiler.timestamp("migrate visibility")}this.removeStubs_();this.list_.update();c=this.list_.toArray();this.setNoFade(true);for(var d=0;d<c.length;++d)this.observerService_.notifyObservers(null,"GTB_CB_UPDATE",c[d]);this.setNoFade(false);if(b&&!GTB_GlobalPrefs.hasUserValue(GTB_CustomButtonsService.PREF_ORDER_MIGRATED)){b=
this.migrateButtonOrder_();GTB_GlobalPrefs.setPref(GTB_CustomButtonsService.PREF_ORDER_MIGRATED,!!b);b&&new G_Alarm(BindToObject(this.setButtonList,this,b),0)}new G_Alarm(BindToObject(this.startFeedsForVisibleButtons_,this),3E3);GTB_StartupProfiler.timestamp("-loadButtonsFromDisk")};a.hasStubs=function(){var b=false;for(var c in this.buttons_){var d=this.buttons_[c];if(d.isStub())b=true}return b};
a.removeStubs_=function(){var b=[],c;for(c in this.buttons_){var d=this.buttons_[c];d.isStub()&&b.push(c)}for(d=0;d<b.length;++d){c=b[d];this.list_.remove(c);delete this.buttons_[c];this.observerService_.notifyObservers(null,"GTB_CB_REMOVE",c)}};a.startFeedsForVisibleButtons_=function(){GTB_StartupProfiler.timestamp("+startFeedsForVisibleButtons_");for(var b=this.list_.getVisible(),c=0;c<b.length;++c){var d=b[c];d=this.buttons_[d];d.updateFeedIfOnline()}GTB_StartupProfiler.timestamp("-startFeedsForVisibleButtons_")};
GTB_CustomButtonsService.PREF_ORDER_MIGRATED="google.toolbar.custombuttons.order.migrated.to.v6";GTB_CustomButtonsService.DEFAULT_V5_ORDER=["gtbSearchScholar","gtbSearchPhotos","gtbSearchPatents","gtbSearchFinance","gtbSearchDocs","gtbSearchCalendar","gtbSearchBooks","gtbSearchBlogs","gtbSearchVideo","gtbstoolbar-google-com_CTK0Y7F4MTG6NKYH03WT-xml","gtbSearchLocal","gtbSearchFroogle","gtbSearchGroups","gtbSearchImages","gtbSearchNews","gtbSearchWebhistory","gtbFeelingLucky","gtbSearchSite","gtbCountrySearch"];
GTB_CustomButtonsService.DEFAULT_SHARED_BUTTONS=["gtbstoolbar-google-com_J66T77NJDBMW4FEUU7FA-xml","gtbstoolbar-google-com_O8Y91YHB24Z6SR0SGYSK-xml"];a=GTB_CustomButtonsService.prototype;
a.migrateButtonOrder_=function(){var b=GTB_CustomButtonsService.DEFAULT_V5_ORDER.filter(GTB_buttonAvailableInDomain),c=this.list_.toArray(),d=c.indexOf(b[0]),e=d+b.length;if(d<0||e>c.length||c.slice(d,e).toString()!=b.toString())return null;for(b=0;d>0&&GTB_CustomButtonsService.DEFAULT_SHARED_BUTTONS.indexOf(c[d-1])>=0;){b++;d--}for(;e<c.length&&GTB_CustomButtonsService.DEFAULT_SHARED_BUTTONS.indexOf(c[e])>=0;){b++;e++}if(b!=2)return null;return c.slice(0,d).concat(this.defaultBuiltInOrder_,c.slice(e))};
a.shutdown=function(){this.buttons_=null;for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.observers_=null};a.migrateButtonVisibilityFromIE_=function(){for(var b in this.buttons_){var c=this.buttons_[b];c.migrateVisibilityFromIE()}};
a.migrateButtonVisFromPrevTb_=function(){var b=this.prefs_.getPref("gtbCustomButtonGmail",null);if(b!=null){var c=this.findButtonByUpdateUrl("http://toolbar.google.com/buttons/defs/mail.google.com.xml");if(c){this.prefs_.setPref(c.getID(),b);this.prefs_.clearPref("gtbCustomButtonGmail")}}c=[{pref:"gtbCustomButtonDesktop",id:"Google Desktop Search"},{pref:"gtbCustomButtonGoogle Earth",id:"GoogleEarth"}];for(var d=0,e=null;e=c[d];++d){b=this.prefs_.getPref(e.pref,null);if(b!=null){var f="gtbuHKCU_"+
e.id;this.buttons_[f]||(f="gtbsHKLM_"+e.id);if(this.buttons_[f])this.prefs_.setPref(f,b);else if(e.id=="GoogleEarth")for(var g in this.buttons_){f=this.buttons_[g];f.getLegacy()=="GoogleEarth"&&this.prefs_.setPref(g,b)}this.prefs_.clearPref(e.pref)}}};a.observeSignin_=function(b,c,d){this.forceLoadButtons();b=this.getAllButtons();for(var e in b){c=b[e];(c=c.getButtonFeed())&&c.gaiaSignedInStateChanged(d)}};
a.observeGaiaChangeEmail_=function(b,c,d){this.forceLoadButtons();b=this.getAllButtons();for(var e in b){c=b[e];(c=c.getButtonFeed())&&c.gaiaEmailChanged(d)}};a.observeEdit=function(b,c,d){if(c=this.getButton(d)){b.QueryInterface(Ci.nsIDOMNode);b=b.contentDocument;c=c.getXmlDoc();d=b.getElementById("custom_button_xml");d.value=G_FirefoxXMLUtils.getXMLString(c);c=b.getElementsByTagName("input")[2];b=b.getElementById("action");b.textContent=c.getAttribute("value")}};
a.observeSave=function(b,c,d){b.QueryInterface(Ci.nsIDOMNode);b=b.contentDocument;b=b.getElementById("custom_button_xml").value;try{var e=G_FirefoxXMLUtils.parseString(b)}catch(f){e=null}b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getMostRecentWindow("navigator:browser");b=b.GTB_getToolbar().customButtons;d=this.getButton(d);b.promptEditorInstall_(e,d)};GTB_CustomButtonsService.namespaceResolver=function(){return"http://toolbar.google.com/custombuttons/"};
a=GTB_CustomButtonsService.prototype;a.tryToCopyButtonFile_=function(b,c){if(!c)return null;var d=c.clone();d.append(b.leafName);if(d.exists())throw Error("File already exists "+d.path);try{b.copyTo(c,null);return d}catch(e){return null}};
a.prefChanged_=function(b){if(!this.ignorePrefChanges_){var c=this.buttons_[b];if(c){if(!c.isSearchTypeWithoutButton()){var d=this.prefs_.getPref(b),e=d?"GTB_CB_SHOW":"GTB_CB_HIDE";this.observerService_.notifyObservers(null,e,b);if(d)new G_Alarm(BindToObject(c.updateFeed,c),0);else c.stopFeed()}}else{if(b.substr(-6)=="option"){d=b.substring(0,b.length-7);if(c=this.buttons_[d]){new G_Alarm(BindToObject(c.updateFeedIfOnline,c),0);this.observerService_.notifyObservers(null,"GTB_CB_NAMECHANGE",d);return}}if(b.substr(-4)==
"name"){d=b.substring(0,b.length-5);(c=this.buttons_[d])&&this.observerService_.notifyObservers(null,"GTB_CB_NAMECHANGE",d)}}}};a.registerLoadedButton_=function(b){var c=this.buttons_[b.getID()],d=b.getURL("update");if(!c&&d)c=this.builtInButtons_[d];if(!(c&&!c.isStub()&&!b.isNewerThan(c))){if(c&&c.getID()!=b.getID()){this.list_.remove(c.getID());delete this.buttons_[c.getID()]}this.registerNewButton_(b)}};
a.registerNewButton_=function(b){var c=b.getID();this.buttons_[c]=b;!this.list_.contains(c)&&!b.isSearchTypeWithoutButton()&&this.list_.push(c);var d=b.getURL("update");if(d&&d in this.builtInButtons_)this.builtInButtons_[d]=b;c=this.prefs_.getPref(c);c==null&&this.setButtonVisible_(b)};a.setButtonVisible_=function(b){b=b.getID();this.ignorePrefChanges_=true;try{this.prefs_.setPref(b,true)}finally{this.ignorePrefChanges_=false}};GTB_CustomButtonsService.getBuiltinButtons_=function(){return[]};
GTB_CustomButtonsService.registerBuiltinButtons=function(b){GTB_CustomButtonsService.getBuiltinButtons_=b};a=GTB_CustomButtonsService.prototype;
a.loadBuiltInButtons_=function(){var b=GTB_CustomButtonsService.getBuiltinButtons_(),c=GTB_CustomButtonsService.getDefaultButtonsDirectory();this.defaultBuiltInOrder_=[];for(var d=c.directoryEntries;d.hasMoreElements();){c=d.getNext().QueryInterface(Ci.nsIFile);if(!(c.leafName in GTB_BuiltInButtonFromFileFactory.FILE_NAMES))if(c=this.loadButtonFromFile_(c)){var e=c.getURL("update");if(e)this.builtInButtons_[e]=c;this.defaultBuiltInOrder_.unshift(c.getID())}}for(d=b.length-1;d>=0;d--){e=b[d];c=null;
if(e.isAvailableInDomain()){c=e.createButton();if(!c){"Couldn't load built in button: "+e.getButtonId();continue}this.registerNewButton_(c);c.isSearchTypeWithoutButton()||this.defaultBuiltInOrder_.unshift(c.getID())}if(e=e.getUpdateUrl())this.builtInButtons_[e]=c}};
a.onGoogleHomeChange_=function(){for(var b=0;b<GTB_builtinButtons().length;b++){var c=GTB_builtinButtons()[b].getButtonId(),d=GTB_builtinButtons()[b];if(d.isAvailableInDomain()&&!this.buttons_[c]){c=d.createButton();this.registerNewButton_(c);this.observerService_.notifyObservers(null,"GTB_CB_ADD",c.getID())}else if(!d.isAvailableInDomain()&&this.buttons_[c])this.removeButtonFromService_(c);else"gtbCountrySearch"==c&&this.updateCountrySearchButton_(d)}};
a.updateCountrySearchButton_=function(b){var c=this.buttons_.gtbCountrySearch;if(c){c.setSearchUrl(b.getSearchUrl());c.setTitle(GTB_getGoogleHomeCountryShortName());this.observerService_.notifyObservers(null,"GTB_CB_NAMECHANGE","gtbCountrySearch")}};a.loadButtons_=function(b){if(b&&b.exists())for(b=b.directoryEntries;b.hasMoreElements();){var c=b.getNext().QueryInterface(Ci.nsIFile);this.loadButtonFromFile_(c)}};
a.loadButtonFromFile_=function(b){try{var c=G_FirefoxXMLUtils.loadXML(b),d=new GTB_CB_ButtonWithFile(c,b);this.registerLoadedButton_(d);return d}catch(e){return null}};a.loadOldCustomSearchButtons_=function(){var b={};for(var c in this.buttons_){var d=this.buttons_[c],e=d.getLegacy();if(e)b[e]=true}c=GTB_CS_GetOldCustomSearches();e=0;for(var f=null;f=c[e];++e){var g=f.id.substr(5);if(!b[g])try{d=new GTB_CB_RegistryButton(f.doc,f.id);this.registerLoadedButton_(d)}catch(h){}}};
a.setSyncStatus=function(b){this.syncStatus_=b};a.startAdd=function(b,c,d){d||this.addUpdateNode_(b,c);if(this.syncStatus_)return new GTB_CB_Button(b,GTB_CB_IdRoutines.generateButtonIdFromUrl(c));else{c=GTB_CB_IdRoutines.suggestButtonFile(c,GTB_CustomButtonsService.getUserDirectory());return new GTB_CB_ButtonWithFile(b,c)}};a.startReplace=function(b,c){this.addUpdateNode_(b,c.getURL("update"));var d=c.getFile();if(d)return new GTB_CB_ButtonWithFile(b,d);return new GTB_CB_Button(b,c.getID())};
a.addUpdateNode_=function(b,c){var d=b.getElementsByTagName("update")[0],e=d&&d.textContent;if(e){e=e.trim();var f=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);try{var g=f.newURI(e,null,null),h=g.host.endsWith("toolbar.google.com");if(h)return}catch(i){}}if(!d){e=b.getElementsByTagName("button")[0];if(e==null)return;d=b.createElementNS(e.namespaceURI,"update");e.appendChild(d)}d.textContent=c};
a.installButton=function(b,c,d){if(c&&!b.isNewerThan(c)&&!d){this.setButtonVisible_(c);this.observerService_.notifyObservers(null,"GTB_CB_UPDATE",c.getID())}else{this.removeOldCustomSearches(b);if(b.getFile()){d=Cc["@mozilla.org/network/file-output-stream;1"].createInstance(Ci.nsIFileOutputStream);d.init(b.getFile(),G_File.PR_RDWR|G_File.PR_CREATE_FILE|G_File.PR_TRUNCATE,420,null);var e=Cc["@mozilla.org/xmlextras/xmlserializer;1"].createInstance(Ci.nsIDOMSerializer);e.serializeToStream(b.getXmlDoc(),
d,"UTF-8")}this.installButtonWithoutFile(b,c)}};a.installButtonWithoutFile=function(b,c){c&&c.getID()!=b.getID()&&this.list_.replace(c.getID(),b.getID());this.registerNewButton_(b);b.updateFeed(true);this.setButtonVisible_(b);var d=c?"GTB_CB_UPDATE":"GTB_CB_ADD";this.observerService_.notifyObservers(null,d,b.getID())};a.uninstall=function(b,c){var d=this.removeButtonFromService_(b);d.getFile()&&c?d.removeWithoutDeletingFile():d.remove()};
a.removeButtonFromService_=function(b){var c=this.buttons_[b];c.stopFeed();this.list_.remove(b);this.observerService_.notifyObservers(null,"GTB_CB_REMOVE",b);delete this.buttons_[b];if((b=c.getURL("update"))&&b in this.builtInButtons_)this.builtInButtons_[b]=null;return c};a.removeOldCustomSearches=function(b){var c=b.getLegacy();if(c)for(var d in this.buttons_){b=this.buttons_[d];b.regKeyName_&&b.regKeyName_.substr(5)==c&&this.removeButtonFromService_(d)}};
a.getButton=function(b){b=b.replace("gtbChevronMenu","");if(this.buttons_[b])this.cachedButtonsUI_||this.forceLoadButtons();return this.buttons_[b]};a.getAllButtons=function(){return this.buttons_};goog.exportSymbol("GTB_CustomButtonsService.prototype.getAllButtons",GTB_CustomButtonsService.prototype.getAllButtons);a=GTB_CustomButtonsService.prototype;
a.getSearchButtons=function(b){for(var c=this.list_.toArray(),d=[],e={},f=0,g=null;g=c[f];++f){g=this.buttons_[g];var h=g.getURL("search");if(h&&!e[h])if(!(b&&g.getURL("send"))){d.push(g);e[h]=true}}return d};a.getSendButtons=function(){for(var b=this.list_.toArray(),c=[],d={},e=0,f=null;f=b[e];++e){f=this.buttons_[f];var g=f.getURL("send");if(g&&!d[g]){c.push(f);d[g]=true}}return c};a.isBuiltInUpdateUrl=function(b){return b in this.builtInButtons_};a.getVisibleList=function(){return this.list_.getVisible()};
a.getList=function(){return this.list_};a.getDefaultBuiltInOrder=function(){return this.defaultBuiltInOrder_};a.setButtonList=function(b){this.list_.setList(b);try{this.observerService_.notifyObservers(null,"GTB_CB_SORT",null)}catch(c){}GTB_Layout.persistCurrentSet()};
a.findButtonByUpdateUrl=function(b){if(!b)return null;var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);b=c.newURI(b,null,null);for(var d in this.buttons_){var e=this.buttons_[d];try{var f=c.newURI(e.getURL("update"),null,null);if(b.equals(f))return e}catch(g){}}return null};
a.getMatchingGeneratedSearch=function(b){for(var c in this.buttons_){var d=this.buttons_[c];if(!d.getURL("update")){var e=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(b,null,null);try{var f=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(d.getURL("search"),null,null);if(e.equals(f))return d}catch(g){}}}return false};a.hasSimilarSearchButton=function(b,c){return this.hasSimilarBuiltInButton_(b,c)||this.hasSimilarCustomButton_(b)};
a.hasSimilarBuiltInButton_=function(b,c){for(var d=GTB_isGoogleDomain(c)?b.replace(/(\.google\.).*?\//,"$1{domain}/"):null,e=GTB_getGoogleDomain(),f=0;f<GTB_builtinButtons().length;f++){var g=GTB_builtinButtons()[f].getButtonId();if(g=this.buttons_[g]){g=g.getURL("search");if(d&&g.startsWith(d))return true;g=g.replace("{domain}",e);if(g.startsWith(b))return true}}return false};a.hasSimilarCustomButton_=function(b){for(var c in this.buttons_){var d=this.buttons_[c];if(d=d.getURL("search"))if(d.startsWith(b))return true}return false};
a.setNoFade=function(b){if(b)this.noFade_++;else this.noFade_--};a.getNoFade=function(){return!!this.noFade_};a.changeButtonOptions=function(b,c,d){var e=b.getID(),f=this.prefs_.getPref(e+".option",null);d?this.prefs_.setPref(e+".option",d):this.prefs_.clearPref(e+".option");f!=d&&this.prefs_.clearPref(e+".feedUpdate");if(c&&c!=b.getName())c==b.getTitle()?this.prefs_.clearPref(e+".name"):this.prefs_.setPref(e+".name",c)};
a.restoreButtonOptions=function(b,c,d){b=b.getID();d?this.prefs_.setPref(b+".gadgetOptions",d):this.prefs_.clearPref(b+".gadgetOptions");c?this.prefs_.setPref(b+".name",c):this.prefs_.clearPref(b+".name")};
GTB_CustomButtonsService.getUserDirectory=function(){var b;b=GetPlatform();if(b==1){b=G_File.getSpecialFile("LocalAppData");b.appendRelativePath("Google\\Custom Buttons")}else if(b==2){b=G_File.getSpecialFile("ULibDir");b.append("Application Support");b.appendRelativePath("Google/Custom Buttons")}else{b=G_File.getHomeFile();b.appendRelativePath(".google/custombuttons")}if(!b.exists())try{b.create(Ci.nsIFile.DIRECTORY_TYPE,493)}catch(c){}return b};
GTB_CustomButtonsService.getSharedDirectory=function(){var b;try{var c=Cc["@google.com/toolbar/utils;1"].getService(Ci.GTBIUtils);b=c.getCommonAppDataDir()}catch(d){return null}c=GetPlatform();if(c==1)b.appendRelativePath("Google\\Custom Buttons");else c==2?b.appendRelativePath("Google/Custom Buttons"):b.appendRelativePath("google/custombuttons");if(!b.exists())try{b.create(Ci.nsIFile.DIRECTORY_TYPE,493)}catch(e){return null}return b};
GTB_CustomButtonsService.getDefaultButtonsDirectory=function(){return GTB_getInstallFile("defaults","custombuttons")};function GTB_CS_GetOldCustomSearches(){var b=[],c=Cc["@google.com/customsearch;1"];if(!c)return b;c=c.createInstance(Ci.GTBICustomSearch);if(!c)return b;for(var d={},e=new G_Base64;c.searchId;){var f={};f.site=null;f.tip=null;f.searchId=c.searchId;var g=f.searchId.substr(5);if(!d[g]){for(d[g]=true;c.attr;){g=c.attr.toLowerCase();if(g=="icon"){var h=c.value;if(c.isBinary){h=e.arrayifyString(h);h=e.encodeByteArray(h)}f[g]=h}else if(!c.isBinary){f[g]=c.value;if(g=="title")f[g]=f[g].replace("&","")}c.nextAttr()}b.push(new GTB_CustomSearch(f.searchId,
f.icon,f.title,f.tip,f.url,f.site,null))}c.nextSearch()}c.finish();return b}
function GTB_CustomSearch(b,c,d,e,f,g,h){this.debugZone="doAddDialogLoad";this.id=b;this.doc=G_FirefoxXMLUtils.newXML("custombuttons","http://toolbar.google.com/custombuttons/");b=this.doc.createElementNS("http://toolbar.google.com/custombuttons/","button");if(d){var i=this.doc.createElementNS("http://toolbar.google.com/custombuttons/","title");i.appendChild(this.doc.createTextNode(d));b.appendChild(this.doc.createTextNode("\n    "));b.appendChild(i)}if(e){d=this.doc.createElementNS("http://toolbar.google.com/custombuttons/",
"description");d.appendChild(this.doc.createTextNode(e));b.appendChild(this.doc.createTextNode("\n    "));b.appendChild(d)}if(f){e=this.doc.createElementNS("http://toolbar.google.com/custombuttons/","search");e.setAttribute("charset",h);e.appendChild(this.doc.createTextNode(f));b.appendChild(this.doc.createTextNode("\n    "));b.appendChild(e)}if(c){f=this.doc.createElementNS("http://toolbar.google.com/custombuttons/","icon");f.appendChild(this.doc.createTextNode(c));f.setAttribute("type","image/x-icon");
f.setAttribute("mode","base64");b.appendChild(this.doc.createTextNode("\n    "));b.appendChild(f)}if(g){c=this.doc.createElementNS("http://toolbar.google.com/custombuttons/","site");c.appendChild(this.doc.createTextNode(g));b.appendChild(this.doc.createTextNode("\n    "));b.appendChild(c)}b.appendChild(this.doc.createTextNode("\n  "));this.doc.documentElement.appendChild(this.doc.createTextNode("\n  "));this.doc.documentElement.appendChild(b);this.doc.documentElement.appendChild(this.doc.createTextNode("\n"))}
;function GTB_CustomButtonList(){this.debugZone="GTB_CustomButtonList";this.service_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;this.ignorePrefChanges_=false;this.arrayOfIds_=this.getArrayOfIdsFromPref_();GTB_GlobalPrefs.addObserver(GTB_CustomButtonList.PREF_NAME,BindToObject(this.handlePrefChanged_,this))}GTB_CustomButtonList.PREF_NAME="google.toolbar.custombuttons.list";a=GTB_CustomButtonList.prototype;
a.update=function(){var b=this.arrayOfIds_,c=this.service_;b=b.filter(function(d){return!!c.getButton(d)});this.setList(b)};a.orderSubset=function(b){for(var c=this.arrayOfIds_,d=0,e=0;d<c.length&&e<b.length;){if(b.indexOf(c[d])>-1){c[d]=b[e];e++}d++}this.setList(c)};a.push=function(b){if(!this.contains(b)){var c=this.arrayOfIds_;c.unshift(b);this.setList(c)}};a.remove=function(b){var c=this.arrayOfIds_;b=c.indexOf(b);if(b!=-1){c.splice(b,1);this.setList(c)}};
a.replace=function(b,c){var d=this.arrayOfIds_,e=d.indexOf(b);if(e!=-1){d[e]=c;this.setList(d)}};a.indexOf=function(b){return this.arrayOfIds_.indexOf(b)};a.length=function(){return this.arrayOfIds_.length};a.contains=function(b){return this.indexOf(b)!=-1};a.getVisible=function(){var b=this.arrayOfIds_.slice(),c=this.service_.getAllButtons();return b.filter(function(d){d=c[d];return!!(d&&d.isVisible())})};a.toArray=function(){return this.arrayOfIds_};
a.handlePrefChanged_=function(){if(!this.ignorePrefChanges_)this.arrayOfIds_=this.getArrayOfIdsFromPref_()};a.getArrayOfIdsFromPref_=function(){var b=GTB_GlobalPrefs.getPref(GTB_CustomButtonList.PREF_NAME);return b=b?b.split(","):[]};a.setList=function(b){for(var c=0;c<b.length;)if(b[c])c++;else b.splice(c,1);this.arrayOfIds_=b;b=b.join(",");this.ignorePrefChanges_=true;try{GTB_GlobalPrefs.setPref(GTB_CustomButtonList.PREF_NAME,b)}finally{this.ignorePrefChanges_=false}};var GTB_LayoutUtil={};GTB_LayoutUtil.sortMenupopup=function(b,c,d,e){if(c==null)c=0;if(d==null)d=b.childNodes.length-1;e=!!e;var f=d-c+1;d=[];for(var g={},h=0;h<f;++h){var i=b.childNodes[c+h],j=i.getAttribute("label");if(e)j=j.toLowerCase();if(g[j])g[j].push(i);else{g[j]=[i];d.push(j)}}d.sort(function(k,l){return k.localeCompare(l)});for(h=d.length-1;h>=0;--h){j=d[h];e=g[j];for(f=e.length-1;f>=0;--f)b.insertBefore(e[f],b.childNodes[c])}};goog.exportSymbol("GTB_LayoutUtil.sortMenupopup",GTB_LayoutUtil.sortMenupopup);
GTB_LayoutUtil.getBrowserWindows=function(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getEnumerator("navigator:browser");for(var c=[];b.hasMoreElements();)c.push(b.getNext());return c};GTB_LayoutUtil.getMostRecentBrowserWindow=function(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);return b.getMostRecentWindow("navigator:browser")};
GTB_LayoutUtil.getGoogleSearchIconUrl=function(){var b=new G_Preferences("google.toolbar.");return b.getPref("search-icon","chrome://google-toolbar/skin/search.png")};GTB_LayoutUtil.setSearchIcon=function(b){b.style.listStyleImage="url('"+GTB_LayoutUtil.getGoogleSearchIconUrl()+"')"};goog.exportSymbol("GTB_LayoutUtil.setSearchIcon",GTB_LayoutUtil.setSearchIcon);var GTB_TB_DefaultSet=["gtbGoogleMenu","gtbSearchBox","gtbShare","gtbSidewiki","gtbBookmarks","gtbPageRank","gtbSpellCheck","gtbTranslate","gtbAutoFill","gtbGoUp","gtbHighlight","gtbFindTerms","gtbSettingsItem"];
function GTB_moveToPalette(b){var c=b.ownerDocument;c=c.getElementById("navigator-toolbox").palette;var d;a:{d=b;var e=d.ownerDocument;e=e.getElementById("navigator-toolbox").palette;for(e=e.firstChild;e;e=e.nextSibling)if(e.id==d.id){d=e;break a}d=null}d?c.replaceChild(b,d):c.appendChild(b)}
function GTB_Layout(b){this.debugZone="layout";this.toolboxCustomizeWindow_=b;this.toolbarElement_=b.document.getElementById("gtbToolbar");this.navbarElement_=b.document.getElementById("nav-bar");this.customButtonService_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;this.toolboxCustomizeDone=BindToObject(this.toolboxCustomizeDoneCallback_,this);this.browserCustomizeDone=function(){};this.customizeStartedCallback_=BindToObject(this.toolboxCustomizeStartedCallback_,
this);this.restoredDefaultsCallback_=BindToObject(this.toolboxRestoreDefaultsCallback_,this);this.observers_=[new G_ObserverServiceObserver("google-toolbar-customize-started",this.customizeStartedCallback_,false),new G_ObserverServiceObserver("google-toolbar-customize-restoredefaults",this.restoredDefaultsCallback_,false)];this.prefs=new G_Preferences("google.toolbar.");b=this.prefs.getPref("button_text_level",null);this.applyButtonTextLevel_(b);this.prefs.addObserver("button_text_level",BindToObject(this.onButtonTextLevelChanged_,
this));this.hiddenButtons_={};b=BindToObject(this.updateFeatureButtonsForLocale,this);this.prefs.addObserver("google_home",b);new G_Alarm(b,0)}a=GTB_Layout.prototype;a.onGoogleHomeChange_=function(){this.updateFeatureButtonsForLocale();this.persistCurrentSet_(this.toolbarElement_)};a.finishButtonsLoad=function(){this.persistCurrentSet_(this.toolbarElement_)};a.shutdown=function(){if(this.observers_)for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.prefs.removeAllObservers()};
a.getCurrentLayout=function(){var b=this.toolboxCustomizeWindow_.document,c=false;if(b=b.getElementById("nav-bar")){b=b.getElementsByTagName("toolbaritem");for(var d=0;d<b.length;++d)if(b[d].id=="gtbSearchBox"){c=true;break}}return c?this.toolbarElement_.collapsed?"space-saver":"combined":"classic"};a.setLayout=function(b){this.collapseToolbar_(b=="space-saver");this.replaceSearchBox_(b=="combined"||b=="space-saver")};a.updateButtonsToPrefs=function(b){for(var c in b)b[c]?this.addButton(c):this.removeButton(c)};
a.updatePrefsToButtons_=function(){var b=this.toolboxCustomizeWindow_.document;b=b.getElementById("navigator-toolbox");this.updateButtonsContainer_(b.palette);for(b=b.firstChild;b;){this.updateButtonsContainer_(b);b=b.nextSibling}};a.updateButtonsContainer_=function(b){var c=b.ownerDocument;for(b=b.firstChild;b;){if(this.isGoogleToolbarItem(b)){var d=b.id,e=c.getElementById(d);this.prefs.setPref("button_option."+d,e!=null)}b=b.nextSibling}};
a.persistToolbars=function(){var b=GTB_LayoutUtil.getMostRecentBrowserWindow();b=b.document;for(var c=b.getElementById("navigator-toolbox"),d=c.toolbarset,e=0,f=0;f<c.childNodes.length;++f){var g=c.childNodes[f];if(g.localName=="toolbar"&&g.getAttribute("customizable")=="true"){var h=g.currentSet;g.setAttribute("currentset",h);var i=g.hasAttribute("customindex");if(i)if(g.firstChild){d.setAttribute("toolbar"+ ++e,g.toolbarName+":"+h);b.persist(d.id,"toolbar"+e)}else{c.removeChild(g);--f}else b.persist(g.id,
"currentset")}}for(;d.hasAttribute("toolbar"+ ++e);){d.removeAttribute("toolbar"+e);b.persist(d.id,"toolbar"+e)}b.persist("gtbToolbar","collapsed")};
a.replaceSearchBox_=function(b){var c=this.toolboxCustomizeWindow_.document,d=this.navbarElement_,e=this.toolbarElement_,f=c.getElementById("gtbSearchBox"),g=c.getElementById("search-container"),h=c.getElementById("gtbGoogleSearchBox");h=h?h.value:"";var i=c.getElementById("fullscreenflex");i&&i.parentNode==d||(i=null);if(b){g&&g.parentNode&&GTB_moveToPalette(g);if(f&&f.parentNode!=d){this.removeButton(f.id);f=null}d&&f==null&&d.insertItem("gtbSearchBox",i,null,false)}else{if(d&&f&&f.parentNode==
d){this.removeButton(f.id);f=null}if(f==null){(b=c.getElementById("gtbGoogleMenu"))?e.insertItem("gtbSearchBox",b.nextSibling):e.insertItem("gtbSearchBox",e.firstChild);e=c.getElementById("gtbSearchButton");e.mSearchTypes.setSearchButton_("gtbSearchGoogle")}if(d&&g&&g.parentNode!=d){g.parentNode.removeChild(g);g=null}d&&g==null&&d.insertItem("search-container",i)}if(c=c.getElementById("gtbGoogleSearchBox"))c.value=h};
a.toolboxCustomizeStartedCallback_=function(b){if(b==this.toolboxCustomizeWindow_){b=this.getSearchBox_();this.searchBoxBeforeCustomize_=!!b;this.layoutBeforeCustomize_=this.getCurrentLayout();this.restoringDefaults_=false}};a.toolboxRestoreDefaultsCallback_=function(b){if(b==this.toolboxCustomizeWindow_)this.restoringDefaults_=true};
a.toolboxCustomizeDoneCallback_=function(){var b=this.toolboxCustomizeWindow_;!b.document.getElementById("gtbSearchBox")&&this.searchBoxBeforeCustomize_&&b.openDialog("chrome://google-toolbar/content/confirm-customize.xul","gtbConfirmCustomize","modal,centerscreen,chrome,resizable=no",BindToObject(this.restoreSearchBox_,this));if(this.restoringDefaults_){this.cleanupNonGoogleToolbars_();this.restoreCustomButtonsDefaultLayout_();GTB_LayoutManager.resetButtonDefaultTextLevel();this.onButtonTextLevelChanged_()}else{b=
this.toolbarElement_.getAttribute("mode");this.prefs.setPref("button_text_level",b)}this.persistCurrentSet_(this.toolbarElement_);this.copyWindowLayoutToAllWindows_();this.updatePrefsToButtons_();this.browserCustomizeDone(true);b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);b.notifyObservers(null,"google-toolbar-customized",null)};a.restoreSearchBox_=function(){this.setLayout(this.layoutBeforeCustomize_);this.persistCurrentSet_(this.toolbarElement_)};
a.getFindTermsLayout_=function(){var b=this.toolboxCustomizeWindow_.document;b=b.getElementById("gtbFindTerms");if(!b)return null;for(var c={},d=0;d<b.childNodes.length;++d){var e=b.childNodes[d];if(!e.hidden)c[e.id]=e.label}return c};a.restoreFindTermsLayout_=function(b){var c=this.toolboxCustomizeWindow_.document;for(var d in b){var e=c.getElementById(d);e.label=b[d];e.hidden=false}};
a.restoreDefaultLayout=function(){Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;var b=this.getSearchBoxText_(),c=this.getFindTermsLayout_(),d=this.toolboxCustomizeWindow_.document,e=d.getElementById("gtbSearchBox");(e=e&&e.parentNode)&&e.id=="nav-bar"&&!d.getElementById("search-container")&&e.insertItem("search-container",null);e=this.toolboxCustomizeWindow_.GTB_GoogleToolbarOverlay;e=e.chevron;var f=d.getElementById("navigator-toolbox");e.saveChevronMenuChildren();
for(d=0;d<f.childNodes.length;d++)for(var g=f.childNodes[d],h=g.childNodes.length-1;h>=0;h--){var i=g.childNodes[h];if(this.isGoogleToolbarItem(i)||g.id=="gtbToolbar")GTB_moveToPalette(i)}d=this.toolbarElement_;d.setAttribute("iconsize","small");d=d.getAttribute("defaultset");f=d.split(",");for(d=0;d<f.length;d++)this.addButton(f[d]);e.restoreChevronMenuChildren();this.restoreCustomButtonsDefaultLayout_();e=this.getSearchBox_();e.value=b;c&&this.restoreFindTermsLayout_(c);this.collapseToolbar_(false);
this.persistToolbars()};
a.updateFeatureButtonsForLocale=function(){for(var b=this.toolboxCustomizeWindow_.document,c=this.toolbarElement_,d=[],e=[],f={},g=0;g<GTB_TB_DefaultSet.length;g++){var h=GTB_TB_DefaultSet[g],i=GTB_buttonAvailableInLocale(h);i?d.push(h):e.push(h);f[h]=true}h=b.getElementById("navigator-toolbox").palette;i=null;for(g=h.lastChild;g;){if(g.id in f){i=g.nextSibling;break}g=g.previousSibling}var j=this.hiddenButtons_;for(g=h.firstChild;g;){var k=g;g=g.nextSibling;if(k.id in f){h.removeChild(k);j[k.id]=
k}}for(g=d.length-1;g>=0;g--){f=d[g];k=j[f];delete j[f];if(k)i=h.insertBefore(k,i)}for(g=0;g<e.length;g++){f=e[g];if((h=b.getElementById(f))&&h.parentNode){c=h.parentNode;c.removeChild(h);this.persistCurrentSet_(c)}}e=[];for(g=0;g<d.length;g++){f=d[g];h=b.getElementById(f);i="google.toolbar.button_option."+f;j=GTB_getPrefWithLocaleDefault(i);if(j==undefined)j=!!h;if(h&&!j)this.removeButton(f);else!h&&j&&this.addButton(f);h="button_option."+f;this.prefs.setPref(h,j);i=GTB_getLocaleDefaultForPref(i);
if(i!=false){h=h+".default";this.prefs.getPref(h,true)&&e.push(f)}}c.setAttribute("defaultset",e.join(","));b.persist(c.id,"defaultset")};goog.exportSymbol("GTB_Layout.prototype.updateFeatureButtonsForLocale",GTB_Layout.prototype.updateFeatureButtonsForLocale);a=GTB_Layout.prototype;a.applyButtonTextLevel_=function(b){var c=this.toolboxCustomizeWindow_.document;this.toolbarElement_.setAttribute("mode",b);c.persist("gtbToolbar","mode")};
a.onButtonTextLevelChanged_=function(){var b=this.prefs.getPref("button_text_level");this.applyButtonTextLevel_(b);this.toolboxCustomizeWindow_.GTB_GoogleToolbarOverlay.chevron.doResize()};
a.cleanupNonGoogleToolbars_=function(){var b=this.toolboxCustomizeWindow_;b=b.document.getElementById("navigator-toolbox");for(var c=b.childNodes.length-1;c>=0;c--)b.childNodes[c].hasAttribute("customindex")&&b.removeChild(b.childNodes[c]);for(var d=0;d<b.childNodes.size;d++){var e=b.childNodes[d];if(e.id!="gtbToolbar")for(c=e.childNodes.length-1;c>=0;c--){var f=e.childNodes[c];this.isGoogleToolbarItem(f)&&e.removeChild(f)}}this.collapseToolbar_(false)};
a.copyWindowLayoutToAllWindows_=function(){for(var b=this.toolboxCustomizeWindow_.document.getElementById("navigator-toolbox"),c=b.getAttribute("mode"),d=b.getAttribute("iconsize"),e=GTB_LayoutUtil.getBrowserWindows(),f=null,g=0;f=e[g];++g){var h=f.GTB_GoogleToolbarOverlay.layout;h.toolbarElement_.setAttribute("iconsize","small");if(f!=this.toolboxCustomizeWindow_){this.restoringDefaults_&&h.cleanupNonGoogleToolbars_();var i=h.getSearchBoxText_(),j=f.document.getElementById("navigator-toolbox");j.setAttribute("mode",
c);j.setAttribute("iconsize",d);for(var k=0;k<b.childNodes.length;k++){var l=b.childNodes[k];if(l.getAttribute("customizable")=="true"){var m=l.id;if(m=f.document.getElementById(m)){if(this.restoringDefaults_)m.collapsed=l.collapsed;m.currentSet=l.currentSet}else if(l.hasAttribute("customindex")){m=l.getAttribute("toolbarname");var n=l.currentSet;m=j.appendCustomToolbar(m,n)}if(m){m.setAttribute("mode",l.getAttribute("mode"));m.setAttribute("iconsize",l.getAttribute("iconsize"))}}}if(f=h.getSearchBox_())f.value=
i;h.browserCustomizeDone(true)}}};a.getSearchBoxText_=function(){var b=this.getSearchBox_();if(b)return b.value;return""};a.getSearchBox_=function(){var b=this.toolboxCustomizeWindow_.document;return b.getElementById("gtbGoogleSearchBox")};a.removeButton=function(b){var c=this.toolboxCustomizeWindow_.document;(b=c.getElementById(b))&&b.parentNode&&GTB_moveToPalette(b)};a.hideOneButton=function(b){this.removeButton(b);this.toolboxCustomizeWindow_.GTB_GoogleToolbarOverlay.chevron.doResize()};
a.showOneButton=function(b){this.addButton(b);this.toolboxCustomizeWindow_.GTB_GoogleToolbarOverlay.chevron.doResize()};a.addButton=function(b){var c=this.toolboxCustomizeWindow_.document;c=c.getElementById(b);if(!c)if(c=this.findPaletteItem(b)){c=this.customButtonService_.getButton(b);try{var d=c?this.getCustomButtonAnchor_(b):this.getFeatureButtonAnchor_(b);this.toolbarElement_.insertItem(b,d)}catch(e){}}};
a.restoreCustomButtonsDefaultLayout_=function(){for(var b=this.toolboxCustomizeWindow_.document,c=this.getCustomButtonsDefaultAnchor_(),d=this.toolbarElement_,e=this.customButtonService_.getVisibleList(),f=0;f<e.length;f++){var g=e[f],h=b.getElementById(g);h&&h.parentNode.removeChild(h);d.insertItem(g,c)}b=this.toolboxCustomizeWindow_.GTB_GoogleToolbarOverlay.customButtons;b.observeRestoreDefaults()};
a.getCustomButtonAnchor_=function(b){var c=this.customButtonService_.getVisibleList(),d=c.indexOf(b);if(d==-1)throw Error("Custom button is currently hidden "+b);b=this.toolbarElement_;if(c=this.getNextElementOnToolbar_(d,c,b))return c;return this.getCustomButtonsDefaultAnchor_()};a.getFeatureButtonAnchor_=function(b){var c=GTB_TB_DefaultSet,d=c.indexOf(b);if(d==-1)throw Error("Button is not in the deafault set: "+b);return this.getNextElementOnToolbar_(d,c,this.toolbarElement_)};
a.findPaletteItem=function(b){var c=this.toolboxCustomizeWindow_.document;c=c.getElementById("navigator-toolbox");for(c=c.palette.firstChild;c;){if(c.id==b)return c;c=c.nextSibling}return null};a.getCustomButtonsDefaultAnchor_=function(){var b=GTB_TB_DefaultSet.indexOf("gtbSearchBox"),c=this.toolbarElement_;return this.getNextElementOnToolbar_(b,GTB_TB_DefaultSet,c)};
a.restoreDynamicItem=function(b){var c=this.toolboxCustomizeWindow_.document,d=c.getElementById("navigator-toolbox"),e=d&&d.getElementsByTagName("toolbar"),f=0;for(d=null;d=e[f];++f){var g=d.getAttribute("currentset");if(g){g=g.split(",");var h=g.indexOf(b);if(h!=-1){f=g[h+1];e=null;if(f)if(GTB_Layout.SPACING_ITEM_IDS.indexOf(f)!=-1){c=1;for(var i=0;i<h;i++)g[i]==f&&c++;for(g=d.firstChild;g;g=g.nextSibling)if(g.id&&g.id.startsWith(f)){c--;if(c==0){e=g;break}}}else{e=this.getNextElementOnToolbar_(h,
g,d);if(!e)if((c=c.getElementById("gtbSettingsItem"))&&c.parentNode==d)e=c}d.insertItem(b,e);return true}}}return false};a.getNextElementOnToolbar_=function(b,c,d){var e=d.ownerDocument;for(b=b+1;b<c.length;b++){var f=c[b];if((f=e.getElementById(f))&&f.parentNode==d)return f}return null};GTB_Layout.SPACING_ITEM_IDS=["separator","spacer","spring"];GTB_Layout.prototype.collapseToolbar_=function(b){var c=this.toolboxCustomizeWindow_.document,d=this.toolbarElement_;d.collapsed=b;c.persist(d.id,"collapsed")};
GTB_Layout.prototype.showGoogleToolbar=function(){this.collapseToolbar_(false)};GTB_Layout.prototype.isGoogleToolbarItem=function(b){return b&&b.id&&b.id.indexOf("gtb")==0};GTB_Layout.prototype.setPageRankButtonDefault=function(b){this.setButtonDefault("gtbPageRank",b)};goog.exportSymbol("GTB_Layout.prototype.setPageRankButtonDefault",GTB_Layout.prototype.setPageRankButtonDefault);GTB_Layout.prototype.setAnnotationsButtonDefault=function(b){this.setButtonDefault("gtbSidewiki",b)};
goog.exportSymbol("GTB_Layout.prototype.setAnnotationsButtonDefault",GTB_Layout.prototype.setAnnotationsButtonDefault);
GTB_Layout.prototype.setButtonDefault=function(b,c){var d=this.toolboxCustomizeWindow_.document,e=this.toolbarElement_;if(c)this.addButton(b);else{var f=d.getElementById(b);f&&f.parentNode&&GTB_moveToPalette(f)}this.persistCurrentSet_(e);var g=e.getAttribute("defaultset");f=GTB_TB_DefaultSet;var h=b,i=c;g=g.split(",");if(i){for(var j=i=0;i!=f.length&&j!=g.length;i++){if(f[i]==h)break;f[i]==g[j]&&j++}g[j]!=h&&g.splice(j,0,h)}else{f=g.indexOf(h);f>=0&&g.splice(f,1)}g=g.join(",");e.setAttribute("defaultset",
g);d.persist(e.id,"defaultset")};goog.exportSymbol("GTB_Layout.prototype.setButtonDefault",GTB_Layout.prototype.setButtonDefault);GTB_Layout.prototype.removeButtonFromPalette=function(b){var c=this.toolboxCustomizeWindow_.document;c=c.getElementById("navigator-toolbox");c=c.palette;for(var d=0;d<c.childNodes.length;d++)if(c.childNodes[d].id==b){c.removeChild(c.childNodes[d]);return}};GTB_Layout.persistCurrentSet=function(){var b=GTB_LayoutUtil.getMostRecentBrowserWindow();b.GTB_GoogleToolbarOverlay.layout.persistCurrentSet_()};
GTB_Layout.prototype.persistCurrentSet_=function(b){b=b||this.toolbarElement_;var c=b.currentSet;b.setAttribute("currentset",c);b.ownerDocument.persist(b.id,"currentset")};function GTB_LayoutService(){this.debugZone="GTB_LayoutService"}a=GTB_LayoutService.prototype;a.updateButtonsToPrefs=function(){this.forEachBrowserLayout_(GTB_Layout.prototype.updateButtonsToPrefs,arguments)};a.hideOneButton=function(b){var c="google.toolbar.button_option."+b;GTB_GlobalPrefs.setPref(c,false);this.forEachBrowserLayout_(GTB_Layout.prototype.hideOneButton,arguments);this.onToolbarCustomized_()};
a.showOneButton=function(b){var c="google.toolbar.button_option."+b;GTB_GlobalPrefs.setPref(c,true);this.forEachBrowserLayout_(GTB_Layout.prototype.showOneButton,arguments);this.onToolbarCustomized_()};a.onToolbarCustomized_=function(){var b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);b.notifyObservers(null,"google-toolbar-customized",null)};a.restoreBrowserLayouts=function(){this.forEachBrowserLayout_(GTB_Layout.prototype.restoreDefaultLayout,arguments)};
goog.exportProperty(GTB_LayoutService.prototype,"restoreBrowserLayouts",GTB_LayoutService.prototype.restoreBrowserLayouts);GTB_LayoutService.prototype.restoreDefaultLayout=function(){this.resetButtonDefaultTextLevel();this.restoreBrowserLayouts();this.getMostRecentLayout_().updatePrefsToButtons_()};GTB_LayoutService.prototype.setLayout=function(){this.forEachBrowserLayout_(GTB_Layout.prototype.setLayout,arguments)};
GTB_LayoutService.prototype.showGoogleToolbar=function(){this.forEachBrowserLayout_(GTB_Layout.prototype.showGoogleToolbar,arguments)};goog.exportProperty(GTB_LayoutService.prototype,"showGoogleToolbar",GTB_LayoutService.prototype.showGoogleToolbar);GTB_LayoutService.prototype.resetButtonDefaultTextLevel=function(){var b=new G_Preferences("google.toolbar.");b.clearPref("button_text_level")};
GTB_LayoutService.prototype.forEachBrowserLayout_=function(b,c){for(var d=GTB_LayoutService.getAllBrowserWindows_();d.hasMoreElements();){var e=d.getNext();e=e.GTB_GoogleToolbarOverlay.layout;b.apply(e,c)}};GTB_LayoutService.prototype.getMostRecentLayout_=function(){var b=GTB_LayoutUtil.getMostRecentBrowserWindow();return b.GTB_GoogleToolbarOverlay.layout};GTB_LayoutService.getAllBrowserWindows_=function(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);return b.getEnumerator("navigator:browser")};
var GTB_LayoutManager=new GTB_LayoutService;goog.exportSymbol("GTB_LayoutManager",GTB_LayoutManager);function GTB_CB_BuiltInButton(b,c,d,e){GTB_CB_Button.call(this,b,c);this.debugZone="GTB_CB_BuiltInButton";this.isSearchTypeOnly_=d;this.isIconSetInCSS_=e}GTB_CB_BuiltInButton.inherits(GTB_CB_Button);GTB_CB_BuiltInButton.prototype.isBuiltInSearch=function(){return true};GTB_CB_BuiltInButton.prototype.remove=function(){};GTB_CB_BuiltInButton.prototype.isSearchTypeWithoutButton=function(){return this.isSearchTypeOnly_};goog.exportSymbol("GTB_CB_BuiltInButton.prototype.isSearchTypeWithoutButton",GTB_CB_BuiltInButton.prototype.isSearchTypeWithoutButton);
GTB_CB_BuiltInButton.prototype.isIconSetInStyleSheet=function(){return this.isIconSetInCSS_};GTB_CB_BuiltInButton.prototype.migrateVisibilityFromIE=function(){};function GTB_BuiltInButtonFactory(b,c){this.id_=b;this.updateUrl_=c}GTB_BuiltInButtonFactory.prototype.getButtonId=function(){return this.id_};GTB_BuiltInButtonFactory.prototype.getUpdateUrl=function(){return this.updateUrl_};GTB_BuiltInButtonFactory.prototype.isAvailableInDomain=function(){return GTB_buttonAvailableInDomain(this.getButtonId())};
GTB_BuiltInButtonFactory.prototype.createButton=function(){throw Error("GTB_BuiltInButtonFactory: this method is not implemented");};GTB_BuiltInButtonFromFileFactory.FILE_NAMES={};function GTB_BuiltInButtonFromFileFactory(b,c,d){GTB_BuiltInButtonFactory.call(this,c,d);this.fileName_=b;GTB_BuiltInButtonFromFileFactory.FILE_NAMES[b]=true}GTB_BuiltInButtonFromFileFactory.inherits(GTB_BuiltInButtonFactory);GTB_BuiltInButtonFromFileFactory.prototype.debugZone="GTB_BuiltInButtonFromFileFactory";
GTB_BuiltInButtonFromFileFactory.prototype.createButton=function(){var b=GTB_CustomButtonsService.getDefaultButtonsDirectory();b.append(this.fileName_);try{var c=G_FirefoxXMLUtils.loadXML(b);return new GTB_CB_BuiltInButton(c,this.getButtonId(),false,false)}catch(d){return null}};
function GTB_BuiltInButtonInfo(b,c,d,e,f,g,h,i){GTB_BuiltInButtonFactory.call(this,b,c);this.iconUrl_=d;this.title_=e;this.description_=f;this.searchUrl_=g;this.isSearchTypeOnly_=h;this.isIconSetInCSS_=!!i;b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);this.stringBundle_=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties")}GTB_BuiltInButtonInfo.inherits(GTB_BuiltInButtonFactory);GTB_BuiltInButtonInfo.prototype.getLocalizedTitle=function(){return this.stringBundle_.GetStringFromName(this.title_)};
GTB_BuiltInButtonInfo.prototype.createButton=function(){var b=this.getLocalizedTitle(),c=this.stringBundle_.GetStringFromName(this.description_),d=this.getSearchUrl();b=GTB_BuiltInButtonInfo.createButtonDocument_(this.iconUrl_,b,c,d);this.addAdditionalDataToButtonDefinition(b);try{return new GTB_CB_BuiltInButton(b,this.getButtonId(),this.isSearchTypeOnly_,this.isIconSetInCSS_)}catch(e){throw e;}};GTB_BuiltInButtonInfo.prototype.addAdditionalDataToButtonDefinition=function(){};
GTB_BuiltInButtonInfo.createButtonDocument_=function(b,c,d,e){var f=G_FirefoxXMLUtils.newXML("custombuttons","http://toolbar.google.com/custombuttons/"),g=f.documentElement;g=GTB_BuiltInButtonInfo.createChildNode_(g,"button",null);GTB_BuiltInButtonInfo.createChildNode_(g,"icon-url",b);GTB_BuiltInButtonInfo.createChildNode_(g,"title",c);GTB_BuiltInButtonInfo.createChildNode_(g,"description",d);b=GTB_BuiltInButtonInfo.createChildNode_(g,"search",e);b.setAttribute("charset","UTF-8");return f};
GTB_BuiltInButtonInfo.createChildNode_=function(b,c,d){var e=b.ownerDocument;c=e.createElementNS("http://toolbar.google.com/custombuttons/",c);d&&c.appendChild(e.createTextNode(d));b.appendChild(c);return c};GTB_BuiltInButtonInfo.prototype.fixSearchUrlParameters=function(b){return b};GTB_BuiltInButtonInfo.prototype.getSearchUrl=function(){return this.fixSearchUrlParameters(this.searchUrl_)};
function GTB_CountrySearchButtonInfo(){GTB_BuiltInButtonInfo.call(this,"gtbCountrySearch","http://toolbar.google.com/buttons/defs/google.com_country.xml","chrome://google-toolbar/skin/country-search.png","must be overriden","prop.gtb.country.tip","http://www.google.{domain}/search?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",false);this.debugZone="GTB_CountrySearchButtonInfo"}GTB_CountrySearchButtonInfo.inherits(GTB_BuiltInButtonInfo);
GTB_CountrySearchButtonInfo.prototype.fixSearchUrlParameters=function(b){var c=GTB_GOOGLE_HOME_DICT[GTB_getGoogleHome()].iso.split(";");b=b;for(var d=0;d<c.length;d++)b+="&meta=cr%3Dcountry"+c[d];return b};GTB_CountrySearchButtonInfo.prototype.getLocalizedTitle=function(){return GTB_getGoogleHomeCountryShortName()};
function GTB_SearchNewsButtonInfo(){GTB_BuiltInButtonInfo.call(this,"gtbSearchNews","http://toolbar.google.com/buttons/defs/news.google.com.xml","chrome://google-toolbar/skin/news.png","prop.gtb.news","prop.gtb.news.tip","http://www.google.{domain}/news?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",false);this.debugZone="GTB_SearchNewsButtonInfo"}GTB_SearchNewsButtonInfo.inherits(GTB_BuiltInButtonInfo);
GTB_SearchNewsButtonInfo.prototype.addAdditionalDataToButtonDefinition=function(b){b=GTB_CB_XmlUtils.getNode("//gtb:button",b);b=GTB_BuiltInButtonInfo.createChildNode_(b,"gadget","http://www.google.com/ig/modules/tabnews.xml");b.setAttributeNS("http://toolbar.google.com/custombuttons/","width","300");b.setAttributeNS("http://toolbar.google.com/custombuttons/","height","550")};
function GTB_builtinButtons(){if(!GTB_builtinButtons.buttonsList_){GTB_builtinButtons.buttonsList_=[new GTB_BuiltInButtonInfo("gtbSearchGoogle",null,GTB_LayoutUtil.getGoogleSearchIconUrl(),"prop.gtb.search","prop.gtb.search.tip","http://www.google.{domain}/search?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",true),new GTB_CountrySearchButtonInfo,new GTB_BuiltInButtonInfo("gtbSearchSite","http://toolbar.google.com/buttons/defs/google.com_site.xml","chrome://google-toolbar/skin/search-site.png",
"prop.gtb.site","prop.gtb.site.tip","http://www.google.{domain}/search?q=site:{url.host}+{query}{sourceid}{rlz}{aq}&ie=UTF-8&hl={locale}",false,true),new GTB_BuiltInButtonInfo("gtbFeelingLucky","http://toolbar.google.com/buttons/defs/google.com_lucky.xml","chrome://google-toolbar/skin/lucky.png","prop.gtb.lucky","prop.gtb.lucky.tip","http://www.google.{domain}/search?hl={locale}&q={query}&btnI=I{sourceid}{rlz}{aq}&ie=UTF-8",false,true),new GTB_BuiltInButtonInfo("gtbSearchWebhistory","http://toolbar.google.com/buttons/defs/google.com_web_history.xml",
"chrome://google-toolbar/skin/webhistory.png","prop.gtb.webhistory","prop.gtb.webhistory.tip","http://www.google.{domain}/history{find}?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",false),new GTB_SearchNewsButtonInfo,new GTB_BuiltInButtonInfo("gtbSearchImages","http://toolbar.google.com/buttons/defs/google.com_images.xml","chrome://google-toolbar/skin/images.png","prop.gtb.images","prop.gtb.images.tip","http://www.google.{domain}/images?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",false),
new GTB_BuiltInButtonInfo("gtbSearchGroups","http://toolbar.google.com/buttons/defs/groups.google.com.xml","chrome://google-toolbar/skin/groups.png","prop.gtb.groups","prop.gtb.groups.tip","http://www.google.{domain}/groups?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",false),new GTB_BuiltInButtonInfo("gtbSearchFroogle","http://toolbar.google.com/buttons/defs/en/google.com_products.xml","chrome://google-toolbar/skin/froogle.png","prop.gtb.froogle","prop.gtb.froogle.tip","http://www.google.{domain}/products?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",
false),new GTB_BuiltInButtonInfo("gtbSearchLocal","http://toolbar.google.com/buttons/defs/maps.google.com.xml","chrome://google-toolbar/skin/local.png","prop.gtb.local","prop.gtb.local.tip","http://maps.google.{domain}/maps?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",false),new GTB_BuiltInButtonInfo("gtbSearchBookmarks",null,"chrome://google-toolbar/skin/bookmarkstar.png","prop.gtb.bookmarks","prop.gtb.bookmarks.tip","http://www.google.{domain}/bookmarks/find?hl={locale}&q={query}{sourceid}{rlz}{aq}&ie=UTF-8",
true),new GTB_BuiltInButtonFromFileFactory("toolbar.google.com_CTK0Y7F4MTG6NKYH03WT.xml","gtbstoolbar-google-com_CTK0Y7F4MTG6NKYH03WT-xml","http://toolbar.google.com/buttons/defs/orkut.com.xml"),new GTB_BuiltInButtonFromFileFactory("video.google.com.xml","gtbSearchVideo","http://toolbar.google.com/buttons/defs/video.google.com.xml"),new GTB_BuiltInButtonFromFileFactory("google.com_blog_search.xml","gtbSearchBlogs","http://toolbar.google.com/buttons/defs/google.com_blog_search.xml"),new GTB_BuiltInButtonFromFileFactory("books.google.com.xml",
"gtbSearchBooks","http://toolbar.google.com/buttons/defs/books.google.com.xml"),new GTB_BuiltInButtonFromFileFactory("calendar.google.com.xml","gtbSearchCalendar","http://toolbar.google.com/buttons/defs/calendar.google.com.xml"),new GTB_BuiltInButtonFromFileFactory("docs.google.com.xml","gtbSearchDocs","http://toolbar.google.com/buttons/defs/docs.google.com.xml"),new GTB_BuiltInButtonFromFileFactory("google.com_finance.xml","gtbSearchFinance","http://toolbar.google.com/buttons/defs/google.com_finance.xml"),
new GTB_BuiltInButtonFromFileFactory("google.com_patents.xml","gtbSearchPatents","http://toolbar.google.com/buttons/defs/google.com_patents.xml"),new GTB_BuiltInButtonFromFileFactory("photos.google.com.xml","gtbSearchPhotos","http://toolbar.google.com/buttons/defs/photos.google.com.xml"),new GTB_BuiltInButtonFromFileFactory("google.com_scholar.xml","gtbSearchScholar","http://toolbar.google.com/buttons/defs/google.com_scholar.xml")];for(var b=GTB_builtinButtons.buttonsList_,c=GTB_builtinButtons.popularButtons_,
d=c.length-1;d>=0;d--)for(var e=c[d],f=0,g;g=b[f];f++)if(g.getButtonId()==e){b.splice(f,1);b.unshift(g);break}}return GTB_builtinButtons.buttonsList_}GTB_builtinButtons.popularButtons_=["gtbSearchGoogle","gtbBookmarks","gtbSearchImages","gtbCountrySearch","gtbSearchLocal","gtbSearchSite","gtbSearchNews","gtbSearchVideo","gtbSearchWebhistory"];GTB_builtinButtons.buttonsList_=null;GTB_CustomButtonsService.registerBuiltinButtons(GTB_builtinButtons);function GTB_CB_ButtonWithFile(b,c){GTB_CB_Button.call(this,b,GTB_CB_IdRoutines.generateButtonIdFromFile(c));this.debugZone="GTB_CB_ButtonWithFile";if(!c)throw Error("no file specified");this.file_=c}GTB_CB_ButtonWithFile.inherits(GTB_CB_Button);a=GTB_CB_ButtonWithFile.prototype;a.getIEButtonRegistryKeyName=function(){var b=this.isShared()?"S":"U";return b+"_"+this.file_.leafName};a.getFile=function(){return this.file_};
a.canRemove=function(){if(!GTB_CB_Button.prototype.canRemove.call(this))return false;var b=this.file_.parent;if(b)return b.isWritable();return this.file_.isWritable()};a.remove=function(){GTB_CB_Button.prototype.remove.call(this);try{this.file_.remove(false)}catch(b){}};a.removeWithoutDeletingFile=function(){GTB_CB_Button.prototype.remove.call(this)};function G_BinaryFetcher(){this.debugZone="binary-fetcher"}
G_BinaryFetcher.prototype.get=function(b,c){this.callback_=c;this.data_="";var d=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);this.channel_=null;try{this.channel_=d.newChannel(b,null,null)}catch(e){this.callback_({status:null,responseText:""});this.callback_=null;return}d=Cc["@mozilla.org/network/stream-loader;1"].createInstance(Ci.nsIStreamLoader);var f=new G_ThisFirefoxVersion;if(f.isVersionOf("2"))d.init(this.channel_,this,null);else{d.init(this);this.channel_.asyncOpen(d,
this.channel_)}};G_BinaryFetcher.prototype.onStreamComplete=function(b,c,d,e,f){b=b.request.QueryInterface(Ci.nsIHttpChannel);d=null;try{d=b.responseStatus}catch(g){}f=String.fromCharCode.apply(this,f);this.callback_({status:d,responseText:f});this.channel_=this.callback_=null};G_BinaryFetcher.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIStreamLoaderObserver))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};function GTB_ButtonFeed(b,c,d,e){this.debugZone="GTB_ButtonFeed";this.button_=b;this.prefs_=c;this.observerService_=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);this.gaiaService_=Cc["@google.com/toolbar/gaia-service;1"].getService().wrappedJSObject;this.lastRefresh_=0;this.feedTimer_=null;this.isConnecting_=false;this.isMenuEnabled_=!d.hasAttribute("menu")||GTB_CB_XmlUtils.getBoolAttribute("menu",d);this.refreshOnclick_=GTB_CB_XmlUtils.getBoolAttribute("refresh-onclick",
d);this.isGoogleService_=GTB_CB_XmlUtils.getBoolAttribute("google-service",d);var f=parseInt(d.getAttribute("refresh-interval"),10);this.refreshInterval_=isNaN(f)?600:Math.max(60,f);this.allowFeedAlert_=(d=d.getAttribute("allow-alerts"))&&(d.trim().toLowerCase()=="true"||parseInt(d,10));this.iconFeed_=null;if((d=GTB_CB_XmlUtils.getNode("//gtb:feed-icon",e))&&d.textContent)this.iconFeed_="data:image/x-icon;base64,"+d.textContent;this.descriptionFeed_=GTB_CB_XmlUtils.getTextContent("feed-description",
e);this.buttonID_=b.getID();this.feedDataLocalStore_=this.isGoogleService_?new GTB_CB_GoogleServiceFeedStore(this.buttonID_,b.getPreferenceName()):new GTB_CB_SimpleFeedStore(this.buttonID_,c);(b=this.feedDataLocalStore_.loadFeed())||this.prefs_.clearPref(".feedUpdate")}a=GTB_ButtonFeed.prototype;a.isMenuEnabled=function(){return this.isMenuEnabled_};a.isSignInRequired=function(){if(!this.isGoogleService_)return false;return!this.gaiaService_.gaiaIsSignedIn()};
a.gaiaEmailChanged=function(b){if(this.isGoogleService_){this.feedDataLocalStore_.gaiaEmailChanged(b);this.updateFeed(true)}};a.gaiaSignedInStateChanged=function(){this.isGoogleService_&&this.updateFeed()};a.updateFeedIfOnline=function(){this.updateFeedInternal(false,true)};a.updateFeed=function(b){this.updateFeedInternal(!!b,false)};
a.updateFeedInternal=function(b,c){if(this.button_.isVisible())if(this.isRunning_())this.isSignInRequired()?this.stopFeed():this.refreshDataFromServer_(b,c);else{this.feedTimer_=new G_Alarm(BindToObject(this.updateFeedIfOnline,this),this.refreshInterval_*1E3,true);this.refreshDataFromServer_(b,c);this.notifyFeedChanged_()}};
a.refreshDataFromServer_=function(b,c){if(!(c&&!GTB_IsOnline()))if(!(!b&&this.prefs_.getPref(".feedUpdate",0)>Date.now()/1E3))if(!this.isConnecting_){this.lastRefresh_=Date.now();this.isConnecting_=true;var d=Date.now()-this.gaiaService_.getLastGaiaRequestTime();d=5E3-d;if(d>0)new G_Alarm(BindToObject(this.sendUpdateRequest_,this),d);else this.sendUpdateRequest_()}};
a.sendUpdateRequest_=function(){var b=this.button_.getURL("feed"),c=GTB_getGoogleDomain();b=b.replace("{0}",c).replace("{domain}",c).replace("{locale}",GTB_getLangCode());if(b.indexOf("{option1}")>-1)if(c=this.button_.getOptionValue())b=b.replace("{option1}",c);else{this.isRunning_()&&this.stopFeed();return}b.replace(/{[^}]*}/,"");c=GTB_BackoffedFetcher.createFetcherForCBFeed(this.buttonID_);c.get(b,BindToObject(this.updateFeedCallback_,this,c));b=Math.round(Date.now()/1E3+this.refreshInterval_);
this.prefs_.setPref(".feedUpdate",b)};
a.updateFeedCallback_=function(b,c){this.isConnecting_=false;if(c.status==200)if(!this.isSignInRequired()){var d=b.getResponseHeader("Expires");if(d){d=new Date(d);if(!isNaN(d.getTime())){d=Math.max(d.getTime()/1E3,Date.now()/1E3+this.refreshInterval_);d=Math.round(d);this.prefs_.setPref(".feedUpdate",d)}}d=c.responseXML;if(!d&&c.responseText)try{d=G_FirefoxXMLUtils.parseString(c.responseText)}catch(e){d=null}if(d){d=this.feedDataLocalStore_.createFeedData(d);if(!d.equals(this.getFeedData())){this.feedDataLocalStore_.setFeedData(d,
c.responseText);d.markAsNew();if(d.alert()&&this.allowFeedAlert_){var f=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);f=f.getMostRecentWindow("navigator:browser");(f=f.GTB_getToolbar().customButtons)&&f.showAlert(this.button_,d.alert())}this.notifyFeedChanged_()}}}};a.stopFeed=function(){if(this.feedTimer_){this.feedTimer_.cancel();this.feedTimer_=null;this.notifyFeedChanged_()}};a.isRunning_=function(){return!!this.feedTimer_};a.getId_=function(){return this.button_.getID()};
a.getFeedData=function(){return this.feedDataLocalStore_.getFeedData()};a.isConnecting=function(){return this.isConnecting_};a.getMinutesSinceLastRefresh=function(){var b=this.lastRefresh_/1E3,c=Date.now()/1E3;b=Math.round((c-b)/60);if(b>2)return b;return 2};a.handleButtonClick=function(){this.refreshOnclick_&&this.updateFeed(true);this.isRunning_()&&this.markFeedDataAsRead()};a.markFeedDataAsRead=function(){var b=this.getFeedData();if(b&&b.hasUnreadItems()){b.markAsRead();this.notifyFeedChanged_()}};
a.notifyFeedChanged_=function(){this.observerService_.notifyObservers(null,"GTB_CB_FEED_UPDATE",this.getId_())};a.getCurrentStateIcon=function(){if(!this.isRunning_())return null;var b=this.getFeedData();if(!b)return null;if(b.icon())return b.icon();if(b.hasUnreadItems())return this.iconFeed_;return null};
a.getFeedDescription=function(){if(!this.isRunning_())return null;var b=this.getFeedData();if(!b)return null;if(b.description())return b.description();if(b.hasUnreadItems())return this.descriptionFeed_;return null};a.getStatus=function(){if(!this.isRunning_())return null;var b=this.getFeedData();if(b)return b.status();return null};function GTB_CB_Manager(b,c,d,e){this.debugZone="custom-buttons-manager";this.tabWatcher_=b;this.doc_=c;this.window_=d;this.prefs_=new G_Preferences("google.toolbar.button_option.");this.service_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject;this.observerService_=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);this.observers_=[new G_ObserverServiceObserver("GTB_CB_SHOW",BindToObject(this.observeShow_,this)),new G_ObserverServiceObserver("GTB_CB_HIDE",
BindToObject(this.observeHide_,this)),new G_ObserverServiceObserver("GTB_CB_ADD",BindToObject(this.observeUpdate_,this)),new G_ObserverServiceObserver("GTB_CB_REMOVE",BindToObject(this.observeRemove_,this)),new G_ObserverServiceObserver("GTB_CB_UPDATE",BindToObject(this.observeUpdate_,this)),new G_ObserverServiceObserver("GTB_CB_FEED_UPDATE",BindToObject(this.observeFeedUpdate_,this)),new G_ObserverServiceObserver("GTB_CB_SORT",BindToObject(this.observeSort_,this)),new G_ObserverServiceObserver("GTB_CB_NAMECHANGE",
BindToObject(this.observeNameChange_,this)),new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.observeCustomize_,this)),new G_ObserverServiceObserver("google-toolbar-options-restoredefaults",BindToObject(this.observeRestoreDefaults,this))];this.toolbarInstance_=e;this.gaiaService_=Cc["@google.com/toolbar/gaia-service;1"].getService().wrappedJSObject;this.gaiaSettings_=e.settings.gaia_;e.eventRegistrar.registerListener("searchbox-textchange",BindToObject(this.onSearchBoxTextChange_,
this));c=this.tabWatcher_.getTabBrowser().mTabBox;d=BindToObject(this.checkForSelection_,this);c.addEventListener("mouseup",d,false);GTB_RegisterListener(b,"pageshow",this.checkForSelection_,this);GTB_RegisterListener(b,"tabswitch",this.checkForSelection_,this);this.initializing_=true;this.createCustomButtonsInCustomPalette_();this.restoreOnToolbar_();this.updateFeelingLuckyButtonState();this.initializing_=false;this.service_.releaseCachedButtonsUI()}
GTB_CB_Manager.prototype.restoreOnToolbar_=function(){for(var b=this.service_.getVisibleList(),c=this.toolbarInstance_.layout,d=b.length-1;d>=0;--d){var e=b[d];c.restoreDynamicItem(e)&&this.updateIconAndTooltip_(e)}};GTB_CB_Manager.prototype.ensureVisibleButtonsOnToolbar=function(){for(var b=this.service_.getVisibleList(),c=this.toolbarInstance_.layout,d=b.length-1;d>=0;--d){var e=b[d];if(this.doc_.getElementById(e)==null){c.addButton(e);this.updateIconAndTooltip_(e)}}};
goog.exportSymbol("GTB_CB_Manager.prototype.ensureVisibleButtonsOnToolbar",GTB_CB_Manager.prototype.ensureVisibleButtonsOnToolbar);GTB_CB_Manager.prototype.shutdown=function(){for(var b=0;b<this.observers_.length;b++)this.observers_[b].unregister();this.observers_=null};GTB_CB_Manager.prototype.handleCurrentLocationChange=function(b){var c=this.doc_.getElementById("gtbSearchSite");if(c){b=GTB_convertToUrl(b);b=b!=null&&!GTB_isGoogleUrl(b)&&b.scheme=="http";c.disabled=!b}};
goog.exportProperty(GTB_CB_Manager.prototype,"handleCurrentLocationChange",GTB_CB_Manager.prototype.handleCurrentLocationChange);GTB_CB_Manager.prototype.updateFeelingLuckyButtonState=function(){var b=this.doc_.getElementById("gtbFeelingLucky");if(b){var c=this.doc_.getElementById("gtbGoogleSearchBox");c=c.value;b.disabled=c.trim().length==0}};
GTB_CB_Manager.checkInstallCookie=function(){var b=GTB_getCookie("http://toolbar.google.com/T4/","CBINST");if(b){var c="http://toolbar.google.com/T4/",d="CBINST",e=GTB_getCookie(c,d);if(e){e=new Date(1970,1,1);d=d+"=EXPIRED;expires="+e.toUTCString();c=GTB_convertToUrl(c);e=Cc["@mozilla.org/cookieService;1"].getService(Ci.nsICookieService);e.setCookieString(c,null,d,null)}GTB_CB_Manager.openInstallButtonDialog(decodeURIComponent(b))}};
GTB_CB_Manager.openInstallButtonDialog=function(b){var c=GTB_LayoutUtil.getMostRecentBrowserWindow();c&&GTB_CB_Manager.promptInstall(b,c,null)};a=GTB_CB_Manager.prototype;a.observeShow_=function(b,c,d){this.showButton_(d)};a.observeHide_=function(b,c,d){this.hideButton_(d)};a.observeRemove_=function(b,c,d){this.hideButton_(d);this.toolbarInstance_.layout.removeButtonFromPalette(d)};
a.observeUpdate_=function(b,c,d){if(c=this.service_.getButton(d)){var e=this.createButtonUI_(d),f=this.serializeButtonUI_(e);b=true;var g=this.findElementOnCustomPalette_(d);if(g)(b=f!=this.serializeButtonUI_(g))&&g.parentNode.replaceChild(e,g);else this.addToCustomPalette_(e);b&&this.saveButtonUI_(d,f);if(c.isVisible()){if(c=this.doc_.getElementById(d)){if(b){b=c.parentNode;e=c.nextSibling;b.removeChild(c);b.insertItem&&b.insertItem(d,e)}this.updateIconAndTooltip_(d)}else this.showButton_(d);this.toolbarInstance_.chevron.doResize();
this.service_.getNoFade()||this.fadeButton_(d)}}};a.observeSort_=function(){this.sortToolbarButtons_()};a.observeFeedUpdate_=function(b,c,d){(b=this.service_.getButton(d))&&this.updateIconAndTooltip_(d)};a.observeNameChange_=function(b,c,d){if(b=this.service_.getButton(d)){(c=this.doc_.getElementById(d))&&this.setLabelText_(b,c);(d=this.findElementOnCustomPalette_(d))&&this.setLabelText_(b,d)}};
a.findElementOnCustomPalette_=function(b){var c=this.doc_.getElementById("navigator-toolbox");c=c.palette;for(c=c.firstChild;c;c=c.nextSibling)if(c.id==b)return c;return null};a.observeCustomize_=function(b,c,d){if(d!=GTB_Options.OPTIONS_DIALOG_APPLIED){this.cleanupBloodyCustomizePaletteEffects_();if(!this.doc_.getElementById("gtbSearchBox")){b=this.doc_.getElementById("main-window");b.removeAttribute("gtbSearchBox")}}};
a.observeRestoreDefaults=function(){for(var b=this.service_.getVisibleList(),c=0,d=null;d=b[c];++c)this.doc_.getElementById(d)&&this.updateIconAndTooltip_(d)};a.checkForSelection_=function(){var b=this.doc_.getElementById("main-window"),c=this.tabWatcher_.getTabBrowser().selectedBrowser&&GetFocusedWindow(this.doc_.defaultView).getSelection();c&&c.toString().trim()?b.setAttribute("gtbContentArea","selectedText"):b.removeAttribute("gtbContentArea")};
a.onSearchBoxTextChange_=function(b){b=b.trim();var c=this.tabWatcher_.getCurrentWindow();if(c&&c.document){c=this.doc_.getElementById("main-window");var d=c.getAttribute("gtbSearchBox");if("focusedNoText"==d&&b.length)c.setAttribute("gtbSearchBox","focused");else"focused"==d&&b.length==0&&c.setAttribute("gtbSearchBox","focusedNoText")}};
a.createButtonUI_=function(b){var c=this.service_.getButton(b);if(!c)return null;var d=this.doc_.createElement("toolbarbutton");d.setAttribute("id",b);d.setAttribute("tooltip","gtbMultilineTooltip");this.setLabelText_(c,d);c.isIconSetInStyleSheet()||d.setAttribute("image",c.getIcon());c.canSendSelection()&&d.setAttribute("hassend","true");c.canPerformSearch()&&d.setAttribute("hassearch","true");b=c.getGadgetDescription();var e="gtb-custombutton gtbHelperIcon ";if(b)if(b.isWholeDropdown()){d.setAttribute("type",
"menu");d.setAttribute("class",e+"gtbWholeMenuGadgetButton")}else{d.setAttribute("type","menu-button");d.setAttribute("class",e+"gtbGadgetButtonWithSeparateMenu")}else if(c.menuEnabled()){d.setAttribute("type","menu-button");d.setAttribute("class",e+"gtbButtonWithSeparateMenu");c=this.doc_.createElement("menupopup");c.setAttribute("class","gtbButtonFeedMenupopup");d.appendChild(c)}else d.setAttribute("class",e+"gtbSimpleCustomButton");return d};
a.getButtonUI_=function(b){var c=this.service_.getCachedButtonsUI();if(c)return this.deserializeButtonUI_(c[b]);(c=this.createButtonUI_(b))&&this.saveButtonUI_(b,this.serializeButtonUI_(c));return c};a.saveButtonUI_=function(b,c){this.prefs_.setPref("cached."+b,c)};a.serializeButtonUI_=function(b){var c=Cc["@mozilla.org/xmlextras/xmlserializer;1"].createInstance(Ci.nsIDOMSerializer);return c.serializeToString(b)};
a.deserializeButtonUI_=function(b){try{var c=Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromString(b,"text/xml");return c.documentElement.cloneNode(true)}catch(d){}};a.isInChevron_=function(b){for(;b;){if(b.id=="gtbChevron")return true;b=b.parentNode}return false};
a.setLabelText_=function(b,c){var d=b.getButtonFeed();d=d?d.getStatus():null;var e=b.getNameFull();if(e)e=e.substring(0,32);if(d){d=d.substring(0,16);e+=" "+d}c.setAttribute("label",e);c.setAttribute("fullText",e);d?c.setAttribute("statusText",d):c.removeAttribute("statusText")};
a.addToCustomPalette_=function(b){var c=this.doc_.getElementById("navigator-toolbox");c=c.palette;for(var d=null,e=c.lastChild;e;){if(e.id==b.id)return;else if(e.id.indexOf("Search")>-1){d=e.nextSibling;break}e=e.previousSibling}c.insertBefore(b,d)};
a.createCustomButtonsInCustomPalette_=function(){var b=this.doc_.getElementById("navigator-toolbox");b=b.palette;for(var c=null,d=b.lastChild;d;){if(d.id.indexOf("Search")>-1){c=d.nextSibling;break}d=d.previousSibling}d=this.service_.getList().toArray();for(var e=0;e<d.length;++e){var f=d[e],g=this.doc_.getElementById(f);if(!g)(f=this.getButtonUI_(f))&&b.insertBefore(f,c)}};
a.showButton_=function(b){var c=this.toolbarInstance_.layout;c.addButton(b);c.persistToolbars();"gtbFeelingLucky"==b&&this.updateFeelingLuckyButtonState();this.updateIconAndTooltip_(b)};a.hideButton_=function(b){var c=this.doc_.getElementById(b);if(c){c=this.toolbarInstance_.layout;c.removeButton(b);c.persistToolbars()}};
a.sortToolbarButtons_=function(){for(var b=this.doc_.getElementById("gtbToolbar"),c=this.service_.getVisibleList(),d=c.length-1;d>=0;--d){var e=c[d];e=this.doc_.getElementById(e);e.parentNode!=b&&c.splice(d,1)}var f=[];for(d=b.firstChild;d=d.nextSibling;){e=d.id;this.service_.getButton(e)&&c.indexOf(e)!=-1&&f.push(e)}for(d=0;d<c.length;d++){e=c[d];var g=f.indexOf(e);if(g!=d){var h=this.doc_.getElementById(e),i=this.doc_.getElementById(f[d]),j=h.nextSibling;b.removeChild(h);b.replaceChild(h,i);b.insertBefore(i,
j);f[g]=i.id;f[d]=e}}};a.cleanupBloodyCustomizePaletteEffects_=function(){var b=this.doc_.getElementById("gtbToolbar"),c=[];for(b=b.firstChild;b=b.nextSibling;){var d=b.id;this.service_.getButton(d)&&c.push(d)}this.service_.getList().orderSubset(c);this.toolbarInstance_.layout.persistToolbars()};a.handleClick=function(b,c){var d=this.doc_.getElementById(b);GTB_CB_Manager.doCustomSearch_(this.doc_,b,c,!!d.getAttribute("hassend"))};
GTB_CB_Manager.doCustomSearch_=function(b,c,d,e){var f=b.defaultView,g=1==d.button;e=GTB_CB_Manager.getQueryAndSelectionText(b,e);b=e.query;e=e.selectedText;var h=Cc["@google.com/toolbar/search-service;1"].getService().wrappedJSObject;h.executeSearch(f,c,b,e,"",g,d)};
GTB_CB_Manager.getQueryAndSelectionText=function(b,c){var d={query:"",selectedText:""},e=b.getElementById("main-window");if(e.getAttribute("gtbSearchBox")=="focused"){if(e=b.getElementById("gtbGoogleSearchBox"))d.query=e.value}else if(e.getAttribute("gtbContentArea")=="selectedText"){e=b.defaultView;d.selectedText=GetFocusedWindow(e).getSelection().toString().trim();if(!c){var f=d.selectedText;d.query=f;if(f.length>0)if(e=b.getElementById("gtbGoogleSearchBox"))e.value=f}}return d};
GTB_CB_Manager.prototype.doButtonClick=function(b){var c=b.target;c=c.id;var d=this.service_.getButton(c);if(d){this.handleClick(c,b);(c=d.getButtonFeed())&&c.handleButtonClick()}b.preventBubble()};goog.exportProperty(GTB_CB_Manager.prototype,"doButtonClick",GTB_CB_Manager.prototype.doButtonClick);
GTB_CB_Manager.prototype.showGadgetPopup_=function(b){var c=b.target,d=c.id;d=this.service_.getButton(d);var e=d.getButtonFeed();e&&e.markFeedDataAsRead();if(c.tagName=="menuitem"){do c=c.parentNode;while(c.tagName!="xul:toolbarbutton")}if(3!=GetPlatform()&&GTB_GeckoVersion.isFirefox2())new GTB_GadgetPopupWinMac(d,this.window_,c);else new GTB_GadgetPopupBubble(d,this.window_,c,this.doc_);b.preventBubble()};goog.exportProperty(GTB_CB_Manager.prototype,"showGadgetPopup_",GTB_CB_Manager.prototype.showGadgetPopup_);
GTB_CB_Manager.prototype.createChevronItem=function(b,c){if(!c)return null;var d=this.service_.getButton(c);if(!d)return null;var e=d.getGadgetDescription();if(e?!e.isWholeDropdown():d.menuEnabled()){d=b.createElement("menu");e=b.createElement("menupopup");e.setAttribute("class","gtbButtonFeedMenupopup");d.appendChild(e)}else{d=b.createElement("menuitem");GTB_CB_Manager.setChevronCommandHandler_(d,e)}return d};goog.exportProperty(GTB_CB_Manager.prototype,"createChevronItem",GTB_CB_Manager.prototype.createChevronItem);
GTB_CB_Manager.setChevronCommandHandler_=function(b,c){b.setAttribute("oncommand","GTB_getToolbar().customButtons."+(c?"showGadgetPopup_":"doButtonClick")+"(event);");b.setAttribute("onclick","GTB_GTO_onClickMiddleMouse(event);")};
GTB_CB_Manager.prototype.doPopupShowing=function(b){for(var c=b.target,d=c.parentNode,e=d.id,f=this.service_.getButton(e);c.lastChild;)c.removeChild(c.lastChild);if(d.tagName=="menu"){var g=this.doc_.createElement("menuitem");g.setAttribute("class","menuitem-iconic");g.setAttribute("id",e);g.setAttribute("label",d.getAttribute("label"));var h=d.getAttribute("image");if(h)g.setAttribute("image",h);else{d=this.doc_.defaultView.getComputedStyle(d,"");g.style.listStyleImage=d.listStyleImage;g.style.MozImageRegion=
d.MozImageRegion}GTB_CB_Manager.setChevronCommandHandler_(g,false);c.appendChild(g);c.appendChild(this.doc_.createElement("menuseparator"));if(f.getGadgetDescription()){b=this.doc_.createElement("menuitem");b.setAttribute("class","menuitem-iconic");b.setAttribute("id",e);b.setAttribute("label",this.getString_("label.show.gadget"));GTB_CB_Manager.setChevronCommandHandler_(b,true);c.appendChild(b);return}}e=f.getButtonFeed();if((g=e.getFeedData())&&g.length()>0&&!e.isSignInRequired()){g.fillPopup(c);
e.markFeedDataAsRead()}else{e=this.doc_.createElement("menuitem");e.setAttribute("refresh-item",true);c.appendChild(e);e.setAttribute("label",this.getRefreshItemLabel_(f))}b.preventBubble()};goog.exportProperty(GTB_CB_Manager.prototype,"doPopupShowing",GTB_CB_Manager.prototype.doPopupShowing);
GTB_CB_Manager.prototype.getRefreshItemLabel_=function(b){var c=this.getString_("name"),d=this.getString_("label.refresh");b=b.getButtonFeed();if(!b)return d;if(b.isConnecting())return c.replace("&NAME;",d).replace("&OPTION;",this.getString_("label.refresh.connecting"));if(b.isSignInRequired())return c.replace("&NAME;",d).replace("&OPTION;",this.getString_("label.refresh.signedout"));if(b.getFeedData()){b=b.getMinutesSinceLastRefresh();b=b>1?this.getString_("label.refresh.last").replace("%s",b):this.getString_("label.refresh.last.recent");
return c.replace("&NAME;",d).replace("&OPTION;",b)}return d};
GTB_CB_Manager.prototype.doPopupClick=function(b){var c=b.target;if(c.getAttribute("refresh-item")){c=this.service_.getButton(c.parentNode.parentNode.id);var d=c.getButtonFeed();if(d.isSignInRequired()){this.gaiaSettings_.gaiaSignIn();return}c.updateFeed(true)}else if(c=c.getAttribute("url")){d=GTB_GlobalPrefs.getPref("google.toolbar.search_new_window_or_tab",null);if(1==b.button||d=="newTab"){d=this.tabWatcher_.getTabBrowser();d.selectedTab=d.addTab(c)}else d=="newWindow"?this.window_.open(c,"gtbSearchWindow"):
this.window_.openUILink(c,b,false,true)}b.preventBubble()};goog.exportProperty(GTB_CB_Manager.prototype,"doPopupClick",GTB_CB_Manager.prototype.doPopupClick);GTB_CB_Manager.prototype.fadeButton_=function(b){b=this.doc_.getElementById(b);b=b.buttonImage;b.style.backgroundColor="Window";var c=this.doc_.defaultView;c=c.getComputedStyle(b,"");c=c.backgroundColor.substring(4);c=c.substring(0,c.length-1);c=c.split(", ");for(var d=0;d<c.length;++d)c[d]=parseInt(c[d],10);this.fadeButtonStep_(b,c,14)};
GTB_CB_Manager.prototype.fadeButtonStep_=function(b,c,d){var e=[255,255,0];if(d>0){for(var f=[],g=0;g<c.length;++g){var h=e[g],i=c[g];f.push(Math.round((h-i)/14*d)+i)}if(b.src&&d%3==1){b.setAttribute("gtbSrc",b.src);b.src=null}else if(b.hasAttribute("gtbSrc"))b.src=b.getAttribute("gtbSrc");b.style.backgroundColor="rgb("+f.join(", ")+")";new G_Alarm(BindToObject(this.fadeButtonStep_,this,b,c,d-1),300)}else{if(b.hasAttribute("gtbSrc")){b.src=b.getAttribute("gtbSrc");b.removeAttribute("gtbSrc")}b.style.backgroundColor=
""}};
GTB_CB_Manager.setupDialog=function(b,c){var d="gtbCustomButtonsButton",e=c.getElementById(d+"Icon"),f=c.getElementById(d+"Title"),g=c.getElementById(d+"Description");e.setAttribute("src",b.getIconDefault());f.setAttribute("value",b.getTitle());g.textContent=b.getDescriptionDefault();GTB_Directionality.setNodeDirection(g,g.textContent);d="gtbCustomButtonsPrivacy";f=["Search","Site","Send","Feed"];for(e=0;e<f.length;e++){g=f[e];var h=b.getURL(g.toLowerCase());if(!(g=="Site"&&h&&!h.match("{url")))if(h){h=h.replace("{domain}",
GTB_getGoogleDomain());h=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(h,null,null).host;g=c.getElementById(d+g);g.textContent=g.textContent.replace("{url}",h);g.parentNode.setAttribute("hidden",false);g=c.getElementById(d+"Description");g.parentNode.setAttribute("hidden",true)}}if(b.getLegacy()){g=c.getElementById(d+"Replace");g.textContent=g.textContent.replace("{name}",b.getLegacy());g.parentNode.setAttribute("hidden",false)}d="gtbCustomButtonsEditOptions";g=c.getElementById(d+
"Description");f="";if(b.hasOption()){f=c.getElementById(d+"Title");e=c.getElementById(d+"Value");(h=b.getOptionTitle())&&f.setAttribute("value",h);if(f=b.getOptionDescription())g.textContent=f;e.setAttribute("value",b.getOptionValue());e=c.getElementById(d+"Container");e.setAttribute("hidden",false)}if(b.getURL("search")){d=c.getElementById(d+"SearchTypeCheckbox");d.setAttribute("hidden",false);g.setAttribute("hidden",!f);g=new G_Preferences("google.toolbar.button_option.search.");d.checked=g.getPref(b.getID(),
true)}};
GTB_CB_Manager.prototype.doAddDialogLoad=function(b){b=b.currentTarget;b.document.documentElement.getButton("accept").hidden=true;b.document.documentElement.getButton("extra1").hidden=true;var c=b.document.location.toString(),d=c.substr(c.indexOf("?")+1);c=b.opener.GTB_getToolbar().customButtons;var e=b.arguments[0];switch(d){case "web":var f=new G_XMLFetcher;f.get(e.buttonUri.spec,BindToObject(c.onPromptCallback_,c,b));break;case "advanced":c.onPromptEditorInstallCallback_(b);break;case "generate":e=e.inputElement;
e=e.ownerDocument;a:{e=e;d=e.getElementsByTagName("link");for(var g=0,h=null;h=d[g];++g){var i=h.getAttribute("rel")||"";i=i.toLowerCase().split(" ");if(i.indexOf("icon")!=-1){i=GTB_convertToUrl(e.body.baseURI);h=h.getAttribute("href")||"/favicon.ico";try{f=i.resolve(h)}catch(j){}if(f){e=f;break a}}}e=GetFavicon(e.location.href)}f=new G_BinaryFetcher;f.get(e,BindToObject(c.addGeneratedSearchCallback_,c,b));break}};goog.exportProperty(GTB_CB_Manager.prototype,"doAddDialogLoad",GTB_CB_Manager.prototype.doAddDialogLoad);
GTB_CB_Manager.prototype.doAddDialogOK=function(b){var c=b.target.parentNode.defaultView,d=c.document;b=c.arguments[0];var e=d.getElementById("gtbCustomButtonsInstaller"),f=e.getAttribute("type");if(f=="search"){if(!this.updateButtonFromUserEdit_(d,b.newButton)){b=d.getElementById("gtbCustomButtonsFailedDesc");alert(b.textContent.trim());d.getElementById("gtbCustomButtonsSearchTitle").focus();return false}f=d.getElementById("gtbCustomButtonsEditOptionsSearchTypeCheckbox");this.prefs_.setPref("search."+
b.newButton.getID(),f.checked)}e=e.getAttribute("mode");switch(e){case "failed":return true;case "option":c=b.newButton;d=d.getElementById("gtbCustomButtonsEditOptionsValue").value;this.prefs_.setPref(c.getID()+".option",d);this.service_.installButton(c,b.existingButton);return true;case "add":this.maybeFinishInstall_(c);return false;case "replace":d=b.xmlDoc;e=b.existingButton;b.newButton=this.service_.startReplace(d,e);this.maybeFinishInstall_(c);return false;default:}};
goog.exportProperty(GTB_CB_Manager.prototype,"doAddDialogOK",GTB_CB_Manager.prototype.doAddDialogOK);GTB_CB_Manager.prototype.updateButtonFromUserEdit_=function(b,c){var d=b.getElementById("gtbCustomButtonsSearchTitle"),e=b.getElementById("gtbCustomButtonsSearchDescription");if(!d.value.trim())return false;d.setAttribute("disabled","true");e.setAttribute("disabled","true");c.setTitle(d.value);c.setDescription(e.value);return true};
GTB_CB_Manager.prototype.doInstallerAdd=function(b){b=b.target.ownerDocument.defaultView;b.arguments[0].existingButton=null;this.maybeFinishInstall_(b)};goog.exportProperty(GTB_CB_Manager.prototype,"doInstallerAdd",GTB_CB_Manager.prototype.doInstallerAdd);GTB_CB_Manager.prototype.maybeFinishInstall_=function(b){var c=b.arguments[0],d=c.newButton;if(d.hasOption())this.loadInstaller_("option",b);else{this.service_.installButton(d,c.existingButton,c.isUserEdited);b.close()}};
GTB_CB_Manager.prototype.getString_=function(b){return this.doc_.getElementById("google-toolbar-strings").getString("prop.gtb.custombuttons."+b)};GTB_CB_Manager.prototype.updateIconAndTooltip_=function(b){var c=this.service_.getButton(b);if(!c.isStub())if(c.isVisible())if(b=this.doc_.getElementById(b)){b.setAttribute("gtbTooltipText",c.getDescription()||c.getName());c.isIconSetInStyleSheet()||b.setAttribute("image",c.getIcon());this.setLabelText_(c,b)}};
GTB_CB_Manager.prototype.imageLoadError=function(b){var c=this.service_.getButton(b.id);if(c){var d=b.getAttribute("image");if(d!="chrome://google-toolbar/skin/custom-unknown.png")d!=c.getIconDefault()?b.setAttribute("image",c.getIconDefault()):b.setAttribute("image","chrome://google-toolbar/skin/custom-unknown.png")}};goog.exportProperty(GTB_CB_Manager.prototype,"imageLoadError",GTB_CB_Manager.prototype.imageLoadError);
GTB_CB_Manager.promptInstall=function(b,c,d){b=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(b,null,null);d=new GTB_AddButtonParameters_(b,null,d,null,null);c.openDialog("chrome://google-toolbar/content/custom-buttons-add.xul?web",b.spec,"modal,centerscreen,chrome,resizable",d)};a=GTB_CB_Manager.prototype;
a.onPromptCallback_=function(b,c){var d=b.arguments[0],e=d.buttonUri,f=b.document.getElementById("gtbCustomButtonsDetails").getElementsByTagName("caption")[0],g=f.getAttribute("label");f.setAttribute("label",g.replace("{url}",e.host));if(c&&c.status!=200)this.loadInstaller_("failed",b);else{f=c.responseXML;if(!f&&c.responseText)f=Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromString(c.responseText,"text/xml");d.xmlDoc=f;if(G_FirefoxXMLUtils.isParserError(f))this.loadInstaller_("failed",
b);else{try{var h=this.service_.startAdd(f,e.spec);d.newButton=h;GTB_CB_Manager.setupDialog(h,b.document)}catch(i){this.loadInstaller_("failed",b);return}e=h.getURL("update");if(e=this.service_.findButtonByUpdateUrl(e)){if(!d.existingButton)d.existingButton=e;this.loadInstaller_("replace",b)}else this.loadInstaller_("add",b)}}};
a.promptEditorInstall_=function(b,c){var d=new GTB_AddButtonParameters_(null,b,c,null,null,true);this.doc_.defaultView.openDialog("chrome://google-toolbar/content/custom-buttons-add.xul?advanced","gtbCustomButtonsAdd","modal,centerscreen,chrome,resizable=no",d)};
a.onPromptEditorInstallCallback_=function(b){var c=b.document,d=b.arguments[0],e=d.xmlDoc,f=d.existingButton;f=f.getURL("update");if(!f)f=(f=e.getElementsByTagName("search")[0])&&f.textContent;try{d.newButton=this.service_.startAdd(e,f,true);GTB_CB_Manager.setupDialog(d.newButton,c);var g=c.getElementById("gtbCustomButtonsDetails").getElementsByTagName("caption")[0],h=g.getAttribute("label"),i=this.getString_("advancededitor");g.setAttribute("label",h.replace("{url}",i));this.loadInstaller_("replace",
b)}catch(j){this.loadInstaller_("failed",b)}};a.loadInstaller_=function(b,c){new G_Alarm(BindToObject(this.loadInstallerFinal_,this,b,c),50)};
a.loadInstallerFinal_=function(b,c){var d=c.arguments[0],e=d.newButton,f=c.document,g=f.getElementById("gtbCustomButtonsInstaller");g.setAttribute("mode",b);g="option"==b?"add":b;g=this.getString_("button."+g);var h=f.documentElement.getButton("accept");h.setAttribute("label",g);g={add:"accept,cancel",replace:"accept,cancel",option:"accept,cancel",failed:"accept"};if("replace"==b)if(e.hasOption())g.replace+=",extra1";h=["accept","cancel","extra1"];for(var i=0;i<h.length;i++){var j=h[i],k=f.documentElement.getButton(j);
k.hidden=g[b].indexOf(j)==-1}if("option"==b){g=f.getElementById("gtbCustomButtonsEditOptionsValue");g.value=e.getOptionValue()}if(b=="failed")if((d=d.xmlDoc)&&G_FirefoxXMLUtils.isParserError(d)){d=d.documentElement;g=f.getElementById("gtbCustomButtonsFailedXmlError");f=d.childNodes[0].nodeValue+"\n"+d.childNodes[1].firstChild.textContent;g.value=f;g.parentNode.setAttribute("xmlerror","yes")}c.sizeToContent()};
a.maybeShowGenerateMenuItem=function(){var b=this.doc_.getElementById("contentAreaContextMenu");if(b){b.setAttribute("gtbCustomSearch","hide");var c=this.doc_.popupNode;if(c)if(c.nodeName.toLowerCase()=="input")if(!(c.type&&c.type.toLowerCase()!="text"))if(c=c.form)if(!(c.method&&c.method.toLowerCase()=="post"&&c.enctype&&c.enctype.toLowerCase()!="application/x-www-form-urlencoded"))if(c=this.getFormActionUri_(c))c.scheme!="http"&&c.scheme!="https"||b.removeAttribute("gtbCustomSearch")}};
goog.exportProperty(GTB_CB_Manager.prototype,"maybeShowGenerateMenuItem",GTB_CB_Manager.prototype.maybeShowGenerateMenuItem);GTB_CB_Manager.prototype.getFormActionUri_=function(b){var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService),d=b.ownerDocument;try{var e=c.newURI(d.URL,d.characterSet,null),f=c.newURI(b.getAttribute("action"),d.characterSet,e);return f}catch(g){}return null};
GTB_CB_Manager.prototype.generateCustomSearch=function(b){var c=b.ownerDocument,d=this.constructSearchUrl_(b),e=c.location.href,f=e.substring(0,50),g=b.form;if(g=g.acceptCharset){var h=g.split(/,|\s/);g=null;for(var i=0;i<h.length;i++)if(h[i].length>0){g=h[i];break}}if(!g)g=b.ownerDocument.characterSet;e=(new GTB_CustomSearch(null,null,c.title,f,d,e,g)).doc;f=e.getElementsByTagName("search")[0];b.form.method.toLowerCase()=="post"&&f.setAttribute("method","post");f=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);
c=f.newURI(c.location.href,null,null);b=new GTB_AddButtonParameters_(c,e,null,b,g);this.doc_.defaultView.openDialog("chrome://google-toolbar/content/custom-buttons-add.xul?generate",d,"modal,centerscreen,chrome,resizable",b)};goog.exportProperty(GTB_CB_Manager.prototype,"generateCustomSearch",GTB_CB_Manager.prototype.generateCustomSearch);
GTB_CB_Manager.prototype.addGeneratedSearchCallback_=function(b,c){var d=b.arguments[0],e=d.inputElement;e=this.constructSearchUrl_(e);var f=d.xmlDoc;if(c.status==200){for(var g=b.btoa(c.responseText),h=f.createElementNS("http://toolbar.google.com/custombuttons/","icon"),i=[""],j=0;j<g.length;j+=76)i.push(g.substring(j,j+76));i.push("    ");h.appendChild(f.createTextNode(i.join("\n")));g=f.getElementsByTagName("button")[0];g.appendChild(this.doc_.createTextNode("  "));g.appendChild(h);g.appendChild(this.doc_.createTextNode("\n  "))}h=
b.document;h.title=b.generatorTitle;g=d.buttonUri;try{d.newButton=this.service_.startAdd(f,g.spec,true)}catch(k){this.loadInstaller_("failed",b);return}GTB_CB_Manager.setupDialog(d.newButton,h);if(e=this.service_.getMatchingGeneratedSearch(e)){d.existingButton=e;d.newButton=e;d="replace";this.loadInstaller_("replace",b)}else d="add";this.generatedSearchDialogFixUp_(b,d)};
GTB_CB_Manager.prototype.generatedSearchDialogFixUp_=function(b,c){this.loadInstaller_(c,b);var d=b.document.getElementById("gtbCustomButtonsInstaller");d.setAttribute("type","search");d=b.document;var e=b.arguments[0].newButton,f="gtbCustomButtonsSearch",g=d.getElementById(f+"Title");f=d.getElementById(f+"Description");g.value=e.getTitle();f.value=e.getDescriptionDefault();e=d.documentElement.getButton("extra1");e.hidden=true;b.sizeToContent()};
GTB_CB_Manager.prototype.constructSearchUrl_=function(b){for(var c=b.form,d=[],e=0,f=null;f=c.elements[e];++e)if(f.type)if(f==b)d.push(encodeURIComponent(f.name)+"={query}");else{var g=f.type.toLowerCase(),h=f.nodeName.toLowerCase();if(g=="text"||g=="hidden"||g=="textarea"||g=="password"||(g=="checkbox"||g=="radio")&&f.checked)d.push(encodeURIComponent(f.name)+"="+encodeURIComponent(f.value));else if((g=="select"||h=="select")&&f.selectedIndex>=0)for(g=0;g<f.options.length;++g)f.options[g].selected&&
d.push(encodeURIComponent(f.name)+"="+encodeURIComponent(f.options[g].value))}b=d.join("&");d=this.getFormActionUri_(c).spec;d+=c.method.toLowerCase()=="post"?"?"+b:d.indexOf("?")!=-1?"&"+b:"?"+b;return d};GTB_CB_Manager.prototype.onAddSearchTypes=function(b,c){b.GTB_getToolbar().loadUrlWithModifiers("http://www.google.com/tools/toolbar/buttons/gallery?hl="+GTB_getLangCode(),c);c.preventBubble()};goog.exportProperty(GTB_CB_Manager.prototype,"onAddSearchTypes",GTB_CB_Manager.prototype.onAddSearchTypes);
GTB_CB_Manager.prototype.onManageSearchTypes=function(b,c){GTB_OpenOptionsWindow(b,"gtbOptionsSearchPane");c.preventBubble()};goog.exportProperty(GTB_CB_Manager.prototype,"onManageSearchTypes",GTB_CB_Manager.prototype.onManageSearchTypes);
GTB_CB_Manager.prototype.maybeShowMoreSearchTypesMenu=function(b){if(b.target.id=="contentAreaContextMenu"){b=this.doc_.getElementById("gtbMoreSearchTypesMenuItem");b.hidden=true;var c=this.doc_.defaultView;if(c=(c=GetFocusedWindow(c).getSelection())&&c.toString().trim()){c=this.service_.getSearchButtons(true);if(c.length!=0)b.hidden=false}}};goog.exportProperty(GTB_CB_Manager.prototype,"maybeShowMoreSearchTypesMenu",GTB_CB_Manager.prototype.maybeShowMoreSearchTypesMenu);
GTB_CB_Manager.prototype.onMoreSearchTypesPopup=function(){var b=this.doc_.getElementById("gtbMoreSearchTypesPopup");if(b){for(;b.firstChild;)b.removeChild(b.firstChild);for(var c=this.service_.getSearchButtons(true),d=0,e=null;e=c[d];++d){var f=e.makeMenuItem(this.doc_);f.setAttribute("oncommand",'GTB_getToolbar().customButtons.onMoreSearchPopupCommand("'+e.getID()+'", event);');f.setAttribute("onclick","GTB_GTO_onClickMiddleMouse(event);this.parentNode.parentNode.parentNode.hidePopup();");b.appendChild(f)}}};
goog.exportProperty(GTB_CB_Manager.prototype,"onMoreSearchTypesPopup",GTB_CB_Manager.prototype.onMoreSearchTypesPopup);GTB_CB_Manager.prototype.onMoreSearchPopupCommand=function(b,c){var d=this.doc_.defaultView,e=GetFocusedWindow(d).getSelection();e=e&&e.toString().trim();var f=this.doc_.getElementById("gtbGoogleSearchBox");if(f)f.value=e;f=Cc["@google.com/toolbar/search-service;1"].getService().wrappedJSObject;f.executeSearch(d,b,e,"","",false,c)};
goog.exportProperty(GTB_CB_Manager.prototype,"onMoreSearchPopupCommand",GTB_CB_Manager.prototype.onMoreSearchPopupCommand);
GTB_CB_Manager.prototype.onSendToPopup=function(){for(var b=this.doc_.getElementById("gtbSendToMailContextMenuitem"),c=b.nextSibling;c;){b=c;c=c.nextSibling;b.parentNode.removeChild(b)}if(b=GetFocusedWindow(this.doc_.defaultView).getSelection().toString().trim()){b=this.doc_.getElementById("gtbSharingContextMenuPopup");c=this.service_.getSendButtons();for(var d=0,e=null;e=c[d];++d){var f=e.makeMenuItem(this.doc_);f.setAttribute("oncommand",'GTB_getToolbar().customButtons.onSendToPopupCommand("'+e.getID()+
'", event);');f.setAttribute("onclick","GTB_GTO_onClickMiddleMouse(event);this.parentNode.parentNode.parentNode.hidePopup();");b.appendChild(f)}}};goog.exportProperty(GTB_CB_Manager.prototype,"onSendToPopup",GTB_CB_Manager.prototype.onSendToPopup);GTB_CB_Manager.prototype.onSendToPopupCommand=function(b,c){var d=this.doc_.defaultView,e=GetFocusedWindow(d).getSelection().toString().trim(),f=Cc["@google.com/toolbar/search-service;1"].getService().wrappedJSObject;f.executeSearch(d,b,"",e,"",false,c)};
goog.exportProperty(GTB_CB_Manager.prototype,"onSendToPopupCommand",GTB_CB_Manager.prototype.onSendToPopupCommand);
GTB_CB_Manager.prototype.showAlert=function(b,c){var d=this.doc_.getElementById(b.getID());if(d){var e=this.doc_.getElementById("mainPopupSet"),f=this.doc_.createElement("tooltip");f.setAttribute("position","after_start");var g=this.doc_.createElement("description");g.setAttribute("value",c);f.appendChild(g);e.appendChild(f);f.showPopup(d,-1,-1,"tooltip","bottomleft","topleft");new G_Alarm(function(){f.hidePopup()},5E3)}};
function GTB_AddButtonParameters_(b,c,d,e,f,g){this.debugZone="GTB_AddButtonParameters";this.newButton=null;this.buttonUri=b;this.xmlDoc=c;this.existingButton=d;this.inputElement=e;this.charset=f;this.isUserEdited=!!g};function GTB_CB_EditDialogController(b,c){this.button_=b;this.service_=c;this.prefs_=new G_Preferences("google.toolbar.button_option.");this.observers_=null}GTB_CB_EditDialogController.debugZone="GTB_CB_EditDialogController";GTB_CB_EditDialogController.prototype.debugZone=GTB_CB_EditDialogController.debugZone;
GTB_CB_EditDialogController.prototype.doEditDialogLoad=function(b){this.setupEditDialogUI_(b);this.observers_=[new G_ObserverServiceObserver("GTB_CB_UPDATE",BindToObject(this.doEditDialogObserveUpdate_,this,b))]};goog.exportProperty(GTB_CB_EditDialogController.prototype,"doEditDialogLoad",GTB_CB_EditDialogController.prototype.doEditDialogLoad);GTB_CB_EditDialogController.prototype.doEditDialogUnload=function(){for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.observers_=null};
goog.exportProperty(GTB_CB_EditDialogController.prototype,"doEditDialogUnload",GTB_CB_EditDialogController.prototype.doEditDialogUnload);GTB_CB_EditDialogController.prototype.doEditDialogObserveUpdate_=function(b,c,d,e){e==this.button_.getID()&&this.setButtonToEdit(b,e)};GTB_CB_EditDialogController.prototype.setButtonToEdit=function(b,c){this.button_=this.service_.getButton(c);this.setupEditDialogUI_(b);b.sizeToContent()};
GTB_CB_EditDialogController.prototype.setupEditDialogUI_=function(b){var c=b.document;b=this.button_;GTB_CB_Manager.setupDialog(b,c);var d=c.getElementById("gtbCustomButtonsEditOptionsIFrame");if(b.getGadgetDescription()){var e=b.getGadgetDescription();d.setAttribute("hidden","false");e=e.getGadgetOptionsUrl();d.addEventListener("load",GTB_CB_EditDialogController.onFrameLoaded_,true);d.src=e;d.webNavigation.loadURI(e,Ci.nsIWebNavigation.LOAD_FLAGS_NONE,null,null,null);if(!b.hasOption()){d=c.getElementById("gtbCustomButtonsEditOptionsDescriptionContainer");
d.setAttribute("hidden","true")}}else d.setAttribute("hidden","true");if(d=b.getURL("update")){d=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService).newURI(d,null,null).host;e=c.getElementById("gtbCustomButtonsEditUpdate");var f=e.getAttribute("value");e.setAttribute("value",f.replace("{url}",d));e.setAttribute("hidden",false)}if(!b.isAdvancedEditorAvailable()){d=c.getElementById("gtbCustomButtonsAdvancedEditor");d.setAttribute("hidden","true")}c=c.getElementById("gtbCustomButtonsButtonTitleField");
c.setAttribute("value",b.getName())};
GTB_CB_EditDialogController.prototype.enableJSForOptions=function(b){var c=b.target.ownerDocument;b=c.getElementById("gtbCustomButtonsEditOptionsIFrame");var d=b.contentDocument.location,e=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);e=e.newURI(d.href,null,null);var f=Cc["@google.com/toolbar/caps-manager;1"].getService().wrappedJSObject;f.allow([e.prePath],["javascript.enabled"]);c=c.getElementById("gtbCustomButtonsEditOptionsJSDisabled");c.setAttribute("hidden","true");b.setAttribute("hidden",
"false");d.reload(false)};goog.exportProperty(GTB_CB_EditDialogController.prototype,"enableJSForOptions",GTB_CB_EditDialogController.prototype.enableJSForOptions);GTB_CB_EditDialogController.onFrameLoaded_=function(b){GTB_CB_EditDialogController.checkJSAccess_(b)&&GTB_CB_EditDialogController.adjustHeightToFitGadgetOptions_(b)};
GTB_CB_EditDialogController.checkJSAccess_=function(b){var c=b.target;b=b.currentTarget;var d=c.defaultView.GetUserPrefs;if(d&&"function"==typeof d)return true;b.setAttribute("hidden","true");c=c.location.href;d=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);c=d.newURI(c,null,null);d=b.ownerDocument;d=d.getElementById("gtbCustomButtonsEditOptionsJSDisabledLabel");d=d.firstChild;var e=d.data;d.data=e.replace("$url;",c.prePath);b=b.ownerDocument.getElementById("gtbCustomButtonsEditOptionsJSDisabled");
b.setAttribute("hidden","false");return false};
GTB_CB_EditDialogController.adjustHeightToFitGadgetOptions_=function(b){var c=b.target,d=GTB_getBoxObjectFor(c.documentElement);d=d.height;b=b.currentTarget;var e=GTB_getBoxObjectFor(b).height;if(d>e){var f=c.defaultView.top;f.resizeBy(0,d-e+10)}d=c.defaultView.GetUserPrefs;if(!d||"function"!=typeof d){b.setAttribute("hidden","true");c=c.location.href;d=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);c=d.newURI(c,null,null);d=b.ownerDocument.getElementById("gtbCustomButtonsEditOptionsJSDisabledLabel");e=
d.getAttribute("value");d.setAttribute("value",e.replace("%s",c.prePath));b=b.ownerDocument.getElementById("gtbCustomButtonsEditOptionsJSDisabled");b.setAttribute("hidden","false")}};
GTB_CB_EditDialogController.prototype.doEditDialogOK=function(b){b=b.document;var c=this.button_;if(c.getURL("search")){var d=b.getElementById("gtbCustomButtonsEditOptionsSearchTypeCheckbox");this.prefs_.setPref("search."+c.getID(),d.checked)}if(c.getGadgetDescription()){d=b.getElementById("gtbCustomButtonsEditOptionsIFrame");try{var e=d.contentDocument.defaultView.GetUserPrefs();c.getGadgetDescription().setGadgetOptions(e)}catch(f){}}this.service_.changeButtonOptions(c,b.getElementById("gtbCustomButtonsButtonTitleField").value.trim(),
b.getElementById("gtbCustomButtonsEditOptionsValue").value)};goog.exportProperty(GTB_CB_EditDialogController.prototype,"doEditDialogOK",GTB_CB_EditDialogController.prototype.doEditDialogOK);GTB_CB_EditDialogController.prototype.doInstallerReplace=function(b){var c=this.button_,d=c.getURL("update");GTB_CB_Manager.promptInstall(d,b,c)};goog.exportProperty(GTB_CB_EditDialogController.prototype,"doInstallerReplace",GTB_CB_EditDialogController.prototype.doInstallerReplace);
GTB_CB_EditDialogController.prototype.loadAdvancedEditor=function(b){var c="http://toolbar.google.com/buttons/edit/?custom_button_uri="+this.button_.getID();b.open(c,"gtbCustomButtonsAdvancedEditor","toolbar=no")};goog.exportProperty(GTB_CB_EditDialogController.prototype,"loadAdvancedEditor",GTB_CB_EditDialogController.prototype.loadAdvancedEditor);function GTB_CB_FeedData(b,c){this.debugZone="feed-data";this.xmlDoc_=b;this.prefsParent_=c;this.hasUnreadItems_=false;this.feedItems_=[];this.status_=this.icon_=this.description_=null;var d=this.getParamFromFeed_("gtb:description");if(d){d=d.split("\n");d=d.map(StripHTML);this.description_=GTB_Directionality.adaptToCurrentLocale(d.join("\n").trim())}if(d=this.getParamFromFeed_("gtb:icon"))this.icon_="data:image/x-icon;base64,"+d.trim();if(d=this.getParamFromFeed_("gtb:status"))this.status_=StripHTML(d).trim();
if(d=this.getParamFromFeed_("gtb:alert"))this.alert_=StripHTML(d).trim();if((d=this.getItems_())&&d.length>0)for(var e=0;e<d.length;e++){var f=new GTB_CB_FeedItem(d[e]);f.label&&this.feedItems_.push(f)}}a=GTB_CB_FeedData.prototype;a.getParamFromFeed_=function(b){return(b=GTB_CB_XmlUtils.getNode("//atom:feed/"+b,this.xmlDoc_)||GTB_CB_XmlUtils.getNode("//rss/channel/"+b,this.xmlDoc_))?b.textContent:null};
a.fillPopup=function(b){for(var c=BindToObject(this.onMouseOver_,this),d=BindToObject(this.onMouseOut_,this),e=0;e<this.feedItems_.length;e++){var f=this.feedItems_[e],g=b.ownerDocument.createElement("menuitem");g.setAttribute("class","menuitem-iconic");g.setAttribute("label",f.label);g.setAttribute("image",f.image);g.setAttribute("url",f.url);g.setAttribute("tooltip","gtbMultilineTooltip");g.addEventListener("DOMMenuItemActive",c,false);g.addEventListener("DOMMenuItemInactive",d,false);f.tooltiptext&&
g.setAttribute("gtbTooltipText",StripHTML(f.tooltiptext).trim());b.appendChild(g)}};a.onMouseOver_=function(b){var c=b.target;b=c.getAttribute("url");c=c.ownerDocument;if(c=c.getElementById("statusbar-display")){this.lastStatusText_=c.label;c.label=b}};a.onMouseOut_=function(b){b=b.target;b=b.ownerDocument;if(b=b.getElementById("statusbar-display"))b.label=this.lastStatusText_};a.markAsRead=function(){this.prefsParent_.setPref(".feedWasRead",true)};a.markAsNew=function(){this.prefsParent_.clearPref(".feedWasRead")};
a.hasUnreadItems=function(){return!this.prefsParent_.getPref(".feedWasRead",false)&&this.feedItems_.length>0};a.length=function(){return this.feedItems_.length};a.itemAt=function(b){return this.feedItems_[b]};a.nsResolver=function(b){switch(b){case "rss":return"http://purl.org/rss/1.0/";case "rdf":return"http://www.w3.org/1999/02/22-rdf-syntax-ns#";case "atom0p3":return"http://purl.org/atom/ns#";case "atom1p0":return"http://www.w3.org/2005/Atom";default:return"http://toolbar.google.com/custombuttons/"}};
a.getItems_=function(){for(var b=["//item","//rss:item","//rdf:item","//atom1p0:entry","//atom0p3:entry"],c=0;c<b.length;c++){for(var d=G_FirefoxXMLUtils.selectNodes(this.xmlDoc_,b[c],this.nsResolver),e=[],f=0,g;g=d.iterateNext();){e[f]=g;f++}if(f>0)return e}return false};a.description=function(){return this.description_};a.icon=function(){return this.icon_};a.status=function(){return this.status_};a.alert=function(){return this.alert_};
a.equals=function(b){if(!(b instanceof GTB_CB_FeedData))return false;if(this.length()!=b.length())return false;for(var c=0;c<this.length();c++)if(!this.itemAt(c).equals(b.itemAt(c)))return false;return this.description()==b.description()&&this.icon()==b.icon()&&this.status()==b.status()&&this.alert()==b.alert()};
function GTB_CB_FeedItem(b){this.debugZone="feed-item";var c=GTB_CB_XmlUtils.getChildByTagName(b,"title");if(c)this.label=StripHTML(c.textContent).trim();if(c=GTB_CB_XmlUtils.getChildByTagName(b,"icon"))this.image="data:image/x-icon;base64,"+c.textContent;if(c=GTB_CB_XmlUtils.getChildByTagName(b,"link"))this.url=c.getAttribute("href")||c.textContent;if(b=GTB_CB_XmlUtils.getChildByTagName(b,"description")||GTB_CB_XmlUtils.getChildByTagName(b,"summary"))this.tooltiptext=b.textContent}
GTB_CB_FeedItem.prototype.equals=function(b){return b instanceof GTB_CB_FeedItem&&this.label==b.label};function GTB_CB_GoogleServiceFeedStore(b,c){this.debugZone="GTB_CB_GoogleServiceFeedStore";this.buttonID_=b;this.buttonPrefName_=c;this.currentUserEmail_=null;this.emailToFeed_={};this.emailToFeed_.ts=Date.now()}a=GTB_CB_GoogleServiceFeedStore.prototype;a.gaiaEmailChanged=function(b){if(b){b=b.toLowerCase();this.currentUserEmail_=GTB_CB_SimpleFeedStore.hashString(b)}else this.currentUserEmail_=null};
a.loadFeed=function(){var b=this.getFeedDir_(),c=true;for(b=b.directoryEntries;b.hasMoreElements();){var d=b.getNext();d.QueryInterface(Ci.nsIFile);if(d.isFile()){var e=d.leafName,f=this.getFeedPrefsParent_(e);d=GTB_CB_SimpleFeedStore.loadFeedFromFile(d,f);this.emailToFeed_[e]=d;c&=!!d}}return c};
a.createFeedData=function(b){if(!this.currentUserEmail_)throw Error("Creating google service feed data when signed out");var c=this.getFeedPrefsParent_(this.currentUserEmail_);return new GTB_CB_FeedData(b,c)};a.getFeedPrefsParent_=function(b){return new G_Preferences(this.buttonPrefName_+"."+b)};a.getFeedData=function(){if(this.currentUserEmail_)return this.emailToFeed_[this.currentUserEmail_];return null};
a.setFeedData=function(b,c){if(this.currentUserEmail_!=null){this.emailToFeed_[this.currentUserEmail_]=b;var d=this.getFeedDir_();d.append(this.currentUserEmail_);GTB_CB_SimpleFeedStore.saveFeedToFile(d,c)}};a.getFeedDir_=function(){var b=GTB_CB_SimpleFeedStore.getFeedDir(),c=this.buttonID_.replace(/\-xml$/,"");b.append(c);GTB_ensureDirectoryExists(b);return b};
function GTB_CB_SimpleFeedStore(b,c){this.debugZone="GTB_CB_SimpleFeedStore";this.buttonID_=b;this.feedPrefsParent_=c;this.feedData_=null}a=GTB_CB_SimpleFeedStore.prototype;a.createFeedData=function(b){return new GTB_CB_FeedData(b,this.feedPrefsParent_)};a.getFeedData=function(){return this.feedData_};a.loadFeed=function(){var b=this.getFeedFile_();this.feedData_=GTB_CB_SimpleFeedStore.loadFeedFromFile(b,this.feedPrefsParent_);return!!this.feedData_};
a.setFeedData=function(b,c){this.feedData_=b;GTB_CB_SimpleFeedStore.saveFeedToFile(this.getFeedFile_(),c)};a.getFeedFile_=function(){var b=GTB_CB_SimpleFeedStore.getFeedDir();b.append(this.buttonID_);return b};
GTB_CB_SimpleFeedStore.loadFeedFromFile=function(b,c){if(!b.exists())return null;var d="";try{d=G_FileReader.readAll(b);var e=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);e.charset="UTF-8";d=e.ConvertToUnicode(d)}catch(f){}e=null;if(d)e=Cc["@mozilla.org/xmlextras/domparser;1"].createInstance(Ci.nsIDOMParser).parseFromString(d,"text/xml");d=null;if(e&&!G_FirefoxXMLUtils.isParserError(e))d=new GTB_CB_FeedData(e,c);return d};
GTB_CB_SimpleFeedStore.getFeedDir=function(){var b=GTB_getDataDir();GTB_ensureDirectoryExists(b);b.append("feeds");GTB_ensureDirectoryExists(b);return b};GTB_CB_SimpleFeedStore.saveFeedToFile=function(b,c){var d=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);d.charset="UTF-8";d=d.ConvertFromUnicode(c);G_FileWriter.writeAll(b,d);b.permissions=384};
GTB_CB_SimpleFeedStore.hashString=function(b){var c=new G_CryptoHasher;c.init(G_CryptoHasher.algorithms.MD5);c.updateFromString(b);return c.digestHex().toUpperCase()};var GTB_GADGET_CLOSING_EVENT_TYPES=["mousedown","resize","scroll","keydown","move","focus"];function GTB_GadgetPopupCommon(b,c,d){this.debugZone="GTB_GadgetPopupCommon";this.onKeyDownBound_=BindToObject(this.onKeyDown_,this);b.setAttribute("checked",true);this.currentButtonElement_=b;this.button_=c;this.buttonId_=this.button_.getID();this.firefoxWindow_=d;this.resized_=false;this.buttonOptionsOpener_=null;GTB_GadgetPopupCommon.closeCurrentPopup();GTB_GadgetPopupCommon.currentPopup_=this}
GTB_GadgetPopupCommon.currentPopup_=null;GTB_GadgetPopupCommon.closeCurrentPopup=function(){if(GTB_GadgetPopupCommon.currentPopup_){GTB_GadgetPopupCommon.currentPopup_.closeWindow_(null);GTB_GadgetPopupCommon.currentPopup_=null}};
GTB_GadgetPopupCommon.prototype.gadgetIFrameLoadListener_=function(b){b=b.currentTarget;b=b.contentDocument;var c=b.getElementById("google_gadget_info");if(c&&c.getAttribute("ggi_error")=="missing_userprefs")this.buttonOptionsOpener_=new GTB_CB_ButtonOptionsOpener(this.firefoxWindow_,this.buttonId_,this,b)};
GTB_GadgetPopupCommon.onClickLinkInsideGadget_=function(b,c){var d=c.target;if(!GTB_GadgetPopupCommon.isHyperlink_(d)&&"FORM"!=d.nodeName){if("SPAN"!=d.nodeName)return;d=d.parentNode;if(!d||!GTB_GadgetPopupCommon.isHyperlink_(d))return}if(d.target&&"_self"!=d.target||d.href&&d.href.indexOf("http://toolbar.google.com/buttons/add")==0){GTB_GadgetPopupCommon.closeCurrentPopup();if("FORM"!=d.tagName)try{b.openUILink(d.href,c,false,true)}catch(e){}}};
GTB_GadgetPopupCommon.isHyperlink_=function(b){b=b.nodeName;return"A"==b||"AREA"==b};GTB_GadgetPopupCommon.prototype.onKeyDown_=function(b){if(b.keyCode==Ci.nsIDOMKeyEvent.DOM_VK_ESCAPE){this.closeWindow_(null);this.currentButtonElement_.focus()}};
GTB_GadgetPopupCommon.prototype.closeWindow_=function(){if(this.resized_){var b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);b.notifyObservers(null,"GTB_CB_RESIZE",this.buttonId_)}this.buttonOptionsOpener_&&this.buttonOptionsOpener_.detachFromDom();GTB_GadgetPopupCommon.currentPopup_=null;this.currentButtonElement_.setAttribute("checked",false)};
GTB_GadgetPopupCommon.prototype.setUserSize=function(b,c){this.resized_=true;this.button_.getGadgetDescription().setUserSize(b,c)};
function GTB_CB_ButtonOptionsOpener(b,c,d,e){this.debugZone="GTB_CB_ButtonOptionsOpener";this.window_=b;this.buttonId_=c;this.gadgetPopup_=d;b=e.body;c=e.createElement("p");b.appendChild(c);e=e.createElement("input");e.setAttribute("type","button");c=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);c=c.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");c=c.GetStringFromName("prop.gtb.custombuttons.gadget.updateoptions");e.setAttribute("value",c);this.onUpdateOptionsBound_=
BindToObject(this.onUpdateOptions_,this);e.addEventListener("click",this.onUpdateOptionsBound_,true);b.appendChild(e);this.inputElement_=e}GTB_CB_ButtonOptionsOpener.prototype.onUpdateOptions_=function(b){this.gadgetPopup_.closeWindow_(b);GTB_OpenOptionsWindow(this.window_,"gtbOptionsSearchPane",{gtbCallback:GTB_Options.prototype.openCustomButtonEditor,gtbCallbackArguments:[this.buttonId_]})};
GTB_CB_ButtonOptionsOpener.prototype.detachFromDom=function(){if(this.inputElement_){this.inputElement_.removeEventListener("click",this.onUpdateOptionsBound_,true);this.inputElement_=null}};function GTB_GadgetPopupLin(b,c,d,e){GTB_GadgetPopupCommon.call(this,d,b,c);this.debugZone="GTB_GadgetPopupLin";this.window_=c;this.document_=e;var f=b.getGadgetDescription();this.overlay_=e.getElementById("gtb-gadget-overlay");this.iframe_=e.getElementById("gtb-gadget-iframe");this.corner_=e.getElementById("gtb-gadget-corner");this.gripper_=e.getElementById("gtb-gadget-gripper");var g=this.overlay_.style,h=this.iframe_.style,i=this.corner_.style,j=c.getComputedStyle(this.overlay_,"");this.direction_=
j.direction;g.display="block";this.overlay_.hidden=false;e=e.getElementById("main-window").boxObject.width;d=d.boxObject;j=Math.min(f.getWidth(),e);var k=f.getHeight();g.width=j+"px";g.left=Math.min(d.x,Math.max(e-f.getWidth(),0))+"px";g.top=d.y+d.height+"px";h.width=j+"px";h.height=k+"px";this.onClosingEventBound_=BindToObject(this.onClosingEvent_,this);this.ignoreEventBound_=BindToObject(this.ignoreEvent_,this);if(GTB_GeckoVersion.isFirefox2()){g.height=k+2+"px";i.display="none"}else{g.height=k+
18+"px";i.width=j+"px";this.gripper_.setAttribute("src",this.direction_=="rtl"?"chrome://google-toolbar/content/resize-corner-rtl.html":"chrome://google-toolbar/content/resize-corner.html");this.dragging_=false;this.onMouseDownGripperBound_=BindToObject(this.onMouseDownGripper_,this);this.onMouseMoveGripperBound_=BindToObject(this.onMouseMoveGripper_,this);this.onMouseUpGripperBound_=BindToObject(this.onMouseUpGripper_,this);this.window_.addEventListener("mousemove",this.onMouseMoveGripperBound_,
true);this.window_.addEventListener("mouseup",this.onMouseUpGripperBound_,true);this.gripper_.addEventListener("mousedown",this.onMouseDownGripperBound_,true);this.overlay_.addEventListener("resize",this.ignoreEventBound_,false)}this.addCloseListeners_();this.window_.addEventListener("keydown",this.onKeyDownBound_,true);this.iframe_.addEventListener("click",GTB_GadgetPopupLin.clickListener_,true);b=f.getSyndicationUrl(c,b);this.iframe_.setAttribute("src",b);this.loadListenerBound_=BindToObject(this.gadgetIFrameLoadListener_,
this);this.iframe_.addEventListener("load",this.loadListenerBound_,true);this.buttonOptionsOpener_=null}GTB_GadgetPopupLin.inherits(GTB_GadgetPopupCommon);a=GTB_GadgetPopupLin.prototype;a.addCloseListeners_=function(){for(var b=GTB_GADGET_CLOSING_EVENT_TYPES,c=0;c<b.length;c++)this.window_.addEventListener(b[c],this.onClosingEventBound_,false)};a.ignoreEvent_=function(b){b.stopPropagation()};
a.onMouseDownGripper_=function(b){this.dragging_=true;this.startX_=b.screenX;this.startY_=b.screenY;this.startWidth_=this.overlay_.boxObject.width;this.startLeft_=this.overlay_.boxObject.x;this.ovlStartHeight_=this.overlay_.boxObject.height;this.frameStartHeight_=this.iframe_.boxObject.height;var c=this.document_.getElementById("main-window").boxObject.width,d=this.document_.getElementById("main-window").boxObject.height;this.maxWidth_=this.direction=="rtl"?this.overlay_.boxObject.x+this.overlay_.boxObject.width:
c-this.overlay_.boxObject.x;this.minWidth_=100;this.maxOvlHeight_=d-this.overlay_.boxObject.y;this.minOvlHeight_=60;this.maxFrameHeight_=this.maxOvlHeight_-this.corner_.boxObject.height;this.minFrameHeight_=this.minOvlHeight_+this.frameStartHeight_-this.ovlStartHeight_;b.stopPropagation()};
a.onMouseMoveGripper_=function(b){if(this.dragging_){var c=b.screenX-this.startX_;b=b.screenY-this.startY_;var d=this.startWidth_+c;if(this.direction_=="rtl"){d=this.startWidth_-c;this.overlay_.style.left=Math.max(this.startLeft_+c,0)}d=Math.min(Math.max(d,this.minWidth_),this.maxWidth_);this.overlay_.style.width=d+"px";this.iframe_.style.width=d+"px";this.corner_.style.width=d+"px";c=Math.min(Math.max(this.ovlStartHeight_+b-2,this.minOvlHeight_),this.maxOvlHeight_);this.overlay_.style.height=c+"px";
this.iframe_.style.height=Math.min(Math.max(this.frameStartHeight_+b,this.minFrameHeight_),this.maxFrameHeight_)+"px";this.setUserSize(d,c)}};a.onMouseUpGripper_=function(){if(this.dragging_)this.dragging_=false};GTB_GadgetPopupLin.clickListener_=function(b){var c=b.currentTarget;c=c.ownerDocument.defaultView;GTB_GadgetPopupCommon.onClickLinkInsideGadget_(c,b)};
GTB_GadgetPopupLin.prototype.onClosingEvent_=function(b){if(this.iframe_){var c=this.iframe_.contentDocument;b.target==c||b.target.ownerDocument==c||this.closeWindow_(b)}};
GTB_GadgetPopupLin.prototype.closeWindow_=function(b){if(this.overlay_){for(var c=GTB_GADGET_CLOSING_EVENT_TYPES,d=0;d<c.length;d++)this.window_.removeEventListener(c[d],this.onClosingEventBound_,true);this.window_.removeEventListener("keydown",this.onKeyDownBound_,true);if(!GTB_GeckoVersion.isFirefox2()){this.window_.removeEventListener("mousemove",this.onMouseMoveGripperBound_,true);this.window_.removeEventListener("mouseup",this.onMouseUpGripperBound_,true);this.gripper_.removeEventListener("mousedown",
this.onMouseDownGripperBound_,true);this.overlay_.removeEventListener("resize",this.ignoreEventBound_,false)}this.iframe_.removeEventListener("load",this.loadListenerBound_,true);this.iframe_.setAttribute("src","about:blank");this.iframe_=null;this.overlay_.hidden=true;this.overlay_.style.display="none";this.overlay_=null;GTB_GadgetPopupCommon.prototype.closeWindow_.call(this,b)}};function GTB_GadgetPopupWinMac(b,c,d){GTB_GadgetPopupCommon.call(this,d,b,c);this.debugZone="GTB_GadgetPopupWinMac";this.window_=c;var e=b.getGadgetDescription();c=["chrome","resizable=no","dependent","titlebar=no","alwaysRaised"];var f=e.getWidth();e=e.getHeight();if(GetPlatform()==2){f+=2;e+=2}c.push("width="+f);c.push("height="+e);d=d.boxObject;c.push("screenX="+d.screenX);d=d.screenY+d.height;if(GTB_GeckoVersion.isFirefox2()&&GetPlatform()==2)d-=21;c.push("screenY="+d);c=c.join(",");this.gadgetPopup_=
this.window_.open("chrome://google-toolbar/content/gadget-popup-win.xul",b.getTitle(),c);this.closeWindowBound_=BindToObject(this.closeWindow_,this);this.clickListenerBound_=BindToObject(this.onClickLinkInsideGadget_,this);this.gadgetPopup_.addEventListener("load",BindToObject(this.onLoad_,this),false);this.isLoaded_=false}GTB_GadgetPopupWinMac.inherits(GTB_GadgetPopupCommon);a=GTB_GadgetPopupWinMac.prototype;
a.onLoad_=function(b){this.addCloseListeners_();this.gadgetPopup_.addEventListener("keydown",this.onKeyDownBound_,true);var c=this.button_.getGadgetDescription();b=b.target;if(GTB_GeckoVersion.isFirefox2()){var d=b.getElementById("gtbGripperCorner");d.style.display="none"}else{this.gripper_=b.getElementById("gtbGripperWinImage");this.dragging_=false;this.onMouseDownGripperBound_=BindToObject(this.onMouseDownGripper_,this);this.onMouseMoveGripperBound_=BindToObject(this.onMouseMoveGripper_,this);this.onMouseUpGripperBound_=
BindToObject(this.onMouseUpGripper_,this);this.gripper_.addEventListener("mousedown",this.onMouseDownGripperBound_,true);this.gadgetPopup_.addEventListener("mousemove",this.onMouseMoveGripperBound_,true);this.gadgetPopup_.addEventListener("mouseup",this.onMouseUpGripperBound_,true);d=this.gadgetPopup_.getComputedStyle(this.gripper_,"");this.direction_=d.direction;if(this.direction_=="rtl"){this.gripper_.src="chrome://google-toolbar/skin/gripper-rtl.png";this.gripper_.style.cursor="sw-resize"}else{this.gripper_.src=
"chrome://google-toolbar/skin/gripper.png";this.gripper_.style.cursor="se-resize"}}b=b.getElementById("gtbGadgetIFrame");if(GetPlatform()==2){b.style.borderStyle="solid";b.style.borderWidth="1px"}b.addEventListener("click",this.clickListenerBound_,true);d=BindToObject(this.gadgetIFrameLoadListener_,this);b.addEventListener("load",d,true);c=c.getSyndicationUrl(this.window_,this.button_);b.setAttribute("src",c);this.isLoaded_=true};
a.addCloseListeners_=function(){for(var b=GTB_GADGET_CLOSING_EVENT_TYPES,c=0;c<b.length;c++)this.window_.addEventListener(b[c],this.closeWindowBound_,true)};a.onMouseDownGripper_=function(b){this.dragging_=true;this.startX_=b.screenX;this.startY_=b.screenY;this.startLeft_=this.gadgetPopup_.screenX;this.startTop_=this.gadgetPopup_.screenY;this.startWidth_=this.gadgetPopup_.outerWidth;this.startHeight_=this.gadgetPopup_.outerHeight;b.stopPropagation()};
a.onMouseMoveGripper_=function(b){if(this.dragging_){var c=b.screenX-this.startX_,d=b.screenY-this.startY_,e;if(this.direction_=="rtl"){e=Math.max(100,this.startWidth_-c);this.gadgetPopup_.moveTo(this.startLeft_+c,this.startTop_)}else e=Math.max(100,this.startWidth_+c);c=Math.max(60,this.startHeight_+d);this.gadgetPopup_.resizeTo(e,c);b.stopPropagation();if(GetPlatform()==2){e-=2;c-=2}this.setUserSize(e,c)}};a.onMouseUpGripper_=function(){if(this.dragging_)this.dragging_=false};
a.onClickLinkInsideGadget_=function(b){GTB_GadgetPopupCommon.onClickLinkInsideGadget_(this.window_,b)};
a.closeWindow_=function(b){if(this.gadgetPopup_){if(this.isLoaded_){for(var c=GTB_GADGET_CLOSING_EVENT_TYPES,d=0;d<c.length;d++)this.window_.removeEventListener(c[d],this.closeWindowBound_,true);this.gadgetPopup_.removeEventListener("keydown",this.onKeyDownBound_,true);if(!GTB_GeckoVersion.isFirefox2()){this.gripper_.removeEventListener("mousedown",this.onMouseDownGripperBound_,true);this.gadgetPopup_.removeEventListener("mousemove",this.onMouseMoveGripperBound_,true);this.gadgetPopup_.removeEventListener("mouseup",
this.onMouseUpGripperBound_,true)}}if(b&&b.type=="focus"&&GetPlatform()==2)new G_Alarm(BindToObject(this.gadgetPopup_.close,this.gadgetPopup_),0);else this.gadgetPopup_.close();this.gadgetPopup_=null;GTB_GadgetPopupCommon.prototype.closeWindow_.call(this,b)}};GTB_GadgetPopupBubble.MARGIN_X=2;GTB_GadgetPopupBubble.MARGIN_Y=22;
function GTB_GadgetPopupBubble(b,c,d,e){var f=e.getElementById("gtb-bubble-container");f=!f.hidden;GTB_GadgetPopupCommon.call(this,d,b,c);this.debugZone="GTB_GadgetPopupBubble";if(!f){this.document_=e;this.anchor_=d;this.chromeWindow_=c;this.mainWindow_=this.document_.getElementById("main-window");this.container_=this.document_.getElementById("gtb-bubble-container");this.iframe_=this.document_.getElementById("gtb-bubble-iframe");b=this.chromeWindow_.getComputedStyle(this.container_,"");this.direction_=
b.direction;this.resizer=new GTB_BubbleResizer(this.chromeWindow_,this.container_,this.direction_,"gtb-bubble-gripper",BindToObject(this.resize_,this));this.onClosingEventBound_=BindToObject(this.onClosingEvent_,this);this.onNestedFrameLoadBound_=BindToObject(this.onNestedFrameLoad_,this);this.initNestedFrameBound_=BindToObject(this.initNestedFrame_,this);this.fixAntiframingBound_=BindToObject(this.fixAntiframing_,this,true);this.initFrame_();this.show(d,{minWidth:0,minHeight:0,maxWidth:1E4,maxHeight:1E4,
leftOffset:0})}}goog.inherits(GTB_GadgetPopupBubble,GTB_GadgetPopupCommon);a=GTB_GadgetPopupBubble.prototype;
a.shutdown=function(){if(this.container_){if(this.resizer){this.resizer.shutdown();this.resizer=null}this.hide();GTB_GadgetPopupCommon.prototype.closeWindow_.call(this,null);var b=GTB_GadgetPopupBubble.clickListener_,c=true;this.iframe_.removeEventListener("click",b,c);this.iframe_.removeEventListener("submit",b,c);this.iframe_.removeEventListener("load",this.fixAntiframingBound_,c);this.container_=this.iframe_=null}};a.closeWindow_=GTB_GadgetPopupBubble.prototype.shutdown;a.isVisible=function(){return!this.container_.hidden};
a.show=function(b,c){if(!this.isVisible()){this.minWidth_=c.minWidth+GTB_GadgetPopupBubble.MARGIN_X;this.minHeight_=c.minHeight+GTB_GadgetPopupBubble.MARGIN_Y;this.maxWidth_=c.maxWidth+GTB_GadgetPopupBubble.MARGIN_X;this.maxHeight_=c.maxHeight+GTB_GadgetPopupBubble.MARGIN_Y;this.leftOffset_=c.leftOffset;this.anchor_=b;var d=this.button_.getGadgetDescription(),e=this.mainWindow_.boxObject.width;e=Math.min(d.getWidth(),e);d=d.getHeight();this.setSize(e,d);this.container_.hidden=false;this.container_.style.display=
"block"}};a.hide=function(){if(this.isVisible()){var b=this.getNestedFrame_();if(b){b.removeEventListener("load",this.onNestedFrameLoadBound_,false);b.setAttribute("src","about:blank")}this.anchor_=null;this.container_.hidden=true;this.container_.style.display="none";this.removeListeners_()}};
a.addListeners_=function(){for(var b=GTB_GADGET_CLOSING_EVENT_TYPES,c=0;c<b.length;c++)this.chromeWindow_.addEventListener(b[c],this.onClosingEventBound_,false);this.chromeWindow_.addEventListener("keydown",this.onKeyDownBound_,true)};a.removeListeners_=function(){for(var b=GTB_GADGET_CLOSING_EVENT_TYPES,c=0;c<b.length;c++)this.chromeWindow_.removeEventListener(b[c],this.onClosingEventBound_,false);this.chromeWindow_.removeEventListener("keydown",this.onKeyDownBound_,true)};
GTB_GadgetPopupBubble.clickListener_=function(b){var c=b.currentTarget;c=c.ownerDocument.defaultView;GTB_GadgetPopupCommon.onClickLinkInsideGadget_(c,b)};a=GTB_GadgetPopupBubble.prototype;
a.onClosingEvent_=function(b){if(this.isVisible()){var c=b.target.ownerDocument||b.target;c=c&&c.defaultView&&c.defaultView.top.document;var d=this.iframe_.contentDocument;if(!(b.originalTarget==this.anchor_||c==d)){c=Cc["@mozilla.org/satchel/form-fill-controller;1"].getService(Ci.nsIAutoCompleteInput);b.target!=c.popup&&this.closeWindow_(null)}}};
a.setSize=function(b,c,d){b=Math.min(this.maxWidth_,Math.max(this.minWidth_,b));c=Math.min(this.maxHeight_,Math.max(this.minHeight_,c));d&&this.setUserSize(b,c);var e=this.mainWindow_.boxObject.width,f=this.mainWindow_.boxObject.height,g=this.anchor_.boxObject,h=g.y+g.height-1,i=this.container_.style,j=this.iframe_.contentDocument.documentElement.getAttribute("gtb-resize-dir","ltr")||this.direction_;if(j=="rtl"){if(d)d=this.container_.boxObject.x+this.container_.boxObject.width;else{d=g.x+g.width-
this.leftOffset_;d>=e&&b<e&&this.iframe_.contentDocument.documentElement.setAttribute("gtb-resize-dir","ltr");d=Math.min(e,Math.max(b,d))}b=Math.min(b,d);i.left=d-b+"px"}else{if(d)d=this.container_.boxObject.x;else{d=g.x+this.leftOffset_;d>=e-b&&b<e&&this.iframe_.contentDocument.documentElement.setAttribute("gtb-resize-dir","rtl");d=Math.min(d,Math.max(e-b,0));i.left=d+"px"}b=Math.min(b,e-d)}i.top=h+"px";i.width=b+"px";i.height=Math.min(c,f-h)+"px";this.iframe_.style.width=i.width;this.iframe_.style.height=
i.height};a.resize_=function(b,c){this.setSize(b,c,true);this.resizeContent()};a.resizeContent=function(){this.iframe_.contentWindow.wrappedJSObject.onWindowResize()};a.getNestedFrame_=function(){try{return this.iframe_.contentDocument.getElementById("gtb-bubble-content")}catch(b){return null}};
a.initFrame_=function(){this.iframe_.addEventListener("click",GTB_GadgetPopupBubble.clickListener_,true);this.iframe_.addEventListener("submit",GTB_GadgetPopupBubble.clickListener_,true);this.iframe_.addEventListener("load",this.fixAntiframingBound_,true);this.fixAntiframing_(false)};
a.fixAntiframing_=function(b){var c=this.getNestedFrame_();if(c)b||this.initNestedFrame_();else{c="chrome://google-toolbar/content/bubble-frame.html";this.iframe_.setAttribute("src",c);this.iframe_.addEventListener("load",this.initNestedFrameBound_);if(b){var d=this.iframe_.contentDocument.location.href;if(c!=d&&"about:blank"!=d){c=this.document_.getElementById("content");b=c.addTab(b);c.selectedTab=b}this.shutdown()}}};
a.initNestedFrame_=function(){this.iframe_.removeEventListener("load",this.initNestedFrameBound_,true);this.iframe_.contentDocument.documentElement.setAttribute("dir",this.direction_);this.iframe_.contentDocument.documentElement.setAttribute("gtb-resize-dir",this.direction_);var b=this.getNestedFrame_();if(b){b.addEventListener("load",this.onNestedFrameLoadBound_,false);var c=this.button_.getGadgetDescription();c=c.getSyndicationUrl(this.chromeWindow_,this.button_);b.setAttribute("src",c)}};
a.onNestedFrameLoad_=function(b){this.addListeners_();this.resizeContent();this.gadgetIFrameLoadListener_(b)};
function GTB_BubbleResizer(b,c,d,e,f){this.chromeWindow_=b;this.box_=c;this.dirFactor_=d=="rtl"?-1:1;this.gripperId_=e;this.callback_=f;this.dragging_=false;this.onMouseDownGripperBound_=BindToObject(this.onMouseDownGripper_,this);this.onMouseMoveGripperBound_=BindToObject(this.onMouseMoveGripper_,this);this.onMouseUpGripperBound_=BindToObject(this.onMouseUpGripper_,this);this.chromeWindow_.addEventListener("mousemove",this.onMouseMoveGripperBound_,true);this.chromeWindow_.addEventListener("mouseup",
this.onMouseUpGripperBound_,true);this.box_.addEventListener("mousedown",this.onMouseDownGripperBound_,true);this.ignoreEventBound_=BindToObject(this.ignoreEvent_,this);this.box_.addEventListener("resize",this.ignoreEventBound_,false)}a=GTB_BubbleResizer.prototype;
a.shutdown=function(){this.chromeWindow_.removeEventListener("mousemove",this.onMouseMoveGripperBound_,true);this.chromeWindow_.removeEventListener("mouseup",this.onMouseUpGripperBound_,true);this.box_.removeEventListener("mousedown",this.onMouseDownGripperBound_,true);this.box_.removeEventListener("resize",this.ignoreEventBound_,false)};a.ignoreEvent_=function(b){b.stopPropagation()};
a.onMouseDownGripper_=function(b){if(b.target.id==this.gripperId_){this.dragging_=true;this.startX_=b.screenX;this.startY_=b.screenY;this.startWidth_=this.box_.boxObject.width;this.startHeight_=this.box_.boxObject.height;var c=b.target.ownerDocument.documentElement.getAttribute("gtb-resize-dir");if(c)this.dirFactor_=c=="rtl"?-1:1;b.stopPropagation();b.preventDefault()}};
a.onMouseMoveGripper_=function(b){if(this.dragging_){this.callback_(this.startWidth_+(b.screenX-this.startX_)*this.dirFactor_,this.startHeight_+(b.screenY-this.startY_));b.stopPropagation();b.preventDefault()}};a.onMouseUpGripper_=function(b){if(this.dragging_){this.dragging_=false;b.stopPropagation();b.preventDefault()}};function GTB_CB_UrlChecker(){this.debugZone="custom-buttons-url-checker"}
GTB_CB_UrlChecker.prototype.shouldLoad=function(b,c,d,e){b=c.asciiSpec;c=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);if(b.indexOf("http://toolbar.google.com/buttons/add")==0){d=this.parseUrlParameters_(b);if(e=d.url){e=unescape(e);GTB_CB_Manager.openInstallButtonDialog(e)}return Ci.nsIContentPolicy.REJECT_REQUEST}if(b.indexOf("http://toolbar.google.com/command")==0){d=b.split("?");if(d.length>1){d=d[1].split("&");for(var f=0;f<d.length;f++){var g=d[f].split("=");if(g.length==
2){var h=g[0];g=g[1];if(h=="custom-button-load"){c.notifyObservers(e,"GTB_CB_EDIT",g);return Ci.nsIContentPolicy.REJECT_REQUEST}if(h=="custom-button-save"){c.notifyObservers(e,"GTB_CB_SAVE",g);return Ci.nsIContentPolicy.REJECT_REQUEST}}}}}if(b.indexOf("http://toolbar.google.com/buttons/edit")==0)if(b.indexOf("edit_mode_title")>-1)return Ci.nsIContentPolicy.REJECT_REQUEST;return Ci.nsIContentPolicy.ACCEPT};GTB_CB_UrlChecker.prototype.shouldProcess=function(){return Ci.nsIContentPolicy.ACCEPT};
GTB_CB_UrlChecker.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIContentPolicy)||b.equals(Ci.nsISupports))return this;throw Cr.NS_ERROR_NO_INTERFACE;};GTB_CB_UrlChecker.prototype.parseUrlParameters_=function(b){var c={};b=b.split("?");if(b.length<2)return c;b=b[1].split("&");for(var d=0;d<b.length;d++){var e=b[d].split("=");if(e[0])c[e[0].toLowerCase()]=e.length>1?e[1]:""}return c};var GTB_DNS_Status={DONE:0,FAILED:1,IGNORED:2,CANCELED:3};function GTB_DNS_Prefetch(){this.debugZone="GTB_DNS_Prefetch";new G_ObserverServiceObserver("browser:purge-session-history",BindToObject(this.clearResourcesInfo_,this));this.queue_=[];this.resolving_=[];this.prefs_=new G_Preferences("google.toolbar.");new G_Alarm(BindToObject(this.collectMetrics_,this),6E4);new G_Alarm(BindToObject(this.collectMetrics_,this),36E5,true);new G_Alarm(BindToObject(this.prefetchNewTab_,this),2E3)}a=GTB_DNS_Prefetch.prototype;
a.annotationService_=null;a.observerService_=null;a.getAnnotationService=function(){if(!this.annotationService_)this.annotationService_=Cc["@mozilla.org/browser/annotation-service;1"].getService(Ci.nsIAnnotationService);return this.annotationService_};a.resolveHost=function(b,c,d){b={host:b,callback:c,requestTime:null,startTime:null,cancelHook:null,finished:false,alarm:null};if(d)b.alarm=new G_Alarm(BindToObject(this.resolveNow_,this,b),d);else this.resolveNow_(b);return b};
a.resolveNow_=function(b){b.alarm=null;b.requestTime=Date.now();this.queue_.push(b);this.resolveNextRequest_()};
a.cancelResolution=function(b){if(b.finished)return false;b.finished=true;b.callback&&b.callback({ip:"",time:0,status:GTB_DNS_Status.CANCELED});if(b.alarm){b.alarm.cancel();b.alarm=null;return true}var c=this.resolving_.indexOf(b);if(c!=-1){b.cancelHook.cancel(Cr.NS_ERROR_ABORT);this.resolving_.splice(c,1);this.resolveNextRequest_();return true}c=this.queue_.indexOf(b);if(c!=-1){this.queue_.splice(c,1);return true}return false};
a.resolveNextRequest_=function(){if(this.queue_.length>0&&this.resolving_.length<8){var b=this.queue_[0],c=Date.now();if(c-b.requestTime>500)this.clearQueue_();else{this.queue_.shift();this.doResolve_(b)}}};a.doResolve_=function(b){b.startTime=Date.now();b.cancelHook=GTB_resolveIp(b.host,BindToObject(this.onResolutionComplete_,this,b));this.resolving_.push(b)};
a.onResolutionComplete_=function(b,c){var d=this.resolving_.indexOf(b);d!=-1&&this.resolving_.splice(d,1);b.cancelHook=null;if(!b.finished&&b.callback){d=c?GTB_DNS_Status.DONE:GTB_DNS_Status.FAILED;b.callback({ip:c,time:Date.now()-b.startTime,status:d})}b.finished=true;this.resolveNextRequest_()};a.clearQueue_=function(){for(var b,c=0;b=this.queue_[c];c++){b.finished=true;b.callback&&b.callback({ip:"",time:0,status:GTB_DNS_Status.IGNORED})}this.queue_=[]};
a.onDocumentStart=function(b,c){this.isResourcePrefetchEnabled_()&&new GTB_DNS_ResourcesPrefetch(b,c);var d=b.GTB_DNS_HoverPrefetchObject;d&&d.onDocumentStart()};a.onBrowserOpen=function(b){if(this.isHoverPrefetchEnabled_())if(!b.GTB_DNS_HoverPrefetchObject){var c=new GTB_DNS_HoverPrefetch(b);b.GTB_DNS_HoverPrefetchObject=c}};a.onBrowserClose=function(b){(b=b.GTB_DNS_HoverPrefetchObject)&&b.onClose()};
a.isResourcePrefetchEnabled_=function(){return this.prefs_.getPref("dns_prefetch")&&!GTB_IsPrivateBrowsing()&&!!this.getAnnotationService()&&GTB_isGoogleToolbarActive()};a.isHoverPrefetchEnabled_=function(){return this.prefs_.getPref("dns_prefetch")&&GTB_isGoogleToolbarActive()};a.clearResourcesInfo_=function(){var b=this.getAnnotationService(),c={value:0};c=b.getPagesWithAnnotation("google-toolbar/resources-prefetch",c);for(var d,e=0;d=c[e];e++)b.removePageAnnotation(d,"google-toolbar/resources-prefetch")};
a.notifyMetrics=function(b,c){if(!this.observerService_)this.observerService_=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);this.observerService_.notifyObservers(this,b,c)};a.collectMetrics_=function(){var b=Cc["@google.com/toolbar/metrics2/service;1"].getService(Ci.nsIMetricsService2);b&&b.isCollectorEnabled("histogram")&&this.calculateTotalResources_()};
a.calculateTotalResources_=function(){var b=this.getAnnotationService(),c={value:0};c=b.getPagesWithAnnotation("google-toolbar/resources-prefetch",c);for(var d=0,e,f=0;e=c[f];f++){e=b.getPageAnnotation(e,"google-toolbar/resources-prefetch");d+=e.split(",").length}this.notifyMetrics("GTB_DNS_TOTAL_RESOURCES",String(d))};
a.prefetchNewTab_=function(){if(this.prefs_.getPref("dns_prefetch")&&this.prefs_.getPref("newtab")&&GTB_NewTabService.instance)for(var b=GTB_NewTabService.instance.getMostVisitedHosts(),c=Math.min(b.length,6),d=0;d<c;d++)this.resolveHost(b[d],null)};var GTB_DNS_PrefetchInstance=new GTB_DNS_Prefetch;function GTB_DNS_DocLoadListener(){this.debugZone="GTB_DNS_DocLoadListener";var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT)}GTB_DNS_DocLoadListener.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};
GTB_DNS_DocLoadListener.prototype.onStateChange=function(b,c,d){if(c instanceof Ci.nsIHttpChannel)if(d&Ci.nsIWebProgressListener.STATE_START)try{var e=b.QueryInterface(Ci.nsIDocShell),f=GTB_getBrowserAndWindowFromDocShell(e),g=f&&f.browser;g&&GTB_DNS_PrefetchInstance.onDocumentStart(g,c)}catch(h){}};GTB_DNS_DocLoadListener.instance_=new GTB_DNS_DocLoadListener;function GTB_DNS_ResourcesPrefetch(b,c){this.debugZone="GTB_DNS_ResourcesPrefetch";this.browser_=b;this.host_=null;this.resources_=[];var d=b.docShell.QueryInterface(Ci.nsIWebProgress);try{d.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_STATE_REQUEST|Ci.nsIWebProgress.NOTIFY_STATE_WINDOW|Ci.nsIWebProgress.NOTIFY_LOCATION)}catch(e){return}if((d=this.getRequestUri_(c))&&d.schemeIs("http")){this.init_(d);this.onDocumentStarted_()}this.alarm_=new G_Alarm(BindToObject(this.onDocumentFinished_,this),
12E4)}a=GTB_DNS_ResourcesPrefetch.prototype;a.init_=function(b){b=b||this.getBrowserUri_(this.browser_);this.host_=b.asciiHost;this.resources_=[];if(b=GTB_convertToUrl("http://"+this.host_)){var c=GTB_DNS_PrefetchInstance.getAnnotationService();if(c.pageHasAnnotation(b,"google-toolbar/resources-prefetch")){b=c.getPageAnnotation(b,"google-toolbar/resources-prefetch").split(",");var d;for(c=0;d=b[c];c++){var e=d.split(":");d=e[0];e=e[1];this.resources_.push({host:d,score:parseInt(e,10)})}}}};
a.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};a.getResourceByHost_=function(b){for(var c,d=0;c=this.resources_[d];d++)if(c.host==b)return c;b={host:b,score:200};this.resources_.push(b);return b};a.getBrowserUri_=function(b){if((b=GTB_convertToUrl(b.contentDocument.documentURI))&&!b.asciiHost)b=null;return b};
a.getRequestUri_=function(b){b=b instanceof Ci.nsIChannel?b.URI:GTB_convertToUrl(b.name);try{if(b&&!b.asciiHost)b=null}catch(c){b=null}return b};a.onLocationChange=function(b,c,d){if(this.host_!=d.asciiHost){this.host_&&this.onDocumentCanceled_();if(d.schemeIs("http")){this.init_(d);this.onDocumentStarted_()}}};
a.onStateChange=function(b,c,d){b=this.getRequestUri_(c);d&Ci.nsIWebProgressListener.STATE_STOP&&d&Ci.nsIWebProgressListener.STATE_IS_WINDOW&&this.onDocumentFinished_();b&&d&Ci.nsIWebProgressListener.STATE_START&&this.onResourceRequested_(b)};a.onDocumentStarted_=function(){for(var b,c=0;b=this.resources_[c];c++)b.cancelInfo=GTB_DNS_PrefetchInstance.resolveHost(b.host,BindToObject(this.onResolutionComplete_,this,b),100)};
a.onDocumentCanceled_=function(){for(var b,c=0;b=this.resources_[c];c++)b.cancelInfo&&GTB_DNS_PrefetchInstance.cancelResolution(b.cancelInfo)};
a.onDocumentFinished_=function(){if(this.alarm_){this.alarm_.cancel();this.alarm_=null}if(this.host_){for(var b=0,c=0,d=0,e=0,f,g=0;f=this.resources_[g];g++)if(f.requested){b++;if(f.resolutionFailed)f.score=Math.floor(f.score/2);else if(f.resolutionTime){var h=f.resolutionTime-15;if(h>50){f.score+=h;f.score=Math.floor(f.score/2);c+=h}}}else{f.score=Math.floor(f.score/2);if(f.resolutionTime)if(f.resolutionFailed)e+=f.resolutionTime;else d+=f.resolutionTime}f=function(k,l){return l.score-k.score};this.resources_.sort(f);
for(f=Math.min(this.resources_.length,10);f>0&&this.resources_[f-1].score==0;)f--;this.resources_.length>f&&this.resources_.splice(f,this.resources_.length-f);if(h=GTB_convertToUrl("http://"+this.host_)){var i=[];for(g=0;f=this.resources_[g];g++)i.push(f.host+":"+f.score);f=GTB_DNS_PrefetchInstance.getAnnotationService();f.setPageAnnotation(h,"google-toolbar/resources-prefetch",i.join(","),0,Ci.nsIAnnotationService.EXPIRE_WEEKS)}c>0&&GTB_DNS_PrefetchInstance.notifyMetrics("GTB_DNS_RESOURCE_TIME_SAVED",
""+c);d>0&&GTB_DNS_PrefetchInstance.notifyMetrics("GTB_DNS_RESOURCE_UNNECESSARY",""+d);e>0&&GTB_DNS_PrefetchInstance.notifyMetrics("GTB_DNS_RESOURCE_FAILED",""+e);GTB_DNS_PrefetchInstance.notifyMetrics("GTB_DNS_RESOURCE_COUNT",""+b);b=this.browser_.docShell.QueryInterface(Ci.nsIWebProgress);try{b.removeProgressListener(this)}catch(j){}}};a.onResourceRequested_=function(b){if(this.host_){b=b.asciiHost;if(b!=this.host_){b=this.getResourceByHost_(b);b.requested=true}}};
a.onResolutionComplete_=function(b,c){if(c.status==GTB_DNS_Status.DONE)b.resolutionTime=c.time;else if(c.status==GTB_DNS_Status.FAILED)b.resolutionFailed=true};function GTB_DNS_HoverPrefetch(b){this.debugZone="GTB_DNS_HoverPrefetch";this.browser=b;b.addEventListener("mouseover",BindToObject(this.onMouseOver_,this),true);b.addEventListener("click",BindToObject(this.onClick_,this),true);this.onResolutionCompleteBound_=BindToObject(this.onResolutionComplete_,this);this.resolutionInfo_=this.element_=null;this.resolved_={};this.clicked_={}}a=GTB_DNS_HoverPrefetch.prototype;
a.getLinkAncestor_=function(b){for(;b&&!(b.hasAttribute&&b.hasAttribute("href"));)b=b.parentNode;return b};a.onDocumentClosed_=function(){var b=0;for(var c in this.resolved_)c in this.clicked_||(b+=this.resolved_[c]);b>0&&GTB_DNS_PrefetchInstance.notifyMetrics("GTB_HOVER_DNS_UNNECESSARY",""+b)};a.onDocumentStart=function(){this.onDocumentClosed_();this.element_=null;this.resolved_={};this.clicked_={}};
a.onMouseOver_=function(b){var c=this.getLinkAncestor_(b.target);if(this.element_!=c){this.element_!=null&&this.resolutionInfo_&&GTB_DNS_PrefetchInstance.cancelResolution(this.resolutionInfo_);this.element_=c;this.resolutionInfo_=null;if(c){b=GTB_convertToUrl(c.ownerDocument.baseURI);c=b.resolve(c.getAttribute("href"));c=GTB_convertToUrl(c).asciiHost;if(!GTB_isIP(c)&&c!=b.asciiHost&&!this.resolved_[c])this.resolutionInfo_=GTB_DNS_PrefetchInstance.resolveHost(c,this.onResolutionCompleteBound_,200)}}};
a.onResolutionComplete_=function(b){if(b.status==GTB_DNS_Status.DONE){this.resolved_[this.resolutionInfo_.host]=b.time;GTB_DNS_PrefetchInstance.notifyMetrics("GTB_HOVER_DNS_RESOLUTION_DONE",""+b.time)}};
a.onClick_=function(b){if((b=this.getLinkAncestor_(b.target))&&b==this.element_&&this.resolutionInfo_){b=this.resolutionInfo_.host;if(this.resolved_[b]){var c=this.resolved_[b]-15;this.clicked_[b]=c;c>0&&GTB_DNS_PrefetchInstance.notifyMetrics("GTB_HOVER_DNS_SUCCESS",""+c)}if(this.resolutionInfo_.startTime&&!this.resolved_[b]){c=Date.now()-this.resolutionInfo_.startTime;this.clicked_[b]=c;c>0&&GTB_DNS_PrefetchInstance.notifyMetrics("GTB_HOVER_DNS_EARLY_NAVIGATION",""+c)}}};
a.onClose=function(){this.onDocumentClosed_();this.browser=null};function GTB_Highlighter(b,c,d){this.debugZone="highlighter";this.googleToolbar_=b;this.doc_=d;this._GOOGLE_TOOLBAR_ID="google-toolbar-hilite-";this._MAX_TERMS=10;b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this._TERM_BUTTON_TOOLTIP=b.GetStringFromName("prop.google-term.tooltip");this._highlightFlag=false;this.currentWords_=[];this._HIGHLIGHT_COLORS=["Yellow","Cyan","Fuchsia","Chartreuse",
"Dodgerblue"];this.prefs_=new G_Preferences("google.toolbar.",false,true);this.prefs_.addObserver("button_option.gtbHighlight",BindToObject(this.onHighlighterPrefChanged_,this));this.prefs_.addObserver("button_option.gtbFindTerms",BindToObject(this.onWordFindPrefChanged_,this));GTB_RegisterListener(c,"pageshow",this.onPageShow_,this);GTB_RegisterListener(c,"pagehide",this.onPageHide_,this);GTB_RegisterListener(c,"tabswitch",this.onTabSwitch_,this);this.tabWatcher_=c;c=BindToObject(this.onSearchTextChanged,
this);this.googleToolbar_.eventRegistrar.registerListener("searchbox-textchange",c);this.rehighlighter_=new GTB_Rehighlighter(this._GOOGLE_TOOLBAR_ID,this._HIGHLIGHT_COLORS);this.buttonTracker_=new GTB_ToolbarItemVisiblityTracker(d,"gtbHighlight",BindToObject(this.onButtonVisibilityChanged_,this))}a=GTB_Highlighter.prototype;a.shutdown=function(){this.buttonTracker_.shutdown();this.prefs_=null};
a.updateHighlightButton_=function(){var b=this.doc_.getElementById("gtbHighlight");if(b!=null){b.setAttribute("checked",this._highlightFlag);b.disabled=!this.currentWords_.length}};
a.toggle=function(){this._highlightFlag=!this._highlightFlag;this.updateHighlightButton_();if(this.doc_.getElementById("gtbFindTerms"))for(var b=0;b<this._MAX_TERMS;b++){var c=this._getHighlightTermButton(b),d="none";if(this._highlightFlag)d=this._HIGHLIGHT_COLORS[b%this._HIGHLIGHT_COLORS.length].toLowerCase();c.setAttribute("color",d)}this.updateHighlighting_()};a.updateHighlighting_=function(){this.isHighlightingOn_()?this.highlight_():this.unhighlight_()};
a.isHighlightingOn_=function(){return this._highlightFlag&&this.buttonTracker_.isButtonVisible()};a.onButtonVisibilityChanged_=function(){this.updateHighlightButton_();this.updateHighlighting_()};a.onPageShow_=function(b){b.isTop&&this.isHighlightingOn_()&&this.highlight_()};a.onTabSwitch_=function(){this.updateHighlighting_()};a._getSearchTextBox=function(){var b=this.doc_.getElementById("gtbGoogleSearchBox");return b};
a._getSearchTextValue=function(){var b=this._getSearchTextBox();if(b==null)return"";return b.value};a._isWhitespace=function(b){return/^\s$/.test(b)};a._isPunctuation=function(b){return/[`~!@#$%^&\*()-+={}\[\]|\\:;\"<>,\.\?\/]/.test(b)};a._isHebrewCharacter=function(b){return"\u0590"<=b&&"\u05ff">=b};a._isBetweenHebrewCharacters=function(b,c){return c>0&&c<b.length-1&&this._isHebrewCharacter(b[c-1])&&this._isHebrewCharacter(b[c+1])};
a._beginsWith=function(b,c){return b.substring(0,c.length).toUpperCase()==c.toUpperCase()};a._extractCommandString=function(b,c){for(var d=["",b,false],e=false,f=0;f<b.length;++f)if(e){if(b[f]=='"')e=false}else if(b[f]=='"')e=true;else if(f==0||this._isWhitespace(b[f-1]))if(this._beginsWith(b.substring(f),c)){d[0]=b.substring(f+c.length);d[1]=b.substring(0,f);d[2]=true;break}return d};
a._tokenizeSearchQuery=function(b){for(var c=[],d=0,e=0;e<b.length;++e){var f=b.charAt(e);if(d==0)if(f=='"'){c.push(["",true]);d=2}else{if(!this._isWhitespace(f)&&!this._isPunctuation(f)){c.push([f,false]);d=1}}else if(d==1)if(f=='"'&&this._isBetweenHebrewCharacters(b,e))c[c.length-1][0]+=f;else if(this._isWhitespace(f)||this._isPunctuation(f))d=0;else c[c.length-1][0]+=f;else if(d==2)if(f=='"'&&!this._isBetweenHebrewCharacters(b,e))d=0;else c[c.length-1][0]+=f}return c};
a._removeOperators=function(b){for(var c=[],d=0;d<b.length;++d){var e=b[d][0];if(b[d][1])e.length>0&&c.push(e);else if(e.toUpperCase()!="OR")if(e[0]!="-")if(!(e=="*"||e=="/"||e=="^"||e=="%"))if(!/\d+\.\.\.\d+/.test(e)){if(e[0]=="~")e=e.substring(1);c.push(e)}}return c};a._normalizeSpacing=function(b){for(var c=[],d=0;d<b.length;++d){var e=b[d];e=e.replace(/^\s+/,"");e=e.replace(/\s+$/,"");e=e.replace(/\s+/g," ");e.length>0&&c.push(e)}return c};
a._removeDuplicates=function(b){for(var c=function(f,g){for(var h in f)if(g==f[h])return true;return false},d=[],e=0;e<b.length;++e)c(d,b[e])||d.push(b[e]);return d};a._splitUpSearchQuery=function(b){var c=[];c=this._tokenizeSearchQuery(b);c=this._removeOperators(c);c=this._normalizeSpacing(c);return this._removeDuplicates(c)};a._sameWordList=function(b,c){for(var d=b.length==c.length,e=0;d&&e<b.length;){d=b[e]==c[e];e++}return d};
a._getHighlightTermButton=function(b){return b=this.doc_.getElementById("gtbFindTerm"+b)};a._onCurrentWordsChanged=function(b,c){this.isHighlightingOn_()&&this.highlight_();if(this.doc_.getElementById("gtbFindTerms")!=null){for(var d=this._TERM_BUTTON_TOOLTIP,e=0;e<this._MAX_TERMS;e++){var f=this._getHighlightTermButton(e),g=e>=b.length;if(f.hidden=g)f.label="";else if(b[e]!=c[e]){f.label=b[e];f.setAttribute("gtbTooltipText",d.replace("$term;",b[e]))}}this.googleToolbar_==this.toolbar_&&this.googleToolbar_.chevron.doResize()}};
a._checkSearchWordList=function(b){b=b!=null?b:this._getSearchTextValue();var c=this._removeQueryOperators(b),d=this._splitUpSearchQuery(c);if(!this._sameWordList(d,this.currentWords_)){var e=this.currentWords_;this.currentWords_=d;this._onCurrentWordsChanged(this.currentWords_,e)}return{hasTerms:d.length>0,hasOps:b!=c}};
a._removeQueryOperators=function(b){for(var c=b,d=["allinanchor:","allintext:","allintitle:","allinurl:",/\band\b/gi,"author:","bphonebook:","define:","ext:","filetype:","group:","inanchor:","insubject:","intext:","intitle:","inurl:","location:","lucky:","movie:","msgid:",/\bor\b/gi,"phonebook:","rphonebook:","safesearch:","source:","spell:","stocks:","store:",/site:\S+\s*/,/link:\S+\s*/,/related:\S+\s*/],e=[],f=b.indexOf('"');f!=-1;){e.push(f);f=b.indexOf('"',f+1)}b=function(h,i){for(var j=false,
k=0;k<e.length;++k)if(i<e[k])break;else j=!j;return j?h:""};var g;for(g in d)c=c.replace(d[g],b);return c};a._replaceSearchNewLines=function(){var b=this._getSearchTextBox();if(b){var c=b.value;if(b&&/[\n\r]/.test(c)){c=c.replace(/[\n\r]/g," ");b.value=c}}};a._isSearchTextBoxEmpty=function(){var b=this._getSearchTextValue();return b.length==0};a.onSearchTextChanged=function(b){this._replaceSearchNewLines();this._checkSearchWordList(b);this.updateHighlightButton_();this.googleToolbar_.customButtons.updateFeelingLuckyButtonState()};
a.findTerm=function(b,c){this.findTermText(this.currentWords_[b],c)};goog.exportSymbol("GTB_Highlighter.prototype.findTerm",GTB_Highlighter.prototype.findTerm);a=GTB_Highlighter.prototype;
a.findTermText=function(b,c){var d=this.doc_.defaultView,e=this.tabWatcher_.getTabBrowser(),f;if("_find"in d.gFindBar){f={find:function(g){d.gFindBar._find(g)},findNext:function(){d.gFindBar._findAgain(false)},findPrevious:function(){d.gFindBar._findAgain(true)}};e=e.fastFind.searchString}else{f=d.gFindBar;e=e.findString}if(e==b)c?f.findNext():f.findPrevious();else{f.find(b);c||f.findPrevious()}};a.onPageHide_=function(b){b.persisted&&this.unhighlight_()};a.unhighlight_=function(){this.rehighlighter_.unhighlight()};
a.highlight_=function(){var b=this.tabWatcher_.getCurrentWindow();this.rehighlighter_.highlight(b,this.currentWords_)};a.onHighlighterPrefChanged_=function(){if(this.prefs_){var b=this.prefs_.getPref("button_option.gtbHighlight");if(b)this.updateHighlightButton_();else this._highlightFlag&&this.toggle()}};a.onWordFindPrefChanged_=function(){this.reparseWords()};a.onCustomize_=function(){this.reparseWords()};
a.reparseWords=function(){this.currentWords_=[];this._onCurrentWordsChanged(this.currentWords_,this.currentWords_);this.onSearchTextChanged(null)};GTB_Highlighter.findDocuments=function(b){var c=[];if(b.frames)for(var d=0;d<b.frames.length;d++)c=c.concat(GTB_Highlighter.findDocuments(b.frames[d]));b.document&&c.push(b.document);return c};
function GTB_HighlightingWorker(b,c,d){this.wordIndex_=0;this.words_=c;this.colors_=d;this.done=false;this.count=0;this.createWindowHighlighter_=b;this.windowHighlighter_=null;this.moveToNextWord_()}GTB_HighlightingWorker.prototype.checkConsistency_=function(){};GTB_HighlightingWorker.prototype.doWork=function(){this.windowHighlighter_.doWork();if(this.windowHighlighter_.done){this.count+=this.windowHighlighter_.count;this.moveToNextWord_()}};
GTB_HighlightingWorker.prototype.moveToNextWord_=function(){for(;this.wordIndex_<this.words_.length;){this.windowHighlighter_=this.createWindowHighlighter_(this.words_[this.wordIndex_],this.colors_[this.wordIndex_%this.colors_.length],this.count);this.wordIndex_++;if(!this.windowHighlighter_.done)return}if(this.wordIndex_==this.words_.length)this.done=true};
function GTB_WindowHighlighter(b,c,d,e,f,g){this.debugZone="windowHighlighter";this.done=false;this.count=0;this.docs_=c;this.docIndex_=0;this.createDocumentHighlighter_=b;this.documentHighlighter_=null;this.idPrefix_=f;this.idIndex_=g;this.text_=d;this.color_=e;this.moveToNextDocument_()}GTB_WindowHighlighter.prototype.doWork=function(){this.documentHighlighter_.done||this.documentHighlighter_.doWork();if(this.documentHighlighter_.done){this.count+=this.documentHighlighter_.count;this.moveToNextDocument_()}};
GTB_WindowHighlighter.prototype.moveToNextDocument_=function(){for(;this.docIndex_<this.docs_.length;){var b=this.docs_[this.docIndex_++];this.documentHighlighter_=this.createDocumentHighlighter_(b,this.text_,this.color_,this.idPrefix_,this.count+this.idIndex_);if(!this.documentHighlighter_.done)return}if(this.docIndex_==this.docs_.length)this.done=true};
function GTB_DocumentHighlighter(b,c,d,e,f){this.debugZone="documentHighlighter";this.done=true;this.count=0;var g=b&&b.body;if(g){var h=b.createRange();h.selectNode(g);var i=h.cloneRange();i.collapse(true);g=h.cloneRange();g.collapse(false);var j=this.createFindRange_();if(j)if(i=j.Find(c,h,i,g)){this.done=false;this.result_=i;this.stopRange_=g;this.docRange_=h;this.findRange_=j;this.idIndex_=f;this.idPrefix_=e;this.color_=d;this.text_=c;this.doc_=b}}}a=GTB_DocumentHighlighter.prototype;
a.createFindRange_=function(){var b=Cc["@mozilla.org/embedcomp/rangefind;1"].createInstance();if(b&&b instanceof Ci.nsIFind){b.caseSensitive=false;b.findBackwards=false;return b}else return null};
a.doWork=function(){var b=this.result_,c=100;do{if(this.isTextRange_(b)){var d=null;if(b.startOffset>0)d=b.startContainer.nodeValue.charAt(b.startOffset-1);var e=b.endContainer.nodeValue.charAt(b.endOffset);if(!this.isWordCharacter_(d)&&!this.isWordCharacter_(e)){d=this.idPrefix_+(this.idIndex_+this.count);d=this.highlightRange_(b,this.color_,d);b=this.doc_.createRange();b.selectNode(d);this.count++;c-=15}else b=b}else b=b;b.collapse(false);b=this.findRange_.Find(this.text_,this.docRange_,b,this.stopRange_);
this.done=b==null;c-=5}while(!this.done&&c>0);this.result_=b};a.isNodeInputNodeOrChildOf_=function(b){if(b.nodeName.toUpperCase()=="INPUT")return true;if(b.parentNode)return this.isNodeInputNodeOrChildOf_(b.parentNode);return false};a.isTextRange_=function(b){return!!b.endContainer&&!!b.startContainer&&b.endContainer.nodeType==b.endContainer.TEXT_NODE&&b.startContainer.nodeType==b.startContainer.TEXT_NODE&&!this.isNodeInputNodeOrChildOf_(b.startContainer)&&!this.isNodeInputNodeOrChildOf_(b.endContainer)};
a.isWordCharacter_=function(b){if(b==null||typeof b!="string"||b.length!=1)return false;b=b.charCodeAt(0);return b>=48&&b<=57||b>=65&&b<=90||b>=97&&b<=122||b>=138&&b<=142||b>=154&&b<=159||b>=192&&b<=255};a.highlightRange_=function(b,c,d){var e=b.startContainer;e=e.ownerDocument.createElement("layer");e.style.backgroundColor=c;e.style.color="black";e.id=d;c=b.extractContents();e.appendChild(c);b.insertNode(e);return e};
function GTB_UnhighlightingWorker(b,c){this.docs_=b;this.idPrefix_=c;this.count=this.docIndex_=0;this.done=false;this.moveToNextElement_()}GTB_UnhighlightingWorker.prototype.doWork=function(){var b=100;do{for(var c=this.current_,d=c.parentNode,e=c.childNodes,f=e.length-1;f>=0;f--){d.insertBefore(e[0],c);b-=10}d.removeChild(c);b-=10;this.count++;this.moveToNextElement_()}while(!this.done&&b>0)};
GTB_UnhighlightingWorker.prototype.moveToNextElement_=function(){for(var b=null;this.docIndex_<this.docs_.length&&!b;){b=this.idPrefix_+this.count;(b=this.docs_[this.docIndex_].getElementById(b))||this.docIndex_++}this.current_=b;this.done=!b};function GTB_Rehighlighter(b,c){this.documentsForRollingBack_=this.activeUnhighlighter_=this.activeHighlighter_=null;this.idPrefix_=b;this.colors_=c;this.timer_=null}a=GTB_Rehighlighter.prototype;
a.doWork_=function(){if(this.activeUnhighlighter_){this.activeUnhighlighter_.doWork();if(this.activeUnhighlighter_.done)this.activeUnhighlighter_=null}else if(this.activeHighlighter_){this.activeHighlighter_.doWork();if(this.activeHighlighter_.done)this.activeHighlighter_=null}};a.hasWork_=function(){return this.activeUnhighlighter_!=null||this.activeHighlighter_!=null};
a.unhighlight=function(){if(this.documentsForRollingBack_)if(!this.activeUnhighlighter_){var b=new GTB_UnhighlightingWorker(this.documentsForRollingBack_,this.idPrefix_);if(!b.done){this.activeUnhighlighter_=b;this.activate_()}}this.documentsForRollingBack_=this.activeHighlighter_=null};
a.highlight=function(b,c){this.unhighlight();var d=this.idPrefix_,e=GTB_Highlighter.findDocuments(b),f=function(h,i,j,k,l){return new GTB_DocumentHighlighter(h,i,j,k,l)},g=function(h,i,j){return new GTB_WindowHighlighter(f,e,h,i,d,j)};g=new GTB_HighlightingWorker(g,c,this.colors_);if(!g.done){this.activeHighlighter_=g;this.documentsForRollingBack_=e;this.activate_()}};
a.activate_=function(){if(!this.timer_)if(this.hasWork_()){this.doWorkChunk_();if(this.hasWork_()){var b=BindToObject(this.resumeWorkTimerCallback_,this);this.timer_=new G_Alarm(b,0,true)}}};a.doWorkChunk_=function(){for(var b=Date.now();this.hasWork_()&&Date.now()-b<200;)this.doWork_()};a.resumeWorkTimerCallback_=function(){this.doWorkChunk_();if(!this.hasWork_()){this.timer_.cancel();this.timer_=null}};function GTB_PageInfoMenu(b){this.debugZone="pageinfomenu";this.doc_=b;b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.TOOLTIP_CACHE_=b.GetStringFromName("prop.info.cache.tooltip");this.TOOLTIP_SIMILAR_=b.GetStringFromName("prop.info.related.tooltip");this.TOOLTIP_BACKLINKS_=b.GetStringFromName("prop.info.backlinks.tooltip")}
GTB_PageInfoMenu.prototype.getCurrentLocation_=function(){var b=this.doc_.getElementById("content");b=b.selectedBrowser;b=b.contentDocument;return b.location};
GTB_PageInfoMenu.prototype.onShowMenu=function(){var b=this.getCurrentLocation_();b=this.getInfoUrl_(b.href);var c=this.doc_.getElementById("gtbInfoCache");c.tooltipText=this.TOOLTIP_CACHE_.replace("$infourl;",b);c=this.doc_.getElementById("gtbInfoSimilar");c.tooltipText=this.TOOLTIP_SIMILAR_.replace("$url;",b);c=this.doc_.getElementById("gtbInfoBacklinks");c.tooltipText=this.TOOLTIP_BACKLINKS_.replace("$infourl;",b)};goog.exportProperty(GTB_PageInfoMenu.prototype,"onShowMenu",GTB_PageInfoMenu.prototype.onShowMenu);
GTB_PageInfoMenu.prototype.urlIndexable_=function(b){if(b.length==0)return false;if(b.indexOf(" ")!=-1)return false;var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);b=c.newURI(b,null,null);if(!(b instanceof Ci.nsIURL))return false;if(b.scheme!="http")return false;if(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.exec(b.host))return true;b=b.host.substring(b.host.lastIndexOf(".")+1,b.host.length);return".com.edu.net.org.gov.mil.jp.de.au.in.uk.fr.ca.dk.it.kr.int.arpa.nato.biz.name.museum.pro.aero.coop.info.ac.ad.ae.af.ag.ai.al.am.an.ao.aq.ar.as.at.au.aw.az.ba.bb.bd.be.bf.bg.bh.bi.bj.bm.bn.bo.br.bs.bt.bv.bw.by.bz.ca.cc.cd.cf.cg.ch.ci.ck.cl.cm.co.cr.cu.cv.cx.cy.cz.de.dj.dk.dm.do.dz.ec.ee.eg.eh.er.es.et.fi.fj.fk.fm.fo.fr.ga.gd.ge.gf.gg.gh.gi.gl.gm.gn.gp.gq.gr.gs.gt.gu.gw.gy.hk.hm.hn.hr.ht.hu.id.ie.il.im.in.io.iq.ir.is.it.je.jm.jo.jp.ke.kg.kh.ki.km.kn.kp.kr.kw.ky.kz.la.lb.lc.li.lk.lr.ls.lt.lu.lv.ly.ma.mc.md.mg.mh.mk.ml.mm.mn.mo.mp.mq.mr.ms.mt.mu.mv.mw.mx.my.mz.na.nc.ne.nf.ng.ni.nl.no.np.nr.nu.nz.om.pa.pe.pf.pg.ph.pk.pl.pm.pn.pr.ps.pt.pw.py.qa.re.ro.ru.rw.sa.sb.sc.sd.se.sg.sh.si.sj.sk.sl.sm.sn.so.sr.st.sv.sy.sz.tc.td.tf.tg.th.tj.tk.tm.tn.to.tp.tr.tt.tv.tw.tz.ua.ug.uk.um.us.uy.uz.va.vc.ve.vg.vi.vn.vu.wf.ws.ye.yt.yu.za.zm.zw.".indexOf("."+
b+".")!=-1};
GTB_PageInfoMenu.prototype.getInfoUrl_=function(b){if(b.length==0||b.indexOf(" ")!=-1)return b;var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);c=c.newURI(b,null,null);if(!(c instanceof Ci.nsIURL))return b;if(!GTB_isGoogleUrl(c))return b;if(!c.query||c.query.length==0)return b;var d=GTB_parseQueryString(c.query);if(!d||d=={})return b;var e=d.q;if(e&&e.indexOf("related:")==0)return e.replace("related:","");if(e&&e.indexOf("link:")==0)return e.replace("link:","");if(c.host==
"translate.google.com"&&d&&d.u)return decodeURIComponent(d.u);return b};GTB_PageInfoMenu.prototype.gwsRequestInfo_=function(b,c){var d=GTB_getGoogleHome(),e=this.getCurrentLocation_(),f=this.getInfoUrl_(e.href);e=this.doc_.defaultView.GTB_getToolbar();d=uri_create("http",null,d,-1,"/search",["sourceid","navclient-ff","ie","UTF-8","q",c+f],null);e.loadUrlWithModifiers(d.toString(),b);b.stopPropagation()};GTB_PageInfoMenu.prototype.onCachedSnapshot=function(b){this.gwsRequestInfo_(b,"cache:")};
goog.exportProperty(GTB_PageInfoMenu.prototype,"onCachedSnapshot",GTB_PageInfoMenu.prototype.onCachedSnapshot);GTB_PageInfoMenu.prototype.onSimilarPages=function(b){this.gwsRequestInfo_(b,"related:")};goog.exportProperty(GTB_PageInfoMenu.prototype,"onSimilarPages",GTB_PageInfoMenu.prototype.onSimilarPages);GTB_PageInfoMenu.prototype.onBackwardLinks=function(b){this.gwsRequestInfo_(b,"link:")};goog.exportProperty(GTB_PageInfoMenu.prototype,"onBackwardLinks",GTB_PageInfoMenu.prototype.onBackwardLinks);function G_Base64(){this.byteToCharMap_={};this.charToByteMap_={};this.byteToCharMapWebSafe_={};this.charToByteMapWebSafe_={};this.init_()}G_Base64.ENCODED_VALS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";G_Base64.ENCODED_VALS_WEBSAFE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";a=G_Base64.prototype;
a.init_=function(){for(var b=0;b<G_Base64.ENCODED_VALS.length;b++){this.byteToCharMap_[b]=G_Base64.ENCODED_VALS.charAt(b);this.charToByteMap_[this.byteToCharMap_[b]]=b;this.byteToCharMapWebSafe_[b]=G_Base64.ENCODED_VALS_WEBSAFE.charAt(b);this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[b]]=b}};
a.encodeByteArray=function(b,c){if(!(b instanceof Array))throw Error("encodeByteArray takes an array as a parameter");for(var d=c?this.byteToCharMapWebSafe_:this.byteToCharMap_,e=[],f=0;f<b.length;){var g=b[f],h=f+1<b.length,i=h?b[f+1]:0,j=f+2<b.length,k=j?b[f+2]:0,l=g>>2;g=(g&3)<<4|i>>4;i=(i&15)<<2|k>>6;k=k&63;if(!j){k=64;h||(i=64)}e.push(d[l]);e.push(d[g]);e.push(d[i]);e.push(d[k]);f+=3}return e.join("")};
a.decodeString=function(b,c){if(b.length%4)throw Error("Length of b64-encoded data must be zero mod four");for(var d=c?this.charToByteMapWebSafe_:this.charToByteMap_,e=[],f=0;f<b.length;){var g=d[b.charAt(f)],h=d[b.charAt(f+1)],i=d[b.charAt(f+2)],j=d[b.charAt(f+3)];if(g===undefined||h===undefined||i===undefined||j===undefined)throw Error("String contains characters not in our alphabet: "+b);g=g<<2|h>>4;e.push(g);if(i!=64){h=h<<4&240|i>>2;e.push(h);if(j!=64){i=i<<6&192|j;e.push(i)}}f+=4}return e};
a.arrayifyString=function(b){for(var c=[],d=0;d<b.length;d++){for(var e=b.charCodeAt(d);e>255;){c.push(e&255);e>>=8}c.push(e)}return c};a.stringifyArray=function(b){for(var c=[],d=0;d<b.length;d++)c[d]=String.fromCharCode(b[d]);return c.join("")};function GTB_PageRank(b,c,d,e){this.debugZone="GTB_PageRank";this.tabWatcher_=b;GTB_RegisterListener(b,G_TabbedBrowserWatcher.events.LOCATIONCHANGE,this.onLocationChange_,this);GTB_RegisterListener(b,G_TabbedBrowserWatcher.events.TABSWITCH,this.onTabSwitch_,this);this.tabDataManager_=c;this.tabDataManager_.makeContainers(GTB_PageRank.TAB_DATA_KEY_,function(){return new GTB_PrTabData});this.doc_=d;this.infoQueryService_=e;this.infoQueryService_.registerUser(this);this.prefs_=new G_Preferences("google.toolbar.");
this.prefs_.addObserver("button_option.gtbPageRank",BindToObject(this.onPageRankPrefChanged_,this));this.customizeObserver=new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.onPageRankPrefChanged_,this),false);b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.prLabels_={hasPageRank:b.GetStringFromName("prop.google-pr.havepr"),noPageRank:b.GetStringFromName("prop.google-pr.nopr")};
for(var f in this.prLabels_);}GTB_PageRank.inherits(GTB_InfoQueryUser);GTB_PageRank.TAB_DATA_KEY_="page_rank";a=GTB_PageRank.prototype;
a.displayPageRank=function(b){GTB_PrTabData.isPageRankValueValid(b);var c=this.doc_.getElementById("gtbPageRank");if(c!=null){var d=b==null?this.prLabels_.noPageRank:this.prLabels_.hasPageRank.replace(/\$pagerank;/,b);c.setAttribute("gtbTooltipText",d);c.setAttribute("rank",b==null?"unknown":b);d=c.getAttribute("label");d=d.replace(/\s\d*/,"");d=b==null?d:d+" "+b;c.setAttribute("label",d)}};a.onToolbarVisibilityChanged=function(){this.onPageRankPrefChanged_()};
a.shutdown=function(){this.prefs_.removeAllObservers();this.customizeObserver.unregister();this.customizeObserver=null};a.getRequestPrefix=function(){return"Rank"};a.isEnabled=function(){var b=this.doc_.getElementById("gtbPageRank"),c=this.prefs_.getPref("firstrun.done",false);return c&&b!=null&&!GTB_IsPrivateBrowsing()&&GTB_isToolbarVisible(b.parentNode)};
a.shouldSendRequest=function(b,c,d,e,f){if(!b||!this.isEnabled()||!this.isAllowedInternal(c,d,e,f))return false;d=b.currentURI.asciiSpec;if(c!=d)return false;b=this.tabDataManager_.getContainer(b,GTB_PageRank.TAB_DATA_KEY_);return!b.isRequestSent()};a.onRequestSend=function(b,c){var d=b&&b.currentURI.asciiSpec;if(c==d){d=this.tabDataManager_.getContainer(b,GTB_PageRank.TAB_DATA_KEY_);d.setRequestSent(true)}};
a.handleResponse=function(b,c,d){var e=b&&b.currentURI.asciiSpec;d=GTB_PageRank.extractResponse_(d);var f=GTB_PrTabData.isPageRankValueValid(d);if(c==e&&f){c=this.tabDataManager_.getContainer(b,GTB_PageRank.TAB_DATA_KEY_);c.setPageRankValue(d);c=this.tabWatcher_.getCurrentBrowser();c==b&&this.displayPageRank(d)}return f};GTB_PageRank.extractResponse_=function(b){if(b&&b.match(/^Rank_1:(\d+):(\d+)$/m)){b=Number(RegExp.$1);var c=RegExp.$2;if(c.length==b)return parseInt(c,10)}return null};
GTB_PageRank.prototype.onTabSwitch_=function(b){if(b=b.toBrowser){b=this.tabDataManager_.getContainer(b,GTB_PageRank.TAB_DATA_KEY_);b.isRequestSent()||b.reset();this.displayPageRank(b.getPageRankValue())}};GTB_PageRank.prototype.onLocationChange_=function(b){var c=b.browser;if(!(typeof b.isTop=="boolean"&&!b.isTop))if(c){b=this.tabDataManager_.getContainer(c,GTB_PageRank.TAB_DATA_KEY_);b.reset();this.displayPageRank(b.getPageRankValue())}};
GTB_PageRank.prototype.onPageRankPrefChanged_=function(){if(this.isEnabled()){var b=this.tabDataManager_.getSelectedTabContainer(GTB_PageRank.TAB_DATA_KEY_);b.reset();b=this.tabWatcher_.getCurrentBrowser();var c=b.currentURI.asciiSpec;this.infoQueryService_.forceSendRequest(b,c)}};function GTB_PrTabData(){this.debugZone="GTP_PrTabData";this.isRequestSent_=false;this.pageRankValue_=null}GTB_PrTabData.isPageRankValueValid=function(b){return b==null||b>=0&&b<=10};a=GTB_PrTabData.prototype;a.isRequestSent=function(){return this.isRequestSent_};a.setRequestSent=function(b){this.isRequestSent_=b};a.getPageRankValue=function(){return this.pageRankValue_};a.setPageRankValue=function(b){this.pageRankValue_=b};a.reset=function(){this.isRequestSent_=false;this.pageRankValue_=null};function G_JSModule(){this.factoryLookup_={};this.categoriesLookup_={}}goog.exportSymbol("G_JSModule",G_JSModule);G_JSModule.getInstance=function(){return G_JSModule.instance_||(G_JSModule.instance_=new G_JSModule)};goog.exportProperty(G_JSModule,"getInstance",G_JSModule.getInstance);G_JSModule.prototype.registerObject=function(b,c,d,e,f){this.registerFactory(new G_JSFactory(Components.ID(b),c,d,e,f))};goog.exportProperty(G_JSModule.prototype,"registerObject",G_JSModule.prototype.registerObject);
G_JSModule.prototype.registerFactory=function(b){var c=b.classID.toString();this.factoryLookup_[c]=b;this.categoriesLookup_[c]=b.categories_};goog.exportProperty(G_JSModule.prototype,"registerFactory",G_JSModule.prototype.registerFactory);
G_JSModule.prototype.registerSelf=function(b,c,d,e){b=b.QueryInterface(Ci.nsIComponentRegistrar);for(var f in this.factoryLookup_){b.registerFactoryLocation(this.factoryLookup_[f].classID,this.factoryLookup_[f].className,this.factoryLookup_[f].contractID,c,d,e);this.factoryLookup_[f].registerCategories()}};goog.exportProperty(G_JSModule.prototype,"registerSelf",G_JSModule.prototype.registerSelf);
G_JSModule.prototype.getClassObject=function(b,c){var d=this.factoryLookup_[c.toString()];if(!d)throw Error("Invalid classID {"+c+"}");return d};goog.exportProperty(G_JSModule.prototype,"getClassObject",G_JSModule.prototype.getClassObject);G_JSModule.prototype.canUnload=function(){return true};goog.exportProperty(G_JSModule.prototype,"canUnload",G_JSModule.prototype.canUnload);function G_JSFactory(b,c,d,e,f){this.classID=b;this.contractID=c;this.className=d;this.instance_=e;this.categories_=f}
G_JSFactory.prototype.registerCategories=function(){if(this.categories_)for(var b=Cc["@mozilla.org/categorymanager;1"].getService(Ci.nsICategoryManager),c=0,d;d=this.categories_[c];c++)b.addCategoryEntry(d,this.className,this.contractID,true,true)};G_JSFactory.prototype.createInstance=function(){return this.instance_};goog.exportProperty(G_JSFactory.prototype,"createInstance",G_JSFactory.prototype.createInstance);function ListDictionary(b){this.name_=b;this.members_=[]}ListDictionary.prototype.isMember=function(b){for(var c=0;c<this.members_.length;c++)if(this.members_[c]==b)return true;return false};ListDictionary.prototype.addMember=function(b){this.members_.push(b)};ListDictionary.prototype.removeMember=function(b){for(var c=0;c<this.members_.length;c++)if(this.members_[c]==b){for(b=c;b<this.members_.length;b++)this.members_[b]=this.members_[b+1];this.members_.length--;return true}return false};
ListDictionary.prototype.forEach=function(b){if(typeof b!="function")throw Error("argument to forEach is not a function, it's a(n) "+typeof b);for(var c=0;c<this.members_.length;c++)b(this.members_[c])};function EventRegistrar(b){this.eventTypes=[];this.listeners_={};if(b instanceof Array)var c=b;else if(typeof b=="object"){c=[];for(var d in b)c.push(b[d])}else throw Error("Unrecognized init parameter to EventRegistrar");for(b=0;b<c.length;b++){this.eventTypes.push(c[b]);this.listeners_[c[b]]=new ListDictionary(c[b]+"Listeners")}}a=EventRegistrar.prototype;a.isKnownEventType=function(b){for(var c=0;c<this.eventTypes.length;c++)if(b==this.eventTypes[c])return true;return false};
a.addEventType=function(b){if(this.isKnownEventType(b))throw Error("Event type already known: "+b);this.eventTypes.push(b);this.listeners_[b]=new ListDictionary(b+"Listeners")};a.registerListener=function(b,c){if(!this.isKnownEventType(b))throw Error("Unknown event type: "+b);this.listeners_[b].addMember(c)};a.removeListener=function(b,c){if(!this.isKnownEventType(b))throw Error("Unknown event type: "+b);this.listeners_[b].removeMember(c)};
a.fire=function(b,c){if(!this.isKnownEventType(b))throw Error("Unknown event type: "+b);var d=function(e){e(c)};this.listeners_[b].forEach(d)};function G_TabbedBrowserWatcher(b,c,d){this.debugZone="tabbedbrowserwatcher";this.tabBrowser_=b;this.filterAboutBlank_=!!d;this.events=G_TabbedBrowserWatcher.events;this.name_=c;this.mark_=G_TabbedBrowserWatcher.mark_+"-"+this.name_;this.registrar_=new EventRegistrar(G_TabbedBrowserWatcher.events);this.tabbox_=this.getTabBrowser().mTabBox;this.onDOMContentLoadedClosure_=BindToObject(this.onDOMContentLoaded,this);this.tabbox_.addEventListener("DOMContentLoaded",this.onDOMContentLoadedClosure_,true);
this.onDOMNodeInsertedClosure_=BindToObject(this.onDOMNodeInserted,this);this.tabbox_.addEventListener("DOMNodeInserted",this.onDOMNodeInsertedClosure_,true);this.onTabSwitchClosure_=BindToObject(this.onTabSwitch,this);this.tabbox_.addEventListener("select",this.onTabSwitchClosure_,true);b=this.tabbox_.ownerDocument.defaultView;this.onChromeUnloadClosure_=BindToObject(this.onChromeUnload_,this);b.addEventListener("unload",this.onChromeUnloadClosure_,false);this.lastTab_=this.getCurrentBrowser();this.detectNewTabs_()}
G_TabbedBrowserWatcher.events={DOMCONTENTLOADED:"domcontentloaded",LOCATIONCHANGE:"locationchange",PAGESHOW:"pageshow",PAGEHIDE:"pagehide",LOAD:"load",UNLOAD:"unload",TABLOAD:"tabload",TABUNLOAD:"tabunload",TABSWITCH:"tabswitch",TABMOVE:"tabmove"};G_TabbedBrowserWatcher.mark_="watcher-marked";a=G_TabbedBrowserWatcher.prototype;
a.onChromeUnload_=function(){if(this.tabbox_){this.tabbox_.removeEventListener("DOMContentLoaded",this.onDOMContentLoadedClosure_,true);this.tabbox_.removeEventListener("DOMNodeInserted",this.onDOMNodeInsertedClosure_,true);this.tabbox_.removeEventListener("select",this.onTabSwitchClosure_,true);var b=this.tabbox_.ownerDocument.defaultView;b.removeEventListener("unload",this.onChromeUnloadClosure_,false);this.tabbox_=null}if(this.lastTab_)this.lastTab_=null;if(this.tabBrowser_)this.tabBrowser_=null};
a.isInstrumented_=function(b){return!!b[this.mark_]};a.instrumentBrowser_=function(b){new G_BrowserWatcher(this,b);b[this.mark_]=true};a.detectNewTabs_=function(){for(var b=this.getTabBrowser(),c=0;c<b.browsers.length;++c)this.maybeFireTabLoad(b.browsers[c])};a.registerListener=function(b,c){this.registrar_.registerListener(b,c)};a.removeListener=function(b,c){this.registrar_.removeListener(b,c)};a.fire=function(b,c){this.registrar_.fire(b,c)};
a.fireDocEvent_=function(b,c,d){if(this.tabBrowser_){try{var e=c==d.contentDocument}catch(f){e=undefined}var g=d==this.getCurrentBrowser(),h=c?c.location.href:undefined;if(!this.filterAboutBlank_||h!="about:blank")this.fire(b,{doc:c,isTop:e,inSelected:g,browser:d})}};a.maybeFireTabLoad=function(b){if(!this.isInstrumented_(b)){this.instrumentBrowser_(b);this.fire(this.events.TABLOAD,{browser:b})}};
a.onDOMContentLoaded=function(b){b=b.target;var c=this.getBrowserFromDocument(b);if(c){this.maybeFireTabLoad(c);this.fireDocEvent_(this.events.DOMCONTENTLOADED,b,c)}};a.onDOMNodeInserted=function(b){if(b.target.localName=="tab")if(typeof b.target._tPos!="undefined"){for(var c=b.target._tPos,d,e=0;e<b.relatedNode.childNodes.length;e++){var f=b.relatedNode.childNodes[e];if(f==b.target){d=e;break}}this.fire(this.events.TABMOVE,{tab:b.target,fromIndex:c,toIndex:d})}};
a.onTabSwitch=function(b){if(!(b.target==null||b.target.localName!="tabs"&&b.target.localName!="tabpanels")){b=this.lastTab_;var c=this.getCurrentBrowser();if(b!=c){this.lastTab_=c;this.fire(this.events.TABSWITCH,{fromBrowser:b,toBrowser:c})}}};a.getTabBrowser=function(){return this.tabBrowser_};a.getCurrentBrowser=function(){return this.getTabBrowser().selectedBrowser};a.getCurrentWindow=function(){var b=this.getCurrentBrowser();return b&&b.contentWindow};
a.getBrowserFromDocument=function(b){function c(f,g){if(g.document==f)return true;if(g.frames)for(var h=0;h<g.frames.length;h++)if(c(f,g.frames[h]))return true;return false}for(var d=this.getTabBrowser().browsers,e=0;e<d.length;e++)if(c(b,d[e].contentWindow))return d[e];return null};
a.getDocumentFromURL=function(b,c){function d(h,i){if(h.document.location.href==i)return h.document;if(h.frames)for(var j=0;j<h.frames.length;j++){var k=d(h.frames[j],i);if(k)return k}return null}if(c)return d(c.contentWindow,b);for(var e=this.getTabBrowser().browsers,f=0;f<e.length;f++){var g=d(e[f].contentWindow,b);if(g)return g}return null};
a.getDocumentsFromURL=function(b,c){function d(h,i){h.document.location.href==i&&e.push(h.document);if(h.frames)for(var j=0;j<h.frames.length;j++)d(h.frames[j],i)}var e=[];if(c)return d(c.contentWindow,b);for(var f=this.getTabBrowser().browsers,g=0;g<f.length;g++)d(f[g].contentWindow,b);return e};
a.getBrowserFromWindow=function(b){function c(f,g){if(g==f)return true;if(g.frames)for(var h=0;h<g.frames.length;h++)if(c(f,g.frames[h]))return true;return false}for(var d=this.getTabBrowser().browsers,e=0;e<d.length;e++)if(c(b,d[e].contentWindow))return d[e];return null};G_TabbedBrowserWatcher.getTabElementFromBrowser=function(b,c){for(var d=0;d<b.browsers.length;d++)if(b.browsers[d]==c)return b.mTabContainer.childNodes[d];return null};
function G_BrowserWatcher(b,c){this.debugZone="browserwatcher";this.parent_=b;this.browser_=c;this.onPageShowClosure_=BindToObject(this.onPageShow,this);this.browser_.addEventListener("pageshow",this.onPageShowClosure_,true);this.onPageHideClosure_=BindToObject(this.onPageHide,this);this.browser_.addEventListener("pagehide",this.onPageHideClosure_,true);this.onLoadClosure_=BindToObject(this.onLoad,this);this.browser_.addEventListener("load",this.onLoadClosure_,true);this.onUnloadClosure_=BindToObject(this.onUnload,
this);this.browser_.addEventListener("unload",this.onUnloadClosure_,true);this.webProgressListener_={QueryInterface:function(){return this},onLocationChange:BindToObject(this.onLocationChange,this),onStateChange:function(){},onStatusChange:function(){},onSecurityChange:function(){},onProgressChange:function(){},onRefreshAttempted:function(){return true}};this.browser_.addProgressListener(this.webProgressListener_,Ci.nsIWebProgress.NOTIFY_LOCATION)}a=G_BrowserWatcher.prototype;
a.onLocationChange=function(b,c){if(this.parent_){var d=b.QueryInterface(Ci.nsIDocShellTreeItem),e=d&&d.parent;d=d&&d.sameTypeParent;e=!(e&&e==d);e={browser:this.browser_,request:c,isTop:e};this.parent_.fire(this.parent_.events.LOCATIONCHANGE,e)}};a.onPageShow=function(b){if(b.target&&b.target.nodeName=="#document"){b=b.target;this.parent_.fireDocEvent_(this.parent_.events.PAGESHOW,b,this.browser_)}};
a.onLoad=function(b){if(b.target)if(b.target.nodeName=="#document"){b=b.target;this.parent_.fireDocEvent_(this.parent_.events.LOAD,b,this.browser_)}};
a.onUnload=function(b){(b=b.target)&&b.nodeName=="#document"&&this.parent_.fireDocEvent_("unload",b,this.browser_);if(!this.browser_.docShell)if(!b){this.parent_.fire(this.parent_.events.TABUNLOAD,{browser:this.browser_});this.browser_.removeEventListener("pageshow",this.onPageShowClosure_,true);this.browser_.removeEventListener("pagehide",this.onPageHideClosure_,true);this.browser_.removeEventListener("load",this.onLoadClosure_,true);this.browser_.removeEventListener("unload",this.onUnloadClosure_,
true);this.browser_=this.parent_=null}};a.onPageHide=function(b){if(b.target.nodeName=="#document"){b=b.target;this.parent_.fireDocEvent_(this.parent_.events.PAGEHIDE,b,this.browser_)}};goog.crypt={};goog.crypt.stringToByteArray=function(b){for(var c=[],d=0,e=0;e<b.length;e++){for(var f=b.charCodeAt(e);f>255;){c[d++]=f&255;f>>=8}c[d++]=f}return c};goog.crypt.byteArrayToString=function(b){return String.fromCharCode.apply(null,b)};goog.crypt.stringToUtf8ByteArray=function(b){b=b.replace(/\r\n/g,"\n");for(var c=[],d=0,e=0;e<b.length;e++){var f=b.charCodeAt(e);if(f<128)c[d++]=f;else{if(f<2048)c[d++]=f>>6|192;else{c[d++]=f>>12|224;c[d++]=f>>6&63|128}c[d++]=f&63|128}}return c};
goog.crypt.utf8ByteArrayToString=function(b){for(var c=[],d=0,e=0;d<b.length;){var f=b[d++];if(f<128)c[e++]=String.fromCharCode(f);else if(f>191&&f<224){var g=b[d++];c[e++]=String.fromCharCode((f&31)<<6|g&63)}else{g=b[d++];var h=b[d++];c[e++]=String.fromCharCode((f&15)<<12|(g&63)<<6|h&63)}}return c.join("")};goog.crypt.base64={};goog.crypt.base64.byteToCharMap_=null;goog.crypt.base64.charToByteMap_=null;goog.crypt.base64.byteToCharMapWebSafe_=null;goog.crypt.base64.charToByteMapWebSafe_=null;goog.crypt.base64.ENCODED_VALS_BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.ENCODED_VALS_BASE+"+/=";goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.ENCODED_VALS_BASE+"-_.";
goog.crypt.base64.encodeByteArray=function(b,c){if(!goog.isArrayLike(b))throw Error("encodeByteArray takes an array as a parameter");goog.crypt.base64.init_();for(var d=c?goog.crypt.base64.byteToCharMapWebSafe_:goog.crypt.base64.byteToCharMap_,e=[],f=0;f<b.length;f+=3){var g=b[f],h=f+1<b.length,i=h?b[f+1]:0,j=f+2<b.length,k=j?b[f+2]:0,l=g>>2;g=(g&3)<<4|i>>4;i=(i&15)<<2|k>>6;k=k&63;if(!j){k=64;h||(i=64)}e.push(d[l],d[g],d[i],d[k])}return e.join("")};
goog.crypt.base64.encodeString=function(b,c){if(typeof goog.global.btoa=="function"&&!c)return goog.global.btoa(b);return goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(b),c)};goog.crypt.base64.decodeString=function(b,c){if(typeof goog.global.atob=="function"&&!c)return goog.global.atob(b);return goog.crypt.byteArrayToString(goog.crypt.base64.decodeStringToByteArray(b,c))};
goog.crypt.base64.decodeStringToByteArray=function(b,c){if(b.length%4)throw Error("Length of b64-encoded data must be zero mod four");goog.crypt.base64.init_();for(var d=c?goog.crypt.base64.charToByteMapWebSafe_:goog.crypt.base64.charToByteMap_,e=[],f=0;f<b.length;f+=4){var g=d[b.charAt(f)],h=d[b.charAt(f+1)],i=d[b.charAt(f+2)],j=d[b.charAt(f+3)];if(g==null||h==null||i==null||j==null)throw Error();g=g<<2|h>>4;e.push(g);if(i!=64){h=h<<4&240|i>>2;e.push(h);if(j!=64){i=i<<6&192|j;e.push(i)}}}return e};
goog.crypt.base64.init_=function(){if(!goog.crypt.base64.byteToCharMap_){goog.crypt.base64.byteToCharMap_={};goog.crypt.base64.charToByteMap_={};goog.crypt.base64.byteToCharMapWebSafe_={};goog.crypt.base64.charToByteMapWebSafe_={};for(var b=0;b<goog.crypt.base64.ENCODED_VALS.length;b++){goog.crypt.base64.byteToCharMap_[b]=goog.crypt.base64.ENCODED_VALS.charAt(b);goog.crypt.base64.charToByteMap_[goog.crypt.base64.byteToCharMap_[b]]=b;goog.crypt.base64.byteToCharMapWebSafe_[b]=goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(b);
goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.byteToCharMapWebSafe_[b]]=b}}};function Timer(b){this.t={};this.tick=function(c,d,e){e=e?e:(new Date).getTime();this.t[c]=[e,d]};this.tick("start",null,b)}var loadTimer=new Timer;window.jstiming={Timer:Timer,load:loadTimer};try{var pageT=null;if(window.chrome&&window.chrome.csi)pageT=Math.floor(window.chrome.csi().pageT);if(pageT==null)if(window.gtbExternal)pageT=window.gtbExternal.pageT();if(pageT==null)if(window.external)pageT=window.external.pageT;if(pageT)window.jstiming.pt=pageT}catch(e$$168){};function GTB_SidewikiApplication(){this.debugZone="GTB_SidewikiApplication";this.wrappedJSObject=this;this.windowHandlers_=[];this.serverUrlInUse_="";this.sidewikiUtils_=GTB_SidewikiUtil.getInstance();this.currentSID_=GTB_getCookie(GTB_SidewikiApplication.GAIA_COOKIE_URL_,"SID");new G_ObserverServiceObserver("cookie-changed",BindToObject(this.cookieChangeHandler_,this));this.sidewikiPrefs_=new G_Preferences(GTB_SidewikiApplication.SIDEWIKI_PREF_GROUP,false,true);this.sidewikiPrefs_.addObserver(GTB_SidewikiApplication.FIREFOX_PREFS.SIDEWIKI_SERVER,
BindToObject(this.reloadClients,this));this.toolbarPrefs_=new G_Preferences(GTB_SidewikiApplication.TOOLBAR_PREF_GROUP,false,true);this.toolbarPrefs_.addObserver(GTB_SidewikiApplication.BUTTON_VISIBLE_PREF,BindToObject(this.onPrefChange_,this));this.toolbarPrefs_.addObserver(GTB_SidewikiApplication.ENABLED_PREF,BindToObject(this.onPrefChange_,this));this.toolbarPrefs_.addObserver(GTB_SidewikiApplication.WORK_WHEN_INVISIBLE_PREF,BindToObject(this.onPrefChange_,this));new G_ObserverServiceObserver("xpcom-shutdown",
BindToObject(this.shutdown_,this),true)}GTB_SidewikiApplication.LOGIN_URL="http://www.google.com/accounts/login";GTB_SidewikiApplication.SIDEWIKI_PREF_GROUP="google.sidewiki.";
GTB_SidewikiApplication.FIREFOX_PREFS={SIDEWIKI_SERVER:"server.url",MINIBAR_ENABLED:"minibar.enabled",MINIBAR_FOR_ANNOTED_ONLY:"minibar.annoted.only",FILTER_BY_LANGUAGES:"filter.language",SHOW_RELATED_INFO:"related.info",MAILTHIS_LOGIN_URL:"mailthis.login.url",MAILTHIS_URL:"mailthis.url",SCROLL_SPEED:"scroll.speed",NOTIFICATION_DELAY:"notification.delay",NOTIFICATION_BLINKSNUM:"notification.blinksnum",NOTIFICATION_BLINKTIME:"notification.blinktime",NOTIFICATION_BGCOLOR:"notification.bgcolor",SIDEBAR_WIDTH:"sidebar.width",
USE_JSON_INTERFACE:"use.json.interface",USE_INFO_QUERY:"use.infoquery"};GTB_SidewikiApplication.TOOLBAR_PREF_GROUP="google.toolbar.";GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID="gtbSidewiki";GTB_SidewikiApplication.WRITE_ENTRY_MENU_ITEM_ID="gtbWriteSidewikiEntryMenuItem";GTB_SidewikiApplication.BUTTON_VISIBLE_PREF="button_option."+GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID;GTB_SidewikiApplication.ENABLED_PREF="sidewiki.enabled";GTB_SidewikiApplication.WORK_WHEN_INVISIBLE_PREF="work_when_invisible";
GTB_SidewikiApplication.DEFAULT_SIDEWIKI_SERVER_="http://clients3.google.com/sidewiki";GTB_SidewikiApplication.UI_CLIENT_SUFFIX_="clientui";GTB_SidewikiApplication.GAIA_COOKIE_URL_="https://www.google.com/accounts/";GTB_SidewikiApplication.sidewikiApp_=null;GTB_SidewikiApplication.getInstance=function(){if(!GTB_SidewikiApplication.sidewikiApp_)GTB_SidewikiApplication.sidewikiApp_=new GTB_SidewikiApplication;return GTB_SidewikiApplication.sidewikiApp_};a=GTB_SidewikiApplication.prototype;
a.getServerUrlInUse=function(){this.serverUrlInUse_||this.updateServerUrlInUse_();return this.serverUrlInUse_};a.getUIClientUrl=function(){var b=this.getServerUrlInUse()+"/"+GTB_SidewikiApplication.UI_CLIENT_SUFFIX_,c=this.sidewikiUtils_.getGTBContext(),d=[];c&&c.GTB_getLangCode&&d.push("hl="+c.GTB_getLangCode());d.push("browser="+this.sidewikiUtils_.getPlatformVersion());if(c=d.join("&"))b+="?"+c;return b};
a.getAnotationsUrls=function(){for(var b=[],c=0;c<this.windowHandlers_.length;++c)b=b.concat(this.windowHandlers_[c].getAnotationsUrls());return b};a.isEnabled=function(){var b=this.toolbarPrefs_.getPref(GTB_SidewikiApplication.BUTTON_VISIBLE_PREF,true)&&this.toolbarPrefs_.getPref(GTB_SidewikiApplication.ENABLED_PREF,false);if(b){var c=this.sidewikiUtils_.getGTBContext();if(c&&c.GTB_buttonAvailableInLocale)b=c.GTB_buttonAvailableInLocale(GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID)}return!!b};
a.createWindowHandler=function(b,c){if(!b.gtaSidewikiWindowDirector){var d=new GTB_SidewikiWindowDirector(b,c);this.windowHandlers_.push(d);d.updateServiceState();b.gtaSidewikiWindowDirector=d}};goog.exportSymbol("GTB_SidewikiApplication.prototype.createWindowHandler",GTB_SidewikiApplication.prototype.createWindowHandler);a=GTB_SidewikiApplication.prototype;a.reloadClients=function(){this.updateServerUrlInUse_();GTB_SidewikiUrlDataCache.getInstance().reset();for(var b=0;b<this.windowHandlers_.length;++b)this.windowHandlers_[b].reloadClients()};
a.updateContentInAllWindows=function(b){for(var c=0;c<this.windowHandlers_.length;++c)this.windowHandlers_[c].updateContent(b)};a.unregisterWindowHandler=function(b){for(var c=0;c<this.windowHandlers_.length;++c)if(this.windowHandlers_[c]==b){this.windowHandlers_.splice(c,1);return}};a.onPrefChange_=function(){for(var b=0;b<this.windowHandlers_.length;++b)this.windowHandlers_[b].updateServiceState()};
a.updateServerUrlInUse_=function(){var b=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.SIDEWIKI_SERVER,GTB_SidewikiApplication.DEFAULT_SIDEWIKI_SERVER_);this.serverUrlInUse_=b=b.replace(/[\\\/]+$/,"")};a.cookieChangeHandler_=function(b,c,d){b=b&&b.QueryInterface(Ci.nsICookie2);if(d=="cleared"||b&&GTB_isGoogleDomain(b.host)){b=this.currentSID_;c=GTB_getCookie(GTB_SidewikiApplication.GAIA_COOKIE_URL_,"SID");if(b!=c&&(!b||!c)){this.currentSID_=c;this.reloadClients()}}};
a.shutdown_=function(){this.sidewikiPrefs_.removeAllObservers();this.toolbarPrefs_.removeAllObservers()};function GTB_SidewikiBarsContainer(b,c){this.debugZone="GTB_SidewikiBarsContainer";this.topLevelWindow_=b;this.topLevelDocument_=c;this.contentElement_=c.getElementById(GTB_SidewikiBarsContainer.ElementIds_.CONTENT);this.barsContainer_=this.topLevelDocument_.getElementById(GTB_SidewikiBarsContainer.ElementIds_.BARS_CONTAINER);this.geometry_=new GTB_SidewikiGeometry(this.topLevelWindow_,this.topLevelDocument_);this.redrawTimer_=null;this.width_=0;this.zIndex_=1}
GTB_SidewikiBarsContainer.DEFAULT_REDRAW_DELAY_=10;GTB_SidewikiBarsContainer.ElementIds_={CONTENT:"content",BARS_CONTAINER:"sidewiki-bars-container"};a=GTB_SidewikiBarsContainer.prototype;a.changeWidthBy=function(b){this.width_+=b;if(this.width_<0)this.width_=0};
a.redraw=function(){if(this.redrawTimer_){this.redrawTimer_.cancel();this.redrawTimer_=null}var b=this.geometry_.getAvailableBoxSize();this.barsContainer_.style.top=b.top+"px";this.barsContainer_.style.left=b.left+"px";this.barsContainer_.style.height=b.height+"px";this.barsContainer_.style.width=this.width_+"px";this.barsContainer_.collapsed=false;this.barsContainer_.style.zIndex=++this.zIndex_;b=this.contentElement_.selectedBrowser;this.setNotificationBoxPadding_(b,this.width_)};
a.delayedRedraw=function(b){this.redrawTimer_&&this.redrawTimer_.cancel();b=b||GTB_SidewikiBarsContainer.DEFAULT_REDRAW_DELAY_;this.redrawTimer_=new G_Alarm(BindToObject(this.redraw,this),b)};a.hide=function(){if(this.redrawTimer_){this.redrawTimer_.cancel();this.redrawTimer_=null}this.barsContainer_.style.zIndex=0;this.barsContainer_.style.width=0;this.barsContainer_.collapsed=true};
a.destroy=function(){this.hide();var b=this.contentElement_.browsers;b=b&&b.length||0;for(var c=0;c<b;c++){var d=this.contentElement_.browsers[c];this.setNotificationBoxPadding_(d,0)}};a.setNotificationBoxPadding_=function(b,c){c=Math.max(0,c);var d=b&&b.parentNode;if(d)d.style.paddingLeft=c+"px"};function GTB_SidewikiClientInterface(b){this.debugZone="GTB_SidewikiClientInterface";this.baseListenerManager_=new GTB_SidewikiListenerManager;this.clientObj_=GTB_SidewikiClientInterface.getInterfaceObj_(b);var c=new G_Preferences(GTB_SidewikiApplication.SIDEWIKI_PREF_GROUP,false,true);c=c.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.USE_JSON_INTERFACE,false);GTB_SidewikiClientInterface.safeCall(this.clientObj_,"_setSerializeToJson",c);this.eventTarget_=b&&b.contentDocument;this.dataConverter_=new GTB_SidewikiDataConverter(c?
GTB_SidewikiDataConverter.DataFormat.JSON:GTB_SidewikiDataConverter.DataFormat.OBJECT);(this.ON_DEBUG_PRINT_=this.clientObj_&&this.clientObj_._GTA_EVENTS_ON_DEBUG_PRINT||"")&&this.baseListenerManager_.addListener(this.eventTarget_,this.ON_DEBUG_PRINT_,BindToObject(this.onDebugPrint_,this),true);(this.ON_SEND_LOG_EVENT_=this.clientObj_&&this.clientObj_._GTA_EVENTS_ON_SEND_LOGS||"")&&this.baseListenerManager_.addListener(this.eventTarget_,this.ON_SEND_LOG_EVENT_,BindToObject(this.onSendLog_,this),true)}
GTB_SidewikiClientInterface.prototype.isValid=function(){return!!this.clientObj_};GTB_SidewikiClientInterface.prototype.getClientObject=function(){return this.clientObj_};GTB_SidewikiClientInterface.prototype.getEventTarget=function(){return this.eventTarget_};GTB_SidewikiClientInterface.prototype.getDataConverter=function(){return this.dataConverter_};
GTB_SidewikiClientInterface.getVariable=function(b,c){var d=b&&b.contentWindow;if(d)if(d.wrappedJSObject)return d.wrappedJSObject[c];else if(d[c])return d[c];return null};GTB_SidewikiClientInterface.safeCall=function(b,c){if(b){var d=b[c],e=Array.prototype.slice.call(arguments,2);try{return d.apply(b,e)}catch(f){}}};GTB_SidewikiClientInterface.prototype.destroy=function(){this.baseListenerManager_.removeAllListeners();this.clientObj_=null};
GTB_SidewikiClientInterface.getInterfaceObj_=function(b){return(b=GTB_SidewikiClientInterface.getVariable(b,"_GTA_interface"))||null};GTB_SidewikiClientInterface.prototype.onDebugPrint_=function(){var b=this.getDataConverter();b=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.clientObj_,"_getDebugPrintContent"));for(var c=0;c<b.length;c++);};
GTB_SidewikiClientInterface.prototype.onSendLog_=function(){var b=this.getDataConverter();if((b=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.clientObj_,"_getLogElements")))&&b.length)for(var c=0;c<b.length;c++)GTB_SidewikiLogger.logDomElement(b[c])};function GTB_SidewikiClientLoader(b,c){this.debugZone="GTB_SidewikiClientLoader";this.topLevelWindow_=b;this.topLevelDoc_=c;this.listenerManager_=new GTB_SidewikiListenerManager;this.clientBrowser_=this.topLevelDoc_.getElementById(GTB_SidewikiClientLoader.CLIENT_BROWSER_ID_);this.stringBundle_=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.timer_=this.onStateChangeCallback_=this.renderInterface_=
this.coreInterface_=null;this.state_=GTB_SidewikiClientLoader.States.DISABLED}GTB_SidewikiClientLoader.States={LOADING:3,LOAD_FAILURE:2,LOAD_SUCCESS:1,DISABLED:0};GTB_SidewikiClientLoader.DEFAULT_BACKOFF_TIME_=1E4;GTB_SidewikiClientLoader.MAX_BACKOFF_TIME_=864E5;GTB_SidewikiClientLoader.BACKOFF_MULTIPLIER_=2;GTB_SidewikiClientLoader.FUZZING_FACTOR_=0.1;GTB_SidewikiClientLoader.LOAD_TIMEOUT_=6E4;GTB_SidewikiClientLoader.CLIENT_BROWSER_ID_="sidewiki-client";
GTB_SidewikiClientLoader.CSI_SERVICE_NAME_="annotateweb";GTB_SidewikiClientLoader.backOffTime_=GTB_SidewikiClientLoader.DEFAULT_BACKOFF_TIME_;a=GTB_SidewikiClientLoader.prototype;a.setStateChangeCallback=function(b){this.onStateChangeCallback_=b};a.setState=function(b){this.state_=b;this.onStateChangeCallback_&&this.onStateChangeCallback_()};a.getState=function(){return this.state_};a.getCoreInterface=function(){return this.coreInterface_};a.getRenderInterface=function(){return this.renderInterface_};
a.loadClients=function(){this.unloadClients();this.listenerManager_.addListener(this.clientBrowser_,"load",BindToObject(this.onLoad_,this,Date.now()),true);this.setState(GTB_SidewikiClientLoader.States.LOADING);this.clientBrowser_.setAttribute("src",GTB_SidewikiApplication.getInstance().getUIClientUrl());if(this.timer_){this.timer_.cancel();this.timer_=null}this.timer_=new G_Alarm(BindToObject(this.onLoadFailed_,this),GTB_SidewikiClientLoader.LOAD_TIMEOUT_)};
a.unloadClients=function(){if(this.timer_){this.timer_.cancel();this.timer_=null}this.listenerManager_.removeAllListeners();if(this.coreInterface_){this.coreInterface_.destroy();this.coreInterface_=null}if(this.renderInterface_){this.renderInterface_.destroy();this.renderInterface_=null}this.setState(GTB_SidewikiClientLoader.States.DISABLED);this.clientBrowser_.setAttribute("src","")};
a.showLoadDialog=function(){if(this.state_!=GTB_SidewikiClientLoader.States.LOADING){var b=Cc["@mozilla.org/embedcomp/prompt-service;1"].getService(Ci.nsIPromptService);this.unloadClients();(b=b.confirm(null,this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.client.reload.title"),this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.client.reload.text")))&&this.loadClients()}};a.destroy=function(){this.onStateChangeCallback_=null;this.unloadClients()};
a.onLoad_=function(b){var c=Date.now();this.listenerManager_.removeAllListeners();this.coreInterface_=new GTB_SidewikiCoreInterface(this.clientBrowser_);this.renderInterface_=new GTB_SidewikiRenderInterface(this.clientBrowser_);this.coreInterface_&&this.coreInterface_.isValid()&&this.renderInterface_&&this.renderInterface_.isValid()?this.onLoadSucceed_(b,c):this.onLoadFailed_()};a.onUnexpectedLoad_=function(){this.clientBrowser_.getAttribute("src");this.loadClients()};
a.onLoadSucceed_=function(b,c){if(this.timer_){this.timer_.cancel();this.timer_=null}this.listenerManager_.removeAllListeners();this.reportCSILatency_("clientui",b,c,Date.now());GTB_SidewikiClientLoader.backOffTime_=GTB_SidewikiClientLoader.DEFAULT_BACKOFF_TIME_;this.setState(GTB_SidewikiClientLoader.States.LOAD_SUCCESS);this.listenerManager_.addListener(this.clientBrowser_,"load",BindToObject(this.onUnexpectedLoad_,this),true)};
a.onLoadFailed_=function(){if(this.timer_){this.timer_.cancel();this.timer_=null}this.setState(GTB_SidewikiClientLoader.States.LOAD_FAILURE);var b=GTB_SidewikiClientLoader.backOffTime_;b*=GTB_SidewikiClientLoader.BACKOFF_MULTIPLIER_;b+=(Math.random()-0.5)*b*GTB_SidewikiClientLoader.FUZZING_FACTOR_;b=Math.min(b,GTB_SidewikiClientLoader.MAX_BACKOFF_TIME_);if(isNaN(b)||b<0)b=GTB_SidewikiClientLoader.DEFAULT_BACKOFF_TIME_;GTB_SidewikiClientLoader.backOffTime_=Math.round(b);this.timer_=new G_Alarm(BindToObject(this.loadClients,
this),GTB_SidewikiClientLoader.backOffTime_)};a.reportCSILatency_=function(b,c,d,e){var f=Number(GTB_SidewikiClientInterface.getVariable(this.clientBrowser_,"_SERVER_RESPONSE_TIME"));if(f){b=["http://csi.gstatic.com/csi?v=3&s=",GTB_SidewikiClientLoader.CSI_SERVICE_NAME_,"&action=",b,"&rt=srt.",f-c,",ol.",d-f,",prt.",e-f].join("");this.clientBrowser_.contentDocument.createElement("img").setAttribute("src",b)}};function GTB_SidewikiCoreInterface(b){GTB_SidewikiClientInterface.call(this,b);this.debugZone="GTB_SidewikiCoreInterface";this.listenerManager_=new GTB_SidewikiListenerManager;b=this.getClientObject();var c=this.getEventTarget();if(b&&c){GTB_SidewikiClientInterface.safeCall(b,"_setServerBaseUrl",GTB_SidewikiApplication.getInstance().getServerUrlInUse());this.ON_SHOW_ALL_CLICK_=b._GTA_EVENTS_ON_SHOW_ALL_CLICK||"";this.listenerManager_.addListener(c,this.ON_SHOW_ALL_CLICK_,BindToObject(this.onShowAllEntriesClick_,
this),true);this.ON_SERVICE_STATE_CHANGE_=b._GTA_EVENTS_ON_STATE_UPDATE||"";this.listenerManager_.addListener(c,this.ON_SERVICE_STATE_CHANGE_,BindToObject(this.onServiceStateChange_,this),true);this.ON_DATA_RECEIVED_=b._GTA_EVENTS_ON_DATA_RECEIVED||"";this.listenerManager_.addListener(c,this.ON_DATA_RECEIVED_,BindToObject(this.onDataRecieved_,this),true);this.ON_CLIENT_RELOAD_=b._GTA_EVENTS_ON_RELOAD_CLIENT_UI||"";this.listenerManager_.addListener(c,this.ON_CLIENT_RELOAD_,BindToObject(this.onClientReload_,
this),true)}}GTB_SidewikiCoreInterface.inherits(GTB_SidewikiClientInterface);a=GTB_SidewikiCoreInterface.prototype;a.setOnShowAllEntriesCallback=function(b){this.onShowAllEntriesCallback_=b};a.setOnServiceStateChangeCallback=function(b){this.onServiceStateChangeCallback_=b};
a.fetchUrlData=function(b,c,d){var e="",f=goog.uri.utils.getDomain(b),g=goog.uri.utils.getScheme(b);if(g&&g.toLowerCase()=="http"&&f)try{var h=Cc["@mozilla.org/network/dns-service;1"].getService(Ci.nsIDNSService),i=h.resolve(f,0);e=i.getNextAddrAsString()}catch(j){}f=this.getClientObject();GTB_SidewikiClientInterface.safeCall(f,"_fetchUrlData",b,c,e,d)};a.getRelatedInfoCount=function(b){return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getRelatedInfoCount",b)};
a.shouldShowNotifier=function(b){return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_shouldShowNotifier",b)};a.isEntryPermalinkUrl=function(b){return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_isAnnotationPermalinkUrl",b)};a.notifierShown=function(b){GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_notifierShown",b)};a.isServiceAvailable=function(){return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_isServiceAvailable")};
a.getTotalEntriesNum=function(b){return(b=this.getEntriesNum_(b))&&b.partial+b.wholePage||0};a.getPartialEntriesNum=function(b){return(b=this.getEntriesNum_(b))&&b.partial||0};a.getWholePageEntriesNum=function(b){return(b=this.getEntriesNum_(b))&&b.wholePage||0};a.getHighlightsData=function(b,c){var d=this.getDataConverter();return d.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getHighlights",b,c))};
a.setHighlightsPositions=function(b,c){var d=this.getDataConverter();return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_setHighlightsPositions",b,d.convertToExternal(c))};a.isEntriesAllowed=function(b){return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_isAnnotationsAllowed",b)};a.handleFetchUrlDataResponse=function(b,c){GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_handleFetchUrlDataResponse",b,c)};
a.getInfoQueryParams=function(b,c,d){return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getInfoQueryParams",b,c,d)};a.handleFetchUrlDataNAResponse=function(b){GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_handleFetchUrlDataNAResponse",b)};a.handleFetchUrlDataFailedResponse=function(b){GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_handleFetchUrlDataFailedResponse",b)};
a.sendLog=function(b,c){GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_sendLog",b,c)};a.destroy=function(){this.listenerManager_.removeAllListeners();GTB_SidewikiCoreInterface.superClass_.destroy.call(this)};a.getEntriesNum_=function(b){var c=this.getDataConverter();return b=c.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getAnnotationsNum",b))};a.onShowAllEntriesClick_=function(){this.onShowAllEntriesCallback_&&this.onShowAllEntriesCallback_()};
a.onServiceStateChange_=function(){this.onServiceStateChangeCallback_&&this.onServiceStateChangeCallback_()};a.onDataRecieved_=function(){for(var b=this.getDataConverter(),c=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getReceivedUrlData")),d,e=0;d=c[e];e++)GTB_SidewikiUrlDataCache.getInstance().putUrlData(d.url,d.canonicalUrl,b.convertToExternal(d.urlData))};a.onClientReload_=function(){GTB_SidewikiApplication.getInstance().reloadClients()};function GTB_SidewikiDataConverter(b){this.debugZone="GTB_SidewikiDataConverter";this.extDataFormat_=GTB_SidewikiDataConverter.DataFormat.OBJECT;if(typeof b=="number")this.extDataFormat_=b}GTB_SidewikiDataConverter.DataFormat={JSON:1,OBJECT:2};a=GTB_SidewikiDataConverter.prototype;a.getExternalFormat=function(){return this.extDataFormat_};a.convertToInternal=function(b){return this.convert_(b,this.extDataFormat_,GTB_SidewikiDataConverter.DataFormat.OBJECT)};
a.convertToExternal=function(b){return this.convert_(b,GTB_SidewikiDataConverter.DataFormat.OBJECT,this.extDataFormat_)};
a.convert_=function(b,c,d){if(c==GTB_SidewikiDataConverter.DataFormat.JSON){b=this.ensureString_(b);if(d==GTB_SidewikiDataConverter.DataFormat.OBJECT)return this.ensureObject_(goog.json.unsafeParse(b));else if(d==GTB_SidewikiDataConverter.DataFormat.JSON)return b}else if(c==GTB_SidewikiDataConverter.DataFormat.OBJECT){b=this.ensureObject_(b);if(d==GTB_SidewikiDataConverter.DataFormat.OBJECT)return b;else if(d==GTB_SidewikiDataConverter.DataFormat.JSON)return this.ensureString_(goog.json.serialize(b))}};
a.ensureObject_=function(b){if(typeof b!="object")return null;return b};a.ensureString_=function(b){if(typeof b!="string")return"";return b};function GTB_SidewikiDOM(){}GTB_SidewikiDOM.insertAfter=function(b,c,d){d&&d.nextSibling?b.insertBefore(c,d.nextSibling):b.appendChild(c)};GTB_SidewikiDOM.appendElement=function(b,c,d){c=b.ownerDocument.createElement(c);b.appendChild(c);d&&GTB_SidewikiDOM.appendTextNode(c,d);return c};GTB_SidewikiDOM.appendTextNode=function(b,c){var d=b.ownerDocument.createTextNode(c);b.appendChild(d);return d};GTB_SidewikiDOM.isWhitespace=function(b){return/^\s*$/.test(b)};
GTB_SidewikiDOM.getBoxObjectFor=function(b){var c=GTB_SidewikiUtil.getInstance().getGTBContext();return c.GTB_getBoxObjectFor(b)};
GTB_SidewikiDOM.wrapTextNodesInRange=function(b,c,d,e,f,g){var h=[];if(f=="undefined")f=0;if(typeof g=="undefined")g=c.length-1;for(var i=Math.min(g,c.length-1);i>=f;--i){var j=c[i],k=i==f?d:0,l=i==g?e:j.nodeValue.length;if(!GTB_SidewikiDOM.isWhitespace(j.nodeValue.substring(k,l))){var m=b?b(j.ownerDocument):j.ownerDocument.createElement("SPAN");GTB_SidewikiDOM.wrapNode(m,j,k,l);h.push(m)}}h.reverse();return h};
GTB_SidewikiDOM.wrapNode=function(b,c,d,e){var f=c.nodeValue.length-e,g=c.parentNode;if(d==0){g.replaceChild(b,c);b.appendChild(c);if(f!=0){f=g.ownerDocument.createTextNode(c.nodeValue.substring(e));GTB_SidewikiDOM.insertAfter(g,f,b);c.nodeValue=c.nodeValue.substring(0,e)}}else{b.appendChild(g.ownerDocument.createTextNode(c.nodeValue.substring(d,e)));GTB_SidewikiDOM.insertAfter(g,b,c);if(f!=0){f=g.ownerDocument.createTextNode(c.nodeValue.substring(e));GTB_SidewikiDOM.insertAfter(g,f,b)}c.nodeValue=
c.nodeValue.substring(0,d)}};GTB_SidewikiDOM.flattenElements=function(b){for(var c=0;c!=b.length;c++)GTB_SidewikiDOM.flattenElement(b[c])};GTB_SidewikiDOM.flattenSelectedElements=function(b,c){for(var d=b.firstChild;d;){var e=d.nextSibling;if(d.nodeType==Ci.nsIDOMElement.ELEMENT_NODE){GTB_SidewikiDOM.flattenSelectedElements(d,c);c(d)&&GTB_SidewikiDOM.flattenElement(d)}d=e}};
GTB_SidewikiDOM.flattenElement=function(b){for(var c=b.previousSibling,d=b.nextSibling,e=b.parentNode;b.firstChild;){var f=b.firstChild;b.removeChild(f);e.insertBefore(f,b)}e.removeChild(b);if(c&&c.nodeType==Ci.nsIDOMElement.TEXT_NODE)if((b=c.nextSibling)&&b.nodeType==Ci.nsIDOMElement.TEXT_NODE)if(b!=d){c.nodeValue+=b.nodeValue;e.removeChild(b)}if(d&&d.nodeType==Ci.nsIDOMElement.TEXT_NODE)if((b=d.previousSibling)&&b.nodeType==Ci.nsIDOMElement.TEXT_NODE){b.nodeValue+=d.nodeValue;e.removeChild(d)}};
GTB_SidewikiDOM.traverseSubtree=function(b,c,d){c(b)&&d&&d.push(b);for(var e=0;e!=b.childNodes.length;e++)GTB_SidewikiDOM.traverseSubtree(b.childNodes[e],c,d);return d};GTB_SidewikiDOM.getText=function(b,c){var d=(c?c:".")+"/text()";return(d=GTB_SidewikiDOM.getNode(b,d))?d.nodeValue:""};GTB_SidewikiDOM.getNumber=function(b,c){var d=GTB_SidewikiDOM.getText(b,c);return parseInt(d,10)||0};
GTB_SidewikiDOM.getNode=function(b,c){return b.ownerDocument.evaluate(c,b,null,Ci.nsIDOMXPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue};GTB_SidewikiDOM.getNodes=function(b,c){return b.ownerDocument.evaluate(c,b,null,Ci.nsIDOMXPathResult.ORDERED_NODE_ITERATOR_TYPE,null)};GTB_SidewikiDOM.contains=function(b,c){for(;c&&b!=c;)c=c.parentNode;return c==b};GTB_SidewikiDOM.setField=function(b,c,d){b=b.getElementById(c);if(b.firstChild)b.firstChild.nodeValue=d;else b.value=d};
GTB_SidewikiDOM.setVisibility=function(b,c){b.style.display=c?b.tagName=="P"||b.tagName=="DIV"?"block":"inline":"none"};
GTB_SidewikiDOM.cloneTree=function(b,c){if(b.nodeType==Ci.nsIDOMElement.TEXT_NODE)return b.ownerDocument.createTextNode(b.nodeValue);else{for(var d=b.ownerDocument.createElement(b.tagName),e=b.attributes,f=0;f!=e.length;f++){var g=e[f].name,h=e[f].value;if(g=="id")c[h]=d;else d.setAttribute(g,h)}e=b.childNodes;for(f=0;f!=e.length;f++)d.appendChild(GTB_SidewikiDOM.cloneTree(e[f],c));return d}};GTB_SidewikiDOM.getDocumentTextNodes=function(b){return GTB_SidewikiDOM.getSubtreeTextNodes(b.body)};
GTB_SidewikiDOM.getSubtreeTextNodes=function(b){for(var c=[],d=b;d;){for(;d.hasChildNodes();)d=d.firstChild;for(d.nodeType==Ci.nsIDOMElement.TEXT_NODE&&c.push(d);d&&d!=b&&!d.nextSibling;)d=d.parentNode;if(d==b)break;if(d)d=d.nextSibling}return c};GTB_SidewikiDOM.getTextNodesValues=function(b){for(var c=[],d=b.length,e=0;e<d;++e)c.push(b[e].nodeValue);return c};
GTB_SidewikiDOM.getNestedDocuments=function(b){for(var c=[b],d=0;b=c[d];d++){for(var e=b.getElementsByTagName("frame")||[],f,g=0;f=e[g];g++)f.contentDocument&&c.push(f.contentDocument);b=b.getElementsByTagName("iframe")||[];for(g=0;e=b[g];g++)e.contentDocument&&c.push(e.contentDocument)}return c};function GTB_SidewikiEmailDispatcher(b,c){this.debugZone="GTB_SidewikiEmailDispatcher";this.tabWatcher_=b;this.listenerManager_=new GTB_SidewikiListenerManager;this.win_=c;this.sidewikiPrefs_=new G_Preferences(GTB_SidewikiApplication.SIDEWIKI_PREF_GROUP,false,true);this.timer_=null;this.closeBrowser_=false;this.onPageShowHandler_=GTB_RegisterListener(this.tabWatcher_,G_TabbedBrowserWatcher.events.PAGESHOW,this.onPageShow_,this)}GTB_SidewikiEmailDispatcher.contentContainer_=[];
GTB_SidewikiEmailDispatcher.DEFAULT_MAILTHIS_LOGIN_URL_="http://mail.google.com/mail/?tb=4";GTB_SidewikiEmailDispatcher.MAILTHIS_COMMAND_="http://toolbar.google.com/command?send_to_gmail";GTB_SidewikiEmailDispatcher.CB_COMMAND_URL_="http://toolbar.google.com/command";GTB_SidewikiEmailDispatcher.DEFAULT_MAILTHIS_URL_="http://mail.google.com/mail/?view=mm&at=";GTB_SidewikiEmailDispatcher.MAIL_URL_TEMPLATE_="mail.google.com/mail/?tf=1";a=GTB_SidewikiEmailDispatcher.prototype;
a.sendMail=function(b){GTB_SidewikiEmailDispatcher.contentContainer_.push(b);b=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.MAILTHIS_LOGIN_URL,GTB_SidewikiEmailDispatcher.DEFAULT_MAILTHIS_LOGIN_URL_);this.openGmailWin_(b)};a.destroy=function(){this.tabWatcher_.removeListener(G_TabbedBrowserWatcher.events.PAGESHOW,this.onPageShowHandler_);this.listenerManager_.removeAllListeners();if(this.timer_){this.timer_.cancel();this.timer_=null}};
a.openGmailWin_=function(b){var c="chrome,dialog=no,status=yes,resizable=yes,scrollbars=yes,minimizeable=yes";c=this.win_.openDialog(this.win_.getBrowserURL(),"_blank",c,"about:blank");this.listenerManager_.addListener(c,"load",BindToObject(this.loadGmail_,this,c,b),false)};a.loadGmail_=function(b,c){this.timer_=new G_Alarm(BindToObject(this.loadURI_,this,b,c,null),50)};
a.onPageShow_=function(b){var c=b.doc&&b.doc.location&&b.doc.location.href;if(this.closeBrowser_&&c==GTB_SidewikiEmailDispatcher.CB_COMMAND_URL_+"?close_browser"){b.doc.defaultView.close();this.closeBrowser_=false}else{if(this.closeBrowser_&&c.indexOf(GTB_SidewikiEmailDispatcher.MAIL_URL_TEMPLATE_)!=-1&&c.indexOf("&act=sm")!=-1){for(b=b.doc.defaultView;b.parent!=b;)b=b.parent;new G_Alarm(BindToObject(b.close,b),2E3)}if(GTB_SidewikiEmailDispatcher.contentContainer_.length!=0)if(GTB_SidewikiEmailDispatcher.MAILTHIS_COMMAND_==
c){c=GTB_SidewikiEmailDispatcher.contentContainer_.shift();c=this.makeGmailPostData_(c);b=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.MAILTHIS_URL,GTB_SidewikiEmailDispatcher.DEFAULT_MAILTHIS_URL_);var d=GTB_getCookie(b,"GMAIL_AT");if(!d){b=b.replace(/^http:/,"https:");d=GTB_getCookie(b,"GMAIL_AT")}b+=d;this.win_.loadURI(b,null,c);this.closeBrowser_=true}}};a.loadURI_=function(b,c,d){b.resizeTo(800,550);b.loadURI(c,null,d)};
a.makeGmailPostData_=function(b){var c="{------------";c+=Math.floor(Math.random()*32767);c+=Math.floor(Math.random()*32767);c+=Math.floor(Math.random()*32767);c+="}";c='Mime-Version: 1.0\r\nContent-Type: Multipart/related; boundary="'+c+'"\r\n\r\n--'+c+"\r\nContent-Type: Text/HTML\r\n\r\n"+b.content+"\r\n--"+c+"--\r\n";c="mime="+encodeURIComponent(c);c+="&subject="+encodeURIComponent(b.title);b=Cc["@mozilla.org/io/string-input-stream;1"].createInstance(Ci.nsIStringInputStream);b.setData(c,c.length);
c=Cc["@mozilla.org/network/mime-input-stream;1"].createInstance(Ci.nsIMIMEInputStream);c.addHeader("Content-Type","application/x-www-form-urlencoded;");c.addContentLength=true;c.setData(b);return c};function GTB_SidewikiGeometry(b,c){this.debugZone="GTB_SidewikiGeometry";this.topLevelWindow_=b;this.topLevelDocument_=c}
GTB_SidewikiGeometry.prototype.getAvailableBoxSize=function(){var b=this.topLevelDocument_.getElementById("content");var c=(b=b.selectedBrowser)&&b.parentNode;if(!c)return null;b=c.boxObject.width;var d=c.boxObject.height,e=c.boxObject.x,f=this.topLevelWindow_.innerWidth-c.boxObject.x-c.boxObject.width,g=c.boxObject.y;c=this.topLevelWindow_.innerHeight-c.boxObject.y-c.boxObject.height;return{height:d,width:b,top:g,bottom:c,left:e,right:f}};function GTB_SidewikiHighlightList(b,c){this.debugZone="GTB_SidewikiHighlightList";this.highlightedDoc_=c;this.urlData_=b;this.highlights_=[];this.activeHighlight_=null;this.pointedHighlights_=[];this.isInitialized_=false;this.highlightDefaultState_=GTB_SidewikiHighlight.States.DISABLED}
GTB_SidewikiHighlightList.createFromJson=function(b,c,d){b=new GTB_SidewikiHighlightList(b,c);if(d){c=0;for(var e=d.length;c<e;++c){var f=GTB_SidewikiHighlight.createFromJson(d[c]);f.isValid()&&b.highlights_.push(f)}}b.initializeHighlights_();return b};a=GTB_SidewikiHighlightList.prototype;a.getHighlightsNum=function(){return this.highlights_.length};a.getHighlights=function(){return this.highlights_.slice(0)};
a.getHighlightByEntryId=function(b){for(var c,d=0;c=this.highlights_[d];++d)if(c.getEntryId()==b)return c;return null};a.setActiveHighlight=function(b){this.activeHighlight_=b;this.updateHighlights_()};a.getActiveHighlight=function(){return this.activeHighlight_};a.addPointedHighlights=function(b){for(var c="",d,e=0;d=b[e];++e){this.pointedHighlights_.push(d);c+=d.getEntryId()+","}GTB_SidewikiLogger.logData("add_pointed_highlights",c);this.updateHighlights_()};
a.removePointedHighlights=function(b){for(var c,d=0;c=b[d];++d)for(var e,f=0;e=this.pointedHighlights_[f];++f)e==c&&this.pointedHighlights_.splice(f--,1);this.updateHighlights_()};a.removeAllPointedHighlights=function(){this.pointedHighlights_=[];this.updateHighlights_()};a.getPointedHighlights=function(){return this.pointedHighlights_.slice(0)};a.setHighlightsDefaultState=function(b){this.highlightDefaultState_=b;this.updateHighlights_()};
a.getHighlightPositions=function(){for(var b={},c,d=0;c=this.highlights_[d];++d)if(!c.isWholePage()){var e=c.getBoundingBox();if(e)b[c.getEntryId()]=e.top}return b};a.updateBoundingBoxes=function(){for(var b,c=0;b=this.highlights_[c];++c)b.updateBoundingBox()};
a.isUpToDate=function(b,c,d){if(!this.isInitialized_||c!=this.highlightedDoc_||b!=this.urlData_)return false;b=new GTB_SidewikiHighlightList(b,c);var e,f;if(d){f=d.length;for(e=0;e<f;++e){c=GTB_SidewikiHighlight.createFromJson(d[e]);c.isValid()&&b.highlights_.push(c)}}if(this.getHighlightsNum()!=b.getHighlightsNum())return false;f=this.highlights_.length;for(e=0;e<f;++e){c=b.getHighlightByEntryId(this.highlights_[e].getEntryId());if(!c)return false}return true};
a.destroy=function(){for(var b=this.highlights_.length,c=0;c<b;++c)for(var d=this.highlights_[c].getSpans(),e,f=0;e=d[f];++f)try{e.parentNode&&GTB_SidewikiDOM.flattenElement(e)}catch(g){c=b;break}this.highlights_=[]};a.updateHighlights_=function(){var b,c;for(c=0;b=this.highlights_[c];++c)b.setState(this.highlightDefaultState_);this.activeHighlight_&&this.activeHighlight_.setState(GTB_SidewikiHighlight.States.ACTIVE);for(c=0;b=this.pointedHighlights_[c];++c)b.setState(GTB_SidewikiHighlight.States.ACTIVE)};
a.initializeHighlights_=function(){if(this.highlightedDoc_){for(var b=0,c,d=0;c=this.highlights_[d];++d)c.isWholePage()||++b;if(b){c=GTB_SidewikiDOM.getNestedDocuments(this.highlightedDoc_);d=0;for(var e,f=0;(e=c[f])&&d<b;++f)d+=this.initializeHighlightsForDoc_(e);this.isInitialized_=d>0}else this.isInitialized_=true}};
a.initializeHighlightsForDoc_=function(b){var c=0,d=new GTB_SidewikiSubstringFinder;b=GTB_SidewikiDOM.getDocumentTextNodes(b);var e=GTB_SidewikiDOM.getTextNodesValues(b);d.initialize(e);e=[];for(var f,g=0;f=this.highlights_[g];++g)if(!f.isWholePage()&&!f.getRange()){var h=f.getText();if(h=d.getSubstringRange(h)){f.setRange(h);e.push(f);++c}else this.highlights_.splice(g--,1)}d.clear();c>=0&&this.setupHighlightSpans_(e,b);return c};
a.setupHighlightSpans_=function(b,c){b.sort(function(i,j){var k=i.getRange(),l=j.getRange();if(!k&&!l)return 0;if(!k)return-1;if(!l)return 1;if(k.endNode>l.endNode)return-1;if(k.endNode<l.endNode)return 1;if(k.endOffset>l.endOffset)return-1;if(k.endOffset<l.endOffset)return 1;return 0});for(var d=b.length,e=0;e<d;++e){var f=b[e].getRange();if(f){var g=[b[e]],h={startNode:f.startNode,startOffset:f.startOffset,endNode:f.endNode,endOffset:f.endOffset};for(e=e+1;e<d;++e){f=b[e].getRange();if(h.startNode>
f.endNode||h.startNode==f.endNode&&h.startOffset>f.endOffset)break;if(h.startNode>f.startNode){h.startNode=f.startNode;h.startOffset=f.startOffset}else if(h.startNode==f.startNode)h.startOffset=Math.min(h.startOffset,f.startOffset);g.push(b[e])}e=e-1;this.setupSpansForCluster_(g,c)}}};
a.setupSpansForCluster_=function(b,c){var d=b.length,e=this.getSortedBoundaries_(b),f=e.length;for(f=f-1;f>0;--f){var g=e[f-1],h=e[f];if(g.node!=h.node||g.offset!=h.offset)for(var i=GTB_SidewikiDOM.wrapTextNodesInRange(null,c,g.offset,h.offset,g.node,h.node),j=0;j<d;++j){var k=b[j],l=k.getRange();if(l&&(g.node>l.startNode||g.node==l.startNode&&g.offset>=l.startOffset)&&(h.node<l.endNode||h.node==l.endNode&&h.offset<=l.endOffset))for(var m=0;l=i[m];++m)k.addSpan(l)}}};
a.getSortedBoundaries_=function(b){for(var c=[],d,e=0;d=b[e];++e)if(d=d.getRange()){c.push({node:d.startNode,offset:d.startOffset});c.push({node:d.endNode,offset:d.endOffset})}c.sort(function(f,g){if(f.node<g.node)return-1;if(f.node>g.node)return 1;if(f.offset<g.offset)return-1;if(f.offset>g.offset)return 1;return 0});return c};function GTB_SidewikiHighlight(){this.debugZone="GTB_SidewikiHighlight";this.highlightText_=this.entryId_="";this.spans_=[];this.range_=this.boundingBox_=null;this.state_=GTB_SidewikiHighlight.States.DISABLED}GTB_SidewikiHighlight.States={ACTIVE:2,ENABLED:1,DISABLED:0};GTB_SidewikiHighlight.Colors_={ACTIVE:"#fdde66",ENABLED:"#edf2fd",DISABLED:""};GTB_SidewikiHighlight.createFromJson=function(b){var c=new GTB_SidewikiHighlight;if(b){c.entryId_=b.id||"";c.highlightText_=b.text||""}return c};a=GTB_SidewikiHighlight.prototype;
a.getEntryId=function(){return this.entryId_};a.getText=function(){return this.highlightText_};a.setRange=function(b){this.range_=b};a.getRange=function(){return this.range_};a.setSpans=function(b){this.spans_=b;this.boundingBox_=null};a.addSpan=function(b){this.spans_.push(b);this.boundingBox_=null};a.getSpans=function(){return this.spans_};a.setState=function(b){if(this.state_!=b){this.state_=b;this.updateState_()}};a.getState=function(){return this.state_};
a.updateBoundingBox=function(){for(var b=null,c=0,d=this.spans_.length;c<d;++c){var e=GTB_SidewikiDOM.getBoxObjectFor(this.spans_[c]);if(e){var f=e.x,g=e.x+e.width,h=e.y;e=e.y+e.height;if(h!=e&&g!=f)if(b){b.left=Math.min(b.left,f);b.right=Math.max(b.right,g);b.top=Math.min(b.top,h);b.bottom=Math.max(b.bottom,e)}else b={left:f,right:g,top:h,bottom:e}}}this.boundingBox_=b};a.getBoundingBox=function(){this.boundingBox_||this.updateBoundingBox();return this.boundingBox_};a.isWholePage=function(){return!this.getText()};
a.isValid=function(){return!!this.getEntryId()};a.equals=function(b){return!!b&&this.getEntryId()==b.getEntryId()&&this.getText()==b.getText()};
a.updateState_=function(){var b=GTB_SidewikiHighlight.Colors_.DISABLED;if(GTB_SidewikiHighlight.States.ACTIVE==this.state_)b=GTB_SidewikiHighlight.Colors_.ACTIVE;else if(GTB_SidewikiHighlight.States.ENABLED==this.state_)b=GTB_SidewikiHighlight.Colors_.ENABLED;else this.state_=GTB_SidewikiHighlight.States.DISABLED;for(var c,d=0;c=this.spans_[d];++d)c.style.backgroundColor=b};function GTB_SidewikiListenerManager(){this.debugZone="GTB_SidewikiListenerManager";this.listenersArray_=[]}GTB_SidewikiListenerManager.prototype.addListener=function(b,c,d,e){if(b&&c){b.addEventListener(c,d,e);b={object:b,type:c,handler:d,useCapture:e};this.listenersArray_.push(b)}};
GTB_SidewikiListenerManager.prototype.removeListenersFor=function(b,c,d,e){for(var f,g=0;f=this.listenersArray_[g];g++)if(f.object==b&&(c==undefined||c==f.type)&&(d==undefined||d==f.handler)&&(e==undefined||e==f.useCapture)){f.object.removeEventListener(f.type,f.handler,f.useCapture);this.listenersArray_.splice(g--,1)}};
GTB_SidewikiListenerManager.prototype.removeAllListeners=function(){for(var b,c=0;b=this.listenersArray_[c];c++)try{b.object.removeEventListener(b.type,b.handler,b.useCapture)}catch(d){}this.listenersArray_.length=0};function GTB_SidewikiLogger(){}GTB_SidewikiLogger.loggingCallback_=null;GTB_SidewikiLogger.setLoggingCallback=function(b){GTB_SidewikiLogger.loggingCallback_=b};GTB_SidewikiLogger.logData=function(b,c){if(GTB_SidewikiLogger.loggingCallback_)GTB_SidewikiLogger.loggingCallback_(b,c||null)};GTB_SidewikiLogger.logDomElement=function(b){var c=b&&b.ownerDocument;try{var d=c&&c.createEvent("UIEvents");if(d){d.initUIEvent("command",true,true,null,0);b.dispatchEvent(d)}}catch(e){}};function GTB_SidewikiMainPanel(b,c,d,e,f){GTB_SidewikiOverlayObject.call(this,c,d);this.debugZone="GTB_SidewikiMainPanel";this.topLevelDocument_=b;this.resizer_=e;this.contextMenu_=this.topLevelDocument_.getElementById(GTB_SidewikiMainPanel.ElementIds_.CONTEXT_MENU);this.listenerManager_=new GTB_SidewikiListenerManager;this.renderInterface_=f}GTB_SidewikiMainPanel.inherits(GTB_SidewikiOverlayObject);GTB_SidewikiMainPanel.ElementIds_={CONTEXT_MENU:"contentAreaContextMenu",FRAME_SUBMENU:"frame",CLIENT_BROWSER:"sidewiki-client"};
GTB_SidewikiMainPanel.contextMenuElementsToHide_={"context-fitimage":true,"context-viewimage":true,"context-copyimage":true,"context-sep-copyimage":true,"context-back":true,"context-forward":true,"context-reload":true,"context-stop":true,"context-sep-stop":true,"context-bookmarkpage":true,"context-savepage":true,"context-sep-viewbgimage":true,"context-viewbgimage":true,"frame-sep":true,frame:true,"context-sep-properties":true,"context-viewpartialsource-selection":true,"context-viewpartialsource-mathml":true,
"context-viewsource":true,"context-viewinfo":true,"context-metadata":true};a=GTB_SidewikiMainPanel.prototype;a.getResizerElement=function(){return this.resizer_};a.setClientMode=function(b){this.renderInterface_.setMode(b)};a.getClientMode=function(){return this.renderInterface_.getMode()};a.setActiveEntry=function(b){this.getRenderInterfaceInternal().setActiveEntry(b)};a.getActiveEntry=function(){return this.getRenderInterfaceInternal().getActiveEntry()};a.open=function(){};
a.close=function(){if(this.isOpened()){this.renderInterface_.updateContext();this.renderInterface_.hideClient()}this.resizer_.collapsed=true;this.listenerManager_.removeAllListeners();GTB_SidewikiMainPanel.superClass_.close.call(this)};a.updateState=function(b){if(this.isOpened()){this.renderInterface_.updateContext();this.renderInterface_.initClient(b)}};a.updateContext=function(){this.isOpened()&&this.renderInterface_.updateContext()};a.updatePageTitle=function(b){this.isOpened()&&this.renderInterface_.updatePageTitle(b)};
a.updateSelectionText=function(b){this.isOpened()&&this.renderInterface_.updateSelectionText(b)};a.updateOtherDomainsContentEstateSize=function(b){this.isOpened()&&this.renderInterface_.updateOtherDomainsContentEstateSize(b)};a.getRenderInterfaceInternal=function(){return this.renderInterface_};
a.drawInCompleteInternal=function(){if(this.isOpened()){this.resizer_.collapsed=false;this.listenerManager_.addListener(this.resizer_,"mousedown",BindToObject(this.onStartResizingInternal,this),true);this.listenerManager_.addListener(this.topLevelDocument_,"resize",BindToObject(this.onWindowResize,this),true);this.contextMenu_&&this.listenerManager_.addListener(this.contextMenu_,"popupshowing",BindToObject(this.updateContextMenu_,this),false)}};
a.updateContextMenu_=function(){var b=this.topLevelDocument_.popupNode,c=this.topLevelDocument_.getElementById(GTB_SidewikiMainPanel.ElementIds_.CLIENT_BROWSER);c=c&&c.contentDocument;!this.contextMenu_||!b||!c||!GTB_SidewikiDOM.contains(c,b)||GTB_SidewikiDOM.traverseSubtree(this.contextMenu_,BindToObject(this.updateContextMenuItem_,this))};
a.updateContextMenuItem_=function(b){if(b.tagName=="menu"||b.tagName=="menuitem"||b.tagName=="menuseparator")if(GTB_SidewikiMainPanel.contextMenuElementsToHide_[b.id])b.hidden=true};a.onStartResizingInternal=function(){var b=this.topLevelDocument_;b.documentElement.style.cursor=this.resizer_.style.cursor;this.listenerManager_.addListener(b,"mousemove",BindToObject(this.onResizingInternal,this),true);this.listenerManager_.addListener(b,"mouseup",BindToObject(this.onResizingFinishInternal,this),true)};
a.onResizingInternal=function(){};a.onResizingFinishInternal=function(){this.listenerManager_.removeListenersFor(this.topLevelDocument_);this.topLevelDocument_.documentElement.style.cursor=""};function GTB_SidewikiMarkerPanel(b,c,d){this.debugZone="GTB_SidewikiMarkerPanel";this.topLevelWindow_=b;this.topLevelDocument_=c;this.barsContainer_=d;this.minibar_=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MINIBAR);this.writeIconOverlay_=new GTB_SidewikiWriteIcon(b,c);this.minibarBrowser_=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MINIBAR_BROWSER);this.sidewikiPrefs_=new G_Preferences(GTB_SidewikiApplication.SIDEWIKI_PREF_GROUP,false,true);this.stringBundle_=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");
this.highlightedDocSize_={};this.highlightList_=null;this.markersArray_=[];this.listenerManager_=new GTB_SidewikiListenerManager;this.markersListenerManager_=new GTB_SidewikiListenerManager;this.notificationTimer_=null;this.updateHeightTimer_=new G_Alarm(BindToObject(this.updateHeight_,this),GTB_SidewikiMarkerPanel.Props_.UPDATE_HEIGHT_TIME);this.scrollingTimer_=this.setupMarkersTimer_=null;this.height_=this.mouseY_=0;this.selectedText_="";this.sidewikiMode_=GTB_SidewikiMarkerPanel.SidewikiModes.SIDEWIKI_NA;
this.defaultMarkersState_=GTB_SidewikiMarker.States.ENABLED;this.isSidebarOpened_=false;b=this.minibarBrowser_.contentDocument;b=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.CHEVRON);b.style.display=""}GTB_SidewikiMarkerPanel.SidewikiModes={SIDEWIKI_NA:2,SIDEWIKI_WRITE:1,SIDEWIKI_VIEW:0};
GTB_SidewikiMarkerPanel.Props_={MINIBAR_WIDTH:18,UPDATE_HEIGHT_TIME:5E3,SCROLLING_TIME:1500,SETUP_MARKERS_DELAY:0,NOTIFICATION_BLINKSNUM:0,NOTIFICATION_BLINKTIME:1500,NOTIFICATION_DELAY_TIME:5E3,NOTIFICATION_BGCOLOR:"#77a4ff",DEFAULT_BGCOLOR:"#edf2fd"};
GTB_SidewikiMarkerPanel.ElementIds_={MINIBAR:"sidewiki-minibar",MINIBAR_BROWSER:"sidewiki-minibar-browser",MINIBAR_HEADER:"minibar-header",MINIBAR_FOOTER:"minibar-footer",CHEVRON:"chevron",WP_MARKER:"wp-marker",GRIPPER:"gripper",RESIZER:"resizer",WRITE_ICON:"write-icon",MARKERS_CONTAINER:"markers-container",MARKER_TEMPLATE:"marker-template",ARROW_UP:"arrow-up",ARROW_DOWN:"arrow-down",MAIN_PANEL_RESIZER:"sidewiki-sidebar-resizer"};
GTB_SidewikiMarkerPanel.Classes_={ARROW_DISABLED:"arrow-disabled",CHEVRON_OPEN:"chevron-open",CHEVRON_CLOSE:"chevron-close",CHEVRON_DISABLED:"chevron-disabled"};a=GTB_SidewikiMarkerPanel.prototype;a.setOnMarkerClickCallback=function(b){this.onMarkerClickCallback_=b};a.setOnViewClickCallback=function(b){this.onViewClickCallback_=b};a.setOnWriteClickCallback=function(b){this.onWriteClickCallback_=b;this.writeIconOverlay_.setOnClickCallback(b)};
a.setOnStartResizingCallback=function(b){this.onStartResizingCallback_=b};a.setOnCloseClickCallback=function(b){this.onCloseClickCallback_=b};a.show=function(){if(this.minibar_.collapsed){var b=GTB_SidewikiMarkerPanel.Props_.MINIBAR_WIDTH;this.barsContainer_.changeWidthBy(b);this.barsContainer_.delayedRedraw();this.minibar_.style.width=b+"px";this.minibar_.collapsed=false}this.updateWriteIcon_();this.updateHeight_()};
a.hide=function(){if(!this.minibar_.collapsed){this.barsContainer_.changeWidthBy(-GTB_SidewikiMarkerPanel.Props_.MINIBAR_WIDTH);this.barsContainer_.delayedRedraw();this.minibar_.style.width=0;this.minibar_.collapsed=true}this.updateWriteIcon_()};a.toggleHighlighting=function(b){if(this.highlightList_)if(b)this.highlightList_.setHighlightsDefaultState(GTB_SidewikiHighlight.States.ENABLED);else{this.setActiveHighlight(null);this.highlightList_.setHighlightsDefaultState(GTB_SidewikiHighlight.States.DISABLED)}};
a.showActiveHighlight=function(b){var c=this.topLevelDocument_.getElementById("content");c=c.boxObject.height/2;var d=this.highlightList_.getHighlightByEntryId(b),e=d&&d.getBoundingBox();if(d&&!d.isWholePage()&&e){this.scrollingTimer_&&this.scrollingTimer_.cancel();this.scrollingTimer_=this.smoothScrollTo_(e,c,GTB_SidewikiMarkerPanel.Props_.SCROLLING_TIME,BindToObject(this.onScrollHandler_,this))}this.setActiveHighlight(b)};
a.setActiveHighlight=function(b){if(this.highlightList_){b=this.highlightList_.getHighlightByEntryId(b);this.highlightList_.setActiveHighlight(b);this.updatePanelElements_()}};a.setSidebarState=function(b){this.isSidebarOpened_=b;this.updatePanelElements_()};a.setSidewikiMode=function(b){this.sidewikiMode_=b;this.updateWriteIcon_()};
a.showMarkers=function(b,c){if(!(this.highlightedDoc_==b&&this.highlightList_==c)){this.clearMarkers();if(b&&b.body&&c){this.setupMarkersTimer_=new G_Alarm(BindToObject(this.setupMarkers_,this,b,c),GTB_SidewikiMarkerPanel.Props_.SETUP_MARKERS_DELAY);this.highlightedDoc_=b;this.highlightList_=c;this.updatePanelElements_();this.updateWriteIcon_();this.selectedText_=GTB_SidewikiUtil.getInstance().getSelectionText(b)}this.setupListenters_()}};
a.clearMarkers=function(){if(this.setupMarkersTimer_){this.setupMarkersTimer_.cancel();this.setupMarkersTimer_=null}this.listenerManager_.removeAllListeners();this.removeMarkers_();this.highlightList_=this.highlightedDoc_=null;if(this.scrollingTimer_){this.scrollingTimer_.cancel();this.scrollingTimer_=null}this.selectedText_="";this.updatePanelElements_();this.updateWriteIcon_()};
a.destroy=function(){if(this.updateHeightTimer_){this.updateHeightTimer_.cancel();this.updateHeightTimer_=null}this.clearMarkers();this.listenerManager_.removeAllListeners();this.hide();this.writeIconOverlay_.close()};
a.getMarkersContainerRange_=function(){var b=this.minibarBrowser_.contentDocument,c=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MINIBAR_HEADER);b=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MINIBAR_FOOTER);c=GTB_SidewikiDOM.getBoxObjectFor(c);b=GTB_SidewikiDOM.getBoxObjectFor(b);return{top:c.y+c.height,bottom:b.y}};
a.setupMarkers_=function(b,c){var d=this.minibarBrowser_.contentDocument,e=d.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MARKER_TEMPLATE),f=d.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MARKERS_CONTAINER);e.title=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.marker.partial.tooltip");this.updateHeight_(b);var g=c.getHighlights();g.sort(function(n,o){if(n.isWholePage()&&o.isWholePage())return 0;if(n.isWholePage())return-1;if(o.isWholePage())return 1;var p=n.getBoundingBox(),
r=o.getBoundingBox();if(!p&&!r)return 0;if(!p)return 1;if(!r)return-1;if(p.top<r.top)return-1;if(p.top>r.top)return 1;return 0});this.markersArray_=[];var h=0,i;for(i=[];g[h]&&g[h].isWholePage();){i.push(g[h]);h++}if(i.length>0){d=d.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.WP_MARKER);d.title=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.marker.wholepage.tooltip");i=new GTB_SidewikiMarker(d,i);this.markersArray_.push(i);this.markersListenerManager_.addListener(d,"click",
BindToObject(this.onMarkerClickHandler_,this,i,GTB_SidewikiRenderInterface.WHOLE_PAGE_ENTRY_ID),true)}for(;i=g[h];++h){if(!i.getBoundingBox())break;d=e.cloneNode(true);d.id="sidewikiMarker-"+i.getEntryId();d.style.top=Math.max(this.getMarkersContainerRange_().top,i.getBoundingBox().top)+"px";f.appendChild(d);var j=new GTB_SidewikiMarker(d,[i]),k=i;this.markersArray_.push(j);for(h=h+1;i=g[h];++h){var l=j.getBoundingBox(),m=i.getBoundingBox();if(!i.getBoundingBox())break;if(m.top>l.bottom)break;j.addRelatedHighlight(i)}h=
h-1;this.markersListenerManager_.addListener(d,"click",BindToObject(this.onMarkerClickHandler_,this,j,k.getEntryId()),true);this.markersListenerManager_.addListener(d,"mouseover",BindToObject(c.addPointedHighlights,c,j.getRelatedHighlights()),true);this.markersListenerManager_.addListener(d,"mouseout",BindToObject(c.removePointedHighlights,c,j.getRelatedHighlights()),true)}new G_Alarm(BindToObject(this.onScrollHandler_,this),0)};
a.removeMarkers_=function(){this.markersListenerManager_.removeAllListeners();for(var b,c=0;b=this.markersArray_[c];c++){b=b.getTargetObject();b.style.display="none"}c=this.minibarBrowser_.contentDocument;if(c=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MARKERS_CONTAINER))for(;c.firstChild;)c.removeChild(c.firstChild);this.markersArray_=[];this.onScrollHandler_()};
a.setupListenters_=function(){this.listenerManager_.addListener(this.topLevelDocument_,"mousemove",BindToObject(this.onMouseMove_,this),true);this.listenerManager_.addListener(this.topLevelDocument_,"mouseup",BindToObject(this.onTextSelection_,this),true);this.listenerManager_.addListener(this.topLevelDocument_,"keyup",BindToObject(this.onTextSelection_,this),true);this.listenerManager_.addListener(this.topLevelDocument_,"scroll",BindToObject(this.onScrollHandler_,this),true);this.listenerManager_.addListener(this.topLevelDocument_,
"resize",BindToObject(this.onResizeHandler_,this),true);this.listenerManager_.addListener(this.minibarBrowser_,"click",BindToObject(this.onPanelClickHandler_,this),true);this.listenerManager_.addListener(this.minibar_,"mousedown",BindToObject(this.onPanelMouseDownHandler_,this),true)};
a.onPanelClickHandler_=function(b){GTB_SidewikiLogger.logDomElement(b.target);if(b.button==0){var c=this.minibarBrowser_.contentDocument,d=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.WRITE_ICON),e=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.CHEVRON),f=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.ARROW_UP);c=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.ARROW_DOWN);if(b.target==d){GTB_SidewikiLogger.logData("write_annotation_click");this.onWriteClickCallback_()}else if(b.target==
e){GTB_SidewikiLogger.logData("minibar_chevron_click");this.isSidebarOpened_?this.onCloseClickCallback_():this.onViewClickCallback_()}else if(b.target==f){GTB_SidewikiLogger.logData("arrow_up_click");this.onArrowUpClick_()}else if(b.target==c){GTB_SidewikiLogger.logData("arrow_down_click");this.onArrowDownClick_()}if(this.notificationTimer_){this.notificationTimer_.cancel();this.notificationTimer_=null}}};
a.onPanelMouseDownHandler_=function(b){GTB_SidewikiLogger.logDomElement(b.target);if(b.button==0){b.preventDefault();var c=this.minibarBrowser_.contentDocument,d=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.GRIPPER),e=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.RESIZER);c=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.CHEVRON);if((b.target==d||b.target==e||b.target==c)&&this.isSidebarOpened_&&this.onStartResizingCallback_)this.onStartResizingCallback_(b)}};
a.onArrowUpClick_=function(){var b=this.topLevelDocument_.getElementById("content"),c=this.minibarBrowser_.contentWindow.scrollY+this.getMarkersContainerRange_().top;b=b.boxObject.height/2;for(var d=null,e,f=0;e=this.markersArray_[f];++f)if(!e.isWholePage())if((e=e.getBoundingBox())&&e.bottom<c&&(!d||d.top<e.top))d=e;this.showBox_(d,b)};
a.onArrowDownClick_=function(){var b=this.topLevelDocument_.getElementById("content"),c=this.minibarBrowser_.contentWindow.scrollY+this.getMarkersContainerRange_().bottom;b=b.boxObject.height/2;for(var d=null,e,f=0;e=this.markersArray_[f];++f)if(!e.isWholePage())if((e=e.getBoundingBox())&&e.top>c&&(!d||d.top>e.top))d=e;this.showBox_(d,b)};a.showBox_=function(b,c){if(b){this.scrollingTimer_&&this.scrollingTimer_.cancel();this.scrollingTimer_=this.smoothScrollTo_(b,c,GTB_SidewikiMarkerPanel.Props_.SCROLLING_TIME)}};
a.getMarkerByHighlight_=function(b){for(var c,d=0;c=this.markersArray_[d];++d)for(var e=c.getRelatedHighlights(),f,g=0;f=e[g];++g)if(b==f)return c;return null};
a.onScrollHandler_=function(){var b=this.highlightedDoc_&&this.highlightedDoc_.defaultView,c=this.minibarBrowser_.contentDocument,d=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.ARROW_UP),e=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.ARROW_DOWN);if(b&&c&&c.body){c=b.scrollY;this.minibarBrowser_.contentWindow.scrollTo(0,c);var f=this.getMarkersContainerRange_();b=c+f.top;c=c+f.bottom;for(var g=f=0,h,i=0;h=this.markersArray_[i];++i)if(!h.isWholePage()){var j=h.getBoundingBox();if(j)if(j.bottom<
b)f+=h.getRelatedHighlightsNum();else if(j.top>c)g+=h.getRelatedHighlightsNum()}d.textContent=f;e.textContent=g;d.style.display=f>0?"":"none";e.style.display=g>0?"":"none";d.title=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.arrow.up.tooltip");e.title=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.arrow.down.tooltip")}else{d.style.display="none";e.style.display="none"}};
a.updateHeight_=function(b){if(this.updateHeightTimer_){this.updateHeightTimer_.cancel();this.updateHeightTimer_=null}var c=this.minibarBrowser_.contentDocument;b=b||this.highlightedDoc_;var d;if(b=b&&b.defaultView)d=b.innerHeight+b.scrollMaxY;else try{d=this.topLevelWindow_&&this.topLevelWindow_.innerHeight}catch(e){d=0}if(c&&c.body&&d!=this.height_){this.height_=d;b=c.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.MARKERS_CONTAINER);c.body.style.height=d+"px";b.style.height=d+"px";this.onScrollHandler_();
this.updateWriteIcon_()}this.updateHeightTimer_=new G_Alarm(BindToObject(this.updateHeight_,this),GTB_SidewikiMarkerPanel.Props_.UPDATE_HEIGHT_TIME)};
a.updatePanelElements_=function(){var b=this.minibarBrowser_.contentDocument,c=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.CHEVRON);if(this.isSidebarOpened_){c.className=GTB_SidewikiMarkerPanel.Classes_.CHEVRON_CLOSE;c.title=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.chevron.close.tooltip")}else if(!this.isSidebarOpened_&&this.sidewikiMode_==GTB_SidewikiMarkerPanel.SidewikiModes.SIDEWIKI_NA){c.className=GTB_SidewikiMarkerPanel.Classes_.CHEVRON_DISABLED;c.title=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.chevron.na.tooltip")}else{c.className=
GTB_SidewikiMarkerPanel.Classes_.CHEVRON_OPEN;c.title=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.chevron.open.tooltip")}c=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.ARROW_UP);var d=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.ARROW_DOWN),e=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.GRIPPER);b=b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.RESIZER);if(this.isSidebarOpened_){e.style.display="";b.style.cursor="e-resize"}else{e.style.display="none";
b.style.cursor=""}for(e=0;b=this.markersArray_[e];++e)b.setState(this.defaultMarkersState_);if(this.defaultMarkersState_==GTB_SidewikiMarker.States.ENABLED){c.className="";d.className=""}else{c.className=GTB_SidewikiMarkerPanel.Classes_.ARROW_DISABLED;d.className=GTB_SidewikiMarkerPanel.Classes_.ARROW_DISABLED}(c=this.getMarkerByHighlight_(this.highlightList_&&this.highlightList_.getActiveHighlight()))&&c.setState(GTB_SidewikiMarker.States.ACTIVE)};
a.onResizeHandler_=function(){var b=this.highlightedDoc_&&this.highlightedDoc_.defaultView;this.highlightList_&&this.highlightList_.updateBoundingBoxes();if(b&&this.markersArray_.length>0){var c=b.innerWidth;b=b.innerHeight;if(!(c==this.highlightedDocSize_.width&&b==this.highlightedDocSize_.height)){this.highlightedDocSize_.width=c;this.highlightedDocSize_.height=b;this.removeMarkers_();this.setupMarkers_(this.highlightedDoc_,this.highlightList_);this.updatePanelElements_()}}else this.updateHeight_()};
a.calcMinOffset_=function(b,c,d,e){b=b;if(e>c)b+=e-c;if(d<b)b=d;return b};a.onMouseMove_=function(b){this.mouseY_=b.pageY};a.onTextSelection_=function(){new G_Alarm(BindToObject(this.updateWriteIcon_,this),10)};
a.updateWriteIcon_=function(){var b=this.minibarBrowser_.contentDocument,c=b&&b.getElementById(GTB_SidewikiMarkerPanel.ElementIds_.WRITE_ICON);b=GTB_SidewikiUtil.getInstance().getSelectionText(this.highlightedDoc_);if(this.sidewikiMode_==GTB_SidewikiMarkerPanel.SidewikiModes.SIDEWIKI_NA||this.isSidebarOpened_&&this.sidewikiMode_==GTB_SidewikiMarkerPanel.SidewikiModes.SIDEWIKI_WRITE){this.defaultMarkersState_=GTB_SidewikiMarker.States.ENABLED;this.writeIconOverlay_.close();c.style.display="none";this.updatePanelElements_();
this.selectedText_=b}else{var d,e;if(b)if(this.selectedText_!=b){this.defaultMarkersState_=GTB_SidewikiMarker.States.DISABLED;d=this.mouseY_;e=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.write.partial.tooltip")}else{this.updatePanelElements_();return}else{this.defaultMarkersState_=GTB_SidewikiMarker.States.ENABLED;d=this.height_;e=this.stringBundle_.GetStringFromName("prop.gtb.sidewiki.minibar.write.wholepage.tooltip")}if(this.minibar_.collapsed){c.style.display="none";c={top:d,
tooltip:e};(d=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.MINIBAR_ENABLED,true))?this.writeIconOverlay_.open(c):this.writeIconOverlay_.close()}else{this.writeIconOverlay_.close();c.style.display="";var f=GTB_SidewikiDOM.getBoxObjectFor(c),g=this.minibarBrowser_.contentWindow.scrollY,h=this.getMarkersContainerRange_();c.style.top=Math.max(g+h.top,d-f.height)+"px";c.title=e}this.selectedText_=b;this.updatePanelElements_()}};
a.onMarkerClickHandler_=function(b,c,d){GTB_SidewikiLogger.logData("marker_click",c);GTB_SidewikiLogger.logDomElement(d.target);this.onMarkerClickCallback_&&this.onMarkerClickCallback_(c);this.highlightList_.removePointedHighlights(b.getRelatedHighlights())};
a.smoothScrollTo_=function(b,c,d,e){function f(){var n=Math.min(Date.now()-m,l),o=n/l,p=Math.round((k.scrollX-j.scrollX)*o);o=Math.round((k.scrollY-j.scrollY)*o);p=j.scrollX+p;o=j.scrollY+o;h.scrollTo(p,o);if(n>=l){e&&e();return true}return false}var g=Number(this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.SCROLL_SPEED));if(!isFinite(g)||g<=0)g=1;var h=this.highlightedDoc_&&this.highlightedDoc_.defaultView,i=this.calcMinOffset_(h.scrollX,h.scrollX+h.innerWidth,b.left,b.right);b=
b.top-c;var j={scrollX:h.scrollX,scrollY:h.scrollY},k={scrollX:i,scrollY:b};i=Math.max(Math.abs(j.scrollX-k.scrollX),Math.abs(j.scrollY-k.scrollY));var l=d||0;l=Math.min(Math.round(i/g),l);l=Math.max(l,1);var m=Date.now();return new G_ConditionalAlarm(f,10,true)};function GTB_SidewikiMarker(b,c){this.debugZone="GTB_SidewikiMarker";if(!(c.length<1)){this.isWholePage_=c[0].isWholePage();for(var d=1;d<c.length;d++)if(this.isWholePage_!=c[d].isWholePage())return;this.targetObject_=b;this.relatedHighlights_=c.splice(0);this.boundingBox_=null;this.state_=GTB_SidewikiMarker.States.ENABLED;this.updateState_()}}GTB_SidewikiMarker.States={ACTIVE:2,ENABLED:1,DISABLED:0};
GTB_SidewikiMarker.Classes_={ACTIVE:"marker-active",ENABLED:"marker",DISABLED:"marker-disabled",SINGLE:"marker-single",MULTIPLE:"marker-multiple"};GTB_SidewikiMarker.HEIGHT_SINGLE_=15;GTB_SidewikiMarker.HEIGHT_MULTIPLE_=20;a=GTB_SidewikiMarker.prototype;a.isWholePage=function(){return this.isWholePage_};a.addRelatedHighlight=function(b){if(this.isWholePage_==b.isWholePage()){this.relatedHighlights_.push(b);this.boundingBox_=null;this.updateState_()}};a.getRelatedHighlights=function(){return this.relatedHighlights_.slice(0)};
a.getRelatedHighlightsNum=function(){return this.relatedHighlights_.length};a.setState=function(b){this.state_=b;this.updateState_()};a.getState=function(){return this.state_};a.getTargetObject=function(){return this.targetObject_};a.getBoundingBox=function(){if(!this.boundingBox_){var b=GTB_SidewikiDOM.getBoxObjectFor(this.targetObject_),c=this.relatedHighlights_.length>1?GTB_SidewikiMarker.HEIGHT_MULTIPLE_:GTB_SidewikiMarker.HEIGHT_SINGLE_;this.boundingBox_={left:0,right:0,top:b.y,bottom:b.y+c}}return this.boundingBox_};
a.updateState_=function(){this.targetObject_.style.display="";var b=this.relatedHighlights_.length>1?GTB_SidewikiMarker.Classes_.MULTIPLE:GTB_SidewikiMarker.Classes_.SINGLE;b+=" ";b+=GTB_SidewikiMarker.States.ACTIVE==this.state_?GTB_SidewikiMarker.Classes_.ACTIVE:GTB_SidewikiMarker.States.DISABLED==this.state_?GTB_SidewikiMarker.Classes_.DISABLED:GTB_SidewikiMarker.Classes_.ENABLED;this.targetObject_.className=b};function GTB_SidewikiOverlayObject(b,c){this.debugZone="GTB_SidewikiOverlayObject";this.geometry_=b;this.overlayElm_=c;this.loadTimer_=null;this.overlayElm_.style.width=0;this.overlayElm_.style.height=0;this.overlayElm_.collapsed=true}GTB_SidewikiOverlayObject.overlayObjectProps_={MAX_OPEN_ATTEMPTS_NUM:128,OPEN_LATENCY_TIME:100,DRAW_IN_TIME:0,DRAW_OUT_TIME:0};GTB_SidewikiOverlayObject.zIndex=0;a=GTB_SidewikiOverlayObject.prototype;a.getOverlayElement=function(){return this.overlayElm_};
a.getDrawInTime=function(){return GTB_SidewikiOverlayObject.overlayObjectProps_.DRAW_IN_TIME};a.getDrawOutTime=function(){return GTB_SidewikiOverlayObject.overlayObjectProps_.DRAW_OUT_TIME};a.getMaxOverlayBoxSize=function(){return this.geometry_.getAvailableBoxSize()};a.getOverlayBoxSize=function(){return null};a.isOpened=function(){return!this.overlayElm_.collapsed&&!this.overlayElm_.hidden};a.open=function(){};a.close=function(){this.drawOutInternal();this.resetTimersInternal()};
a.onWindowResize=function(){if(this.isOpened()){var b=this.getOverlayBoxSize();this.setPositionInternal(b)}};a.resetTimersInternal=function(){if(this.loadTimer_){this.loadTimer_.cancel();this.loadTimer_=null}};
a.loadFrameContentInternal=function(){if(this.loadTimer_){this.loadTimer_.cancel();this.loadTimer_=null}this.isOpened()&&this.close();this.overlayElm_.hidden=false;this.overlayElm_.style.display="block";if(this.initOverlayObjectInternal())this.drawInInternal();else{var b=this;this.loadTimer_=new G_ConditionalAlarm(function(){b.overlayElm_.hidden=false;b.overlayElm_.style.display="block";if(b.initOverlayObjectInternal()){b.drawInInternal();return true}return false},GTB_SidewikiOverlayObject.overlayObjectProps_.OPEN_LATENCY_TIME,
true,GTB_SidewikiOverlayObject.overlayObjectProps_.MAX_OPEN_ATTEMPTS_NUM)}};a.initOverlayObjectInternal=function(){return true};a.drawInInternal=function(){if(!this.overlayElm_.hidden){this.setPositionInternal(this.getOverlayBoxSize());this.overlayElm_.collapsed=false;this.drawInCompleteInternal()}};a.drawOutInternal=function(){this.overlayElm_.collapsed=true;this.drawOutCompleteInternal()};a.drawInCompleteInternal=function(){};a.drawOutCompleteInternal=function(){};
a.setPositionInternal=function(b){this.overlayElm_.style.left=b.left+"px";this.overlayElm_.style.top=b.top+"px";this.overlayElm_.style.width=b.width+"px";this.overlayElm_.style.height=b.height+"px"};a.increaseZIndex_=function(){this.overlayElm_.style.zIndex=++GTB_SidewikiOverlayObject.zIndex};function GTB_SidewikiPerTabDataStorage(b,c){this.debugZone="GTB_SidewikiPerTabDataStorage";this.tabBrowser_=b;this.createTabDataInstance_=c;this.numOfCreatedStorages_=0;this.keyName_="GTB_SidewikiPerTabDataStorage__data__"+ ++GTB_SidewikiPerTabDataStorage.id_;this.onBrowserUnloadHandler_=BindToObject(this.onBrowserUnload_,this);this.onDestroyHandler_=BindToObject(this.onDestroy_,this);var d=this.tabBrowser_.mTabBox;this.onLoadHandler_=GTB_AddEventListener(d,"load",this.onLoad_,this);d=d.ownerDocument.defaultView;
d.addEventListener("unload",this.onDestroyHandler_,false)}GTB_SidewikiPerTabDataStorage.id_=0;a=GTB_SidewikiPerTabDataStorage.prototype;a.getTabData=function(b){if(!b)return null;this.initTabOnDemand_(b);return b[this.keyName_]};a.getSelectedTabData=function(){if(!this.tabBrowser_)return null;return this.getTabData(this.tabBrowser_.selectedBrowser)};
a.getTabDataByDocument=function(b){if(!this.tabBrowser_||!b)return null;var c=this.tabBrowser_.selectedBrowser;if(!GTB_SidewikiUtil.getInstance().windowContainsDocument(c,b)){c=null;for(var d=this.tabBrowser_.browsers,e=0;e<d.length;++e)if(GTB_SidewikiUtil.getInstance().windowContainsDocument(d[e].contentWindow,b)){c=d[e];break}}if(c){this.initTabOnDemand_(c);return c[this.keyName_]}return null};
a.initTabOnDemand_=function(b){if(!(this.keyName_ in b))for(var c=this.tabBrowser_.browsers,d=0;d<c.length;++d)if(b==c[d]){b[this.keyName_]=this.createTabDataInstance_&&this.createTabDataInstance_()||{};this.numOfCreatedStorages_++;b.addEventListener("unload",this.onBrowserUnloadHandler_,true);return}};a.onLoad_=function(b){(b=b.target)&&b.nodeName=="#document"&&this.getTabDataByDocument(b)};
a.onBrowserUnload_=function(b){b=b.currentTarget;if(this.tabBrowser_&&b){var c=this.tabBrowser_.browsers;if(this.numOfCreatedStorages_>c.length&&this.keyName_ in b){for(var d=0;d<c.length;++d)if(b==c[d])return;delete b[this.keyName_];this.numOfCreatedStorages_--;b.removeEventListener("unload",this.onBrowserUnloadHandler_,true)}}};
a.onDestroy_=function(){var b=this.tabBrowser_&&this.tabBrowser_.mTabBox;if(b){b.removeEventListener("load",this.onLoadHandler_,true);b=b.ownerDocument.defaultView;b.removeEventListener("unload",this.onDestroyHandler_,false)}this.onDestroyHandler_=this.onBrowserUnloadHandler_=this.onLoadHandler_=this.tabBrowser_=null};function GTB_SidewikiRenderInterface(b){GTB_SidewikiClientInterface.call(this,b);this.debugZone="GTB_SidewikiRenderInterface";this.listenerManager_=new GTB_SidewikiListenerManager;if(b=this.getClientObject()){this.currentTabData_=null;if(!GTB_SidewikiRenderInterface.WHOLE_PAGE_ENTRY_ID)GTB_SidewikiRenderInterface.WHOLE_PAGE_ENTRY_ID=b._GTA_WHOLE_PAGE_ANNOTE_ID||"";if(!GTB_SidewikiRenderInterface.VIEW_MODE)GTB_SidewikiRenderInterface.VIEW_MODE=b._GTA_MODES_VIEWER;if(!GTB_SidewikiRenderInterface.EDIT_MODE)GTB_SidewikiRenderInterface.EDIT_MODE=
b._GTA_MODES_EDITOR;this.ON_URL_CLICK_=b._GTA_EVENTS_ON_URL_CLICK||"";this.ON_SIGN_IN_URL_CLICK_=b._GTA_EVENTS_ON_SIGN_IN_URL_CLICK||"";this.ON_SEND_ENTRY_=b._GTA_EVENTS_ON_SEND_REMARK||"";this.ON_ACTIVE_ENTRY_CHANGE_=b._GTA_EVENTS_ON_ACTIVE_ANNOTATION_CHANGED||"";this.ON_DATA_UPDATE_=b._GTA_EVENTS_ON_DATA_UPDATE||"";this.ON_MODE_CHANGE_=b._GTA_EVENTS_ON_MODE_CHANGE||"";this.HIDE_MINIBAR_=b._GTA_EVENTS_ON_HIDE_MINIBAR||"";this.ON_CLOSE_=b._GTA_EVENTS_ON_CLOSE||""}}GTB_SidewikiRenderInterface.inherits(GTB_SidewikiClientInterface);
GTB_SidewikiRenderInterface.WHOLE_PAGE_ENTRY_ID=null;GTB_SidewikiRenderInterface.VIEW_MODE=null;GTB_SidewikiRenderInterface.EDIT_MODE=null;a=GTB_SidewikiRenderInterface.prototype;a.setOnUrlClickCallback=function(b){this.onUrlClickCallback_=b};a.setOnSignInUrlClickCallback=function(b){this.onSignInUrlClickCallback_=b};a.setOnSendEntryCallback=function(b){this.onSendEntryCallback_=b};a.setOnDataUpdateCallback=function(b){this.onDataUpdateCallback_=b};
a.setOnModeChangeCallback=function(b){this.onModeChangeCallback_=b};a.setOnDisableMinibarCallback=function(b){this.onDisableMinibarCallback_=b};a.setOnCloseCallback=function(b){this.onCloseCallback_=b};a.setActiveEntryChangeCallback=function(b){this.onActiveEntryChangeCallback_=b};
a.initClient=function(b){if(!b)return false;var c=this.getClientObject(),d=this.getEventTarget();if(!c||!d)return false;this.listenerManager_.removeAllListeners();this.listenerManager_.addListener(d,this.ON_CLOSE_,BindToObject(this.onCloseButtonClick_,this),true);this.listenerManager_.addListener(d,this.ON_URL_CLICK_,BindToObject(this.onUrlClick_,this),true);this.listenerManager_.addListener(d,this.ON_SIGN_IN_URL_CLICK_,BindToObject(this.onSignInUrlClick_,this),true);this.listenerManager_.addListener(d,
this.ON_SEND_ENTRY_,BindToObject(this.onSendEntries_,this),true);this.listenerManager_.addListener(d,this.ON_ACTIVE_ENTRY_CHANGE_,BindToObject(this.onActiveEntryChange_,this),true);this.listenerManager_.addListener(d,this.ON_DATA_UPDATE_,BindToObject(this.onDataUpdate_,this),true);this.listenerManager_.addListener(d,this.ON_MODE_CHANGE_,BindToObject(this.onModeChange_,this),true);this.listenerManager_.addListener(d,this.HIDE_MINIBAR_,BindToObject(this.onDisableMinibar_,this),true);d=b.getEntriesUrl();
var e=GTB_SidewikiUrlDataCache.getInstance().getUrlData(d);GTB_SidewikiClientInterface.safeCall(c,"_setServerBaseUrl",GTB_SidewikiApplication.getInstance().getServerUrlInUse());GTB_SidewikiClientInterface.safeCall(c,"_setUrl",d);GTB_SidewikiClientInterface.safeCall(c,"_setUrlData",e);GTB_SidewikiClientInterface.safeCall(c,"_setMode",b.getClientMode());GTB_SidewikiClientInterface.safeCall(c,"_setContextData",b.getClientContext());GTB_SidewikiClientInterface.safeCall(c,"_updatePageTitle",b.getPageTitle());
GTB_SidewikiClientInterface.safeCall(c,"_setSelectionText",b.getSelectionText());GTB_SidewikiClientInterface.safeCall(c,"_setShowRelatedInfo",b.getShowRelated());GTB_SidewikiClientInterface.safeCall(c,"_setOtherDomainsContentEstateSize",b.getOtherDomainsContentEstateSize());GTB_SidewikiClientInterface.safeCall(c,"_display");this.currentTabData_=b;b=this.getDataConverter();c=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(c,"_getActiveAnnotation"));this.onActiveEntryChangeCallback_&&this.onActiveEntryChangeCallback_(c&&
c.annoteId,false);return true};a.updatePageTitle=function(b){var c=this.getClientObject();c&&GTB_SidewikiClientInterface.safeCall(c,"_updatePageTitle",b)};a.updateOtherDomainsContentEstateSize=function(b){var c=this.getClientObject();c&&GTB_SidewikiClientInterface.safeCall(c,"_setOtherDomainsContentEstateSize",b)};a.updateSelectionText=function(b){var c=this.getClientObject();c&&GTB_SidewikiClientInterface.safeCall(c,"_setSelectionText",b)};
a.setMode=function(b){GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_setMode",b)};a.getMode=function(){return GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getMode")};a.setActiveEntry=function(b){GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_setActiveAnnotation",b)};a.getActiveEntry=function(){var b=this.getDataConverter();return b=(b=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getActiveAnnotation")))&&b.annoteId};
a.updateContext=function(){if(this.currentTabData_){var b=this.getClientObject();this.currentTabData_.setClientContext(GTB_SidewikiClientInterface.safeCall(b,"_getContextData"));this.currentTabData_.setClientMode(GTB_SidewikiClientInterface.safeCall(b,"_getMode"))}};a.hideClient=function(){this.listenerManager_.removeAllListeners();GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_hide")};a.destroy=function(){this.hideClient();GTB_SidewikiRenderInterface.superClass_.destroy.call(this)};
a.onUrlClick_=function(){var b=this.getDataConverter();b=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getUrlsToOpen"));for(var c=0;c<b.length;c++){var d=b[c];this.onUrlClickCallback_&&this.onUrlClickCallback_(d.url,d.buttonId)}};a.onSignInUrlClick_=function(){this.onSignInUrlClickCallback_&&this.onSignInUrlClickCallback_()};
a.onSendEntries_=function(){var b=this.getDataConverter();b=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getAnnotationsToSend"));for(var c=0;c<b.length;c++){var d=b[c];this.onSendEntryCallback_&&this.onSendEntryCallback_(d)}};
a.onActiveEntryChange_=function(){var b=this.getDataConverter();b=b.convertToInternal(GTB_SidewikiClientInterface.safeCall(this.getClientObject(),"_getActiveAnnotation"));this.onActiveEntryChangeCallback_&&this.onActiveEntryChangeCallback_(b&&b.annoteId,true)};a.onDataUpdate_=function(){var b=this.getClientObject(),c=GTB_SidewikiClientInterface.safeCall(b,"_getUrl");b=GTB_SidewikiClientInterface.safeCall(b,"_getUrlData");this.onDataUpdateCallback_&&this.onDataUpdateCallback_(c,b)};
a.onModeChange_=function(){this.onModeChangeCallback_&&this.onModeChangeCallback_()};a.onDisableMinibar_=function(){this.onDisableMinibarCallback_&&this.onDisableMinibarCallback_()};a.onCloseButtonClick_=function(){this.onCloseCallback_&&this.onCloseCallback_()};function GTB_SidewikiSideBar(b,c,d,e){var f=b.getElementById(GTB_SidewikiSideBar.ElementIds_.SIDEBAR),g=b.getElementById(GTB_SidewikiSideBar.ElementIds_.SIDEBAR_RESIZER);GTB_SidewikiMainPanel.call(this,b,c,f,g,d);this.sidewikiPrefs_=new G_Preferences(GTB_SidewikiApplication.SIDEWIKI_PREF_GROUP,false,true);this.resizeOffset_=0;this.barsContainer_=e;this.debugZone="GTB_SidewikiSideBar"}GTB_SidewikiSideBar.inherits(GTB_SidewikiMainPanel);GTB_SidewikiSideBar.Props_={DEFAULT_WIDTH:340,MIN_WIDTH:275};
GTB_SidewikiSideBar.ElementIds_={SIDEBAR:"sidewiki-sidebar",SIDEBAR_RESIZER:"sidewiki-sidebar-resizer"};a=GTB_SidewikiSideBar.prototype;a.getOverlayBoxSize=function(){var b=this.getMaxOverlayBoxSize(),c=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.SIDEBAR_WIDTH);c=Number(c)||GTB_SidewikiSideBar.Props_.DEFAULT_WIDTH;var d={};d.left=0;d.top=0;d.width=Math.min(c,b.width);d.height=b.height;return d};
a.onStartResizing=function(b){if(!b||typeof b.screenX!="number")this.resizeOffset_=0;else{var c=this.getOverlayElement(),d=c.boxObject.screenX;this.resizeOffset_=b.screenX-d-c.boxObject.width}this.onStartResizingInternal()};a.isOpened=function(){var b=GTB_SidewikiDOM.getBoxObjectFor(this.getOverlayElement());return GTB_SidewikiSideBar.superClass_.isOpened.call(this)&&b.width>0};a.open=function(b){var c=this.getRenderInterfaceInternal();c.initClient(b);this.isOpened()||this.drawInInternal()};
a.close=function(){if(this.isOpened()){GTB_SidewikiSideBar.superClass_.close.call(this);this.onResizingFinishInternal();var b=this.getOverlayElement();this.barsContainer_.changeWidthBy(-b.boxObject.width);this.barsContainer_.delayedRedraw();b.style.minWidth=0;b.style.width=0}};a.drawInCompleteInternal=function(){this.barsContainer_.changeWidthBy(this.getOverlayElement().boxObject.width);this.barsContainer_.delayedRedraw();GTB_SidewikiSideBar.superClass_.drawInCompleteInternal.call(this)};
a.onResizingInternal=function(b){var c=this.getOverlayElement(),d=c.boxObject.width,e=c.boxObject.screenX;b=b.screenX-e-this.resizeOffset_;b=Math.max(b,GTB_SidewikiSideBar.Props_.MIN_WIDTH);this.barsContainer_.changeWidthBy(b-d);this.barsContainer_.redraw();c.style.width=b+"px";this.sidewikiPrefs_.setPref(GTB_SidewikiApplication.FIREFOX_PREFS.SIDEBAR_WIDTH,b)};function GTB_SidewikiSubstringFinder(){this.debugZone="GTB_SidewikiSubstringFinder";this.nodeValuesPurified_=this.nodeValues_=null}GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_="\\s\\^\\$\\.\\*\\+\\?\\=\\!\\:\\|\\\\\\/\\(\\)\\[\\]\\{\\}\\-_,'\";<>";GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_REGEX_=RegExp("["+GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_+"]+","g");GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_AT_HEAD_REGEX_=RegExp("^["+GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_+"]+");
GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_AT_TAIL_REGEX_=RegExp("["+GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_+"]+$");GTB_SidewikiSubstringFinder.PREFIX_LENGTH_=128;a=GTB_SidewikiSubstringFinder.prototype;a.initialize=function(b){this.clear();this.nodeValues_=b;this.nodeValuesPurified_=[];b=0;for(var c=this.nodeValues_.length;b<c;++b)this.nodeValuesPurified_.push(this.purifyText_(this.nodeValues_[b]))};
a.getSubstringRange=function(b,c){if(!this.nodeValues_)return null;var d=this.purifyText_(b);return this.find_(this.nodeValues_,this.nodeValuesPurified_,b,d,Math.max(1,c||1))};a.clear=function(){this.nodeValuesPurified_=this.nodeValues_=null};a.purifyText_=function(b){var c=GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_REGEX_;return b.replace(c,"").toLowerCase()};
a.find_=function(b,c,d,e,f){var g=c.join("");if(!e){e=d.replace(/\s+/g,"");if(!e)return null;return null}var h="",i=GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_AT_HEAD_REGEX_;if(i=i.exec(d))h=i[0].replace(/\s+/g,"");i="";var j=GTB_SidewikiSubstringFinder.IGNORABLE_SYMBOLS_AT_TAIL_REGEX_;if(d=j.exec(d))i=d[0].replace(/\s+/g,"");var k=-1;d=e.length>GTB_SidewikiSubstringFinder.PREFIX_LENGTH_?e.substr(0,GTB_SidewikiSubstringFinder.PREFIX_LENGTH_):e;for(k=g.indexOf(d);--f>0&&k>=0;){j=g.indexOf(d,k+d.length);
if(j<0)break;else k=j}if(k<0)return null;g=f=-1;j=d=0;var l=-k;for(k=0;k<b.length;++k){l+=c[k].length;if(f==-1&&l>0){f=k;var m=b[k].toLowerCase(),n=c[k].length-l;d=m.length;for(var o=c[k].length-1;o>=n;--o)for(;m[--d]!=c[k][o];)if(d<=0)break;o=f;n=d-1;for(var p=h.length-1;p>=0;){if(n<0){if(--o<0)break;n=b[o].length-1}for(m=b[o];n>=0&&p>=0;){if(m[n]==h[p]){f=o;d=n;--p}else if(!/\s/.test(m[n])){p=-1;break}--n}}}if(l>=e.length){g=k;j=-1;m=b[k].toLowerCase();e=e.length+c[k].length-l;for(o=0;o<e;++o)for(;m[++j]!=
c[k][o];)if(j>=m.length)break;if(++j>=m.length){++g;j=0}c=g;e=j;for(h=0;h<i.length;){if(c>=b.length)break;for(m=b[c];e<m.length&&h<i.length;){if(m[e]==i[h]){g=c;j=e+1;if(j>=m.length){++g;j=0}++h}else if(!/\s/.test(m[e])){h=i.length;break}++e}if(e>=m.length){++c;e=0}}break}}if(f==-1||f>g)return null;return{startNode:f,startOffset:d,endNode:g,endOffset:j}};function GTB_SidewikiTabData(){this.debugZone="GTB_SidewikiTabData";this.isNotificationShown_=this.isSidebarOpened_=this.isPageLoaded_=false;this.otherDomainsEstateSize_=0;this.showRelated_=false;this.clientMode_=0;this.selectionText_=this.pageTitle_=this.entriesUrl_=this.pageUrl_="";this.highlightList_=null}a=GTB_SidewikiTabData.prototype;a.getIsPageLoaded=function(){return this.isPageLoaded_};a.setIsPageLoaded=function(b){this.isPageLoaded_=b};a.getIsSidebarOpened=function(){return this.isSidebarOpened_};
a.setIsSidebarOpened=function(b){this.isSidebarOpened_=b};a.getIsNotificationShown=function(){return this.isNotificationShown_};a.setIsNotificationShown=function(b){this.isNotificationShown_=b};a.getOtherDomainsContentEstateSize=function(){return this.otherDomainsEstateSize_};a.setOtherDomainsContentEstateSize=function(b){this.otherDomainsEstateSize_=b};a.getShowRelated=function(){return this.showRelated_};a.setShowRelated=function(b){this.showRelated_=b};a.getClientMode=function(){return this.clientMode_};
a.setClientMode=function(b){this.clientMode_=b};a.getPageUrl=function(){return this.pageUrl_};a.setPageUrl=function(b){this.pageUrl_=b||""};a.getEntriesUrl=function(){return this.entriesUrl_};a.setEntriesUrl=function(b){this.entriesUrl_=b||""};a.getPageTitle=function(){return this.pageTitle_};a.setPageTitle=function(b){this.pageTitle_=b};a.getSelectionText=function(){return this.selectionText_};a.setSelectionText=function(b){this.selectionText_=b};a.getHighlightList=function(){return this.highlightList_};
a.setHighlightList=function(b){this.highlightList_=b};a.getClientContext=function(){return this.clientContext_};a.setClientContext=function(b){this.clientContext_=b};function GTB_SidewikiUrlDataCache(){this.debugZone="GTB_SidewikiUrlDataCache";this.canonicalUrlCache_={};this.urlDataCache_={};this.urlsNum_=0;this.lastSweepTime_=Date.now()}GTB_SidewikiUrlDataCache.MAX_URLS_NUM_=1024;GTB_SidewikiUrlDataCache.MAX_SWEEP_INT_=72E5;GTB_SidewikiUrlDataCache.MIN_SWEEP_INT_=3E5;GTB_SidewikiUrlDataCache.EXP_TIME_=864E5;GTB_SidewikiUrlDataCache.cacheInstance_=null;
GTB_SidewikiUrlDataCache.getInstance=function(){if(!GTB_SidewikiUrlDataCache.cacheInstance_)GTB_SidewikiUrlDataCache.cacheInstance_=new GTB_SidewikiUrlDataCache;return GTB_SidewikiUrlDataCache.cacheInstance_};a=GTB_SidewikiUrlDataCache.prototype;a.putCanonicalUrl=function(b,c){b&&!this.canonicalUrlCache_[b]&&this.urlsNum_++;this.canonicalUrlCache_[b]=c};a.getCanonicalUrl=function(b){return b&&this.canonicalUrlCache_[b]||null};
a.putUrlData=function(b,c,d){if(b&&c){this.putCanonicalUrl(b,c);this.urlDataCache_[c]={isUpToDate:true,lastUpdate:Date.now(),data:d};GTB_SidewikiApplication.getInstance().updateContentInAllWindows(c);b=this.lastSweepTime_;c=Date.now();if(b+GTB_SidewikiUrlDataCache.MIN_SWEEP_INT_<c&&(this.urlsNum_>GTB_SidewikiUrlDataCache.MAX_URLS_NUM_||b+GTB_SidewikiUrlDataCache.MAX_SWEEP_INT_<c))this.sweepData_()}};
a.updateUrlData=function(b,c){var d=this.getCanonicalUrl(b);if(b&&d)if(d=this.urlDataCache_[d])d.data=c};a.getUrlData=function(b){return(b=(b=this.getCanonicalUrl(b))&&this.urlDataCache_[b])&&b.data};a.isUpToDate=function(b){b=(b=this.getCanonicalUrl(b))&&this.urlDataCache_[b];return!!(b&&b.isUpToDate)};a.expire=function(b){if(b=(b=this.getCanonicalUrl(b))&&this.urlDataCache_[b])b.isUpToDate=false};a.expireAll=function(){for(var b in this.canonicalUrlCache_)b.isUpToDate=false};
a.reset=function(){this.canonicalUrlCache_={};this.urlDataCache_={};this.urlsNum_=0;this.lastSweepTime_=Date.now()};a.sweepData_=function(){var b=this.canonicalUrlCache_,c=this.urlDataCache_;this.reset();for(var d=GTB_SidewikiApplication.getInstance().getAnotationsUrls(),e=d.length,f=0;f<e;f++)if(d[f]&&!this.canonicalUrlCache_[d[f]]){var g=b[d[f]];if(g){this.canonicalUrlCache_[d[f]]=g;this.urlsNum_++;this.urlDataCache_[g]=c[g]}}};function GTB_SidewikiUtil(){}GTB_SidewikiUtil.PLATFORM_UNKNOWN=0;GTB_SidewikiUtil.PLATFORM_WIN=1;GTB_SidewikiUtil.PLATFORM_MAC=2;GTB_SidewikiUtil.PLATFORM_LINUX=3;GTB_SidewikiUtil.SIDEWIKI_USER_AGENT_PREFIX_="GTBA";GTB_SidewikiUtil.utilsInstance_=null;GTB_SidewikiUtil.getInstance=function(){if(!GTB_SidewikiUtil.utilsInstance_)GTB_SidewikiUtil.utilsInstance_=new GTB_SidewikiUtil;return GTB_SidewikiUtil.utilsInstance_};a=GTB_SidewikiUtil.prototype;
a.getPlatform=function(){var b=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULRuntime).OS.toUpperCase(),c=GTB_SidewikiUtil.PLATFORM_UNKNOWN;switch(b){case "WINNT":case "WINME":case "WIN98":c=GTB_SidewikiUtil.PLATFORM_WIN;break;case "DARWIN":c=GTB_SidewikiUtil.PLATFORM_MAC;break;case "LINUX":case "LINUX-GNU":case "FREEBSD":case "SUNOS":c=GTB_SidewikiUtil.PLATFORM_LINUX;break}return c};a.getPlatformVersion=function(){return"Gecko"+Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULAppInfo).platformVersion};
a.isFirefoxVersionOf=function(b){var c=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULAppInfo).version,d=Cc["@mozilla.org/xpcom/version-comparator;1"].getService(Ci.nsIVersionComparator);if(c.indexOf("+")!=-1||b.indexOf("+")!=-1)return d.compare(c,b)==0;if(d.compare(c,b)==0)return true;c=c.split(".");b=b.split(".");if(b.length>c.length)return false;for(d=0;d<b.length;d++)if(b[d]!=c[d])return false;return true};
a.windowContainsDocument=function(b,c){if(b.document==c)return true;if(b.frames)for(var d=0;d<b.frames.length;++d)if(this.windowContainsDocument(b.frames[d],c))return true;return false};a.dumpProps=function(b){for(var c in b);};a.getSidewikiUserAgent=function(){return GTB_SidewikiUtil.SIDEWIKI_USER_AGENT_PREFIX_};a.getGTBContext=function(){var b=Cc["@google.com/toolbar/application;1"];return(b=b&&b.getService())&&b.wrappedJSObject||null};
a.getSelectionText=function(b){for(var c="",d=GTB_SidewikiDOM.getNestedDocuments(b),e=0,f;f=d[e];++e){f=(f=f.defaultView)&&f.getSelection();try{var g=null;if(f&&f.rangeCount>0)g=f.getRangeAt(f.rangeCount-1);if(g){var h=b.createElement("div");h.appendChild(g.cloneContents());var i=GTB_SidewikiDOM.getSubtreeTextNodes(h);c=GTB_SidewikiDOM.getTextNodesValues(i).join("");return c.replace(/^\s+|\s+$/g,"")}}catch(j){}}return c};a.base64Decode=function(b){return goog.crypt.utf8ByteArrayToString(goog.crypt.base64.decodeStringToByteArray(b))};
a.getOtherDomainsContentEstateSize=function(b){var c=0,d=0,e=this.safeGetHost_(b),f=b&&b.defaultView;if(f)d=(f.innerHeight+f.scrollMaxY)*(f.innerWidth+f.scrollMaxX);if(e&&d>0){b=GTB_SidewikiDOM.getNestedDocuments(b);f=c=0;for(var g;g=b[f];++f){var h=this.safeGetHost_(g);if((g=g.defaultView)&&h&&e!=h)c+=g.innerHeight*g.innerWidth}c=Math.min(100,Math.round(100*c/d))}return c};a.isDonePage=function(b){var c=/^http:\/\/www\.google\.com\/sidewiki\/intl\/[^\/]+\/done\.html$/i;return c.test(b)};
a.isPrivateBrowsingMode=function(){var b=this.getGTBContext();return b&&b.GTB_IsPrivateBrowsing()};a.safeGetHost_=function(b){try{return b&&b.location&&b.location.host}catch(c){return null}};function GTB_SidewikiWindowDirector(b,c){this.debugZone="GTB_SidewikiWindowDirector";this.topLevelWindow_=b;this.topLevelDocument_=c;this.isInitialized_=false;this.infoQueryService_=null;this.listenerManager_=new GTB_SidewikiListenerManager;this.unloadListenerManager_=new GTB_SidewikiListenerManager;this.unloadListenerManager_.addListener(this.topLevelWindow_,"unload",BindToObject(this.onDestroy_,this),false);this.coreInterface_=null;this.contentElement_=c.getElementById(GTB_SidewikiWindowDirector.ElementIds_.CONTENT);
this.tabWatcher_=new G_TabbedBrowserWatcher(this.contentElement_,"sidewikiwatcher",false);this.tabWatcherHandlers_={};var d=G_TabbedBrowserWatcher.events;this.tabWatcherHandlers_[d.LOCATIONCHANGE]=GTB_BindListener(this.onLocationChange_,this,d.LOCATIONCHANGE);this.tabWatcherHandlers_[d.TABLOAD]=GTB_BindListener(this.onLocationChange_,this,d.TABLOAD);this.tabWatcherHandlers_[d.PAGESHOW]=GTB_BindListener(this.onPageShow_,this,d.PAGESHOW);this.tabWatcherHandlers_[d.TABSWITCH]=GTB_BindListener(this.onTabSwitch_,
this,d.TABSWITCH);this.observers_=[new G_ObserverServiceObserver("http-on-modify-request",BindToObject(this.onModifyRequest_,this))];this.clientLoader_=null;this.emailDispatcher_=new GTB_SidewikiEmailDispatcher(this.tabWatcher_,this.topLevelWindow_);this.initTimer_=this.barsContainer_=this.miniBar_=this.sidebar_=null;this.notifyStartTime_=0;this.updateSelectionTextTimer_=null;this.tabDataStorage_=new GTB_SidewikiPerTabDataStorage(this.contentElement_,function(){return new GTB_SidewikiTabData});this.sidewikiPrefs_=
new G_Preferences(GTB_SidewikiApplication.SIDEWIKI_PREF_GROUP,false,true);this.visibilityObserver_=new G_ObserverServiceObserver("GTB_VISIBILITY_CHANGED",BindToObject(this.updateServiceState,this))}GTB_SidewikiWindowDirector.inherits(GTB_InfoQueryUser);GTB_SidewikiWindowDirector.ElementIds_={CONTENT:"content",MAIN_WINDOW:"main-window"};GTB_SidewikiWindowDirector.ToolbarStates_={DISABLED:"disabled",NO_ENTRIES:"hollow",NEW_ENTRIES:"active",NEW_ENTRIES_NOTIFIER:"notify-new"};
GTB_SidewikiWindowDirector.TOOLBAR_ELEMENTS_STATE_ATTR_="sidewikiState";GTB_SidewikiWindowDirector.NOTIFY_TIME_=5E3;a=GTB_SidewikiWindowDirector.prototype;a.updateServiceState=function(b){if(this.initTimer_){this.initTimer_.cancel();this.initTimer_=null}if(GTB_SidewikiApplication.getInstance().isEnabled()){if(!this.isInitialized_||b)this.initTimer_=new G_Alarm(BindToObject(this.initialize_,this),10)}else this.initTimer_=new G_Alarm(BindToObject(this.deinitialize_,this),10)};
a.setMinibarVisibility=function(b){this.sidewikiPrefs_.setPref(GTB_SidewikiApplication.FIREFOX_PREFS.MINIBAR_ENABLED,!!b)};a.getMinibarVisibility=function(){return this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.MINIBAR_ENABLED,true)};a.getAnotationsUrls=function(){var b=[],c=this.contentElement_.browsers;c=c&&c.length||0;for(var d=0;d<c;d++){var e=this.tabDataStorage_.getTabData(this.contentElement_.browsers[d]);e&&b.push(e.getEntriesUrl())}return b};
a.getPageUrlForEntriesUrl=function(b){var c=this.contentElement_.browsers;c=c&&c.length||0;for(var d=0;d<c;d++){var e=this.tabDataStorage_.getTabData(this.contentElement_.browsers[d]);if(e&&e.getEntriesUrl()==b)return e.getPageUrl()}return""};a.reloadClients=function(){this.deinitialize_();new G_Alarm(BindToObject(this.updateServiceState,this,true),1E3)};
a.onButtonClick=function(b){if(b.target==b.currentTarget)if(this.isEnabled()){if(b=this.tabDataStorage_.getSelectedTabData())b.getIsSidebarOpened()?this.onCloseButtonClick():this.onOpenButtonClick()}else(b=this.topLevelWindow_.GTB_GoogleToolbarOverlay)&&b.showFirstRunDialog(true)};
a.onOpenButtonClick=function(){GTB_SidewikiLogger.logData("open_annotations_button_click");this.notifyStartTime_&&this.notifyStartTime_-Date.now()<GTB_SidewikiWindowDirector.NOTIFY_TIME_&&GTB_SidewikiLogger.logData("notification_click");if(this.coreInterface_){if(this.miniBar_)this.getTBElementsState_()!=GTB_SidewikiWindowDirector.ToolbarStates_.NO_ENTRIES?this.onIconClick_(GTB_SidewikiRenderInterface.VIEW_MODE):this.onIconClick_(GTB_SidewikiRenderInterface.EDIT_MODE)}else this.clientLoader_.showLoadDialog()};
a.onWriteButtonClick=function(){GTB_SidewikiLogger.logData("write_annotations_button_click");this.onIconClick_(GTB_SidewikiRenderInterface.EDIT_MODE)};a.onCloseButtonClick=function(){GTB_SidewikiLogger.logData("close_annotations_button_click");var b=this.tabDataStorage_.getSelectedTabData();if(b){b.setIsSidebarOpened(false);this.barsContainer_.hide();this.updateState_();this.topLevelWindow_.focus()}};
a.updateContent=function(b){var c=this.contentElement_.browsers;c=c&&c.length||0;for(var d=0;d<c;d++){var e=this.contentElement_.browsers[d];if(e=this.tabDataStorage_.getTabData(e)){var f=GTB_SidewikiUrlDataCache.getInstance().getCanonicalUrl(e.getEntriesUrl());f==b&&e.setIsNotificationShown(false)}}(e=this.tabDataStorage_.getSelectedTabData())&&GTB_SidewikiUrlDataCache.getInstance().getCanonicalUrl(e.getEntriesUrl())==b&&this.updateState_()};a.getRequestPrefix=function(){return"SW"};
a.getRequestToSend=function(b,c){if(this.coreInterface_){var d=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.FILTER_BY_LANGUAGES,false);return this.coreInterface_.getInfoQueryParams(d,c,this.getMinibarVisibility())}return""};a.isEnabled=function(){return GTB_SidewikiApplication.getInstance().isEnabled()};a.isSleepingPillActive=function(){return!!this.coreInterface_&&!this.coreInterface_.isServiceAvailable()};
a.shouldSendRequest=function(b,c,d,e,f){if(!b||!this.isEnabled()||!this.coreInterface_||!this.shouldUseInfoQuery_()||GTB_SidewikiUrlDataCache.getInstance().isUpToDate(c))return false;else if(this.coreInterface_.isServiceAvailable())if(this.isAllowedInternal(c,d,e,f)){d=this.tabDataStorage_.getSelectedTabData();if(!d)return false;if(GTB_SidewikiUtil.getInstance().isPrivateBrowsingMode()&&!d.getIsSidebarOpened())return false;(d=d.getEntriesUrl())&&d!=c&&!GTB_SidewikiUrlDataCache.getInstance().isUpToDate(d)&&
this.fetchUrlData_(b,d,true);return true}else{this.coreInterface_.handleFetchUrlDataNAResponse(c);return false}else{this.coreInterface_.handleFetchUrlDataFailedResponse(c);return false}};a.onRequestSend=function(){};
a.handleResponse=function(b,c,d){if(d&&d.match(/^SW_1:(\d+):(.*)$/m)){b=Number(RegExp.$1);d=RegExp.$2;var e=GTB_SidewikiUtil.getInstance().base64Decode(d);if(d.length==b){this.coreInterface_.handleFetchUrlDataResponse(c,e);return true}}this.coreInterface_.handleFetchUrlDataFailedResponse(c);return false};a.isAllowedInternal=function(b,c,d,e){c=c&&c.toLowerCase();return!d&&!e&&"http"==c};
a.getReferrerUrl_=function(b){if(!b)return"";var c;try{c=b.QueryInterface(Ci.nsIHttpChannel)}catch(d){return""}b="";try{b=c.getRequestHeader("referer")}catch(e){return""}return b};a.isEntryPermalinkUrl_=function(b){if(this.coreInterface_)return this.coreInterface_.isEntryPermalinkUrl(b);return false};
a.isToolbarActive_=function(){var b=this.topLevelDocument_.getElementById(GTB_SidewikiWindowDirector.ElementIds_.MAIN_WINDOW);if((b=b&&b.getAttribute("chromehidden"))&&b.indexOf("toolbar")>=0)return false;b=GTB_SidewikiUtil.getInstance().getGTBContext();return!(b&&b.GTB_isGoogleToolbarActive)||b.GTB_isGoogleToolbarActive(this.topLevelDocument_,GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID)};
a.shouldUseInfoQuery_=function(){return!!this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.USE_INFO_QUERY,true)};
a.initialize_=function(){this.deinitialize_();if(this.isEnabled()&&this.isToolbarActive_()){if(!this.infoQueryService_){var b=this.topLevelWindow_.GTB_GoogleToolbarOverlay;this.infoQueryService_=b.infoQueryService||null;this.infoQueryService_.registerUser(this)}this.barsContainer_=new GTB_SidewikiBarsContainer(this.topLevelWindow_,this.topLevelDocument_);this.miniBar_=new GTB_SidewikiMarkerPanel(this.topLevelWindow_,this.topLevelDocument_,this.barsContainer_);this.miniBar_.hide();this.miniBar_.setOnMarkerClickCallback(BindToObject(this.onMarkerClick_,
this));this.miniBar_.setOnViewClickCallback(BindToObject(this.onOpenButtonClick,this));this.miniBar_.setOnWriteClickCallback(BindToObject(this.onWriteButtonClick,this));this.miniBar_.setOnCloseClickCallback(BindToObject(this.onCloseButtonClick,this));this.clientLoader_=new GTB_SidewikiClientLoader(this.topLevelWindow_,this.topLevelDocument_);this.clientLoader_.setStateChangeCallback(BindToObject(this.onClientLoaderStateChange_,this));this.clientLoader_.loadClients();this.isInitialized_=true}};
a.deinitialize_=function(){if(this.updateSelectionTextTimer_){this.updateSelectionTextTimer_.cancel();this.updateSelectionTextTimer_=null}for(var b=this.contentElement_.browsers,c=b&&b.length||0,d=0;d<c;d++){var e=this.tabDataStorage_.getTabData(b[d]),f=e&&e.getHighlightList();if(f){f.destroy();e.setHighlightList(null)}}this.coreInterface_&&this.coreInterface_.destroy();this.coreInterface_=null;this.renderInterface_&&this.renderInterface_.destroy();this.renderInterface_=null;this.miniBar_&&this.miniBar_.destroy();
this.miniBar_=null;this.sidebar_&&this.sidebar_.isOpened()&&this.sidebar_.close();this.sidebar_=null;this.barsContainer_&&this.barsContainer_.destroy();this.barsContainer_=null;if(this.clientLoader_){this.clientLoader_.destroy();this.clientLoader_=null}this.removeListeners_();this.setTBElementsState_(GTB_SidewikiWindowDirector.ToolbarStates_.DISABLED);this.isInitialized_=false};
a.setListeners_=function(){this.sidewikiPrefs_.addObserver(GTB_SidewikiApplication.FIREFOX_PREFS.MINIBAR_ENABLED,BindToObject(this.updateBarsState_,this));this.sidewikiPrefs_.addObserver(GTB_SidewikiApplication.FIREFOX_PREFS.MINIBAR_FOR_ANNOTED_ONLY,BindToObject(this.updateBarsState_,this));this.sidewikiPrefs_.addObserver(GTB_SidewikiApplication.FIREFOX_PREFS.FILTER_BY_LANGUAGES,BindToObject(this.expireCacheAndFetchActiveUrlData_,this));for(var b in this.tabWatcherHandlers_)this.tabWatcher_.registerListener(b,
this.tabWatcherHandlers_[b]);this.listenerManager_.addListener(this.topLevelWindow_,"resize",BindToObject(this.barsContainer_.redraw,this.barsContainer_),true);this.listenerManager_.addListener(this.topLevelWindow_,"resize",BindToObject(this.sidebar_.onWindowResize,this.sidebar_),true);this.listenerManager_.addListener(this.topLevelDocument_,"mouseup",BindToObject(this.updateSelectionText_,this,true),true);this.listenerManager_.addListener(this.topLevelDocument_,"keyup",BindToObject(this.updateSelectionText_,
this,true),true)};a.removeListeners_=function(){this.sidewikiPrefs_.removeAllObservers();for(var b in this.tabWatcherHandlers_)this.tabWatcher_.removeListener(b,this.tabWatcherHandlers_[b]);this.listenerManager_.removeAllListeners()};a.updateState_=function(){this.updateBarsState_();this.updateMainPanelState_()};
a.updateMainPanelState_=function(){var b=this.tabDataStorage_.getSelectedTabData();if(b){var c=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.SHOW_RELATED_INFO);b.setPageTitle(this.getPageTitle_());b.setShowRelated(!!c);b.setOtherDomainsContentEstateSize(this.getOtherDomainsContentEstateSize_());if(b.getIsSidebarOpened()){this.onNotificationShow_(b);c=b.getEntriesUrl();var d=GTB_SidewikiUrlDataCache.getInstance().getUrlData(c);if(GTB_SidewikiUtil.getInstance().isPrivateBrowsingMode()&&
!d){d=this.tabWatcher_.getCurrentBrowser();this.fetchUrlData_(d,c,true)}this.sidebar_.isOpened()?this.sidebar_.updateState(b):this.sidebar_.open(b)}else this.sidebar_.close()}};
a.updateBarsState_=function(){var b=this.tabDataStorage_.getSelectedTabData();if(b&&this.coreInterface_){this.sidebar_.updateContext();var c=b.getEntriesUrl(),d=GTB_SidewikiUrlDataCache.getInstance().getUrlData(c),e=this.tabWatcher_.getCurrentBrowser();e=e&&e.contentDocument;var f=b.getHighlightList(),g=this.coreInterface_.getHighlightsData(d,b.getClientContext());if(f&&!f.isUpToDate(d,e,g)){f.destroy();f=null}f||(f=GTB_SidewikiHighlightList.createFromJson(d,e,g));b.setHighlightList(f);f.updateBoundingBoxes();
d=this.setHighlightsPositions_(d,f.getHighlightPositions());GTB_SidewikiUrlDataCache.getInstance().updateUrlData(c,d);this.miniBar_.showMarkers(e,f);this.miniBar_.toggleHighlighting(b.getIsSidebarOpened());b.getIsSidebarOpened()||this.shouldShowMinibar_(d)?this.miniBar_.show():this.miniBar_.hide();this.miniBar_.setSidebarState(b.getIsSidebarOpened());this.sidebar_.getClientMode()==GTB_SidewikiRenderInterface.EDIT_MODE?this.miniBar_.setSidewikiMode(GTB_SidewikiMarkerPanel.SidewikiModes.SIDEWIKI_WRITE):
this.miniBar_.setSidewikiMode(GTB_SidewikiMarkerPanel.SidewikiModes.SIDEWIKI_VIEW);c=(c=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.SHOW_RELATED_INFO))?this.coreInterface_.getRelatedInfoCount(d):0;c=this.coreInterface_.shouldShowNotifier(d)||c>0;if(!d||!this.coreInterface_.isEntriesAllowed(d)){this.setTBElementsState_(GTB_SidewikiWindowDirector.ToolbarStates_.DISABLED);this.miniBar_.setSidewikiMode(GTB_SidewikiMarkerPanel.SidewikiModes.SIDEWIKI_NA)}else if(!b.getIsSidebarOpened()&&
!b.getIsNotificationShown()&&c){this.setTBElementsState_(GTB_SidewikiWindowDirector.ToolbarStates_.NEW_ENTRIES_NOTIFIER);this.notifyStartTime_=Date.now();this.onNotificationShow_(b)}else if(c)this.getTBElementsState_()!=GTB_SidewikiWindowDirector.ToolbarStates_.NEW_ENTRIES_NOTIFIER&&this.setTBElementsState_(GTB_SidewikiWindowDirector.ToolbarStates_.NEW_ENTRIES);else this.setTBElementsState_(GTB_SidewikiWindowDirector.ToolbarStates_.NO_ENTRIES)}};
a.setTBElementsState_=function(b){var c=this.topLevelDocument_.getElementById(GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID);c&&c.setAttribute(GTB_SidewikiWindowDirector.TOOLBAR_ELEMENTS_STATE_ATTR_,b);(c=this.topLevelDocument_.getElementById(GTB_SidewikiApplication.WRITE_ENTRY_MENU_ITEM_ID))&&c.setAttribute(GTB_SidewikiWindowDirector.TOOLBAR_ELEMENTS_STATE_ATTR_,b)};
a.getTBElementsState_=function(){var b=this.topLevelDocument_.getElementById(GTB_SidewikiApplication.TOOLBAR_SIDEWIKI_BUTTON_ID);if(b)return b.getAttribute(GTB_SidewikiWindowDirector.TOOLBAR_ELEMENTS_STATE_ATTR_);return null};a.stopTBButtonAnimation_=function(){this.getTBElementsState_()==GTB_SidewikiWindowDirector.ToolbarStates_.NEW_ENTRIES_NOTIFIER&&this.setTBElementsState_(GTB_SidewikiWindowDirector.ToolbarStates_.NEW_ENTRIES)};
a.getPageTitle_=function(){var b=this.tabWatcher_.getCurrentBrowser();return(b=b&&b.contentDocument)&&b.title||""};a.getOtherDomainsContentEstateSize_=function(){var b=this.tabWatcher_.getCurrentBrowser();b=b&&b.contentDocument;return GTB_SidewikiUtil.getInstance().getOtherDomainsContentEstateSize(b)};a.setHighlightsPositions_=function(b,c){return this.coreInterface_.setHighlightsPositions(b,c)};
a.shouldShowMinibar_=function(b){if(!this.miniBar_||!this.coreInterface_)return false;var c=!this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.MINIBAR_FOR_ANNOTED_ONLY,true);b=this.coreInterface_.shouldShowNotifier(b);return this.getMinibarVisibility()&&(c||b)};a.setTabDataUrlsIfEmpy_=function(b,c){if(b&&(!b.getEntriesUrl()||!b.getPageUrl())){var d=c&&c.currentURI.asciiSpec;b.setEntriesUrl(d);b.setPageUrl(d)}};
a.updateSelectionText_=function(b){if(b){this.updateSelectionTextTimer_&&this.updateSelectionTextTimer_.cancel();this.updateSelectionTextTimer_=new G_Alarm(BindToObject(arguments.callee,this,false),10)}var c=this.tabWatcher_.getCurrentBrowser(),d=c&&c.contentDocument;if(c=d&&this.tabDataStorage_.getTabDataByDocument(d)){d=GTB_SidewikiUtil.getInstance().getSelectionText(d);if(c.getSelectionText()!=d){c.setSelectionText(d);this.sidebar_.updateSelectionText(d)}}};
a.onShowAllEntries_=function(){var b=this.tabWatcher_.getCurrentBrowser(),c=this.tabDataStorage_.getTabData(b);if(c){var d=c.getPageUrl();c.setEntriesUrl(d);GTB_SidewikiUrlDataCache.getInstance().getUrlData(d)||this.fetchUrlData_(b,d,true);this.updateState_()}};
a.expireCacheAndFetchActiveUrlData_=function(){GTB_SidewikiUrlDataCache.getInstance().expireAll();var b=this.tabWatcher_.getCurrentBrowser(),c=this.tabDataStorage_.getTabData(b);this.setTabDataUrlsIfEmpy_(c,b);(c=c&&c.getEntriesUrl())&&this.coreInterface_.isServiceAvailable()&&this.fetchUrlData_(b,c,true)};
a.onClientLoaderStateChange_=function(){var b=this.clientLoader_&&this.clientLoader_.getState();if(b==GTB_SidewikiClientLoader.States.LOAD_SUCCESS){this.coreInterface_=this.clientLoader_.getCoreInterface();this.coreInterface_.setOnShowAllEntriesCallback(BindToObject(this.onShowAllEntries_,this));this.coreInterface_.setOnServiceStateChangeCallback(BindToObject(this.expireCacheAndFetchActiveUrlData_,this));GTB_SidewikiLogger.setLoggingCallback(BindToObject(this.coreInterface_.sendLog,this.coreInterface_));
b=this.clientLoader_.getRenderInterface();b.setActiveEntryChangeCallback(BindToObject(this.onActiveEntryChange_,this));b.setOnUrlClickCallback(BindToObject(this.onUrlClick_,this));b.setOnSignInUrlClickCallback(BindToObject(this.onSignInUrlClick_,this));b.setOnSendEntryCallback(BindToObject(this.onEntrySend_,this));b.setOnDataUpdateCallback(BindToObject(this.onUrlDataUpdate_,this));b.setOnModeChangeCallback(BindToObject(this.updateBarsState_,this));b.setOnDisableMinibarCallback(BindToObject(this.setMinibarVisibility,
this,false));b.setOnCloseCallback(BindToObject(this.onCloseButtonClick,this));var c=new GTB_SidewikiGeometry(this.topLevelWindow_,this.topLevelDocument_);this.sidebar_=new GTB_SidewikiSideBar(this.topLevelDocument_,c,b,this.barsContainer_);this.miniBar_.setOnStartResizingCallback(BindToObject(this.sidebar_.onStartResizing,this.sidebar_));this.removeListeners_();this.setListeners_();this.expireCacheAndFetchActiveUrlData_();this.updateState_()}else{if(this.sidebar_){this.sidebar_.close();this.sidebar_=
null}this.miniBar_.setOnStartResizingCallback(null);this.miniBar_.hide();this.removeListeners_();this.coreInterface_=null;GTB_SidewikiLogger.setLoggingCallback(null);b=(b=this.tabWatcher_.getCurrentBrowser())&&b.contentDocument;this.miniBar_.showMarkers(b,null);this.setTBElementsState_(GTB_SidewikiWindowDirector.ToolbarStates_.DISABLED)}};
a.onIconClick_=function(b){if(this.clientLoader_)if(this.coreInterface_){if(!(b==null||typeof b=="undefined")){var c=this.tabDataStorage_.getSelectedTabData();if(c)if(!this.sidebar_.isOpened()||!c.getIsSidebarOpened()||this.sidebar_.getClientMode()!=b){c.setIsSidebarOpened(true);c.setClientMode(b);this.sidebar_.setClientMode(b);this.updateState_()}}}else this.clientLoader_.showLoadDialog()};
a.onMarkerClick_=function(b){this.sidebar_.isOpened()||this.onIconClick_(GTB_SidewikiRenderInterface.VIEW_MODE);var c=this.tabDataStorage_.getSelectedTabData();if(c){if(this.sidebar_.getClientMode()!=GTB_SidewikiRenderInterface.VIEW_MODE){c.setClientMode(GTB_SidewikiRenderInterface.VIEW_MODE||0);this.sidebar_.setClientMode(c.getClientMode());this.sidebar_.updateState(c)}this.sidebar_.setActiveEntry(b);b=this.sidebar_.getActiveEntry();this.miniBar_.setActiveHighlight(b)}};
a.onNotificationShow_=function(b){b.setIsNotificationShown(true);this.coreInterface_.notifierShown(GTB_SidewikiUrlDataCache.getInstance().getUrlData(b.getEntriesUrl()))};a.onActiveEntryChange_=function(b,c){c?this.miniBar_.showActiveHighlight(b):this.miniBar_.setActiveHighlight(b)};
a.onUrlClick_=function(b,c){var d=c==0,e=c==1;if(d||e){d=(d=this.contentElement_.browsers)&&d.length||0;for(var f=0;f<d;f++){var g=this.contentElement_.browsers[f];g=g.currentURI.spec;if(b==g){this.contentElement_.selectedTab=this.contentElement_.mTabs[f];return}}d=this.contentElement_.addTab(b);if(!e)this.contentElement_.selectedTab=d}};
a.onSignInUrlClick_=function(){var b=this.topLevelWindow_.GTB_GoogleToolbarOverlay;if(b){b=b.settings.getGaiaSettings();var c=Cc["@google.com/toolbar/gaia-service;1"];c=(c=c&&c.getService())&&c.wrappedJSObject;var d=true;if(c)d=c.gaiaIsSignedIn();d&&b.gaiaSignOut();b.gaiaSignIn()}else this.topLevelWindow_.open(GTB_SidewikiApplication.LOGIN_URL,"Google Account Login","resizable=no,scrollbars=yes,status=no,dependent=yes,dialog=yes,width=600,height=400")};a.onEntrySend_=function(b){this.emailDispatcher_.sendMail(b)};
a.onUrlDataUpdate_=function(b,c){var d=GTB_SidewikiUrlDataCache.getInstance().getCanonicalUrl(b);if(d){var e=GTB_SidewikiUrlDataCache.getInstance();e.putUrlData(b,d,c);(d=this.getPageUrlForEntriesUrl(b))&&d!=b&&e.expire(d);this.updateBarsState_()}};
a.fetchUrlData_=function(b,c,d){var e=this.tabDataStorage_.getTabData(b);if(!(GTB_SidewikiUtil.getInstance().isPrivateBrowsingMode()&&(!e||!e.getIsSidebarOpened()))){GTB_SidewikiUtil.getInstance().isDonePage(c)&&e&&e.setIsSidebarOpened(true);if(this.shouldUseInfoQuery_())d&&this.infoQueryService_&&this.infoQueryService_.forceSendRequest(b,c);else if(this.coreInterface_){b=this.sidewikiPrefs_.getPref(GTB_SidewikiApplication.FIREFOX_PREFS.FILTER_BY_LANGUAGES,false);this.coreInterface_.fetchUrlData(c,
b,this.getMinibarVisibility())}}};
a.onTabSwitch_=function(b){if(this.updateSelectionTextTimer_){this.updateSelectionTextTimer_.cancel();this.updateSelectionTextTimer_=null}var c=this.tabWatcher_.getCurrentBrowser(),d=this.tabDataStorage_.getTabData(c);if(d){this.setTabDataUrlsIfEmpy_(d,b.toBrowser);d.getIsSidebarOpened()||this.barsContainer_.hide();this.notifyStartTime_=0;this.stopTBButtonAnimation_();this.updateState_();(b=d.getEntriesUrl())&&!GTB_SidewikiUrlDataCache.getInstance().isUpToDate(b)&&this.fetchUrlData_(c,b);this.barsContainer_.delayedRedraw()}};
a.onLocationChange_=function(b){var c=b.browser;if(!(typeof b.isTop=="boolean"&&!b.isTop))if(c){var d=c.currentURI.asciiSpec;if(d){var e=this.tabDataStorage_.getTabData(c);if(e){if(e.getPageUrl()!=d){e.setIsPageLoaded(false);e.setIsSidebarOpened(false);e.setClientMode(GTB_SidewikiRenderInterface.VIEW_MODE||0)}e.setPageUrl(d);b=this.getReferrerUrl_(b.request);if(this.isEntryPermalinkUrl_(b)){e.setEntriesUrl(b);e.setIsSidebarOpened(true)}else e.setEntriesUrl(d)}if(e==this.tabDataStorage_.getSelectedTabData()){this.sidebar_.setClientMode(e.getClientMode());
this.updateState_();this.stopTBButtonAnimation_()}GTB_SidewikiUrlDataCache.getInstance().expire(d);this.fetchUrlData_(c,d)}}};a.onPageShow_=function(b){if(b=b.browser){var c=b.currentURI.asciiSpec;if(c){(b=this.tabDataStorage_.getTabData(b))&&b.setIsPageLoaded(true);if(b==this.tabDataStorage_.getSelectedTabData()){this.sidebar_.updatePageTitle(this.getPageTitle_());this.sidebar_.updateOtherDomainsContentEstateSize(this.getOtherDomainsContentEstateSize_());this.updateBarsState_();this.updateSelectionText_(false)}}}};
a.onModifyRequest_=function(b,c){if(!(!b||c!="http-on-modify-request")){var d;try{d=b.QueryInterface(Ci.nsIHttpChannel)}catch(e){return}var f="";try{f=d.URI.host}catch(g){return}if(f&&GTB_isGoogleDomain(f)&&this.isEnabled()){f=d.getRequestHeader("user-agent");var h=GTB_SidewikiUtil.getInstance().getSidewikiUserAgent();if(f.indexOf(h)==-1){f+=" "+h;d.setRequestHeader("user-agent",f,false)}}}};
a.onDestroy_=function(){this.deinitialize_();if(this.initTimer_){this.initTimer_.cancel();this.initTimer_=null}if(this.emailDispatcher_){this.emailDispatcher_.destroy();this.emailDispatcher_=null}if(this.unloadListenerManager_){this.unloadListenerManager_.removeAllListeners();this.unloadListenerManager_=null}for(var b=0,c;c=this.observers_[b];++b)c.unregister();this.observers_=[];GTB_SidewikiApplication.getInstance().unregisterWindowHandler(this)};function GTB_SidewikiWriteIcon(b,c){var d=new GTB_SidewikiGeometry(b,c),e=c.getElementById(GTB_SidewikiWriteIcon.ElementIds_.WRITE_ICON_OVERLAY);GTB_SidewikiOverlayObject.call(this,d,e);this.debugZone="GTB_SidewikiWriteIcon";this.topLevelWindow_=b;this.topLevelDocument_=c;this.contentElement_=c.getElementById(GTB_SidewikiWriteIcon.ElementIds_.CONTENT);this.listenerManager_=new GTB_SidewikiListenerManager;this.topOffset_=0;this.tooltip_="";this.isMac_=GTB_SidewikiUtil.getInstance().getPlatform()==
GTB_SidewikiUtil.PLATFORM_MAC;this.isFF3_=GTB_SidewikiUtil.getInstance().isFirefoxVersionOf("3")}GTB_SidewikiWriteIcon.inherits(GTB_SidewikiOverlayObject);GTB_SidewikiWriteIcon.Props_={WIDTH:16,HEIGHT:14};GTB_SidewikiWriteIcon.ElementIds_={CONTENT:"content",WRITE_ICON_OVERLAY:"sidewiki-write-icon-overlay",WRITE_ICON_BROWSER:"sidewiki-write-icon-browser",WRITE_ICON:"write-icon"};a=GTB_SidewikiWriteIcon.prototype;a.setOnClickCallback=function(b){this.onClickCallback_=b};
a.getOverlayBoxSize=function(){var b=this.getMaxOverlayBoxSize(),c=this.contentElement_.selectedBrowser;c=c&&c.contentWindow;var d=c.scrollY;c={};d=this.topOffset_-d-GTB_SidewikiWriteIcon.Props_.HEIGHT;if(d<0||d+GTB_SidewikiWriteIcon.Props_.HEIGHT>b.height){c.width=0;c.height=0}else{c.width=GTB_SidewikiWriteIcon.Props_.WIDTH;c.height=GTB_SidewikiWriteIcon.Props_.HEIGHT}c.left=b.left;c.top=b.top+d;return c};a.open=function(b){this.topOffset_=b.top;this.tooltip_=b.tooltip;this.loadFrameContentInternal()};
a.close=function(){this.listenerManager_.removeAllListeners();this.resetTimersInternal();var b=this.getOverlayElement();b.style.display="none";b.collapsed=true;b.hidden=true;this.drawOutCompleteInternal()};a.initOverlayObjectInternal=function(){try{var b=this.topLevelDocument_.getElementById(GTB_SidewikiWriteIcon.ElementIds_.WRITE_ICON_BROWSER),c=b&&b.contentDocument,d=c&&c.getElementById(GTB_SidewikiWriteIcon.ElementIds_.WRITE_ICON);if(d){d.title=this.tooltip_;return true}}catch(e){}return false};
a.drawInCompleteInternal=function(){if(this.isOpened()){this.listenerManager_.addListener(this.getOverlayElement(),"mousedown",BindToObject(this.onClickHandler_,this),true);this.listenerManager_.addListener(this.topLevelDocument_,"scroll",BindToObject(this.onScrollHandler_,this),true);var b=this.contentElement_.selectedBrowser,c=b&&b.contentWindow;b=b&&b.contentDocument;if(c&&b&&b.body){c=c.getComputedStyle(b.body,"");this.setIconBackgroundColor_(c&&c.backgroundColor||"transparent")}}};
a.setIconBackgroundColor_=function(b){var c=this.topLevelDocument_.getElementById(GTB_SidewikiWriteIcon.ElementIds_.WRITE_ICON_BROWSER);if(c=(c=c&&c.contentDocument)&&c.getElementById(GTB_SidewikiWriteIcon.ElementIds_.WRITE_ICON))c.style.backgroundColor=b};a.onClickHandler_=function(){GTB_SidewikiLogger.logData("write_annotation_overlay_click");this.onClickCallback_&&this.onClickCallback_()};
a.onScrollHandler_=function(){this.setPositionInternal(this.getOverlayBoxSize());if(this.isMac_&&this.isFF3_){var b=this.contentElement_.selectedBrowser;b.style.zIndex++;this.increaseZIndex_()}};function SuggestRequestor(){}
SuggestRequestor.prototype={debugZone:"SuggestRequestor",_serverErrorLog:[],_maxErrorsBeforeBackoff:3,_serverErrorPeriod:6E5,_serverErrorTimeoutIncrement:6E5,_serverErrorTimeout:0,_nextRequestTime:0,_prefs:new G_Preferences("google.toolbar."),onSuggestReadyStateChange_:function(b,c,d,e){try{var f=c&&c.status}catch(g){}var h=null;if(f==200){this._clearServerErrors();h=b.parseResult?b.parseResult(c,e):c.responseText}else this._isBackoffError(f)&&this._noteServerError();b.onSuggestResultsReady(h,h?d:
"",e)},request:function(b,c,d,e){this.stopSuggestSearch();if(d&&e.searchType=="gtbSearchGoogle"&&this._prefs.getPref("search_box_use_suggest")&&this._okToRequest()){var f=this,g=function(h){f.fetcher_=null;f.onSuggestReadyStateChange_(b,h,d,e)};G_Debug(this,"ping "+this._getServiceURL(c,encodeURIComponent(d)));this.fetcher_=new G_XMLFetcher;this.fetcher_.get(this._getServiceURL(c,encodeURIComponent(d)),g)}else b.onSuggestResultsReady(null,d,e)},stopSuggestSearch:function(){this.fetcher_=null},_noteServerError:function(){var b=
Date.now();this._serverErrorLog.push(b);this._serverErrorLog.length>this._maxErrorsBeforeBackoff&&this._serverErrorLog.shift();if(this._serverErrorLog.length==this._maxErrorsBeforeBackoff&&b-this._serverErrorLog[0]<this._serverErrorPeriod){this._serverErrorTimeout=this._serverErrorTimeout*2+this._serverErrorTimeoutIncrement;this._nextRequestTime=b+this._serverErrorTimeout}},_clearServerErrors:function(){this._serverErrorLog=[];this._nextRequestTime=this._serverErrorTimeout=0},_okToRequest:function(){return Date.now()>
this._nextRequestTime},_isBackoffError:function(b){return b==500||b==502||b==503},_getServiceURL:function(b,c){var d="http://clients1.google.%TLD%/";return(d+b).replace(/%TLD%/,GTB_getGoogleDomain()).replace(/%LANG%/,GTB_getLangCode()).replace(/%s/,c)}};SuggestRequestor.instace_=null;SuggestRequestor.getInstance=function(){if(!SuggestRequestor.instance_)SuggestRequestor.instance_=new SuggestRequestor;return SuggestRequestor.instance_};
function SearchSuggestAutoComplete(){this.debugZone="SearchSuggestAutoComplete";var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);if(b=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties")){this._didYouMeanString=b.GetStringFromName("google-suggest.didyoumean");this._calculatorString=b.GetStringFromName("google-suggest.calculator");this._suggestionsString=b.GetStringFromName("google-suggest.suggestions")}this.acResult_=this.observer_=null;this.wrappedJSObject=
this}a=SearchSuggestAutoComplete.prototype;a.QueryInterface=function(b){if(!b.equals(Ci.nsIAutoCompleteSearch)&&!b.equals(Ci.nsIAutoCompleteObserver)&&!b.equals(Ci.nsISupports))throw Cr.NS_ERROR_NO_INTERFACE;return this};a.startSearch=function(b,c,d,e){this.observer_=e;SuggestRequestor.getInstance().request(this,"complete/search?hl=%LANG%&client=toolbar&q=%s",b,{searchType:c})};a.stopSearch=function(){SuggestRequestor.getInstance().stopSuggestSearch();this.observer_=null};
a.getResult=function(b){return this.acResult_&&this.acResult_.results[b]};a.getResultIcon=function(b){return this.acResult_&&this.acResult_.getIconAt(b)};
a.parseResult=function(b,c){var d=[],e=[],f=[],g=b.responseXML;if(!g)return null;var h=g.documentElement;if(h.hasChildNodes()){g=c.searchType;h=h.childNodes;for(var i=0;i<h.length;i++){var j=h[i];switch(j.nodeName){case "CompleteSuggestion":var k=null,l=null;j=j.childNodes;for(var m=0;m<j.length;m++)if(j[m].nodeName=="suggestion")k=j[m].getAttribute("data");else if(j[m].nodeName=="num_queries")l=parseInt(j[m].getAttribute("int"),10);if(k!=null&&l!=null){k=new GTB_HistoryItem(k,"",g);k.comment=this._suggestionsString;
d.push(k)}break;case "spelling_suggestion":k=j.getAttribute("data");k=k.replace(/<\/{0,1}[a-z]+\/{0,1}>/gi,"");k=new GTB_HistoryItem(k,"",g);k.comment=this._didYouMeanString;e.push(k);break;case "calculator_suggestion":k=j.getAttribute("data");k=new GTB_HistoryItem(k,"",g);k.comment=this._calculatorString;f.push(k);break}}}g=[];g=g.concat(e);g=g.concat(f);return g=g.concat(d)};
a.onSuggestResultsReady=function(b,c,d){if(this.observer_){this.acResult_=new SuggestAutoCompleteResult(c,Ci.nsIAutoCompleteResult.RESULT_SUCCESS,0,"",b||[],d.searchType);this.acResult_.matchCount==0&&this.preventFF35onOSXTigerCrash();this.observer_&&this.observer_.onSearchResult(this,this.acResult_)}};
a.preventFF35onOSXTigerCrash=function(){if(GTB_GeckoVersion.isVersionOf("1.9.1")){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getEnumerator("navigator:browser");for(var c=null;b.hasMoreElements();){var d=b.getNext();if(!c){c=d.navigator.userAgent;if(c.indexOf("Mac OS X 10.4")<0)break}(d=d.document.getElementById("gtbPopupAutoComplete"))&&d.closePopup()}}};function SuggestAutoCompleteResult(b,c,d,e,f,g){this.debugZone="suggest-results";this._searchString=b;this._searchResult=c;this._defaultIndex=d;this._errorDescription=e;this._showIcons=d=!b;c=[];if((g=="gtbSearchGoogle"||g=="gtbSearchBookmarks")&&b.length>0){e=Cc["@google.com/toolbar/bookmarks;1"].getService().wrappedJSObject;e=e.getBookmarkItems(b);c=c.concat(e)}e=[];if(d||g!="gtbSearchBookmarks"){var h=new G_Preferences("google.toolbar.");if(d||h.getPref("search_box_save_history")){e=Cc["@google.com/toolbar/search-history;1"].getService().wrappedJSObject;
e=d?e.getHistoryItems("",null):e.getHistoryItems(b,g);c=c.concat(e)}if(f.length>0){b={};for(g=0;g<e.length;++g)if(e[g].searchType=="gtbSearchGoogle")b[e[g].query.toLowerCase()]=true;for(g=f.length-1;g>=0;--g)b[f[g].query.toLowerCase()]&&f.splice(g,1);c=c.concat(f)}}this.results=c}
SuggestAutoCompleteResult.prototype={getValueAt:function(b){return this.results[b].query},getCommentAt:function(b){if(b==0||this.results[b].comment!=this.results[b-1].comment)return this.results[b].comment;return""},getStyleAt:function(b){var c="gtbAutoCompleteRow";if(b!=0&&this.results[b].comment!=this.results[b-1].comment)c="gtbAutoCompleteSeparator";if(this._showIcons)c+="Icons";return c},getIconAt:function(b){b=this.results[b];if(!b||!this._showIcons)return null;return b.icon},getImageAt:function(b){return this.getIconAt(b)},
removeValueAt:function(b,c){var d=this.results[b];this.results.splice(b,1);var e=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);e=e.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");e=e.GetStringFromName("google-suggest.history");if(!(!c||d.comment!=e)){e=Cc["@google.com/toolbar/search-history;1"].getService().wrappedJSObject;e.removeFromHistory(d)}},QueryInterface:function(b){if(!b.equals(Ci.nsIAutoCompleteResult)&&!b.equals(Ci.nsISupports))throw Cr.NS_ERROR_NO_INTERFACE;
return this}};SuggestAutoCompleteResult.prototype.__defineGetter__("searchString",function(){return this._searchString});SuggestAutoCompleteResult.prototype.__defineGetter__("searchResult",function(){return this._searchResult});SuggestAutoCompleteResult.prototype.__defineGetter__("defaultIndex",function(){return this._defaultIndex});SuggestAutoCompleteResult.prototype.__defineGetter__("errorDescription",function(){return this._errorDescription});
SuggestAutoCompleteResult.prototype.__defineGetter__("matchCount",function(){return this.results.length});function GTB_HtmlSuggestObjectFactory(){G_JSFactory.call(this,Components.ID("{75BA950A-19FA-11DE-89C5-B8F255D89593}"),"@google.com/toolbar/html-suggest;1","gToolbar",null,["JavaScript global property"])}GTB_HtmlSuggestObjectFactory.inherits(G_JSFactory);GTB_HtmlSuggestObjectFactory.prototype.createInstance=function(b,c){if(b!=null)throw Components.results.NS_ERROR_NO_AGGREGATION;return(new GTB_HtmlSuggestInterface).QueryInterface(c)};
function GTB_HtmlSuggestInterface(){this.versionstring=GTB_version;this.tld=GTB_getGoogleDomain();this.gtbId=""+GTB_HtmlSuggestInterface.lastId_++}GTB_HtmlSuggestInterface.prototype.debugZone="GTB_HtmlSuggestInterface";GTB_HtmlSuggestInterface.lastId_=0;GTB_HtmlSuggestInterface.clients_=[];a=GTB_HtmlSuggestInterface.prototype;
a.QueryInterface=function(b){if(b.equals(Ci.nsIClassInfo)||b.equals(Ci.gtbIHtmlSuggest)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};a.getInterfaces=function(b){var c=[Ci.nsIClassInfo,Ci.gtbIHtmlSuggest];b.value=c.length;return c};a.getHelperForLanguage=function(){return null};a.flags=Ci.nsIClassInfo.DOM_OBJECT;a.classDescription="Google Toolbar Suggest";a.implementationLanguage=Ci.nsIProgrammingLanguage.JAVASCRIPT;GTB_HtmlSuggestInterface.register=function(b){GTB_HtmlSuggestInterface.clients_.push(b)};
GTB_HtmlSuggestInterface.unregister=function(b){var c=GTB_HtmlSuggestInterface.clients_.indexOf(b);if(c>=0)GTB_HtmlSuggestInterface.clients_.splice(c,1);else"Cannot unregister a client with id="+GTB_HtmlSuggestInterface.getClientId_(b)};goog.exportSymbol("GTB_HtmlSuggestInterface.unregister",GTB_HtmlSuggestInterface.unregister);GTB_HtmlSuggestInterface.getClientId_=function(b){try{var c=b.getComponent();return c&&c.getToolbar().gtbId}catch(d){return null}};
GTB_HtmlSuggestInterface.findClient_=function(b){for(var c=0,d;d=GTB_HtmlSuggestInterface.clients_[c];c++)if(b==GTB_HtmlSuggestInterface.getClientId_(d))return d;return null};GTB_HtmlSuggestInterface.prototype.getClient=function(){return GTB_HtmlSuggestInterface.findClient_(this.gtbId)};goog.exportSymbol("GTB_HtmlSuggestInterface.prototype.getClient",GTB_HtmlSuggestInterface.prototype.getClient);
for(var prototype$$inline_796=GTB_HtmlSuggestInterface.prototype,methodNames$$inline_798=["nav","putQuery","getQuery","closeSuggestWindow","search","setIconBehavior","setWindowSize","usageIncrementCount","usageUpdateTiming","usageSetInteger","usageSetBoolean"],i$$inline_799=0,methodName$$inline_800;methodName$$inline_800=methodNames$$inline_798[i$$inline_799];i$$inline_799++)GTB_DeclareProxy(prototype$$inline_796,"getClient",methodName$$inline_800);
function GTB_DeclareProxy(b,c,d){b[d]=function(){var e;var f=c,g=d;e=arguments;f=this[f];if(typeof f!="function")e=null;else if(f=f.apply(this))e=(g=f[g])?g.apply(f,e):null;else e=null;return e}};function GTB_HTMLSuggestParameters(b,c,d){this.url=c;this.version=d;this.error=this.initialized=false;this.browser_=b.createElement("browser");this.browser_.setAttribute("type","content");this.browser_.setAttribute("collapsed","true");this.mainWindow_=b.getElementById("main-window");this.mainWindow_.appendChild(this.browser_);GTB_HtmlSuggestInterface.register(this);this.browser_.setAttribute("src","about:blank");this.onBrowserLoadBound_=BindToObject(this.onBrowserLoad_,this);this.browser_.addEventListener("load",
this.onBrowserLoadBound_,true);this.browser_.setAttribute("src",this.url)}GTB_HTMLSuggestParameters.prototype.debugZone="GTB_HTMLSuggestParameters";GTB_HTMLSuggestParameters.instance_=null;GTB_HTMLSuggestParameters.prototype.onBrowserLoad_=function(){new G_Alarm(BindToObject(this.checkInitialization_,this),0)};GTB_HTMLSuggestParameters.prototype.checkInitialization_=function(){if(!this.initialized){GTB_HTMLSuggestParameters.revertToStatic_(this.mainWindow_);this.error=true;this.unlinkFrame_()}};
GTB_HTMLSuggestParameters.revertToStatic_=function(b){b.setAttribute("gtbStaticSuggest",true)};
GTB_HTMLSuggestParameters.getInstance=function(b){if(GTB_HTMLSuggestParameters.instance_){if(GTB_HTMLSuggestParameters.instance_.error){b=b.getElementById("main-window");new G_Alarm(BindToObject(GTB_HTMLSuggestParameters.revertToStatic_,GTB_HTMLSuggestParameters.instance_,b),0);return null}return GTB_HTMLSuggestParameters.instance_.initialized?GTB_HTMLSuggestParameters.instance_:null}var c=Cc["@google.com/toolbar/components;1"].getService().wrappedJSObject;c.register("suggest_window.html",GTB_HTMLSuggestParameters.reset,
["json_comp.js","html-sanitizer-minified.js"]);var d=c.getUrl("suggest_window.html");c=c.getVersion("suggest_window.html");GTB_HTMLSuggestParameters.instance_=new GTB_HTMLSuggestParameters(b,d,c);return null};GTB_HTMLSuggestParameters.reset=function(){if(GTB_HTMLSuggestParameters.instance_){GTB_HTMLSuggestParameters.instance_.unlinkFrame_();GTB_HTMLSuggestParameters.instance_=null}};
GTB_HTMLSuggestParameters.prototype.unlinkFrame_=function(){if(this.browser_){GTB_HtmlSuggestInterface.unregister(this);this.mainWindow_.removeChild(this.browser_);this.browser_.removeEventListener("load",this.onBrowserLoadBound_,true);this.browser_.setAttribute("src","about:blank");this.browser_=null}};GTB_HTMLSuggestParameters.prototype.getComponent=function(){return this.browser_.contentWindow.wrappedJSObject};
GTB_HTMLSuggestParameters.prototype.setWindowSize=function(b,c,d,e,f,g,h){this.minWidth=b;this.minHeight=c;this.defaultWidth=d;this.defaultHeight=e;b=this.mainWindow_.ownerDocument.defaultView.screen;this.maxWidth=Math.round(b.availWidth*f/100);this.maxHeight=Math.round(b.availHeight*g/100);this.leftOffset=h;this.suggestPath=this.getComponent().getSuggestQueryPath();this.initialized=true;new G_Alarm(BindToObject(this.unlinkFrame_,this),0)};
goog.exportSymbol("GTB_HTMLSuggestParameters.prototype.setWindowSize",GTB_HTMLSuggestParameters.prototype.setWindowSize);
function GTB_HTMLSuggest(b){this.debugZone="GTB_HTMLSuggest";this.document_=b;this.keyPressCallback_=BindToObject(this.onKeyPress_,this);this.clearLink_=null;this.clearHistoryBound_=BindToObject(this.onClearHistory_,this);this.bookmarks_=this.history_=this.suggest_=null;this.historyService_=Cc["@google.com/toolbar/search-history;1"].getService().wrappedJSObject;this.textChanged_=false;this.pollTimer_=null;this.onTimerBound_=BindToObject(this.onTimer_,this);this.blurTimer_=null;this.onBlurTimerBound_=
BindToObject(this.onBlurTimer_,this);this.stringBundle_=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.dropdown_=new GTB_SuggestDropdownOverlay(this.document_,BindToObject(this.initDropdown_,this),BindToObject(this.onComponentReady_,this));GTB_HtmlSuggestInterface.register(this);this.refreshParameters_()}GTB_HTMLSuggest.defaultPollPeriod_=150;a=GTB_HTMLSuggest.prototype;
a.shutdown=function(){GTB_HtmlSuggestInterface.unregister(this);if(this.dropdown_){this.dropdown_.shutdown();this.dropdown_=null}};a.refreshParameters_=function(){if(!this.dropdown_.isVisible())this.parameters_=GTB_HTMLSuggestParameters.getInstance(this.document_)};a.getBrowser_=function(){return this.document_.getElementById("browser")};a.getSearchBox_=function(){return this.document_.getElementById("gtbGoogleSearchBox")};a.getSearchOverlay_=function(){return this.getSearchBox_().mSearchBox};
a.getSearchType_=function(){return this.document_.getElementById("gtbSearchButton").searchType};a.initDropdown_=function(b){this.clearLink_=b.getElementById("gtb-suggest-clear");this.clearLink_.innerHTML=this.stringBundle_.GetStringFromName("google-suggest.clearhistory");this.clearLink_.setAttribute("visible","false");this.clearLink_.addEventListener("click",this.clearHistoryBound_,false)};
a.onComponentReady_=function(){if(this.delayedUpdate_){this.delayedUpdate_();this.delayedUpdate_=null}this.getComponent().setLabelStrings(this.stringBundle_.GetStringFromName("google-suggest.bookmarks"),this.stringBundle_.GetStringFromName("google-suggest.calculator"),this.stringBundle_.GetStringFromName("google-suggest.history"),this.stringBundle_.GetStringFromName("google-suggest.didyoumean"),this.stringBundle_.GetStringFromName("google-suggest.suggestions"))};
a.onFocus=function(){this.refreshParameters_();this.textChanged_=false;if(this.blurTimer_){this.blurTimer_.cancel();this.blurTimer_=null}this.pollTimer_&&this.pollTimer_.cancel();this.pollTimer_=new G_Alarm(this.onTimerBound_,GTB_HTMLSuggest.defaultPollPeriod_,true);this.getSearchOverlay_().setKeyPressFilter(this.keyPressCallback_)};goog.exportSymbol("GTB_HTMLSuggest.prototype.onFocus",GTB_HTMLSuggest.prototype.onFocus);
GTB_HTMLSuggest.prototype.onBlur=function(){if(!this.blurTimer_)this.blurTimer_=new G_Alarm(this.onBlurTimerBound_,0);this.pollTimer_.cancel();this.pollTimer_=null};goog.exportSymbol("GTB_HTMLSuggest.prototype.onBlur",GTB_HTMLSuggest.prototype.onBlur);GTB_HTMLSuggest.prototype.onTimer_=function(){this.refreshParameters_();if(this.textChanged_){this.textChanged_=false;this.update()}};GTB_HTMLSuggest.prototype.onBlurTimer_=function(){this.dropdown_&&this.dropdown_.hide()};
GTB_HTMLSuggest.prototype.onInput=function(){this.textChanged_=true};goog.exportSymbol("GTB_HTMLSuggest.prototype.onInput",GTB_HTMLSuggest.prototype.onInput);a=GTB_HTMLSuggest.prototype;a.onClearHistory_=function(){var b=Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService);b.notifyObservers(null,"GTB_CLEAR_HISTORY",null);this.dropdown_.hide()};
a.onKeyDown=function(b){this.swallowNextReturn_=false;if(this.dropdown_.isVisible()){var c=this.getComponent();if(c&&c.onKeyDown&&!(b.metaKey||b.ctrlKey||b.altKey))c.onKeyDown(b.keyCode)}};
a.onKeyPress_=function(b){if(b.keyCode==b.DOM_VK_RETURN)if(this.swallowNextReturn_){this.swallowNextReturn_=false;return true}else{this.dropdown_.hide();return false}if(this.dropdown_.isVisible()){if(b.keyCode==b.DOM_VK_ESCAPE){this.dropdown_.hide();this.getSearchOverlay_().restoreOriginalQuery();return true}}else if(b.keyCode==b.DOM_VK_DOWN&&!(b.metaKey||b.ctrlKey||b.altKey)){this.update(b.keyCode);return true}return false};
a.toggle=function(){this.getSearchBox_().focus();this.dropdown_.isVisible()?this.dropdown_.hide():this.onSuggestResultsReady(null,"",{searchType:this.getSearchType_(),parameters:this.parameters_})};a.forceHide=function(){if(this.dropdown_.isVisible()){this.dropdown_.hide();return true}return false};goog.exportSymbol("GTB_HTMLSuggest.prototype.forceHide",GTB_HTMLSuggest.prototype.forceHide);
GTB_HTMLSuggest.prototype.update=function(b){this.refreshParameters_();if(this.parameters_){var c=this.getQuery();this.getSearchOverlay_().clearSuggestIndex();c||b?SuggestRequestor.getInstance().request(this,this.parameters_.suggestPath,c,{searchType:this.getSearchType_(),parameters:this.parameters_,keyToPass:b}):this.dropdown_.hide()}else this.textChanged_=true};GTB_HTMLSuggest.arrayToJson=function(b,c){if(!b.length)return"";for(var d="[",e=0,f;f=b[e];e++){if(e)d+=",";d+=c(f)}return d+"]"};
GTB_HTMLSuggest.quoteString=function(b){b=b.replace(/\\/g,"\\\\");b=b.replace(/"/g,'\\"');return'"'+b+'"'};GTB_HTMLSuggest.highlightFragment=function(b,c){var d=RegExp(""+c+"","gi");return b.replace(d,"\\u003cb\\u003e$&\\u003c/b\\u003e")};GTB_HTMLSuggest.PADDING=":;:;:";
GTB_HTMLSuggest.prototype.onSuggestResultsReady=function(b,c,d){c||(c="");this.bookmarks_="";if((d.searchType=="gtbSearchGoogle"||d.searchType=="gtbSearchBookmarks")&&c.length>0){var e=Cc["@google.com/toolbar/bookmarks;1"].getService().wrappedJSObject;e=e.getBookmarkItems(c);this.bookmarks_=GTB_HTMLSuggest.arrayToJson(e,function(i){return["[",GTB_HTMLSuggest.highlightFragment(GTB_HTMLSuggest.quoteString(i.query),c),",",GTB_HTMLSuggest.quoteString(i.uri),"]"].join("")});if(d.searchType=="gtbSearchBookmarks"&&
c.length<3)c=GTB_HTMLSuggest.PADDING+c}this.history_="";if((e=!c)||d.searchType!="gtbSearchBookmarks"){var f=new G_Preferences("google.toolbar.");if(e||f.getPref("search_box_save_history")){e=this.historyService_.getHistoryItems(c,d.searchType);this.history_=GTB_HTMLSuggest.arrayToJson(e,function(i){return GTB_HTMLSuggest.quoteString(i.query)})}}var g=c&&'["'+c+'",[]]';this.suggest_=b||g;if(this.suggest_==g&&!this.bookmarks_&&!this.history_)this.dropdown_.hide();else{this.dropdown_.show(this.getSearchBox_(),
d.parameters);var h=this;b=function(){h.updateResults_(g);c&&d.keyToPass&&h.getComponent().onKeyDown(d.keyToPass)};if(this.getComponent())b();else this.delayedUpdate_=b}};GTB_HTMLSuggest.prototype.updateResults_=function(b){this.dropdown_.prepareForUpdate();try{this.getComponent().updateSuggestResult(this.suggest_,this.history_,this.bookmarks_)}catch(c){this.getComponent().updateSuggestResult(b,this.history_,this.bookmarks_)}this.dropdown_.resizeContent();this.clearLink_.setAttribute("visible",!this.historyService_.isEmpty())};
GTB_HTMLSuggest.prototype.getComponent=function(){return this.dropdown_.getComponent()};GTB_HTMLSuggest.prototype.nav=function(b){this.dropdown_.hide();this.getBrowser_().focus();this.swallowNextReturn_=true;this.getSearchOverlay_().loadUrl(b,this.getSearchBox_().mAltKey,null)};goog.exportSymbol("GTB_HTMLSuggest.prototype.nav",GTB_HTMLSuggest.prototype.nav);
GTB_HTMLSuggest.prototype.putQuery=function(b,c,d){if(d.indexOf(GTB_HTMLSuggest.PADDING)==0)d=d.substring(GTB_HTMLSuggest.PADDING.length);var e=c.length-1;if(c.charAt(e)=="h")c=c.substring(0,e);this.getSearchOverlay_().suggestQuery(b,c);this.getSearchOverlay_().rememberOriginalQuery(d)};goog.exportSymbol("GTB_HTMLSuggest.prototype.putQuery",GTB_HTMLSuggest.prototype.putQuery);GTB_HTMLSuggest.prototype.getQuery=function(){return this.getSearchOverlay_().getSearchText()};
goog.exportSymbol("GTB_HTMLSuggest.prototype.getQuery",GTB_HTMLSuggest.prototype.getQuery);GTB_HTMLSuggest.prototype.closeSuggestWindow=function(){this.dropdown_.hide()};goog.exportSymbol("GTB_HTMLSuggest.prototype.closeSuggestWindow",GTB_HTMLSuggest.prototype.closeSuggestWindow);
GTB_HTMLSuggest.prototype.search=function(b,c,d){this.dropdown_.hide();this.putQuery(b,c,d);b=new G_Preferences("google.toolbar.");if(b.getPref("search_box_search_on_select")){this.getBrowser_().focus();this.swallowNextReturn_=true;this.getSearchOverlay_().doSearch(null,this.getSearchBox_().mAltKey)}};goog.exportSymbol("GTB_HTMLSuggest.prototype.search",GTB_HTMLSuggest.prototype.search);GTB_HTMLSuggest.prototype.setWindowSize=function(){};
goog.exportSymbol("GTB_HTMLSuggest.prototype.setWindowSize",GTB_HTMLSuggest.prototype.setWindowSize);GTB_HTMLSuggest.prototype.usageIncrementCount=function(b){var c="Suggest";b.startsWith(c)||(b=c+b);c=this.document_.createElement("target");c.setAttribute("id","gtb"+b);this.document_.documentElement.appendChild(c);GTB_logTargetId(c);this.document_.documentElement.removeChild(c)};goog.exportSymbol("GTB_HTMLSuggest.prototype.usageIncrementCount",GTB_HTMLSuggest.prototype.usageIncrementCount);
GTB_HTMLSuggest.prototype.usageUpdateTiming=function(){};goog.exportSymbol("GTB_HTMLSuggest.prototype.usageUpdateTiming",GTB_HTMLSuggest.prototype.usageUpdateTiming);GTB_HTMLSuggest.prototype.usageSetInteger=function(){};goog.exportSymbol("GTB_HTMLSuggest.prototype.usageSetInteger",GTB_HTMLSuggest.prototype.usageSetInteger);GTB_HTMLSuggest.prototype.usageSetBoolean=function(){};goog.exportSymbol("GTB_HTMLSuggest.prototype.usageSetBoolean",GTB_HTMLSuggest.prototype.usageSetBoolean);function GTB_Suggest(b){this.debugZone="suggest";this.searchBox_=b;this.prefs_=new G_Preferences("google.toolbar.");this.searchBox_.setAttribute("disableautocomplete",false)}GTB_Suggest.prototype.getSearchOverlay_=function(){return this.searchBox_.mSearchBox};GTB_Suggest.prototype.onInput=function(b){var c=this.getSearchOverlay_();if(b.value){b=this.searchBox_.ownerDocument;(b=b.getElementById("gtbPopupAutoComplete"))&&b.selectedIndex>=0?c.setSuggestIndex(b.selectedIndex):c.rememberOriginalQuery(c.getSearchText())}else c.clearSuggestIndex()};
GTB_Suggest.prototype.onTextReverted=function(){this.getSearchOverlay_().clearSuggestIndex()};
GTB_Suggest.prototype.onTextEntered=function(b,c){var d=Cc["@mozilla.org/autocomplete/search;1?name=google-search-suggest"].getService().wrappedJSObject,e=this.searchBox_.ownerDocument;e=e.getElementById("gtbPopupAutoComplete");var f=null,g=this.getSearchOverlay_().getSuggestIndex();if(e&&g>=-1)f=d.getResult(g);if(f)if(this.prefs_.getPref("search_box_search_on_select")){if(c&1)b=true;f.uri?this.getSearchOverlay_().loadHistory(f,b,g):this.getSearchOverlay_().doSearch(null,b)}};var GTB_SUGGEST_CLOSING_EVENT_TYPES=["mousedown","resize","scroll","move","focus"];GTB_SuggestDropdownOverlay.MARGIN_X=2;GTB_SuggestDropdownOverlay.MARGIN_Y=22;
function GTB_SuggestDropdownOverlay(b,c,d){this.debugZone="GTB_SuggestDropdownOverlay";this.document_=b;this.onInit_=c;this.onComponent_=d;this.contentVersion_="none";this.anchor_=null;this.chromeWindow_=this.document_.defaultView;this.mainWindow_=this.document_.getElementById("main-window");this.container_=this.document_.getElementById("gtb-suggest-container");this.iframe_=this.document_.getElementById("gtb-suggest-iframe");this.scrollbarWidth_=GTB_getScrollbarWidth();b=this.chromeWindow_.getComputedStyle(this.container_,
"");this.direction_=b.direction;this.component_=null;this.resizer=new GTB_OverlayResizer(this.chromeWindow_,this.container_,this.direction_,"gtb-suggest-gripper","gtb-suggest-scroller",BindToObject(this.resize_,this));this.onClosingEventBound_=BindToObject(this.onClosingEvent_,this);this.onNestedFrameLoadBound_=BindToObject(this.onNestedFrameLoad_,this);this.initFrame_();this.prefs_=new G_Preferences("google.toolbar.suggest.")}a=GTB_SuggestDropdownOverlay.prototype;
a.shutdown=function(){if(this.container_){if(this.resizer){this.resizer.shutdown();this.resizer=null}this.hide();this.container_=this.iframe_=null}};a.getComponent=function(){return this.component_};a.isVisible=function(){return!this.container_.hidden};
a.show=function(b,c){if(!this.isVisible()){this.minWidth_=c.minWidth+GTB_SuggestDropdownOverlay.MARGIN_X;this.minHeight_=c.minHeight+GTB_SuggestDropdownOverlay.MARGIN_Y;this.maxWidth_=c.maxWidth+GTB_SuggestDropdownOverlay.MARGIN_X;this.maxHeight_=c.maxHeight+GTB_SuggestDropdownOverlay.MARGIN_Y;this.leftOffset_=c.leftOffset;if(this.contentVersion_!=c.version){this.contentVersion_=c.version;this.component_=null;var d=this.getNestedFrame_();d.src="about:blank";if(c.url)d.src=c.url}this.anchor_=b;this.setSize(this.prefs_.getPref("width",
c.defaultWidth==-1?this.anchor_.boxObject.width-this.leftOffset_:c.defaultWidth+GTB_SuggestDropdownOverlay.MARGIN_X),this.prefs_.getPref("height",c.defaultHeight+GTB_SuggestDropdownOverlay.MARGIN_Y));this.container_.hidden=false;this.container_.style.display="block";this.addListeners_()}};a.hide=function(){if(this.isVisible()){this.anchor_=null;this.container_.hidden=true;this.container_.style.display="none";this.removeListeners_()}};
a.addListeners_=function(){for(var b=GTB_SUGGEST_CLOSING_EVENT_TYPES,c=0;c<b.length;c++)this.chromeWindow_.addEventListener(b[c],this.onClosingEventBound_,false)};a.removeListeners_=function(){for(var b=GTB_SUGGEST_CLOSING_EVENT_TYPES,c=0;c<b.length;c++)this.chromeWindow_.removeEventListener(b[c],this.onClosingEventBound_,false)};
a.onClosingEvent_=function(b){if(this.isVisible()){var c=this.iframe_.contentDocument;if(!(b.target==this.anchor_||b.target==c||b.target.ownerDocument==c))(c=(c=this.getNestedFrame_())&&c.contentDocument)&&(b.target==c||b.target.ownerDocument==c)||this.hide()}};
a.setSize=function(b,c,d){b=Math.min(this.maxWidth_,Math.max(this.minWidth_,b));c=Math.min(this.maxHeight_,Math.max(this.minHeight_,c));if(d){this.prefs_.setPref("width",""+b);this.prefs_.setPref("height",""+c)}var e=this.mainWindow_.boxObject.width,f=this.mainWindow_.boxObject.height,g=this.anchor_.boxObject,h=g.y+g.height-1,i=this.container_.style;if(this.direction_=="rtl"){if(d)d=this.container_.boxObject.x+this.container_.boxObject.width;else{d=g.x+g.width-this.leftOffset_;d=Math.min(e,Math.max(b,
d))}b=Math.min(b,d);i.left=d-b+"px"}else{if(d)d=this.container_.boxObject.x;else{d=g.x+this.leftOffset_;d=Math.min(d,Math.max(e-b,0));i.left=d+"px"}b=Math.min(b,e-d)}i.top=h+"px";i.width=b+"px";i.height=Math.min(c,f-h)+"px";this.iframe_.style.width=i.width;this.iframe_.style.height=i.height};a.resize_=function(b,c){this.setSize(b,c,true);this.resizeContent()};
a.resizeContent=function(){this.iframe_.contentWindow.wrappedJSObject["gtb-scrollbar-width"]=this.scrollbarWidth_;this.iframe_.contentWindow.wrappedJSObject.onWindowResize();this.getComponent().onWindowResize()};a.prepareForUpdate=function(){this.iframe_.contentWindow.wrappedJSObject.prepareForUpdate()};a.getNestedFrame_=function(){try{return this.iframe_.contentDocument.getElementById("gtb-suggest-content")}catch(b){return null}};
a.initFrame_=function(){this.onInit_&&this.onInit_(this.iframe_.contentDocument);this.iframe_.contentDocument.documentElement.setAttribute("dir",this.direction_);var b=this.getNestedFrame_();b.addEventListener("load",this.onNestedFrameLoadBound_,false)};a.onNestedFrameLoad_=function(){this.component_=this.getNestedFrame_().contentWindow.wrappedJSObject;this.onComponent_&&this.onComponent_(this.component_)};
function GTB_OverlayResizer(b,c,d,e,f,g){this.chromeWindow_=b;this.box_=c;this.dirFactor_=d=="rtl"?-1:1;this.gripperId_=e;this.scrollerId_=f;this.callback_=g;this.dragging_=false;this.onMouseDownGripperBound_=BindToObject(this.onMouseDownGripper_,this);this.onMouseMoveGripperBound_=BindToObject(this.onMouseMoveGripper_,this);this.onMouseUpGripperBound_=BindToObject(this.onMouseUpGripper_,this);this.chromeWindow_.addEventListener("mousemove",this.onMouseMoveGripperBound_,true);this.chromeWindow_.addEventListener("mouseup",
this.onMouseUpGripperBound_,true);this.box_.addEventListener("mousedown",this.onMouseDownGripperBound_,true);this.ignoreEventBound_=BindToObject(this.ignoreEvent_,this);this.box_.addEventListener("resize",this.ignoreEventBound_,false)}a=GTB_OverlayResizer.prototype;
a.shutdown=function(){this.chromeWindow_.removeEventListener("mousemove",this.onMouseMoveGripperBound_,true);this.chromeWindow_.removeEventListener("mouseup",this.onMouseUpGripperBound_,true);this.box_.removeEventListener("mousedown",this.onMouseDownGripperBound_,true);this.box_.removeEventListener("resize",this.ignoreEventBound_,false)};a.ignoreEvent_=function(b){b.stopPropagation()};
a.onMouseDownGripper_=function(b){if(b.target.id==this.gripperId_){this.dragging_=true;this.startX_=b.screenX;this.startY_=b.screenY;this.startWidth_=this.box_.boxObject.width;this.startHeight_=this.box_.boxObject.height;var c=b.target.ownerDocument.documentElement.getAttribute("gtb-resize-dir");if(c)this.dirFactor_=c=="rtl"?-1:1;b.stopPropagation();b.preventDefault()}else if(!(this.scrollerId_&&b.target.id==this.scrollerId_)){b.stopPropagation();b.preventDefault()}};
a.onMouseMoveGripper_=function(b){if(this.dragging_){this.callback_(this.startWidth_+(b.screenX-this.startX_)*this.dirFactor_,this.startHeight_+(b.screenY-this.startY_));b.stopPropagation();b.preventDefault()}};a.onMouseUpGripper_=function(b){if(this.dragging_){this.dragging_=false;b.stopPropagation();b.preventDefault()}};function GTB_SuggestTreeView(){this.debugZone="suggest-treeview";this.view_=null;this.suggestService_=Cc["@mozilla.org/autocomplete/search;1?name=google-search-suggest"].getService().wrappedJSObject;for(var b=["canDrop","cycleCell","cycleHeader","drop","getCellProperties","getCellText","getCellValue","getColumnProperties","getLevel","getParentIndex","getProgressMode","getRowProperties","hasNextSibling","isContainer","isContainerEmpty","isContainerOpen","isEditable","isSeparator","isSorted","performAction",
"performActionOnCell","performActionOnRow","selectionChanged","setCellText","setCellValue","setTree","toggleOpenState"],c=0,d=null;d=b[c];++c)this[d]=BindToObject(this.forwardMethod_,this,d)}GTB_SuggestTreeView.prototype.forwardMethod_=function(b){var c=Array.prototype.slice.call(arguments,1);return this.view_[b].apply(this.view_,c)};GTB_SuggestTreeView.prototype.setView=function(b){this.view_=b};GTB_SuggestTreeView.prototype.getImageSrc=function(b,c){if(c.id=="treecolAutoCompleteValue")return this.suggestService_.getResultIcon(b)};
GTB_SuggestTreeView.prototype.QueryInterface=function(b){if(b.equals(Ci.nsITreeView)||b.equals(Ci.nsISupports))return this;throw Cr.NS_ERROR_NO_INTERFACE;};GTB_SuggestTreeView.prototype.__defineGetter__("rowCount",function(){return this.view_.rowCount});GTB_SuggestTreeView.prototype.__defineGetter__("selection",function(){return this.view_.selection});GTB_SuggestTreeView.prototype.__defineSetter__("selection",function(b){this.view_.selection=b});
GTB_SuggestTreeView.prototype.controller=function(){if(this.view_)return this.view_.QueryInterface(Ci.nsIAutoCompleteController);return null};function GTB_ToolbarItemVisiblityTracker(b,c,d){this.itemId_=c;this.doc_=b;this.callback_=d;this.onToolbarAttributeModificationBound_=BindToObject(this.checkIfVisibilityChanged_,this);this.toolbar_=null;this.observer_=new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.onCustomize_,this));this.checkIfToolbarChanged_();this.visible_=!!this.toolbar_&&GTB_isToolbarVisible(this.toolbar_)}goog.exportSymbol("GTB_ToolbarItemVisiblityTracker",GTB_ToolbarItemVisiblityTracker);a=GTB_ToolbarItemVisiblityTracker.prototype;
a.debugZone="GTB_ToolbarItemVisiblityTracker";a.shutdown=function(){this.observer_.unregister();this.setToolbar_(null)};a.checkIfToolbarChanged_=function(){var b=this.doc_.getElementById(this.itemId_);b=b&&GTB_findToolbar(b);b!=this.toolbar_&&this.setToolbar_(b)};
a.setToolbar_=function(b){var c=this.toolbar_;c&&c.removeEventListener("DOMAttrModified",this.onToolbarAttributeModificationBound_,false);b&&b.addEventListener("DOMAttrModified",this.onToolbarAttributeModificationBound_,false);this.toolbar_=b};a.checkIfVisibilityChanged_=function(){var b=!!this.toolbar_&&GTB_isToolbarVisible(this.toolbar_);if(this.visible_!=b){this.visible_=b;this.callback_()}};a.onCustomize_=function(){this.checkIfToolbarChanged_();this.checkIfVisibilityChanged_()};
a.isButtonVisible=function(){return this.visible_};goog.exportProperty(GTB_ToolbarItemVisiblityTracker.prototype,"isButtonVisible",GTB_ToolbarItemVisiblityTracker.prototype.isButtonVisible);function GTB_XThis(b,c){this.debugZone="xthis";this.tabWatcher_=b;this.win_=c;this.mailToContent_=null;this.closeBrowser_=false;this.prefs_=new G_Preferences("google.toolbar.",false,true);GTB_RegisterListener(b,"pageshow",this.doPageShow,this)}GTB_XThis.prototype.onSendToContextPopup=function(){var b={blogthis:"gtbSendToBloggerContextMenuitem",gmailthis:"gtbSendToMailContextMenuitem"};this.showHideMenuitems_(b)};goog.exportSymbol("GTB_XThis.prototype.onSendToContextPopup",GTB_XThis.prototype.onSendToContextPopup);
a=GTB_XThis.prototype;a.onSendToPopup=function(){var b={blogthis:"gtbSendToBlogger",gmailthis:"gtbSendToMail"};this.showHideMenuitems_(b)};a.showHideMenuitems_=function(b){var c=GTB_getGoogleHome();c=GTB_GOOGLE_HOME_DICT[c].features;for(var d in b){var e=!!c[d],f=this.win_.document.getElementById(b[d]);if(f)f.hidden=!e}};a.getData_=function(b,c){var d=this.tabWatcher_.getCurrentWindow(),e=this.win_;return new GTB_XThisPageData(d,GetFocusedWindow(e).getSelection(),b,c)};
a.doPageShow=function(b){var c=b.doc.location.href;if(this.closeBrowser_&&c=="http://toolbar.google.com/command?close_browser"){b.doc.defaultView.close();this.closeBrowser_=false}else{if(this.closeBrowser_&&c.indexOf("mail.google.com/mail/?tf=1")!=-1&&c.indexOf("&act=sm")!=-1){for(b=b.doc.defaultView;b.parent!=b;)b=b.parent;new G_Alarm(BindToObject(b.close,b),2E3)}if(this.mailToContent_)if("http://toolbar.google.com/command?send_to_gmail"==c){c="mime="+encodeURIComponent(this.mailToContent_);c=GTB_createPostDataStream(c);
b=this.prefs_.getPref("mailthis_url");var d=GTB_getCookie(b,"GMAIL_AT");if(!d&&b.startsWith("http:")){var e="https:"+b.substring(5);if(d=GTB_getCookie(e,"GMAIL_AT"))b=e}b+=d;this.win_.loadURI(b,null,c);this.closeBrowser_=true;this.mailToContent_=null}}};a.onBlogThis=function(b){var c=this.getData_(),d=this.prefs_.getPref("blogthis_url");this.makeRequest_(b,d,GTB_createPostDataStream(c.makeBloggerPostData()))};goog.exportSymbol("GTB_XThis.prototype.onBlogThis",GTB_XThis.prototype.onBlogThis);
GTB_XThis.prototype.onSendMail=function(b,c){var d=this.getData_(!c,b.shiftKey).makeGmailMimeData(),e=this.win_.whereToOpenLink(b);this.showComposeMailWindow(e,d)};goog.exportSymbol("GTB_XThis.prototype.onSendMail",GTB_XThis.prototype.onSendMail);GTB_XThis.prototype.showComposeMailWindow=function(b,c){this.mailToContent_=c;var d=this.prefs_.getPref("mailthis_login_url","http://mail.google.com/mail/?tb=4");this.makeRequest_(b,d)};
GTB_XThis.prototype.onSendLink=function(b){var c=Cc["@google.com/toolbar/content-prefs;1"].getService().wrappedJSObject;c.mailtoEnabled&&this.onSendMail(b,true)};goog.exportSymbol("GTB_XThis.prototype.onSendLink",GTB_XThis.prototype.onSendLink);
GTB_XThis.prototype.makeRequest_=function(b,c,d){if("tab"==b){b=this.tabWatcher_.getTabBrowser();b.selectedTab=b.addTab(c,null,null,d)}else{b="chrome,dialog=no,status=yes,resizable=yes,scrollbars=yes,minimizeable=yes";b=this.win_.openDialog(this.win_.getBrowserURL(),"_blank",b,"about:blank");b.addEventListener("load",BindToObject(this.windowOpened_,this,b,c,d),false)}};GTB_XThis.prototype.windowOpened_=function(b,c,d){b.setTimeout(BindToObject(this.loadURI_,this,b,c,d),50)};
GTB_XThis.prototype.loadURI_=function(b,c,d){b.GTB_getToolbar().xThis.mailToContent_=this.mailToContent_;this.mailToContent_=null;b.resizeTo(800,550);b.loadURI(c,null,d)};function GTB_XThisPageData(b,c,d,e){this.location=b.document.location.href;this.title=b.document.title;this.window_=b;this.selection_=c;this.includeSelectedHTML_=!!d;this.allowFullPage_=!!e}a=GTB_XThisPageData.prototype;
a.getSelectedHTML_=function(){var b;try{b=this.selection_.getRangeAt(0)}catch(c){}var d=this.window_.document;if(!b||b.collapsed){if(!this.allowFullPage_)return"";b=d.body;if(b.tagName=="FRAMESET"){d=b.offsetWidth;var e=b.offsetHeight;b=this.convertFrameset_(b,d,e);return"<div style='width: 100%; height: 0'>"+b+"</div>"}else return this.convertDocumentBody_(d)}else{d=d.createElement("div");d.appendChild(b.cloneContents());e=d;b=b;gtbCopyFormContentsForTag(e,b,"input");gtbCopyFormContentsForTag(e,
b,"option");this.adjustForGeneralContext_(d);return"<div style='"+d.style.cssText+"'>"+d.innerHTML+"</div>"}};
a.adjustForGeneralContext_=function(b){for(var c=b.getElementsByTagName("img"),d=Date.now(),e=0,f=null;f=c[e];++e){f.setAttribute("src",f.src);if(Date.now()-d>500)break}c=b.getElementsByTagName("a");e=0;for(f=null;f=c[e];++e){f.setAttribute("href",f.href);if(Date.now()-d>500)break}c=b.getElementsByTagName("form");e=0;for(f=null;f=c[e];++e){f.action&&f.setAttribute("action",f.action);if(Date.now()-d>500)break}d=b.ownerDocument.defaultView;d=new GTB_XThisPageStyleCorrector(d);d.processElementRecursively(b)};
a.convertFrameset_=function(b,c,d){c=this.convertFramesetRowCols_(b.cols,c);d=this.convertFramesetRowCols_(b.rows,d);var e=["<table style='border-collapse: collapse; border: 0; border-spacing: 0; padding: 0; width: 100%; height: 100%; table-layout: fixed;'>\n"];b=b.childNodes;for(var f=0,g=0;g<d.length;g++){e.push("<tr valign=top>\n");for(var h=0;h<c.length;h++){for(var i=null;!i&&f<b.length;){var j=b[f++],k=j&&j.tagName;switch(k){case "FRAMESET":i=this.convertFrameset_(j,c[h].originalLength,d[g].originalLength);
break;case "FRAME":i=this.convertFrame_(j);break;default:break}}j="";if(g>0)j+="border-top: 1px solid #b9b9b9; ";if(h>0)j+="border-left: 1px solid #b9b9b9; ";e.push("<td width=",c[h].length," height=",d[g].originalLength);j!=""&&e.push(" style='",j,"' ");e.push(">\n");i&&e.push(i);e.push("</td>\n")}e.push("</tr>\n")}e.push("</table>\n");return e.join("")};
a.convertFrame_=function(b){var c=b.getAttribute("SCROLLING"),d="auto";if(typeof c=="string"){c=c.toLowerCase();d=c=="no"?"hidden":c=="auto"?"hidden":"scroll"}else if(typeof c=="boolean")d=c?"scroll":"hidden";c="width: 100%; height: 100%; overflow:"+d;b=b&&b.contentDocument;return"<div style='"+c+"'><div style='padding: 3px'>"+this.convertDocumentBody_(b)+"</div></div>"};
a.convertDocumentBody_=function(b){if(b&&b.body){var c=b.body.cloneNode(true),d=c;b=b;gtbCopyFormContentsForTag(d,b,"input");gtbCopyFormContentsForTag(d,b,"option");this.adjustForGeneralContext_(c);return"<div style='"+c.style.cssText+"'>"+c.innerHTML+"</div>"}else return""};
a.convertFramesetRowCols_=function(b,c){var d=",",e=c>0?100/c:0,f=c;d=typeof b!="undefined"?b.split(d):[];for(var g=[],h=function(){if(g.length>0)f=Math.max(0,f-1)},i=0,j=0;j!=d.length;++j){var k=d[j];k=k.replace(/^\s+|\s+$/g,"","");if(k!="")if(k=="*"){i++;h();g.push("*")}else{var l=k.indexOf("%");if(l!=-1){k=parseInt(k.substr(0,l),10);if(!isNaN(k)){k=Math.floor(c*k/100);h();if(k>f)k=f;f-=k;g.push({length:k*e+"%",originalLength:k})}}else{k=parseInt(k,10);if(!isNaN(k)){h();if(k<0)k=0;if(k>f)k=f;f-=
k;g.push({length:k+"px",originalLength:k})}}}}for(j=0;j!=g.length;j++)if(g[j]=="*"){k=Math.floor(f/i);i--;f-=k;g[j]={length:k*e+"%",originalLength:k}}if(g.length<=1){k=c;g=[{length:k*e+"%",originalLength:k}]}return g};
a.makeGmailMimeData=function(){var b="{------------";b+=Math.floor(Math.random()*32767);b+=Math.floor(Math.random()*32767);b+=Math.floor(Math.random()*32767);b+="}";var c=this.includeSelectedHTML_&&this.getSelectedHTML_(),d=["<a href='",this.location,"'>",c&&this.title?this.escapeHtml_(this.title):this.location,"</a>"];c&&d.push("<br /><br />",c);c=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);c=c.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");
c=c.formatStringFromName("prop.gtb.sendto.gmailsubject",[this.title||this.location],1);c=c.replace(/\r?\n/g," ");return"Mime-Version: 1.0\r\nSubject: "+c+'\r\nContent-Type: Multipart/related; boundary="'+b+'"\r\n\r\n--'+b+"\r\nContent-Type: Text/HTML\r\n\r\n"+d.join("")+"\r\n--"+b+"--\r\n;"};
a.makeBloggerPostData=function(){var b=["source=toolbar-firefox"];b.push("&u=",encodeURIComponent(this.location));b.push("&n=",encodeURIComponent(this.title));var c=this.selection_.toString().trim();b.push("&t=",encodeURIComponent(this.escapeHtml_(c)));return b.join("")};a.escapeHtml_=function(b){var c=this.window_.document,d=c.createElement("span");d.appendChild(c.createTextNode(b));return d.innerHTML};function GTB_XThisPage_AbstractCssCorrectionRule(){}
GTB_XThisPage_AbstractCssCorrectionRule.prototype.apply=function(){throw Error("Abstract method called");};function GTB_XThisPage_SimpleCopyRule(b,c){this.cssPropertyName_=b;this.defaultValue_=c}GTB_XThisPage_SimpleCopyRule.inherits(GTB_XThisPage_AbstractCssCorrectionRule);GTB_XThisPage_SimpleCopyRule.prototype.apply=function(b,c){var d=c.getPropertyValue(this.cssPropertyName_);if(d!=this.defaultValue_)b[this.cssPropertyName_]=d};
function GTB_XThisPage_CopyIfChangedRule(b){this.cssPropertyName_=b}GTB_XThisPage_CopyIfChangedRule.inherits(GTB_XThisPage_AbstractCssCorrectionRule);GTB_XThisPage_CopyIfChangedRule.prototype.apply=function(b,c,d){c=c.getPropertyValue(this.cssPropertyName_);if(d){d=d.getPropertyValue(this.cssPropertyName_);if(c!=d)b[this.cssPropertyName_]=c}else b[this.cssPropertyName_]=c};function GTB_XThisPageStyleCorrector(b){this.window_=b}
GTB_XThisPageStyleCorrector.prototype.rulesForAllElements_=[new GTB_XThisPage_SimpleCopyRule("background-image","none"),new GTB_XThisPage_SimpleCopyRule("background-color","transparent"),new GTB_XThisPage_SimpleCopyRule("background-repeat","repeat"),new GTB_XThisPage_SimpleCopyRule("padding-bottom","0px"),new GTB_XThisPage_SimpleCopyRule("padding-left","0px"),new GTB_XThisPage_SimpleCopyRule("padding-right","0px"),new GTB_XThisPage_SimpleCopyRule("padding-top","0px"),new GTB_XThisPage_SimpleCopyRule("left",
"auto"),new GTB_XThisPage_SimpleCopyRule("right","auto"),new GTB_XThisPage_SimpleCopyRule("top","auto"),new GTB_XThisPage_SimpleCopyRule("bottom","auto")];GTB_XThisPageStyleCorrector.prototype.rulesNotForFont_=[new GTB_XThisPage_CopyIfChangedRule("color"),new GTB_XThisPage_CopyIfChangedRule("font-weight"),new GTB_XThisPage_CopyIfChangedRule("font-style"),new GTB_XThisPage_CopyIfChangedRule("font-family"),new GTB_XThisPage_CopyIfChangedRule("font-size")];
GTB_XThisPageStyleCorrector.prototype.processElementRecursively=function(b,c){for(var d=this.window_.getComputedStyle(b,null),e=b.childNodes,f=0;f<e.length;f++){var g=e[f];g.nodeType==Ci.nsIDOMNode.ELEMENT_NODE&&this.processElementRecursively(g,d)}var h={};e=function(j){j.apply(h,d,c)};this.rulesForAllElements_.forEach(e);b.tagName!="FONT"&&this.rulesNotForFont_.forEach(e);e=[];for(var i in h)e.push(i+": "+h[i]);e.length>0?b.setAttribute("style",e.join("; ")):b.removeAttribute("style")};function GTB_ProtocolHandler(){this.debugZone="ph_UNDEFINED";var b=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);this.http_=b.getProtocolHandler("http")}GTB_ProtocolHandler.prototype.__defineGetter__("scheme",function(){return this.scheme_});GTB_ProtocolHandler.prototype.__defineGetter__("protocolFlags",function(){return this.http_.protocolFlags});GTB_ProtocolHandler.prototype.__defineGetter__("defaultPort",function(){return this.http_.defaultPort});
GTB_ProtocolHandler.prototype.allowPort=function(b,c){return this.http_.allowPort(b,c)};GTB_ProtocolHandler.prototype.newURI=function(b,c,d){return this.http_.newURI(b,c,d)};GTB_ProtocolHandler.prototype.newChannel=function(){};GTB_ProtocolHandler.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIProtocolHandler)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};function GTB_DummyChannel(b){this.contentType="text/html";this.originalURI=this.URI=b}a=GTB_DummyChannel.prototype;
a.QueryInterface=function(b){if(!b.equals(Ci.nsIChannel)&&!b.equals(Ci.nsIRequest)&&!b.equals(Ci.nsISupports))throw Components.results.NS_ERROR_NO_INTERFACE;return this};a.loadFlags=null;a.contentLength=0;a.owner=null;a.loadGroup=null;a.notificationCallbacks=null;a.securityInfo=null;a.open=GTB_DummyChannel.prototype.asyncOpen=function(){this.handleOpenRequest_();Components.returnCode=Components.results.NS_ERROR_NO_CONTENT};
a.handleOpenRequest_=function(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getMostRecentWindow("navigator:browser");b=new b.nsBrowserAccess;b.openURI(this.URI,null,Ci.nsIBrowserDOMWindow.OPEN_DEFAULTWINDOW,null)};a.isPending=function(){return true};a.cancel=function(b){this.status=b};a.suspend=GTB_DummyChannel.prototype.resume=function(){throw Components.results.NS_ERROR_NOT_IMPLEMENTED;};function GTB_DragDropHandler(b){this.debugZone="drophandler";this.win_=b;this.ios_=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);b=this.win_.document.getElementById("content");b.addEventListener("drop",BindToObject(this.onDrop,this),true);b.addEventListener("dragdrop",BindToObject(this.onDrop,this),true);b=Cc["@mozilla.org/network/protocol;1?name=http"].getService(Ci.nsIHttpProtocolHandler).oscpu;this.dataFlavor="text/x-moz-url";if(b.indexOf("Mac")>-1||b.indexOf("Win")>-1)this.dataFlavor=
"application/x-moz-file"}GTB_DragDropHandler.prototype.__defineGetter__("dragService_",function(){if(!this.dragService__)this.dragService__=Cc["@mozilla.org/widget/dragservice;1"].getService(Ci.nsIDragService);return this.dragService__});GTB_DragDropHandler.prototype.__defineGetter__("dragSession_",function(){return this.dragService_.getCurrentSession()});
GTB_DragDropHandler.prototype.onDrop=function(b){var c=Cc["@google.com/toolbar/content-prefs;1"].getService().wrappedJSObject;if(!(!c.enabled||!c.dropEnabled||!this.dragSession_||!GTB_isGoogleToolbarActive())){var d=[],e=Cc["@mozilla.org/widget/transferable;1"].createInstance(Ci.nsITransferable);e.addDataFlavor(this.dataFlavor);for(var f=0;f<this.dragSession_.numDropItems;f++){var g=this.getFileDropped_(e,f);if(g!=null)if(!g.isDirectory()){var h=null;if(g.isFile()){var i=g.path.lastIndexOf(".");if(i!=
-1)h=g.path.substr(i+1).toLowerCase()}c.fileTypes[h]&&c.fileTypes[h].enabled&&c.fileTypes[h].type=="writely"&&d.push(g)}}if(d.length>0){c=new GTB_DocsFileUploader;c.uploadFiles(d);b.stopPropagation();this.dragSession_.endDragSession(true)}}};
GTB_DragDropHandler.prototype.getFileDropped_=function(b,c){try{this.dragSession_.getData(b,c)}catch(d){return null}var e=b.flavorsTransferableCanExport();if(e.Count()!=1||e.GetElementAt(0).QueryInterface(Ci.nsISupportsCString)!=this.dataFlavor)return null;e={};var f={};try{b.getTransferData(this.dataFlavor,e,f)}catch(g){return null}if(this.dataFlavor=="application/x-moz-file")return e.value.QueryInterface(Ci.nsIFile);else{e=e.value.QueryInterface(Ci.nsISupportsString).toString();e=e.trim();e=this.ios_.newURI(e,
null,null);if(e==null||e.scheme!="file")return null;f=this.ios_.getProtocolHandler("file").QueryInterface(Ci.nsIFileProtocolHandler);return f.getFileFromURLSpec(e.spec)}};function GTB_CommandLineHandler(){}a=GTB_CommandLineHandler.prototype;a.QueryInterface=function(b){if(b.equals(Ci.nsICommandLineHandler)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};a.helpText="-GoogleToolbar            Opens files with toolbar";a.handle=function(b){if(!this.handleUninstall_(b)){var c=Cc["@google.com/toolbar/content-prefs;1"].getService().wrappedJSObject;c.parseCommandLine(b)}};
a.getWindow_=function(){try{var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);return b.getMostRecentWindow("navigator:browser")}catch(c){}return null};
a.handleUninstall_=function(b){if(b.handleFlag("UninstallGoogleToolbarSilent",true)){GTB_UninstallExtension("3112ca9c-de6d-4884-a869-9855de68056c");return b.preventDefault=true}if(b.handleFlag("UninstallGoogleToolbarVerbose",true)){var c=this.getWindow_();if(c){GTB_ShowUninstallDialog(c);b.preventDefault=true}else GTB_Uninstaller.uninstallVerboseAndShutdown=true;return true}return false};var GTB_IgnoreOnceUrls={};
function GTB_MimeTypeHandler(b,c,d,e){this.mimeType_=b;this.extension_=c;this.newURI_=d;this.debugZone="MimeCH_"+c;this.bundleService_=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);this.stringBundle_=this.bundleService_.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.localePrefs_=e;this.prefs_=new G_Preferences("google.toolbar.contenthandling.");this.observers_=[new G_ObserverServiceObserver("http-on-modify-request",BindToObject(this.onModifyRequest_,
this)),new G_ObserverServiceObserver("xpcom-shutdown",BindToObject(this.shutdown,this))];this.lastRequestTime=new Date(0)}a=GTB_MimeTypeHandler.prototype;
a.handleContent=function(b,c,d){if(!this.localePrefs_.getBoolPref("docs_spreadsheets_available"))throw 2153578497;if(!GTB_isGoogleToolbarActive())throw 2153578497;var e=Cc["@google.com/toolbar/content-prefs;1"].getService().wrappedJSObject;d=d.QueryInterface(Ci.nsIChannel);if(GTB_IgnoreOnceUrls[d.URI.spec]){delete GTB_IgnoreOnceUrls[d.URI.spec];throw 2153578497;}b=!!(d&&d.URI.scheme.indexOf("http")==0);var f=d.URI.path.replace(/[\?\#].*/,""),g=f.substr(f.lastIndexOf(".")+1).toLowerCase();f=g==this.extension_||
!this.extension_&&e.fileTypes[g];e=(g=e.enabled&&e.mimeEnabled&&e.fileTypes[g]&&e.fileTypes[g].enabled)&&b&&f;if(!g&&b&&this.extension_){b=this.prefs_.getPref("prompt.mimetype",false);f=Cc["@mozilla.org/mime;1"].getService(Ci.nsIMIMEService);f=f.getFromTypeAndExtension(this.mimeType_,null);if(!b&&!f.hasDefaultHandler){e=this.promptToHandle();this.prefs_.setPref("prompt.mimetype",true)}}if(e&&c){b=this.newURI_.replace("{URL}",encodeURIComponent(d.URI.spec));b=b.replace("{HOST}",this.prefs_.getPref("writely.uploadURL",
"http://docs.google.com/"));e=c.getInterface(Ci.nsIWebNavigation);b=BindToObject(e.loadURI,e,b,Ci.nsIWebNavigation.LOAD_FLAGS_NONE,null,null,null);GTB_OverrideUserAgent(b);this.lastRequestTime=new Date;this.showMessage_(c,d.URI)}else throw 2153578497;};a.promptToHandle=function(){return false};a.showMessage_=function(b,c){var d=GTB_getBrowserAndWindowFromDocShell(b.getInterface(Ci.nsIDocShell));if(d!=null){var e=d.window.GTB_getToolbar().contentPopup;e&&e.showLoadingMessage(d.browser,c)}};
a.onModifyRequest_=function(b,c){if(!(new Date-this.lastRequestTime>6E4))if(!(!b||c!="http-on-modify-request")){var d;try{d=b.QueryInterface(Ci.nsIHttpChannel)}catch(e){return}var f=this.prefs_.getPref("writely.uploadURL","http://docs.google.com/"),g="";try{g=d.URI.host}catch(h){return}var i=d.getRequestHeader("user-agent");f.indexOf(g)>=0&&d.URI.spec.indexOf("action=updoc")>=0&&i.indexOf(" GoogleToolbarFF")==-1&&d.setRequestHeader("user-agent",i+" GoogleToolbarFF",false)}};
a.shutdown=function(){for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.observers_=null};var GTB_CAPABILITY_CLIPBOARD_ALLOWED_SITES=["http://doc.google.com","http://docs.google.com","http://spreadsheets.google.com","https://doc.google.com","https://docs.google.com","https://spreadsheets.google.com"];
function GTB_ContentPrefsService(){this.debugZone="chPrefs";this.wrappedJSObject=this;this.fileTypes={doc:{mime:{"application/msword":"{65aa8c36-6b12-4eb7-b4f7-360f40c3ffc4}"},enabled:false,type:"writely"},rtf:{mime:{"application/rtf":"{f87151fe-d5d1-421e-8000-d860836d7cf8}","text/rtf":"{091369a7-5de7-4ac0-8520-db9c9017e6ea}"},enabled:false,type:"writely"},odt:{mime:{"application/vnd.oasis.opendocument.text":"{0de54fb1-1dae-405b-9f51-9b102c0d51ef}"},enabled:false,type:"writely"},sxw:{mime:{"application/vnd.sun.xml.writer":"{a47e8f83-d6a8-45f7-8d3d-adf531a86931}"},
enabled:false,type:"writely"},xls:{mime:{"application/vnd.ms-excel":"{f99cb16f-94a8-44c1-99eb-a0bf19f0b442}"},enabled:false,type:"writely"},ppt:{mime:{"application/vnd.ms-powerpoint":"{e1e49160-e92f-11dc-95ff-0800200c9a66}"},enabled:false,type:"writely"},csv:{mime:{"text/csv":"{02d47007-57f4-4e0a-9c1e-49dd6dda2c8c}"},enabled:false,type:"writely"},ods:{mime:{"application/vnd.oasis.opendocument.spreadsheet":"{28d4bfde-9998-4fb5-8b58-2c12433b67ff}"},enabled:false,type:"writely"}};this.autoContentTypes=
{"application/octet-stream":"{2fc11440-fd26-4df1-9d35-ee2f0351c428}"};this.delayedOpenFunc_=this.prefs_=null}GTB_ContentPrefsService.prototype.registerHandlers=function(b,c){for(var d in this.fileTypes)this.registerTypeHandlers_(b,this.fileTypes[d].mime,d,c);this.registerTypeHandlers_(b,this.autoContentTypes,null,c)};goog.exportProperty(GTB_ContentPrefsService.prototype,"registerHandlers",GTB_ContentPrefsService.prototype.registerHandlers);a=GTB_ContentPrefsService.prototype;
a.registerTypeHandlers_=function(b,c,d,e){for(var f in c)b.registerObject(c[f],"@mozilla.org/uriloader/content-handler;1?type="+f,"Google Toolbar "+f,new GTB_MimeTypeHandler(f,d,"{HOST}?action=updoc&formsubmitted=true&client=navclient-ff&uploadURL={URL}",e))};
a.init=function(){this.prefs_=new G_Preferences("google.toolbar.");this.enabled=this.prefs_.getPref("contenthandling.enabled",false);this.dropEnabled=this.prefs_.getPref("contenthandling.actions.drag",false);this.mimeEnabled=this.prefs_.getPref("contenthandling.actions.link",false);(this.mailtoEnabled=this.prefs_.getPref("mailto.opt",false))&&!this.prefs_.getPref("mailto.cachedPrefs",false)&&this.enableMailto_();this.prefs_.addObserver("contenthandling.enabled",BindToObject(this.onEnabledPrefChanged_,
this));this.prefs_.addObserver("contenthandling.actions.associate",BindToObject(this.onFileAssociationPrefChanged_,this));this.prefs_.addObserver("contenthandling.actions.drag",BindToObject(this.onDragDropPrefChanged_,this));this.prefs_.addObserver("contenthandling.actions.link",BindToObject(this.onMimeTypePrefChanged_,this));this.prefs_.addObserver("mailto.opt",BindToObject(this.onMailtoPrefChanged_,this));this.prefs_.addObserver("contenthandling.clipboard",BindToObject(this.onClipboardPrefChanged_,
this));for(var b in this.fileTypes){this.fileTypes[b].enabled=this.prefs_.getPref("contenthandling.files."+b,false);this.prefs_.addObserver("contenthandling.files."+b,BindToObject(this.onFileTypePrefChanged_,this,b))}if(this.delayedOpenFunc_){this.delayedOpenFunc_();this.delayedOpenFunc_=null}};
a.parseCommandLine=function(b){var c=b.findFlag("GoogleToolbar",true);if(!(c<0||b.length<c+3)){var d=b.getArgument(c+1).replace(".",""),e=b.getArgument(c+2);if(this.prefs_){if(this.openFile(d,e)){b.removeArguments(c,c+2);b.preventDefault=true}}else{this.delayedOpenFunc_=BindToObject(this.openFile,this,d,e);b.removeArguments(c,c+2)}}};
a.openFile=function(b,c){if(this.enabled&&b&&this.fileTypes[b]&&this.fileTypes[b].enabled&&this.fileTypes[b].type=="writely"){var d=Cc["@mozilla.org/file/local;1"].createInstance(Ci.nsILocalFile);d.initWithPath(c);var e=new GTB_DocsFileUploader;new G_Alarm(BindToObject(e.uploadFiles,e,[d]),0);return true}return false};
a.onEnabledPrefChanged_=function(){(this.enabled=this.prefs_.getPref("contenthandling.enabled",false))&&this.prefs_.getPref("contenthandling.actions.associate",false)?this.associateAllFiles():this.unassociateAllFiles();this.enabled&&this.prefs_.getPref("contenthandling.clipboard",false)?this.enableClipboardSupport():this.disableClipboardSupport()};
a.onFileAssociationPrefChanged_=function(){var b=this.prefs_.getPref("contenthandling.actions.associate",false);b&&this.enabled?this.associateAllFiles():this.unassociateAllFiles()};a.associateAllFiles=function(){for(var b in this.fileTypes)this.fileTypes[b].enabled&&this.associateFile(b)};a.unassociateAllFiles=function(){for(var b in this.fileTypes)this.unassociateFile(b)};a.onDragDropPrefChanged_=function(){this.dropEnabled=this.prefs_.getPref("contenthandling.actions.drag",false)};
a.onMimeTypePrefChanged_=function(){this.mimeEnabled=this.prefs_.getPref("contenthandling.actions.link",false)};a.onMailtoPrefChanged_=function(){if(this.prefs_.getPref("mailto.opt",false)&&!this.mailtoEnabled)this.enableMailto_();else!this.prefs_.getPref("mailto.opt",false)&&this.mailtoEnabled&&this.disableMailto_()};a.restoreFirefoxMailtoPrefs=function(){if(this.prefs_.getPref("mailto.opt",false)){this.disableMailto_();this.prefs_.clearPref("mailto.cachedPrefs")}};
a.restoreToolbarMailtoPrefs=function(){this.prefs_.getPref("mailto.opt",false)&&this.enableMailto_()};a.onClipboardPrefChanged_=function(){this.prefs_.getPref("contenthandling.clipboard",false)&&this.enabled?this.enableClipboardSupport():this.disableClipboardSupport()};
a.onFileTypePrefChanged_=function(b){this.fileTypes[b].enabled=this.prefs_.getPref("contenthandling.files."+b,false);if(this.fileTypes[b].enabled&&this.prefs_.getPref("contenthandling.actions.associate",false)&&this.enabled)this.associateFile(b);else this.fileTypes[b].enabled||this.unassociateFile(b)};a.associateFile=function(b){try{var c=Cc["@google.com/fileassociation;1"].createInstance(Ci.GTBIFileAssociation);c.isDefaultFor(b)||c.setDefaultFor(b)}catch(d){}};
a.unassociateFile=function(b){try{var c=Cc["@google.com/fileassociation;1"].createInstance(Ci.GTBIFileAssociation);c.isDefaultFor(b)&&c.clearDefaultFor(b)}catch(d){}};a.enableClipboardSupport=function(){var b=["Clipboard.cutcopy","Clipboard.paste","javascript.enabled"],c=Cc["@google.com/toolbar/caps-manager;1"].getService().wrappedJSObject;c.allow(GTB_CAPABILITY_CLIPBOARD_ALLOWED_SITES,b)};
a.disableClipboardSupport=function(){var b=["Clipboard.cutcopy","Clipboard.paste"],c=Cc["@google.com/toolbar/caps-manager;1"].getService().wrappedJSObject;c.forbid(GTB_CAPABILITY_CLIPBOARD_ALLOWED_SITES,b)};
a.enableMailto_=function(){this.mailtoEnabled=true;var b=new G_Preferences("network.protocol-handler.");this.prefs_.setPref("mailto.old-expose",b.getPref("expose.mailto",false));b.setPref("expose.mailto",true);this.prefs_.setPref("mailto.old-external",b.getPref("external.mailto",true));b.setPref("external.mailto",false);this.prefs_.setPref("mailto.old-warn-external",b.getPref("warn-external.mailto",false));b.setPref("warn-external.mailto",false);this.prefs_.setPref("mailto.cachedPrefs",true)};
a.disableMailto_=function(){this.mailtoEnabled=false;var b=new G_Preferences("network.protocol-handler.");b.setPref("expose.mailto",this.prefs_.getPref("mailto.old-expose",false));b.setPref("external.mailto",this.prefs_.getPref("mailto.old-external",true));b.setPref("warn-external.mailto",this.prefs_.getPref("mailto.old-warn-external",false))};var GTB_ContentHandlingMessageId="GoogleToolbarDocMessage";
function GTB_ContentHandlingPopup(b,c){this.debugZone="CHPopup";this.win_=b;this.tabWatcher_=c;GTB_RegisterListener(c,"load",this.onPageShow_,this);this.locationChangeCallback_=GTB_BindListener(this.onLocationChange,this,"locationchange");this.webprogress_=Cc["@google.com/toolbar/web-progress-listener;1"].getService().wrappedJSObject;this.webprogress_.addWindowListener(this.win_,this.locationChangeCallback_,Ci.nsIWebProgress.NOTIFY_LOCATION);this.prefs_=new G_Preferences("google.toolbar.");this.ios_=
Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);this.fileProtocolHandler_=Cc["@mozilla.org/network/protocol;1?name=file"].getService(Ci.nsIFileProtocolHandler);var d=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);this.stringBundle_=d.createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.featureListService_=Cc["@google.com/toolbar/locale-features-list-service;1"].getService().wrappedJSObject;this.observer=new G_ObserverServiceObserver(GTB_ContentHandlingMessageId,
BindToObject(this.onChooseApplication,this));this.popups=[{check:BindToObject(this.shouldShowGMailPopup_,this),show:BindToObject(this.showGMailPopup_,this)},{check:BindToObject(this.shouldShowDocsPopup_,this),show:BindToObject(this.showDocsPopup_,this)}]}a=GTB_ContentHandlingPopup.prototype;a.shutdown=function(){this.observer.unregister();this.webprogress_.removeWindowListener(this.win_,this.locationChangeCallback_)};
a.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsIInterfaceRequestor)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};a.getInterface=function(b){return this.QueryInterface(b)};
a.onLocationChange=function(b,c,d){if(b.hasAttribute("gtbShowLoadingWindow")){try{this.ios_.newURI(b.getAttribute("gtbLoadingUri"),null,null)}catch(e){b.removeAttribute("gtbShowLoadingWindow");return}c=this.getMessageForUri(d);c!=null&&new G_Alarm(BindToObject(this.showMessageForBrowser,this,b,c),0)}};
a.onPageShow_=function(b){if(b.doc&&b.doc.location){try{var c=b.doc.location.host}catch(d){return}for(b=0;b<this.popups.length;b++)if(this.popups[b].check(c)){this.popups[b].show();G_Preferences.savePrefFile();break}}};a.shouldShowGMailPopup_=function(b){return!this.prefs_.getPref("mailto.gmail.configured",false)&&!this.prefs_.getPref("mailto.opt",false)&&GTB_isGoogleDomain(b)&&b.indexOf("mail.")!=-1};a.shouldShowDocsPopup_=function(){return false};
a.showGMailPopup_=function(){this.prefs_.setPref("mailto.gmail.configured",true);this.win_.openDialog("chrome://google-toolbar/content/mailto-first-run.xul","gtbMailtoFirstRun","modal,centerscreen,chrome,resizable=no",GTB_getLangCode())};
a.showDocsPopup_=function(){var b=Cc["@mozilla.org/embedcomp/prompt-service;1"].getService(Ci.nsIPromptService),c={value:false};b=b.confirmEx(null,this.stringBundle_.GetStringFromName("prop.gtb.docsprompt.title"),this.stringBundle_.GetStringFromName("prop.gtb.docsprompt.askenable"),b.STD_YES_NO_BUTTONS,null,null,null,null,c);this.prefs_.setPref("contenthandling.prompt.visited",true);b==0&&this.prefs_.setPref("contenthandling.enabled",true)};
function GTB_UriContains(b,c,d){try{return b.path.indexOf(c)!=-1&&b.spec.indexOf("?"+d+"=")!=-1}catch(e){return false}}
a.getMessageForUri=function(b){try{if(!GTB_isGoogleDomain(b.host)||!(b.host.startsWith("doc")||b.host.indexOf("spreadsheets")!=-1||b.host.indexOf("writely")!=-1||b.path.indexOf("ServiceLogin")!=-1||b.path.indexOf("CheckCookie")!=-1))return null}catch(c){return null}return GTB_UriContains(b,"Doc","id")||GTB_UriContains(b,"Edit","docid")||GTB_UriContains(b,"Doc","docid")||GTB_UriContains(b,"ccc","key")||GTB_UriContains(b,"Presentation","docid")||GTB_UriContains(b,"present","id")?"viewing":"loading"};
a.showLoadingMessage=function(b,c){var d=null,e=null;if(c instanceof Ci.nsIURI){d=c.spec;e=c.path}else{d=this.fileProtocolHandler_.getURLSpecFromFile(c);e=c.leafName}this.showMessageBar(b,"loading",e);b.setAttribute("gtbLoadingUri",d);b.setAttribute("gtbShowLoadingWindow","true")};
a.showMessageForBrowser=function(b,c){if(b.hasAttribute("gtbShowLoadingWindow")){var d=b.getAttribute("gtbLoadingUri"),e=null;if(d!=null){try{e=this.ios_.newURI(d,null,null)}catch(f){return}var g=null;if(e.scheme=="file"){d=this.fileProtocolHandler_.getFileFromURLSpec(d);g=d.leafName}else g=e.path;this.showMessageBar(b,c,g)}}};
a.onChooseApplication=function(b){b.QueryInterface(Ci.nsIDocShell);var c=GTB_getBrowserAndWindowFromDocShell(b);if(!(c==null||c.window.GTB_getToolbar().contentPopup!=this)){var d=c.browser.getAttribute("gtbLoadingUri"),e=null;try{e=this.ios_.newURI(d,null,null)}catch(f){return}GTB_IgnoreOnceUrls[e.spec]=true;b.QueryInterface(Ci.nsIWebNavigation).loadURI(e.spec,Ci.nsIWebNavigation.LOAD_FLAGS_NONE,null,null,null);b=this.win_.document.getElementById("content");if(b.hideMessage)b.hideMessage(c.browser,
"top");else{b=b.getNotificationBox(c.browser);b.currentNotification&&b.removeCurrentNotification()}c.browser.removeAttribute("gtbShowLoadingWindow")}};
a.showMessageBar=function(b,c,d){var e=null;try{e=this.stringBundle_.formatStringFromName("prop.gtb.docsbar."+c,[d],1)}catch(f){return}d=this.stringBundle_.GetStringFromName("prop.gtb.docsbar.choosebutton");var g=this.stringBundle_.GetStringFromName("prop.gtb.docsbar.choosebutton.accesskey"),h=b.ownerDocument.getElementById("content");if(h.showMessage)h.showMessage(b,null,e,d,b.docShell,GTB_ContentHandlingMessageId,null,"top",true,null);else{h=h.getNotificationBox(b);h.currentNotification&&h.removeCurrentNotification();
var i=BindToObject(this.onChooseApplication,this,b.docShell,GTB_ContentHandlingMessageId,"");h.appendNotification(e,GTB_ContentHandlingMessageId,null,h.PRIORITY_WARNING_HIGH,[{label:d,accessKey:g,browser:b,callback:i}])}c!="loading"&&b.removeAttribute("gtbShowLoadingWindow")};function GTB_Security(){this.debugZone="security";this.wrappedJSObject=this;var b=Cc["@mozilla.org/preferences-service;1"].getService(Ci.nsIPrefService);this.userCapsGPref_=new G_Preferences("capability.policy.");this.defaultCapsPref_=b.getDefaultBranch("capability.policy.");this.googleCapsGPref_=new G_Preferences("google.toolbar.caps.");this.editingCaps_=false}a=GTB_Security.prototype;
a.init=function(){this.refresh();var b=BindToObject(this.policyNamesChanged_,this);this.userCapsGPref_.addObserver("policynames",b)};a.allow=function(b,c){this.set_(b,c,"allAccess")};a.forbid=function(b,c){this.set_(b,c,"noAccess")};a.refresh=function(){var b=this.googleCapsGPref_.getPref("policynames");b=this.split_(b);for(var c=0;c<b.length;c++)this.resolveConflicts_(b[c])};
a.policyNamesChanged_=function(b){if(!(b!="policynames"||this.editingCaps_>0)){b=this.split_(this.userCapsGPref_.getPref("policynames"));for(var c=this.split_(this.googleCapsGPref_.getPref("policynames")),d=0;d<c.length;d++)if(b.indexOf(c[d])==-1){this.refresh();return}}};a.set_=function(b,c,d){for(var e=0;e<b.length;e++){for(var f=this.registerPolicy_(b[e]),g=0;g<c.length;g++)this.googleCapsGPref_.setPref(f+"."+c[g],d);this.resolveConflicts_(f)}};
a.registerPolicy_=function(b){var c=this.getPolicyName_(b),d=this.googleCapsGPref_.getPref("policynames");d=this.insert_(d,c);this.googleCapsGPref_.setPref("policynames",d);this.googleCapsGPref_.setPref(c+".sites",b);return c};a.getPolicyName_=function(b){return"GCM_"+b};
a.resolveConflicts_=function(b){this.editingCaps_++;try{for(var c=new G_Preferences("google.toolbar.caps."+b+"."),d=c.getPref("sites"),e=new G_Preferences("capability.policy."+b+"."),f=this.userCapsGPref_.getPref("policynames"),g=this.split_(f),h=0;h<g.length;h++)if(g[h]!=b){var i=this.userCapsGPref_.getPref(g[h]+".sites");if(this.contains_(i,d)){i=this.remove_(i,d);this.forceSet_(g[h]+".sites",i);for(var j=new G_Preferences("capability.policy."+g[h]+"."),k=j.getChildNames(),l=0;l<k.length;l++){var m=
j.getPref(k[l]);e.setPref(k[l],m)}}}k=c.getChildNames();for(h=0;h<k.length;h++){m=c.getPref(k[h]);e.setPref(k[h],m)}if(!this.contains_(f,b)){f=this.insert_(f,b);this.forceSet_("policynames",f)}}finally{this.editingCaps_--}};a.forceSet_=function(b,c){this.editingCaps_++;try{this.defaultCapsPref_.prefIsLocked(b)?this.defaultCapsPref_.setCharPref(b,c):this.userCapsGPref_.setPref(b,c)}finally{this.editingCaps_--}};a.split_=function(b){var c=[];if(b){c=b.split(/[,\s]+/);if(c[0].length==0)c=[]}return c};
a.insert_=function(b,c){var d=this.split_(b);d.indexOf(c)==-1&&d.push(c);return d.join(" ")};a.remove_=function(b,c){for(var d=this.split_(b),e=[],f=0;f<d.length;f++)d[f]!=c&&e.push(d[f]);return e.join(" ")};a.contains_=function(b,c){var d=this.split_(b);return d.indexOf(c)!=-1};function GTB_GMailDummyChannel(b){GTB_DummyChannel.apply(this);this.mimeMailData_=b}GTB_GMailDummyChannel.inherits(GTB_DummyChannel);GTB_GMailDummyChannel.prototype.handleOpenRequest_=function(){if(this.mimeMailData_){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getMostRecentWindow("navigator:browser");b.GTB_getToolbar().xThis.showComposeMailWindow("",this.mimeMailData_)}};
function GTB_MailtoProtocolHandler(){GTB_ProtocolHandler.call(this);this._scheme="mailto";this.debugZone="ph_mailto";var b=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);this.http_=b.getProtocolHandler("mailto")}GTB_MailtoProtocolHandler.inherits(GTB_ProtocolHandler);GTB_MailtoProtocolHandler.prototype.newChannel=function(b){return new GTB_GMailDummyChannel(this.getGMailData_(b))};
GTB_MailtoProtocolHandler.prototype.getGMailData_=function(b){function c(f){return f.replace(/\r?\n/g," ")}b=b.spec;var d=/mailto:\/*(\S*)(\?)(.*)/i;d=b.match(d);if(!d){d=/mailto:\/*(\S*)/i;d=b.match(d)}if(!d)return null;var e=d[1];if(e[e.length-1]=="/")e=e.substring(0,e.length-1);b={};if(d.length>3)b=GTB_parseQueryString(d[3],true);d="{------------"+Math.floor(Math.random()*32767)+Math.floor(Math.random()*32767)+Math.floor(Math.random()*32767)+"}";e=["Mime-Version: 1.0\r\n","To: ",c(e),"\r\n"];b.subject&&
e.push("Subject: ",c(b.subject),"\r\n");b.cc&&e.push("Cc: ",c(b.cc),"\r\n");b.bcc&&e.push("Bcc: ",c(b.bcc),"\r\n");b=(b.body||"").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r?\n/g,"<br>");e.push('Content-Type: Multipart/related; boundary="',d,'"\r\n\r\n',"--",d,"\r\n","Content-Type: Text/HTML\r\n\r\n",b,"\r\n","--",d);return e.join("")};function GTB_DocsFileUploader(){this.debugZone="DocsFileUploader";this.prefs_=new G_Preferences;this.url_=this.prefs_.getPref(GTB_DocsFileUploader.DOCS_URL_PREF_,GTB_DocsFileUploader.DOCS_URL_DEFAULT_)+GTB_DocsFileUploader.DOCS_UPLOAD_PATH_;this.observers_=[new G_ObserverServiceObserver("http-on-modify-request",BindToObject(this.onModifyRequest_,this)),new G_ObserverServiceObserver("xpcom-shutdown",BindToObject(this.shutdown,this))];this.lastRequestTime_=new Date(0)}
GTB_DocsFileUploader.DOCS_URL_PREF_="google.toolbar.contenthandling.writely.uploadURL";GTB_DocsFileUploader.DOCS_URL_DEFAULT_="http://docs.google.com/";GTB_DocsFileUploader.DOCS_UPLOAD_PATH_="DocAction?action=updoc";
GTB_DocsFileUploader.prototype.uploadFiles=function(b){var c=this.prefs_.getPref("browser.link.open_newwindow");if(b.length>1)c=Ci.nsIBrowserDOMWindow.OPEN_NEWTAB;var d=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator),e=d.getMostRecentWindow("navigator:browser");for(d=0;d<b.length;d++){var f=b[d];if(e==null||c==Ci.nsIBrowserDOMWindow.OPEN_NEWWINDOW){e=Cc["@mozilla.org/embedcomp/window-watcher;1"].getService(Ci.nsIWindowWatcher);e=e.openWindow(null,"chrome://browser/content/browser.xul",
"_blank","chrome,titlebar,toolbar,centerscreen,dialog=no,resizable=yes",null);e.addEventListener("load",BindToObject(this.uploadToCurrentTab_,this,f,e),false)}else c==Ci.nsIBrowserDOMWindow.OPEN_NEWTAB?this.uploadToNewTab_(f,e):this.uploadToCurrentTab_(f,e)}};
GTB_DocsFileUploader.createStream_=function(b){var c=["formsubmitted","true","client","navclient-ff"],d=["uploadedFile",b];b=Cc["@mozilla.org/io/multiplex-input-stream;1"].createInstance(Ci.nsIMultiplexInputStream);var e="",f="---------------------------";f+=Math.floor(Math.random()*32767);f+=Math.floor(Math.random()*32767);f+=Math.floor(Math.random()*32767);for(var g=0;g<c.length;g+=2){var h=encodeURIComponent(c[g]),i=encodeURIComponent(c[g+1]);e+="--"+f+'\r\nContent-Disposition: form-data; name="'+
h+'"\r\n\r\n'+i+"\r\n"}for(g=0;g<d.length;g+=2){h=encodeURIComponent(d[g]);c=d[g+1];e=e;h="--"+f+'\r\nContent-Disposition: form-data; name="'+h+'"; filename="'+c.leafName+'"\r\nContent-Type: ';i=c.leafName.replace(/.*[\.]/,"");var j=Cc["@mozilla.org/mime;1"].getService(Ci.nsIMIMEService),k=null;try{k=j.getTypeFromExtension(i)}catch(l){}i=k;e=e+(h+i+"\r\n\r\n");h=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);h.charset="UTF-8";e=h.convertToInputStream(e);
b.appendStream(e);e="";h=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream);h.init(c,-1,-1,Ci.nsIFileInputStream.CLOSE_ON_EOF|Ci.nsIFileInputStream.REOPEN_ON_REWIND);c=Cc["@mozilla.org/network/buffered-input-stream;1"].createInstance(Ci.nsIBufferedInputStream);c.init(h,8192);b.appendStream(c)}e+="\r\n--"+f+"--\r\n";h=Cc["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Ci.nsIScriptableUnicodeConverter);h.charset="UTF-8";e=h.convertToInputStream(e);b.appendStream(e);
d=Cc["@mozilla.org/network/mime-input-stream;1"].createInstance(Ci.nsIMIMEInputStream);d.addHeader("Content-Type","multipart/form-data; boundary="+f);d.addContentLength=true;d.setData(b);return b=d};a=GTB_DocsFileUploader.prototype;a.uploadToBrowser_=function(b,c){var d=BindToObject(c.webNavigation.loadURI,c.webNavigation,this.url_,Ci.nsIWebNavigation.LOAD_FLAGS_NONE,null,GTB_DocsFileUploader.createStream_(b),null);GTB_OverrideUserAgent(d);this.lastRequestTime_=Date.now()};
a.uploadToCurrentTab_=function(b,c){if(GTB_isGoogleToolbarActive(c.document)){var d=c.gBrowser.selectedBrowser;this.uploadToBrowser_(b,d);this.postLoad_(b,d,c)}};a.uploadToNewTab_=function(b,c){if(GTB_isGoogleToolbarActive(c.document)){var d=BindToObject(c.gBrowser.loadOneTab,c.gBrowser,this.url_,null,null,GTB_DocsFileUploader.createStream_(b),false,false);d=GTB_OverrideUserAgent(d);this.lastRequestTime_=Date.now();d=c.gBrowser.getBrowserForTab(d);this.postLoad_(b,d,c)}};
a.postLoad_=function(b,c,d){var e=BindToObject(this.uploadToBrowser_,this,b,c);new GTB_DocsRedirectObserver(b,c,d,e,GTB_DocsFileUploader.DOCS_UPLOAD_PATH_);new G_Alarm(BindToObject(this.showLoadingMessage_,this,b,c,d),1)};a.showLoadingMessage_=function(b,c,d){(d=d.GTB_getToolbar().contentPopup)&&d.showLoadingMessage(c,b)};
a.onModifyRequest_=function(b,c){if(!(Date.now()-this.lastRequestTime_>6E4))if(!(!b||c!="http-on-modify-request")){var d;try{d=b.QueryInterface(Ci.nsIHttpChannel)}catch(e){return}var f=this.prefs_.getPref("writely.uploadURL","http://docs.google.com/"),g="";try{g=d.URI.host}catch(h){return}var i=d.getRequestHeader("user-agent");f.indexOf(g)>=0&&d.URI.spec.indexOf("action=updoc")>=0&&i.indexOf(" GoogleToolbarFF")==-1&&d.setRequestHeader("user-agent",i+" GoogleToolbarFF",false)}};
a.shutdown=function(){for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.observers_=null};function GTB_DocsRedirectObserver(b,c,d,e,f){this.debugZone="DocsRedirectObserver";this.file_=b;this.browser_=c;this.window_=d;this.repost_=e;this.uploadPath_=f;this.redirected_=false;this.webProgressService_=Cc["@google.com/toolbar/web-progress-listener;1"].getService().wrappedJSObject;this.onStateChangeCallback_=BindToObject(this.onStateChange,this);this.onTabUnloadCallback_=BindToObject(this.onTabUnload_,this);this.onWinUnloadCallback_=BindToObject(this.onWinUnload_,this);this.webProgressService_.addBrowserListener(this.browser_,
this.onStateChangeCallback_,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT);this.browser_.addEventListener("unload",this.onTabUnloadCallback_,true);this.window_.addEventListener("unload",this.onWinUnloadCallback_,false);new G_Alarm(BindToObject(this.redirectTimeout_,this),3E3);GTB_DocsRedirectObserver.listeners_.push(this)}GTB_DocsRedirectObserver.listeners_=[];a=GTB_DocsRedirectObserver.prototype;
a.QueryInterface=function(b){if(b.equals(Ci.nsIChannelEventSink)||b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsIInterfaceRequestor)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};a.getInterface=function(b){return this.QueryInterface(b)};
a.onStateChange=function(b,c,d,e){c=b="";try{b=d.host;c=d.path}catch(f){}if(!this.redirected_&&GTB_isGoogleDomain(b)&&c.indexOf("ServiceLogin")>0)this.redirected_=true;else if(this.redirected_&&c.indexOf(this.uploadPath_)!=-1){e.cancel(2152398850);new G_Alarm(this.repost_,0);this.cleanup_()}else b&&!GTB_isGoogleDomain(b)&&this.cleanup_()};
a.onChannelRedirect=function(b,c){var d="",e="";try{d=c.URI.host;e=c.URI.path}catch(f){}if(GTB_isGoogleDomain(d)&&e.indexOf("ServiceLogin")>0){this.webProgressService_.addBrowserListener(this.browser_,this.onStateChangeCallback_,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT);this.redirected_=true}};a.onTabUnload_=function(b){!this.browser_.docShell&&!b.target&&this.cleanup_()};a.onWinUnload_=function(){this.cleanup_()};a.redirectTimeout_=function(){this.redirected_||this.cleanup_()};
a.cleanup_=function(){for(var b=GTB_DocsRedirectObserver.listeners_.length-1;b>=0;b--)GTB_DocsRedirectObserver.listeners_[b]==this&&GTB_DocsRedirectObserver.listeners_.splice(b,1);this.webProgressService_.removeBrowserListener(this.browser_,this.onStateChangeCallback_);this.browser_.removeEventListener("unload",this.onTabUnloadCallback_,true);this.window_.removeEventListener("unload",this.onWinUnloadCallback_,false)};function GTB_FileAssociation(){}goog.exportSymbol("GTB_FileAssociation",GTB_FileAssociation);GTB_FileAssociation.OLD_HANDLER_PREF_="google.toolbar.contenthandling.oldhandler";GTB_FileAssociation.OLD_SHELLNEW_PREF_="google.toolbar.contenthandling.oldshellnew";GTB_FileAssociation.prototype.debugZone="GTB_FileAssociation";
GTB_FileAssociation.prototype.QueryInterface=function(b){if(b.equals(Ci.nsISupports))return this;if(b.equals(Ci.GTBIFileAssociation)&&GetPlatform()==1)return this;throw Components.results.NS_ERROR_NO_INTERFACE;};goog.exportProperty(GTB_FileAssociation.prototype,"QueryInterface",GTB_FileAssociation.prototype.QueryInterface);GTB_FileAssociation.prototype.isDefaultFor=function(b){b=this.insertLeadingDot_(b);return this.getDefaultHandler_(b)==this.getProgId_(b)};
goog.exportProperty(GTB_FileAssociation.prototype,"isDefaultFor",GTB_FileAssociation.prototype.isDefaultFor);
GTB_FileAssociation.prototype.setDefaultFor=function(b){b=this.insertLeadingDot_(b);var c=this.getProgId_(b),d=this.createRegSubKey_(c,Ci.nsIWindowsRegKey.ACCESS_ALL);try{var e=d.readStringValue("")}catch(f){e=""}if(e!=c){var g=new G_Preferences(GTB_FileAssociation.OLD_HANDLER_PREF_);g.setPref(b,e);e=d.hasChild("ShellNew");g=new G_Preferences(GTB_FileAssociation.OLD_SHELLNEW_PREF_);g.setPref(b,e);g=this.createRegSubKey_(b,Ci.nsIWindowsRegKey.ACCESS_WRITE);g.writeStringValue("",c);e&&g.removeChild("ShellNew");
g.close()}d.writeStringValue("","Google Docs & Spreadsheets");if(c=d.createChild("DefaultIcon",Ci.nsIWindowsRegKey.ACCESS_WRITE)){try{c.writeStringValue("",this.getIconPath_(b))}catch(h){}c.close()}if(d=d.createChild("shell\\open\\command",Ci.nsIWindowsRegKey.ACCESS_WRITE)){b='"'+this.getFirefoxPath_()+'" -GoogleToolbar '+b+' "%1"';d.writeStringValue("",b);d.close()}this.notifyWindowsOfRegistryChange_()};goog.exportProperty(GTB_FileAssociation.prototype,"setDefaultFor",GTB_FileAssociation.prototype.setDefaultFor);
GTB_FileAssociation.prototype.clearDefaultFor=function(b){b=this.insertLeadingDot_(b);var c=this.openRegBaseKey_(Ci.nsIWindowsRegKey.ACCESS_ALL);if(c){var d=this.restoreOldDefaultFor_(c,b);c.close()}if(!d)if(d=this.openDeprecatedRegKey_(b,Ci.nsIWindowsRegKey.ACCESS_READ)){this.restoreOldDefaultFor_(d,b);d.close()}this.notifyWindowsOfRegistryChange_()};goog.exportProperty(GTB_FileAssociation.prototype,"clearDefaultFor",GTB_FileAssociation.prototype.clearDefaultFor);a=GTB_FileAssociation.prototype;
a.insertLeadingDot_=function(b){return(b[0]!="."?".":"")+b};a.getProgId_=function(b){return"GoogleToolbar"+b+".1"};a.getDefaultHandler_=function(b){try{var c=this.openDeprecatedRegKey_(b,Ci.nsIWindowsRegKey.ACCESS_READ),d=c.readStringValue("")}catch(e){d=""}finally{c&&c.close()}return d};
a.openDeprecatedRegKey_=function(b){try{var c=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);c.open(Ci.nsIWindowsRegKey.ROOT_KEY_CLASSES_ROOT,b,Ci.nsIWindowsRegKey.ACCESS_READ)}catch(d){c=null}return c};a.openRegBaseKey_=function(b){var c=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);c.open(Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER,"Software\\Classes",b);return c};
a.createRegSubKey_=function(b,c){var d=this.openRegBaseKey_(Ci.nsIWindowsRegKey.ACCESS_WRITE);if(!d)return null;var e=d.createChild(b,c);d.close();return e};a.getFirefoxPath_=function(){var b=Cc["@mozilla.org/file/directory_service;1"].getService(Ci.nsIProperties).get("XCurProcD",Ci.nsILocalFile);b.append("firefox.exe");return b.path};a.getIconPath_=function(){return GTB_getInstallFile("defaults","contenthandling","doc.ico").path};
a.restoreOldDefaultFor_=function(b,c){var d=true;try{var e=new G_Preferences(GTB_FileAssociation.OLD_HANDLER_PREF_),f=e.getPref(c,null);e=false;if(f)if(b.hasChild(f)){var g=b.createChild(c,Ci.nsIWindowsRegKey.ACCESS_WRITE);g.writeStringValue("",f);e=true;var h=new G_Preferences(GTB_FileAssociation.OLD_SHELLNEW_PREF_);if(h.getPref(c,false)){var i=g.createChild("ShellNew",Ci.nsIWindowsRegKey.ACCESS_WRITE);i.close()}g.close()}if(!e){var j=b.openChild(c,Ci.nsIWindowsRegKey.ACCESS_WRITE);j.removeValue("");
j.close()}var k=b.openChild(this.getProgId_(c),Ci.nsIWindowsRegKey.ACCESS_ALL);this.deleteRegKeyChildren_(k);k.close();b.removeChild(this.getProgId_(c));this.notifyWindowsOfRegistryChange_()}catch(l){d=false}return d};a.deleteRegKeyChildren_=function(b){for(var c=b.childCount-1;c>=0;--c){var d=b.getChildName(c),e=b.openChild(d,Ci.nsIWindowsRegKey.ACCESS_ALL);this.deleteRegKeyChildren_(e);e.close();b.removeChild(d)}};a.notifyWindowsOfRegistryChange_=function(){try{Cc["@google.com/toolbar/registrychangenotifier;1"].createInstance(Ci.GTBIRegistryChangeNotifier).notify()}catch(b){}};function GTB_DictionaryCompression(){this.dictionaryCompression_=null;try{this.dictionaryCompression_=Cc["@google.com/dictionarycompression;1"].getService(Ci.GIDictionaryCompressionService)}catch(b){}}a=GTB_DictionaryCompression.prototype;a.debugZone="GTB_DictionaryCompression";a.GZIP_HEADER_AS_UTF8_=String.fromCharCode(31,65533,8);a.GZIP_HEADER_AS_ISO_8859_1_=String.fromCharCode(31,8249,8);a.SDCH_DICTIONARY_ID_REGEXP_=/^[A-Za-z0-9_-]{8}/;
a.checkForCorruption=function(b){if(this.dictionaryCompression_)try{var c=b.body.firstChild.substringData(0,16);this.doesStringAppearCorrupt(c)&&this.dictionaryCompression_.notifyOfSuspiciousDocumentContent(b.location,c)}catch(d){}};goog.exportSymbol("GTB_DictionaryCompression.prototype.checkForCorruption",GTB_DictionaryCompression.prototype.checkForCorruption);
GTB_DictionaryCompression.prototype.doesStringAppearCorrupt=function(b){var c=b.substring(0,this.GZIP_HEADER_AS_UTF8_.length);if(c==this.GZIP_HEADER_AS_UTF8_||c==this.GZIP_HEADER_AS_ISO_8859_1_)return true;if(b.charCodeAt(8)==65533)return!!b.match(this.SDCH_DICTIONARY_ID_REGEXP_);return false};function GTB_CSI_InterfaceRegistry(){this.head_=new GTB_CSI_InterfaceRegistry.Entry_;this.head_.next=this.head_;this.idToEntry_={};this.size_=0}GTB_CSI_InterfaceRegistry.prototype.debugZone="GTB_CSI_InterfaceRegistry";GTB_CSI_InterfaceRegistry.CAPACITY=1E3;
GTB_CSI_InterfaceRegistry.prototype.register=function(b){var c=this.head_;c.value=b;this.idToEntry_[b.gtbId]=c;if(this.size_==GTB_CSI_InterfaceRegistry.CAPACITY){b=c.next;delete this.idToEntry_[b.value.gtbId];b.value=null}else{this.size_++;b=new GTB_CSI_InterfaceRegistry.Entry_;b.next=c.next;c.next=b}this.head_=b};
GTB_CSI_InterfaceRegistry.prototype.findJSObject=function(b){var c=this.idToEntry_[b.gtbId];if(!c)return null;delete this.idToEntry_[b.gtbId];this.size_--;b=c.value;c.value=c.next.value;c.next=c.next.next;if(c.value)this.idToEntry_[c.value.gtbId]=c;return b};GTB_CSI_InterfaceRegistry.Entry_=function(){};GTB_CSI_InterfaceRegistry.Entry_.prototype.value=null;GTB_CSI_InterfaceRegistry.Entry_.prototype.next=null;function GTB_CSI_TabData(){this.subpagesById_={};this.subpagesByUrl_={};this.docShellQueue_=[]}goog.exportSymbol("GTB_CSI_TabData",GTB_CSI_TabData);GTB_CSI_TabData.debugZone="GTB_CSI_TabData";a=GTB_CSI_TabData.prototype;a.debugZone=GTB_CSI_TabData.debugZone;a.startLoadTime_=null;a.loadCompletionTime_=null;a.transitionType_=-5;a.timeMarker_=null;a.pageReadyTime_=null;GTB_CSI_TabData.getDataForDocShell=function(b){b=GTB_CSI_TabData.getOwningBrowser(b);if(!b)return null;return GTB_CSI_TabData.getDataForBrowser(b)};
GTB_CSI_TabData.getDataForBrowser=function(b){var c=b.gtbCsiData_;if(!c){c=new GTB_CSI_TabData;b.gtbCsiData_=c}return c};goog.exportProperty(GTB_CSI_TabData,"getDataForBrowser",GTB_CSI_TabData.getDataForBrowser);GTB_CSI_TabData.getOwningBrowser=function(b){if(!(b instanceof Ci.nsIDocShellTreeItem))return null;b=b.QueryInterface(Ci.nsIDocShellTreeItem);b=b.sameTypeRootTreeItem;if(!b)return null;try{var c=GTB_getBrowserAndWindowFromDocShellTreeItem(b)}catch(d){return null}return c=c&&c.browser};a=GTB_CSI_TabData.prototype;
a.timeSincePageTransition=function(b){var c=Date.now();if(this.subpagesById_[b])return c-this.subpagesById_[b].start;if(!this.startLoadTime_)return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT;return c-this.startLoadTime_};a.timeSinceTransitionInFrame=function(b){var c=Date.now();if(this.subpagesByUrl_[b])return c-this.subpagesByUrl_[b].start;if(!this.startLoadTime_)return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT;return c-this.startLoadTime_};
a.pageTransitionStart=function(b){if(this.subpagesById_[b])return this.subpagesById_[b].start;if(!this.startLoadTime_)return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT;return this.startLoadTime_};
a.pageLoadTime=function(b){if(this.subpagesById_[b]){b=this.subpagesById_[b];return!b.completion||b.completion<b.start?0:b.completion-b.start}if(!this.startLoadTime_)return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT;if(!this.loadCompletionTime_||this.loadCompletionTime_<this.startLoadTime_)return 0;return this.loadCompletionTime_-this.startLoadTime_};
a.recordStop=function(b){var c=Date.now();if(b!=-1){if(b=this.subpagesById_[b])if(!b.completion)b.completion=c}else if(this.startLoadTime_)if(!this.loadCompletionTime_)this.loadCompletionTime_=c};goog.exportProperty(GTB_CSI_TabData.prototype,"recordStop",GTB_CSI_TabData.prototype.recordStop);a=GTB_CSI_TabData.prototype;a.setPageReadyTime=function(){this.pageReadyTime_=Date.now()};
a.isValidLoadTime=function(){if(!this.pageReadyTime_||!this.startLoadTime_)return true;if(this.startLoadTime_>this.pageReadyTime_)return true;return false};a.setTimeMarker=function(){this.timeMarker_=this.startLoadTime_};a.timeSinceMarker=function(){if(!this.timeMarker_)return Ci.gtbIClientSideInstrumentation.CSI_INVALID_TIME_MARKER;var b=Date.now()-this.timeMarker_;this.timeMarker_=null;return b};a.pageTransitionType=function(){return this.transitionType_};
a.timeSincePageTransitionReset=function(){this.startLoadTime_=Date.now()};
a.handleStartLoading=function(b,c,d){if(b){this.timeSincePageTransitionReset();this.subpagesById_={};this.subpagesByUrl_={};this.docShellQueue_=[];this.loadCompletionTime_=null;this.setTransitionType(Ci.gtbIClientSideInstrumentation.CSI_TRANSITION_UNAVAILABLE)}else{b=Date.now();b={url:d,start:b,completion:null};this.subpagesByUrl_[d]=b;if(c.contentViewer){c=c.contentViewer.DOMDocument.defaultView;if(c.wrappedJSObject)c=c.wrappedJSObject;if(c=c.gtbExternal)this.subpagesById_[c.gtbId]=b}else{b.docShell=
c;this.docShellQueue_.push(b)}}};a.resolveDocShell=function(b,c){for(var d=0,e;e=this.docShellQueue_[d];++d)if(e.docShell==b){this.docShellQueue_.splice(d,1);delete e.docShell;this.subpagesById_[c]=e;return}};a.setTransitionType=function(b){this.transitionType_=b};function GTB_CSI_NotInitializedTabData(){GTB_CSI_TabData.call(this)}GTB_CSI_NotInitializedTabData.inherits(GTB_CSI_TabData);GTB_CSI_NotInitializedTabData.prototype.debugZone="GTB_CSI_NotInitializedTabData";
GTB_CSI_NotInitializedTabData.prototype.timeSincePageTransition=function(){return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT};GTB_CSI_NotInitializedTabData.timeSinceTransitionInFrame=function(){return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT};a=GTB_CSI_NotInitializedTabData.prototype;a.pageTransitionStart=function(){return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT};a.pageLoadTime=function(){return Ci.gtbIClientSideInstrumentation.CSI_NO_BEFORE_NAVIGATE_EVENT};
a.pageTransitionType=function(){return Ci.gtbIClientSideInstrumentation.CSI_TRANSITION_UNAVAILABLE};a.setTimeMarker=function(){};a.setPageReadyTime=function(){};a.isValidLoadTime=function(){};a.timeSinceMarker=function(){return Ci.gtbIClientSideInstrumentation.CSI_INVALID_TIME_MARKER};a.timeSincePageTransitionReset=function(){};
function GTB_CSI_ObjectFactory(){G_JSFactory.call(this,Components.ID("{c3719fc0-54aa-11dd-ae16-0800200c9a66}"),"@google.com/toolbar/instrumentation;1","gtbExternal",null,["JavaScript global property"])}GTB_CSI_ObjectFactory.inherits(G_JSFactory);GTB_CSI_ObjectFactory.prototype.createInstance=function(b,c){if(b!=null)throw Components.results.NS_ERROR_NO_AGGREGATION;return(new GTB_CSI_Interface).QueryInterface(c)};
function GTB_CSI_Interface(){this.gtbId=""+GTB_CSI_Interface.lastId_++;this.googleToolbarVersion=GTB_version;GTB_CSI_Interface.instanceRegistry.register(this)}GTB_CSI_Interface.prototype.debugZone="GTB_CSI_Interface";GTB_CSI_Interface.prototype.data_=new GTB_CSI_NotInitializedTabData;GTB_CSI_Interface.prototype.isInFrame_=false;GTB_CSI_Interface.lastId_=0;GTB_CSI_Interface.instanceRegistry=new GTB_CSI_InterfaceRegistry;a=GTB_CSI_Interface.prototype;a.setTabData=function(b){this.data_=b};
a.setInFrame=function(){this.isInFrame_=true};a.QueryInterface=function(b){if(b.equals(Ci.nsIClassInfo)||b.equals(Ci.gtbIClientSideInstrumentation)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};a.getInterfaces=function(b){var c=[Ci.nsIClassInfo,Ci.gtbIClientSideInstrumentation];b.value=c.length;return c};a.getHelperForLanguage=function(){return null};a.flags=Ci.nsIClassInfo.DOM_OBJECT;a.classDescription="Google Toolbar CSI";a.implementationLanguage=Ci.nsIProgrammingLanguage.JAVASCRIPT;
a.timeSincePageTransition=function(){return this.data_.timeSincePageTransition(this.gtbId)};goog.exportProperty(GTB_CSI_Interface.prototype,"timeSincePageTransition",GTB_CSI_Interface.prototype.timeSincePageTransition);GTB_CSI_Interface.prototype.pageT=GTB_CSI_Interface.prototype.timeSincePageTransition;goog.exportProperty(GTB_CSI_Interface.prototype,"pageT",GTB_CSI_Interface.prototype.pageT);GTB_CSI_Interface.prototype.startE=function(){return this.data_.pageTransitionStart(this.gtbId)};
goog.exportSymbol("GTB_CSI_Interface.prototype.startE",GTB_CSI_Interface.prototype.startE);GTB_CSI_Interface.prototype.onloadT=function(){return this.data_.pageLoadTime(this.gtbId)};goog.exportSymbol("GTB_CSI_Interface.prototype.onloadT",GTB_CSI_Interface.prototype.onloadT);GTB_CSI_Interface.prototype.frameT=function(b){return this.data_.timeSinceTransitionInFrame(b)};goog.exportSymbol("GTB_CSI_Interface.prototype.frameT",GTB_CSI_Interface.prototype.frameT);
GTB_CSI_Interface.prototype.timeSinceMarker=function(){return this.data_.timeSinceMarker()};goog.exportProperty(GTB_CSI_Interface.prototype,"timeSinceMarker",GTB_CSI_Interface.prototype.timeSinceMarker);GTB_CSI_Interface.prototype.markT=GTB_CSI_Interface.prototype.timeSinceMarker;goog.exportProperty(GTB_CSI_Interface.prototype,"markT",GTB_CSI_Interface.prototype.markT);
GTB_CSI_Interface.prototype.pageTransitionType=function(){if(this.isInFrame_)return Ci.gtbIClientSideInstrumentation.TRANSITION_FRAMED_PAGE;return this.data_.pageTransitionType()};goog.exportProperty(GTB_CSI_Interface.prototype,"pageTransitionType",GTB_CSI_Interface.prototype.pageTransitionType);GTB_CSI_Interface.prototype.tran=GTB_CSI_Interface.prototype.pageTransitionType;goog.exportProperty(GTB_CSI_Interface.prototype,"tran",GTB_CSI_Interface.prototype.tran);
GTB_CSI_Interface.prototype.timeSincePageTransitionReset=function(){return this.data_.timeSincePageTransitionReset()};goog.exportProperty(GTB_CSI_Interface.prototype,"timeSincePageTransitionReset",GTB_CSI_Interface.prototype.timeSincePageTransitionReset);GTB_CSI_Interface.prototype.setT=GTB_CSI_Interface.prototype.timeSincePageTransitionReset;goog.exportProperty(GTB_CSI_Interface.prototype,"setT",GTB_CSI_Interface.prototype.setT);GTB_CSI_Interface.prototype.setTimeMarker=function(){this.data_.setTimeMarker()};
goog.exportProperty(GTB_CSI_Interface.prototype,"setTimeMarker",GTB_CSI_Interface.prototype.setTimeMarker);GTB_CSI_Interface.prototype.setM=GTB_CSI_Interface.prototype.setTimeMarker;goog.exportProperty(GTB_CSI_Interface.prototype,"setM",GTB_CSI_Interface.prototype.setM);GTB_CSI_Interface.prototype.setPageReadyTime=function(){this.data_.setPageReadyTime()};goog.exportProperty(GTB_CSI_Interface.prototype,"setPageReadyTime",GTB_CSI_Interface.prototype.setPageReadyTime);
GTB_CSI_Interface.prototype.isValidLoadTime=function(){return this.data_.isValidLoadTime()};goog.exportProperty(GTB_CSI_Interface.prototype,"isValidLoadTime",GTB_CSI_Interface.prototype.isValidLoadTime);GTB_CSI_Interface.prototype.isTranslateEnabled=function(){return GTB_PageTranslator.isEnabled()};goog.exportSymbol("GTB_CSI_Interface.prototype.isTranslateEnabled",GTB_CSI_Interface.prototype.isTranslateEnabled);function GTB_CSI_PageTransitionListener(){this.debugZone="GTB_CSI_PageTransitionListener";var b=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT)}GTB_CSI_PageTransitionListener.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};
GTB_CSI_PageTransitionListener.prototype.onStateChange=function(b,c,d){if(c instanceof Ci.nsIHttpChannel){var e=Ci.gtbIClientSideInstrumentation;if(d&Ci.nsIWebProgressListener.STATE_START)try{var f=b.QueryInterface(Ci.nsIDocShell),g=GTB_CSI_TabData.getOwningBrowser(f),h=g.docShell==f,i=GTB_CSI_TabData.getDataForBrowser(g),j=c.QueryInterface(Ci.nsIHttpChannel);i.handleStartLoading(h,f,j.URI&&j.URI.spec);if(!h)return;if(f.loadType&Ci.nsIDocShell.LOAD_CMD_HISTORY)i.setTransitionType(e.TRANSITION_FORWARD_BACK);
else if(f.loadType&Ci.nsIDocShell.LOAD_CMD_RELOAD)i.setTransitionType(e.TRANSITION_RELOAD);else{var k=f.loadType&65535;if(k!=Ci.nsIDocShell.LOAD_CMD_NORMAL)return;var l=e.CSI_TRANSITION_UNAVAILABLE,m=f.loadType>>16;switch(m){case Ci.nsIWebNavigation.LOAD_FLAGS_NONE:l=e.TRANSITION_USER_BROWSER;break;case Ci.nsIWebNavigation.LOAD_FLAGS_IS_LINK:l=e.TRANSITION_LINK;break;case Ci.nsIWebNavigation.LOAD_FLAGS_REPLACE_HISTORY:l=e.TRANSITION_REDIRECT_ONLOAD;break;case Ci.nsIWebNavigation.LOAD_FLAGS_STOP_CONTENT:case Ci.nsIWebNavigation.LOAD_FLAGS_STOP_CONTENT|
Ci.nsIWebNavigation.LOAD_FLAGS_REPLACE_HISTORY:l=e.TRANSITION_REDIRECT_JAVASCRIPT;break;case Ci.nsIWebNavigation.LOAD_FLAGS_IS_REFRESH:l=e.TRANSITION_REDIRECT_META_REFRESH;break;default:return}i.setTransitionType(l)}}catch(n){}if(d&Ci.nsIWebProgressListener.STATE_REDIRECTING)try{f=b.QueryInterface(Ci.nsIDocShell);g=GTB_CSI_TabData.getOwningBrowser(f);h=g.docShell==f;if(!h)return;i=GTB_CSI_TabData.getDataForBrowser(g);j=c.QueryInterface(Ci.nsIHttpChannel);var o=j.responseStatus;if(300<=o&&o<400){switch(o){case 301:l=
e.TRANSITION_REDIRECT_301;break;case 302:l=e.TRANSITION_REDIRECT_302;break;default:l=e.TRANSITION_REDIRECT_3XX}i.setTransitionType(l)}}catch(p){}if(d&Ci.nsIWebProgressListener.STATE_TRANSFERRING)try{j=c.QueryInterface(Ci.nsIHttpChannel);if(j.responseStatus==200){f=b.QueryInterface(Ci.nsIDocShell);if(f.contentViewer){var r=f.contentViewer.DOMDocument.defaultView;if(r.wrappedJSObject)r=r.wrappedJSObject;var q=r.gtbExternal;if(q)if(i=GTB_CSI_TabData.getDataForDocShell(f))if(q=GTB_CSI_Interface.instanceRegistry.findJSObject(q)){q.setTabData(i);
i.resolveDocShell(f,q.gtbId);var s=b.QueryInterface(Ci.nsIDocShellTreeItem);s.parent&&s.parent==s.sameTypeParent&&q.setInFrame()}}}}catch(u){}}};GTB_CSI_PageTransitionListener.instance_=new GTB_CSI_PageTransitionListener;function GTB_LinkDoctor(){this.debugZone="linkdoctor";this.wrappedJSObject=this;this.webprogress_=this.protocol_=null;this.editingPreferences_=this.enabled_=false;this.visibilityObserver_=new G_ObserverServiceObserver("GTB_VISIBILITY_CHANGED",BindToObject(this.onStateChanged_,this))}a=GTB_LinkDoctor.prototype;
a.init=function(){this.protocol_=new GTB_LinkDoctorProtocolFactory;this.webprogress_=new GTB_LinkDoctorWebprogress;this.preferences_=new G_Preferences;this.preferences_.addObserver("google.toolbar.linkdoctor.enabled",BindToObject(this.onStateChanged_,this));this.dropBackup_("keyword.URL");this.dropBackup_("keyword.enabled");this.onStateChanged_()};a.onPreferenceChanged_=function(b){this.editingPreferences_||this.backupPreference_(b)};
a.updatePreferences_=function(){if(this.enabled_){this.backupPreference_("browser.fixup.alternate.enabled");GTB_GlobalPrefs.setPref("browser.fixup.alternate.enabled",false)}else this.restorePreference_("browser.fixup.alternate.enabled")};a.backupPreference_=function(b){var c=this.preferences_.getPref(b);"undefined"!=typeof c&&this.preferences_.setPref("google.toolbar.linkdoctor.backup."+b,c)};
a.restorePreference_=function(b){var c=this.preferences_.getPref("google.toolbar.linkdoctor.backup."+b);try{this.editingKeyword_=true;"undefined"!=typeof c?this.preferences_.setPref(b,c):this.preferences_.clearPref(b)}finally{this.editingKeyword_=false}};a.dropBackup_=function(b){var c="google.toolbar.linkdoctor.backup."+b,d=this.preferences_.getPref(c);if(d){try{this.editingKeyword_=true;this.preferences_.setPref(b,d)}finally{this.editingKeyword_=false}this.preferences_.clearPref(c)}};
a.onStateChanged_=function(){var b=(!GTB_NoToolbarVisible()||this.preferences_.getPref("google.toolbar.work_when_invisible",false))&&this.preferences_.getPref("google.toolbar.linkdoctor.enabled",false);if(b!=this.enabled_){this.protocol_.setEnabled(b);this.webprogress_.setEnabled(b);this.enabled_=b;this.updatePreferences_()}};a.uninstall=function(){this.preferences_||this.init();this.preferences_.setPref("google.toolbar.linkdoctor.enabled",false)};GTB_LinkDoctor.isWorking=function(b){return GTB_isGoogleToolbarActive(b.ownerDocument)};function GTB_LinkDoctorProtocolFactory(){this.debugZone="linkdoctor-protocol-factory";var b="@mozilla.org/network/protocol/about;1?what=neterror",c=Cc[b].getService(Ci.nsIAboutModule);this.protocol_=new GTB_LinkDoctorProtocol(c);c=Components.manager.QueryInterface(Ci.nsIComponentRegistrar);c.registerFactory(Components.ID("5d229a65-34e4-409e-b3d5-cae97576c26f"),"Google Toolbar LinkDoctorProtocol",b,this)}
GTB_LinkDoctorProtocolFactory.prototype.QueryInterface=function(b){if(b.equals(Ci.nsIFactory)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};GTB_LinkDoctorProtocolFactory.prototype.createInstance=function(b,c){if(b!=null)throw Cr.NS_ERROR_NO_AGGREGATION;return this.protocol_.QueryInterface(c)};GTB_LinkDoctorProtocolFactory.prototype.setEnabled=function(b){this.protocol_.setEnabled(b)};
function GTB_LinkDoctorProtocol(b){this.debugZone="linkdoctor-protocol";this.previousProtocol_=b;this.enabled_=false}a=GTB_LinkDoctorProtocol.prototype;a.QueryInterface=function(b){if(b.equals(Ci.nsIAboutModule)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};
a.newChannel=function(b){var c=Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService),d=new GTB_LinkDoctorProtocolUri(b.spec);if(d.url.indexOf("http://linkhelp.clients.google.com/tbproxy/lh")==0){b=d.getParameter_(d.url,"url");d.getParameter_(d.url,"error");d="about:neterror?e="+encodeURIComponent(d.error)+"&u="+encodeURIComponent(encodeURI(b));c=c.newURI(d,null,null);return this.previousProtocol_.newChannel(c)}if(0==d.url.indexOf("https:")||d.error!="query"&&d.error!="connectionFailure"&&
d.error!="dnsNotFound"&&d.error!="http404")return this.previousProtocol_.newChannel(d);if(d.error=="dnsNotFound"){var e=c.newURI(d.url,null,null);e=this.findBrowsers_(e);this.fixPageRank_(e);e=0==e.length?this.isWorkingInSomeWindow_():this.isWorking_(e);if(!e)return this.previousProtocol_.newChannel(b)}if(!this.enabled_)return this.previousProtocol_.newChannel(b);b=d.url;e=Cc["@mozilla.org/network/idn-service;1"].createInstance(Ci.nsIIDNService);if(e.isACE(b))b=e.convertACEtoUTF8(b);b=this.unalternateUri(b);
if(b.indexOf("?")!=-1)b=b.substring(0,b.indexOf("?")+1);d=d.error;if(d=="connectionFailure")d="connectionfailure";else if(d!="http404")d="dnserror";d="http://linkhelp.clients.google.com/tbproxy/lh/fixurl?url="+encodeURIComponent(b)+"&sourceid=navclient-ff&hl="+GTB_getLangCode()+"&sd="+GTB_getGoogleDomain()+"&error="+encodeURIComponent(d);d=c.newURI(d,null,null);return c.newChannelFromURI(d)};
a.unalternateUri=function(b){var c=uri_parse(b);if(c==null)return b;var d=c.GetDomain();if(d==null)return b;for(var e=0,f=0;f<d.length;f++)d.charAt(f)=="."&&e++;if(e!=2)return b;e=GTB_GlobalPrefs;if(!e.getPref("browser.fixup.alternate.enabled"))return b;b=e.getPref("browser.fixup.alternate.prefix");e=e.getPref("browser.fixup.alternate.suffix");f=d.substring(0,Math.min(d.length,b.length));var g=d.substring(Math.max(0,d.length-e.length));if(b==f)e==g?c.SetDomain(d.substring(f.length,d.length-g.length)):
c.SetDomain(d.substring(f.length));return c.toString()};a.getURIFlags=function(){return 0};a.isWorking_=function(b){for(var c=0;c<b.length;c++)if(GTB_LinkDoctor.isWorking(b[c].window.getBrowser()))return true;return false};a.fixPageRank_=function(b){for(var c=0;c<b.length;c++){var d=b[c].window,e=d.GTB_GoogleToolbarOverlay,f=e.perTabData.getContainers("page_rank"),g=d.getBrowser();d=g.selectedBrowser;g=g.browsers;for(var h=b[c].indices,i=0;i<h.length;i++){f[h[i]].pageRank=null;d==g[h[i]]&&e.pageRank.displayPageRank(null)}}};
a.findBrowsers_=function(b){var c=[],d=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);for(d=d.getEnumerator("navigator:browser");d.hasMoreElements();){for(var e=d.getNext(),f=e.getBrowser().browsers,g=[],h=f.length-1;h>=0;h--){var i=f[h].currentURI;i.equals(b)&&g.push(h)}g.length!=0&&c.push({window:e,indices:g})}return c};
a.isWorkingInSomeWindow_=function(){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);for(b=b.getEnumerator("navigator:browser");b.hasMoreElements();){var c=b.getNext();if(GTB_LinkDoctor.isWorking(c.getBrowser()))return true}return false};a.setEnabled=function(b){this.enabled_=b};
function GTB_LinkDoctorProtocolUri(b){this.debugZone="GTB_LinkDoctorProtocolUri";this.originalSpec=b;var c=this.getParameter_(b,"u");if(!c)throw Error('No "u" parameter in '+b);this.url=c;this.error=this.getParameter_(b,"e");this.asciiHost="";this.scheme="about:";this.originCharset="";this.path="neterror?e="+encodeURIComponent(encodeURI(this.error))+"&u="+encodeURIComponent(encodeURI(this.url));this.prePath="about:";this.spec=encodeURI(this.url);this.asciiSpec=encodeURI(this.url)}a=GTB_LinkDoctorProtocolUri.prototype;
a.clone=function(){return new GTB_LinkDoctorProtocolUri(this.originalSpec)};a.equals=function(b){return b!=null&&this.originalSpec==b.originalSpec};a.resolve=function(b){return b};a.schemeIs=function(b){return this.scheme==b};a.getParameter_=function(b,c){var d=RegExp("[&?]"+c+"=([^&]*)");return(d=b.match(d)[1])?decodeURI(decodeURIComponent(d)):d};function GTB_LinkDoctorWebprogress(){this.debugZone="linkdoctor-webprogress"}a=GTB_LinkDoctorWebprogress.prototype;a.QueryInterface=function(b){if(b.equals(Ci.nsIWebProgressListener)||b.equals(Ci.nsISupportsWeakReference)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;};
a.onLocationChange=function(b,c,d){var e=d.spec;if(e!="about:blank"){d=b.QueryInterface(Ci.nsIDocShell);var f=GTB_getBrowserAndWindowFromDocShell(d);if(f!=null){d=f.browser;f=this.tabBrowserForWindow_(f.window);if(e.indexOf("about:neterror")==0){b=new GTB_LinkDoctorProtocolUri(e);d.docShell.setCurrentURI(b)}else if(GTB_LinkDoctor.isWorking(f))if(c instanceof Ci.nsIHttpChannel){c=c.QueryInterface(Ci.nsIHttpChannel);var g;try{g=c.getResponseHeader("X-Squid-Error")}catch(h){}if(/ERR_DNS_FAIL/.test(g)){b=
"about:neterror?e=dnsNotFound&u="+encodeURIComponent(e)+"&c=UTF-8";d.loadURIWithFlags(b,Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_HISTORY,null,null)}else if(b.isLoadingDocument&&c.responseStatus==404&&c.contentLength<512&&c.contentLength!=-1){b="about:neterror?e=http404&u="+encodeURIComponent(e)+"&c=UTF-8";d.loadURIWithFlags(b,Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_HISTORY,null,null)}}}}};a.onProgressChange=function(){};a.onSecurityChange=function(){};
a.onStateChange=function(b,c,d){if((d|Ci.nsIWebProgressListener.STATE_STOP)==d)if(c instanceof Ci.nsIHttpChannel){c=c.QueryInterface(Ci.nsIHttpChannel);try{if(c.responseStatus!=404)return}catch(e){return}if(c.contentLength==-1){b=b.QueryInterface(Ci.nsIDocShell);b=GTB_getBrowserAndWindowFromDocShell(b);if(b!=null){b=b.browser;d=b.contentDocument;if(!(d.body.innerHTML.length>=512)){d.body.innerHTML="";c=c.URI.spec;c="about:neterror?e=http404&u="+encodeURIComponent(c)+"&c=UTF-8";b.loadURIWithFlags(c,
Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_HISTORY,null,null)}}}}};a.onStatusChange=function(){};a.setEnabled=function(b){var c=Cc["@mozilla.org/docloaderservice;1"].getService(Ci.nsIWebProgress);b?c.addProgressListener(this,Ci.nsIWebProgress.NOTIFY_LOCATION|Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT):c.removeProgressListener(this)};
a.tabBrowserForWindow_=function(b){b=b.QueryInterface(Ci.nsIInterfaceRequestor);b=b.getInterface(Ci.nsIWebNavigation);b=b.QueryInterface(Ci.nsIDocShellTreeItem);b=b.rootTreeItem.QueryInterface(Ci.nsIInterfaceRequestor);return b.getInterface(Ci.nsIDOMWindow).getBrowser()};var GTB_WebHistoryStatus={NO_STATUS:-1,INACTIVE:0,ACTIVE:1,PAUSED:2,SIGNED_OUT:3,DISABLED:4};
function GTB_WebHistoryManager(b,c,d,e,f){this.debugZone="webhistory";this.tabWatcher_=b;GTB_RegisterListener(this.tabWatcher_,G_TabbedBrowserWatcher.events.LOCATIONCHANGE,this.onLocationChange_,this);this.tabDataManager_=c;this.tabDataManager_.makeContainers(GTB_WebHistoryManager.TAB_DATA_KEY_,function(){return new GTB_WebHistoryTabData});this.doc_=d;this.win_=e;this.infoQueryService_=f;this.infoQueryService_.registerUser(this);this.status_=GTB_WebHistoryStatus.NO_STATUS;this.gaiaSettings_=this.doc_.defaultView.GTB_getToolbar().settings.gaia_;
this.gaiaService_=Cc["@google.com/toolbar/gaia-service;1"].getService().wrappedJSObject;this.observers_=[new G_ObserverServiceObserver("gaia-signin-change",BindToObject(this.onGaiaChanged_,this)),new G_ObserverServiceObserver("gaia-email-change",BindToObject(this.onGaiaChanged_,this)),new G_ObserverServiceObserver("http-on-examine-response",BindToObject(this.onRequest_,this)),new G_ObserverServiceObserver("network:offline-status-changed",BindToObject(this.updateStatus,this))];this.prefs_=new G_Preferences("google.toolbar.");
this.setWebHistoryUrlsBound_=BindToObject(this.setWebHistoryUrls_,this);this.prefs_.addObserver("google_home",this.setWebHistoryUrlsBound_);this.setWebHistoryUrls_();var g=this;this.pauseResumeListener_={QueryInterface:function(h){if(h.equals(Ci.nsIWebProgressListener)||h.equals(Ci.nsISupportsWeakReference)||h.equals(Ci.nsISupports))return this;throw Components.results.NS_NOINTERFACE;},onStateChange:function(h,i,j){i&&i.name&&i.name.indexOf("www.google.com/history/pause_notify")>=0&&j&Ci.nsIWebProgressListener.STATE_STOP&&
g.updateStatus()},onLocationChange:function(){},onProgressChange:function(){},onStatusChange:function(){},onSecurityChange:function(){}};this.win_.gBrowser.addProgressListener(this.pauseResumeListener_,Ci.nsIWebProgress.NOTIFY_STATE_REQUEST);this.stringBundle_=null;this.timer_=Cc["@mozilla.org/timer;1"].createInstance(Ci.nsITimer);this.timer_.initWithCallback(this,this.getDefaultTimeInterval_(),Ci.nsITimer.TYPE_REPEATING_SLACK)}GTB_WebHistoryManager.inherits(GTB_InfoQueryUser);
GTB_WebHistoryManager.TAB_DATA_KEY_="web_history";GTB_WebHistoryManager.prototype.getStatus=function(){return this.status_};GTB_WebHistoryManager.prototype.notify=function(){this.updateStatus()};
GTB_WebHistoryManager.prototype.updateStatus=function(){GTB_StartupProfiler.timestamp("+GTB_WebHistoryManager.updateStatus");if(GTB_IsOnline()){var b=this.gaiaService_.gaiaIsSignedIn();if(b&&this.gaiaService_.gaiaIsSearchHistoryOn()){this.setStatus_(GTB_WebHistoryStatus.NO_STATUS);this.requestStatus_()}else b?this.setStatus_(GTB_WebHistoryStatus.DISABLED):this.setStatus_(GTB_WebHistoryStatus.SIGNED_OUT);GTB_StartupProfiler.timestamp("-GTB_WebHistoryManager.updateStatus")}else this.setStatus_(GTB_WebHistoryStatus.INACTIVE)};
goog.exportSymbol("GTB_WebHistoryManager.prototype.updateStatus",GTB_WebHistoryManager.prototype.updateStatus);
GTB_WebHistoryManager.prototype.updateUI=function(){var b=this.doc_.getElementById("gtbManageWebHistoryMenuitem");if(b){var c=this.getStringBundle_(),d=this.getStatus();if(d==GTB_WebHistoryStatus.DISABLED)b.setAttribute("label",c.GetStringFromName("prop.gtb.webhistory.menu.disabled"));else{var e="";try{e=c.GetStringFromName("prop.gtb.webhistory.menu.status"+d)||""}catch(f){}b.setAttribute("label",c.formatStringFromName("prop.gtb.webhistory.menu.label",[e],1))}}};
GTB_WebHistoryManager.prototype.onManageWebHistory=function(b){var c=this.uriWebHistory_+"?hl="+GTB_getLangCode();this.win_.openUILink(c,b);b.stopPropagation()};goog.exportSymbol("GTB_WebHistoryManager.prototype.onManageWebHistory",GTB_WebHistoryManager.prototype.onManageWebHistory);a=GTB_WebHistoryManager.prototype;
a.shutdown=function(){this.win_.gBrowser.removeProgressListener(this.pauseResumeListener_);this.prefs_.removeObserver("google_home",this.setWebHistoryUrlsBound_);for(var b=0,c=null;c=this.observers_[b];++b)c.unregister();this.timer_.cancel();this.infoQueryService_.registerUser(this)};a.getRequestPrefix=function(){return"WH"};a.isEnabled=function(){return this.getStatus()==GTB_WebHistoryStatus.ACTIVE&&!GTB_IsPrivateBrowsing()};
a.shouldSendRequest=function(b,c,d,e,f){if(!b||!this.isEnabled()||!this.isAllowedInternal(c,d,e,f))return false;b=this.tabDataManager_.getContainer(b,GTB_WebHistoryManager.TAB_DATA_KEY_);return!b.isRequestSent()};a.onRequestSend=function(b,c){var d=b&&b.currentURI.asciiSpec;if(c==d){d=this.tabDataManager_.getContainer(b,GTB_WebHistoryManager.TAB_DATA_KEY_);d.setRequestSent(true)}};a.getServerUri_=function(){return this.prefs_.getPref("webhistory.server",GTB_getGoogleHome()+"/history")};
a.getDefaultTimeInterval_=function(){return this.prefs_.getPref("webhistory.timeinterval",3600)*1E3};a.getStringBundle_=function(){if(!this.stringBundle_){var b=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService);this.stringBundle_=b.createBundle("chrome://google-toolbar/locale/google-toolbar.properties")}return this.stringBundle_};
a.setWebHistoryUrls_=function(){this.uriWebHistory_="http://"+this.getServerUri_();this.uriWebHistoryFind_=this.uriWebHistory_+"/find";this.uriWebHistoryPause_=this.uriWebHistory_+"/unsubscribe?";this.uriWebHistoryResume_=this.uriWebHistory_+"/subscribe?";this.uriWebHistoryDelete_=this.uriWebHistory_+"/delete?";this.uriWebHistoryGData_=this.uriWebHistory_+"/feeds"};a.setStatus_=function(b){this.status_=b};
a.onRequest_=function(b){if(b=b&&b.QueryInterface(Ci.nsIRequest))if(b.name.startsWith(this.uriWebHistoryPause_)||b.name.startsWith(this.uriWebHistoryResume_)||b.name.startsWith(this.uriWebHistoryDelete_))this.requestStatus_()};a.requestStatus_=function(b){if(!(b&&b>10)){var c=this.gaiaService_.gaiaUserEmail();if(c){c=this.uriWebHistoryGData_+"/default/subscriptions/browser";var d=new G_XMLFetcher;d.get(c,BindToObject(this.processResponse_,this,b||0))}else this.setStatus_(GTB_WebHistoryStatus.SIGNED_OUT)}};
a.processResponse_=function(b,c){var d=c.status;if(d)if(d==401)new G_Alarm(BindToObject(this.requestStatus_,this,b+1),500);else if(d==500)this.setStatus_(GTB_WebHistoryStatus.INACTIVE);else if(d==503){if(this.timer_.delay<576E5)this.timer_.delay=2*this.timer_.delay}else if(d>=200&&d<300){this.timer_.delay=this.getDefaultTimeInterval_();d=c.responseXML;d=d.getElementsByTagNameNS("http://schemas.google.com/history/2007","subscribed");if(d.length>0){d=d.item(0).firstChild;d.nodeValue=="true"?this.setStatus_(GTB_WebHistoryStatus.ACTIVE):
this.setStatus_(GTB_WebHistoryStatus.PAUSED)}}};a.onLocationChange_=function(b){var c=b.browser;if(!(typeof b.isTop=="boolean"&&!b.isTop))if(c){b=this.tabDataManager_.getContainer(c,GTB_WebHistoryManager.TAB_DATA_KEY_);b.setRequestSent(false)}};a.onGaiaChanged_=function(){this.updateStatus()};function GTB_WebHistoryTabData(){this.debugZone="GTB_WebHistoryTabData";this.isRequestSent_=false}GTB_WebHistoryTabData.prototype.isRequestSent=function(){return this.isRequestSent_};GTB_WebHistoryTabData.prototype.setRequestSent=function(b){this.isRequestSent_=b};function TH_ThreadQueue(b){this.runtime_=100;this.delay_=25;this.interleave_=true;if(b){this.interleave_=b.interleave===true;if(b.runtime)this.runtime_=b.runtime;if(b.delay)this.delay_=b.delay}this.workers_=[];this.guid_=0;this.iterate_=Function.prototype.bind.call(this.runIteration_,this)}a=TH_ThreadQueue.prototype;
a.addWorker=function(b,c){if(b.__workerId)throw Error("Cannot add a worker to a thread while it is currently running in the thread.");b.__isComplete=c||function(){return false};b.__workerId=this.guid_++;this.workers_.push(b);if(this.workers_.length==1){this.setCurrentWorkerByIndex_(0);this.iterate_()}};a.removeWorker=function(b){for(var c=0;c<this.workers_.length;c++)b.__workerId==this.workers_[c].__workerId&&this.removeWorkerByIndex_(c)};
a.removeWorkerByIndex_=function(b){var c=this.workers_[b];delete c.__isComplete;delete c.__workerId;this.workers_.splice(b,1);b=this.currentWorkerIndex_%this.workers_.length;this.setCurrentWorkerByIndex_(b)};a.setDelay=function(b){this.delay_=b};a.setRuntime=function(b){this.runtime_=b};a.run=function(){this.running_=true;this.iterate_()};a.pause=function(){this.running_=false};
a.runIteration_=function(){if(!(!this.running_||this.workers_.length==0)){for(var b=(new Date).getTime();(new Date).getTime()-b<this.runtime_;){if(this.currentWorker_.__isComplete()){this.removeWorkerByIndex_(this.currentWorkerIndex_);break}this.currentWorker_();this.interleave_&&this.nextWorker_()}if(typeof top!="undefined"&&top.setTimeout)top.setTimeout(this.iterate_,this.delay_);else if(G_Alarm)new G_Alarm(this.iterate_,this.delay_);else throw Error("Could not find a mechanism to start a timeout. Need window.setTimeout or G_Alarm.");
}};a.setCurrentWorkerByIndex_=function(b){this.currentWorkerIndex_=b;this.currentWorker_=this.workers_[b]};a.nextWorker_=function(){var b=(this.currentWorkerIndex_+1)%this.workers_.length;this.setCurrentWorkerByIndex_(b)};function G_Protocol4Parser(){this.debugZone="protocol4";this.protocol4RegExp_=/([^:]+):\d+:(.*)$/;this.newlineRegExp_=/(\r)?\n/}G_Protocol4Parser.prototype.parse=function(b){var c={};if(!b)return c;b=b.split(this.newlineRegExp_);for(var d=0;d<b.length;d++)if(this.protocol4RegExp_.exec(b[d]))c[RegExp.$1]=RegExp.$2;return c};
G_Protocol4Parser.prototype.serialize=function(b){if(typeof b!="object")throw Error("map must be an object");var c="";for(var d in b){if(typeof b[d]!="string")throw Error("Keys and values must be strings");c+=d+":"+b[d].length+":"+b[d]+"\n"}return c};function PROT_ApplicationDirectory(){this.debugZone="appdir";this.appDir_=G_File.getProfileFile();this.appDir_.append(PROT_ApplicationDirectory.getAppDirectoryName())}PROT_ApplicationDirectory.getAppDirectoryName=function(){return"GoogleToolbarData"};PROT_ApplicationDirectory.prototype.exists=function(){return this.appDir_.exists()&&this.appDir_.isDirectory()};PROT_ApplicationDirectory.prototype.create=function(){try{this.appDir_.create(Ci.nsIFile.DIRECTORY_TYPE,448)}catch(b){}};
PROT_ApplicationDirectory.prototype.getAppDirFileInterface=function(){return this.appDir_};function GTB_TextReuse(b){this.debugZone="textReuse";this.tabWatcher_=b;this.pageShowCallback_=null;this.prefs_=new G_Preferences("google.toolbar.");this.prefs_.addObserver("textreuse.enabled",BindToObject(this.onEnabledPrefChanged_,this));this.onEnabledPrefChanged_()}
GTB_TextReuse.prototype.onEnabledPrefChanged_=function(){var b=this.prefs_.getPref("textreuse.enabled",false);if(b&&!this.pageShowCallback_)this.pageShowCallback_=GTB_RegisterListener(this.tabWatcher_,"pageshow",this.onPageShow_,this);else if(!b&&this.pageShowCallback_){this.tabWatcher_.removeListener("pageshow",this.pageShowCallback_);this.pageShowCallback_=null}};GTB_TextReuse.prototype.onPageShow_=function(b){b.isTop&&new GTB_TextReuseOnPage(b.doc)};
function GTB_TextReuseOnPage(b){this.debugZone="textReuse";try{this.inputCollector_=Cc["@google.com/toolbar/textreuse;1"].getService(Ci.GTBITextReuse)}catch(c){return}this.doc_=b;this.win_=b.defaultView;this.pageHideCallback_=BindToObject(this.onPageHide_,this);this.win_.addEventListener("pagehide",this.pageHideCallback_,false);this.keyPressCallback_=BindToObject(this.onKeyPress_,this);this.win_.addEventListener("keypress",this.keyPressCallback_,false);this.hasFilledForm_=false;this.nodeIdMap_=[];
this.urlClassifier_=new GTB_UrlClassifier}GTB_TextReuseOnPage.freeNodeId_=0;a=GTB_TextReuseOnPage.prototype;
a.onPageHide_=function(b){if(b.originalTarget==this.doc_){this.win_.removeEventListener("keypress",this.keyPressCallback_,false);this.keyPressCallback_=null;this.win_.removeEventListener("pagehide",this.pageHideCallback_,false);this.pageHideCallback_=null;!this.hasFilledForm_||this.isLocalDomain_()?this.finishInput_("",""):this.urlClassifier_.lookup(this.win_.location.hostname,this.win_.location.pathname,BindToObject(this.finishInput_,this,this.win_.location.href))}};
a.finishInput_=function(b,c){for(var d=!!c,e=c||b,f;f=this.nodeIdMap_.pop();)this.inputCollector_.documentUnload(f.id,e,d)};a.onKeyPress_=function(b){var c=b.target;if(c){var d=c.nodeName.toLowerCase();if(d=="input")d=c.type.toLowerCase();else if(d!="textarea")return;if(!(b.ctrlKey||b.altKey||b.metaKey)){c=this.getNodeId_(c);this.inputCollector_.keyPressEvent(c,d,b.keyCode,b.charCode);this.hasFilledForm_=true}}};
a.getNodeId_=function(b){for(var c=this.nodeIdMap_.length,d=c-1;d>=0;--d)if(b==this.nodeIdMap_[d].node)return this.nodeIdMap_[d].id;this.nodeIdMap_[c]={node:b,id:GTB_TextReuseOnPage.freeNodeId_};++GTB_TextReuseOnPage.freeNodeId_;return this.nodeIdMap_[c].id};a.isLocalDomain_=function(){try{var b=this.win_.location.host}catch(c){return true}return this.win_.location.protocol.indexOf("file:")==0||b.indexOf("localhost")==0||GTB_isIP(b)&&GTB_isLocalIP(b)};function GTB_TextReuseService(){this.isInitialized_=false;new G_Alarm(BindToObject(this.lazyInit_,this),5E3)}a=GTB_TextReuseService.prototype;
a.lazyInit_=function(){if(!this.isInitialized_){this.isInitialized_=true;this.debugZone="textreuse-service";if(!GTB_GeckoVersion.isFirefox2()){try{this.dbservice_=Cc["@google.com/toolbar/textreuse;1"].getService(Ci.GTBITextReuse)}catch(b){return}this.dbservice_.setUploadCallback(BindToObject(this.uploadData_,this));this.prefs_=new G_Preferences("google.toolbar.");this.hasher_=null;this.seenUrls_={};this.seenUrlsArray_=[];var c=this.prefs_.getPref("trseenlist");if(c){this.seenUrlsArray_=c.split(",");
for(c=0;c<this.seenUrlsArray_.length;++c)this.seenUrls_[this.seenUrlsArray_[c]]=true}new PROT_UrlCryptoKeyManager;this.prefs_.addObserver("textreuse.enabled",BindToObject(this.onEnabledPrefChanged_,this));this.onEnabledPrefChanged_()}}};
a.onEnabledPrefChanged_=function(){var b=this.prefs_.getPref("textreuse.enabled",false),c=Cc["@mozilla.org/url-classifier/listmanager;1"].getService(Ci.nsIUrlListManager);c.registerTable("goog-whitedomain-shavar",false);b?c.enableUpdate("goog-whitedomain-shavar"):c.disableUpdate("goog-whitedomain-shavar")};
a.seenUrl_=function(b){this.lazyInit_();if(!this.hasher_)this.hasher_=new G_CryptoHasher;this.hasher_.init(G_CryptoHasher.algorithms.MD5);this.hasher_.updateFromString(b);b=this.hasher_.digestBase64();if(b in this.seenUrls_)return true;this.seenUrls_[b]=true;for(this.seenUrlsArray_.push(b);this.seenUrlsArray_.length>100;){b=this.seenUrlsArray_.shift();delete this.seenUrls_[b]}this.prefs_.setPref("trseenlist",this.seenUrlsArray_.join(","));return false};
a.uploadData_=function(b,c){if(!this.seenUrl_(b)){var d=new G_Preferences("google.toolbar.");if(d.getPref("textreuse.enabled",false)&&GTB_IsOnline()){var e=(new GTB_Pinging).getToolbarId();d=new PROT_UrlCrypto;e={url:b,data:c,guid:e};e=d.maybeCryptParams(e);d="";for(var f in e)d+=f+"="+encodeURIComponent(e[f])+"&";f=this.getTextResultsReportURL();e=new G_XMLFetcher(true);e.post(f,d,null)}}};a.getTextResultsReportURL=function(){return"http://sb.google.com/safebrowsing/reuse?"};function GTB_UrlClassifier(){this.debugZone="urlClassifier";this.listManager_=Cc["@mozilla.org/url-classifier/listmanager;1"].getService(Ci.nsIUrlListManager);this.callback_=this.currUrl_=null}GTB_UrlClassifier.prototype.lookup=function(b,c,d){this.callback_=d;this.currUrl_=b+c;this.listManager_.safeLookup("http://"+this.currUrl_,this)};GTB_UrlClassifier.prototype.handleEvent=function(b){b=b.indexOf("goog-whitedomain-shavar")!=-1?this.currUrl_:"";this.callback_(b);this.callback_=null};function PROT_UrlCryptoKeyManager(b,c){this.debugZone="urlcryptokeymanager";this.testing_=!!c;this.base64_=new G_Base64;this.wrappedKey_=this.clientKeyArray_=this.clientKey_=null;this.rekeyTries_=0;this.keyFilename_=b||PROT_UrlCryptoKeyManager.getKeyFilename();this.MAX_REKEY_TRIES=PROT_UrlCryptoKeyManager.MAX_REKEY_TRIES;this.CLIENT_KEY_NAME=PROT_UrlCryptoKeyManager.CLIENT_KEY_NAME;this.WRAPPED_KEY_NAME=PROT_UrlCryptoKeyManager.WRAPPED_KEY_NAME;if(!this.testing_){PROT_UrlCrypto.prototype.manager_=
this;var d=this.maybeLoadOldKey(),e=new G_Preferences("google.toolbar.");e=e.getPref(PROT_UrlCryptoKeyManager.NEXT_REKEY_PREF,0);if(!d||e<parseInt(Date.now()/1E3,10))this.reKey()}}PROT_UrlCryptoKeyManager.getKeyFilename=function(){return"kf.txt"};PROT_UrlCryptoKeyManager.MAX_REKEY_TRIES=2;PROT_UrlCryptoKeyManager.NEXT_REKEY_PREF="safebrowsing.keyupdatetime";PROT_UrlCryptoKeyManager.KEY_MIN_UPDATE_TIME=86400;PROT_UrlCryptoKeyManager.CLIENT_KEY_NAME="clientkey";
PROT_UrlCryptoKeyManager.WRAPPED_KEY_NAME="wrappedkey";a=PROT_UrlCryptoKeyManager.prototype;a.getClientKeyArray=function(){return this.clientKeyArray_};a.getWrappedKey=function(){return this.wrappedKey_};
a.reKey=function(){if(this.rekeyTries_>this.MAX_REKEY_TRIES)throw Error("Have already rekeyed "+this.rekeyTries_+" times");this.rekeyTries_++;var b=this.getGetKeyURL();if(!this.testing_&&GTB_IsOnline()){(new G_XMLFetcher).get(b,BindToObject(this.onGetKeyResponse,this));b=new G_Preferences("google.toolbar.");var c=parseInt(Date.now()/1E3,10)+PROT_UrlCryptoKeyManager.KEY_MIN_UPDATE_TIME;b.setPref(PROT_UrlCryptoKeyManager.NEXT_REKEY_PREF,c)}};
a.getGetKeyURL=function(){return"https://sb-ssl.google.com/safebrowsing/getkey?client="+this.getClientId()+"&"};a.getClientId=function(){return"navclient-auto-tbff"};a.maybeReKey=function(){if(this.rekeyTries_>this.MAX_REKEY_TRIES)return false;this.reKey();return true};a.hasKey_=function(){return this.clientKey_!=null&&this.wrappedKey_!=null};a.replaceKey_=function(b,c){this.clientKey_=b;this.clientKeyArray_=this.base64_.decodeString(this.clientKey_);this.wrappedKey_=c;this.serializeKey_()};
a.serializeKey_=function(){var b={};b[this.CLIENT_KEY_NAME]=this.clientKey_;b[this.WRAPPED_KEY_NAME]=this.wrappedKey_;try{var c=new PROT_ApplicationDirectory;c.exists()||c.create();var d=c.getAppDirFileInterface();d.append(this.keyFilename_);G_FileWriter.writeAll(d,(new G_Protocol4Parser).serialize(b));return true}catch(e){return false}};
a.onGetKeyResponse=function(b){b=b.responseText;b=(new G_Protocol4Parser).parse(b);var c=b[this.CLIENT_KEY_NAME],d=b[this.WRAPPED_KEY_NAME];b&&c&&d&&this.replaceKey_(c,d)};
a.maybeLoadOldKey=function(){var b=null;try{var c=new PROT_ApplicationDirectory,d=c.getAppDirFileInterface();d.append(this.keyFilename_);if(d.exists())b=G_FileReader.readAll(d)}catch(e){return false}if(!b)return false;b=(new G_Protocol4Parser).parse(b);c=b[this.CLIENT_KEY_NAME];d=b[this.WRAPPED_KEY_NAME];if(b&&c&&d&&!this.hasKey_()){this.replaceKey_(c,d);return true}return false};function PROT_UrlCrypto(){this.debugZone="urlcrypto";this.hasher_=new G_CryptoHasher;this.streamCipher_=Cc["@mozilla.org/security/streamcipher;1"].createInstance(Ci.nsIStreamCipher);this.manager_||new PROT_UrlCryptoKeyManager;this.VERSION=PROT_UrlCrypto.VERSION;this.RC4_DISCARD_BYTES=PROT_UrlCrypto.RC4_DISCARD_BYTES;this.VERSION_QUERY_PARAM_NAME=PROT_UrlCrypto.QPS.VERSION_QUERY_PARAM_NAME;this.ENCRYPTED_PARAMS_PARAM_NAME=PROT_UrlCrypto.QPS.ENCRYPTED_PARAMS_PARAM_NAME;this.COUNT_QUERY_PARAM_NAME=PROT_UrlCrypto.QPS.COUNT_QUERY_PARAM_NAME;
this.WRAPPEDKEY_QUERY_PARAM_NAME=PROT_UrlCrypto.QPS.WRAPPEDKEY_QUERY_PARAM_NAME;this.macer_=new G_CryptoHasher;this.macInitialized_=false;this.separator_=":coolgoog:";this.separatorArray_=Array.map(this.separator_,function(b){return b.charCodeAt(0)})}PROT_UrlCrypto.VERSION="1";PROT_UrlCrypto.RC4_DISCARD_BYTES=1600;PROT_UrlCrypto.QPS={};PROT_UrlCrypto.QPS.VERSION_QUERY_PARAM_NAME="encver";PROT_UrlCrypto.QPS.ENCRYPTED_PARAMS_PARAM_NAME="encparams";PROT_UrlCrypto.QPS.COUNT_QUERY_PARAM_NAME="nonce";
PROT_UrlCrypto.QPS.WRAPPEDKEY_QUERY_PARAM_NAME="wrkey";a=PROT_UrlCrypto.prototype;a.getManager=function(){return this.manager_};a.appendParams_=function(b){var c="";for(var d in b)c+="&"+d+"="+encodeURIComponent(b[d]);return c};
a.maybeCryptParams=function(b){if(!this.manager_)throw Error("Need a key manager for UrlCrypto");if(typeof b!="object")throw Error("params is an associative array of name/value params");var c=this.manager_.getClientKeyArray(),d=this.manager_.getWrappedKey();if(!c||!d)return b;b=this.appendParams_(b);var e=this.getCount_();e&=4294967295;c=this.encryptV1(c,this.VERSION,e,b);b={};b[this.VERSION_QUERY_PARAM_NAME]=this.VERSION;b[this.COUNT_QUERY_PARAM_NAME]=e;b[this.WRAPPEDKEY_QUERY_PARAM_NAME]=d;b[this.ENCRYPTED_PARAMS_PARAM_NAME]=
c;return b};
a.maybeCryptParam=function(b,c){if(!this.manager_)throw Error("Need a key manager for UrlCrypto");if(c<1)throw Error("maxLen must be at least 1");var d=this.manager_.getClientKeyArray(),e=this.manager_.getWrappedKey();if(!d||!e)return b.substring(0,c);var f=this.getCount_();f&=4294967295;e=this.VERSION_QUERY_PARAM_NAME+"="+encodeURIComponent(this.VERSION)+"&"+this.COUNT_QUERY_PARAM_NAME+"="+encodeURIComponent(f)+"&"+this.WRAPPEDKEY_QUERY_PARAM_NAME+"="+encodeURIComponent(e)+"&"+this.ENCRYPTED_PARAMS_PARAM_NAME+"=";
var g=(c-e.length)*3/4-1;if(g<0)throw Error("excrypted url too long");b=b.substring(0,g);if("%"==b[g-1])b=b.substring(0,g-1);else if("%"==b[g-2])b=b.substring(0,g-2);d=this.encryptV1(d,this.VERSION,f,b);return e+d};
a.encryptV1=function(b,c,d,e){if(c!="1")throw Error("Unknown encryption version");b=this.deriveEncryptionKey(b,d);this.streamCipher_.init(b);this.RC4_DISCARD_BYTES>0&&this.streamCipher_.discard(this.RC4_DISCARD_BYTES);this.streamCipher_.updateFromString(e);e=this.streamCipher_.finish(true);return e.replace(/\r\n/g,"")};
a.deriveEncryptionKey=function(b,c){var d=[];d.push(c>>24);d.push(c>>16&255);d.push(c>>8&255);d.push(c&255);this.hasher_.init(G_CryptoHasher.algorithms.MD5);this.hasher_.updateFromArray(b);this.hasher_.updateFromArray(d);d=Cc["@mozilla.org/security/keyobjectfactory;1"].getService(Ci.nsIKeyObjectFactory);return d=d.keyFromString(Ci.nsIKeyObject.RC4,this.hasher_.digestRaw())};a.getCount_=function(){return(new Date).getTime()&4294967295};
a.initMac=function(b){if(this.macInitialized_)throw Error("Can't interleave calls to initMac.  Please use another UrlCrypto object.");this.macInitialized_=true;var c=null;c=b?b:this.manager_.getClientKeyArray();this.macer_.init(G_CryptoHasher.algorithms.MD5);this.macer_.updateFromArray(c);this.macer_.updateFromArray(this.separatorArray_)};
a.updateMacFromString=function(b){if(!this.macInitialized_)throw Error("Initialize mac first");var c=Cc["@mozilla.org/io/string-input-stream;1"].createInstance(Ci.nsIStringInputStream);c.setData(b,b.length);c.available()>0&&this.macer_.updateFromStream(c)};
a.finishMac=function(b){var c=null;c=b?b:this.manager_.getClientKeyArray();if(!this.macInitialized_)throw Error("Initialize mac first");this.macer_.updateFromArray(this.separatorArray_);this.macer_.updateFromArray(c);this.macInitialized_=false;return this.macer_.digestBase64()};
a.computeMac=function(b,c,d,e){var f=null,g=null;f=d?d:this.manager_.getClientKeyArray();g=e?e:this.separatorArray_;this.macer_.init(G_CryptoHasher.algorithms.MD5);this.macer_.updateFromArray(f);this.macer_.updateFromArray(g);d=Cc["@mozilla.org/io/string-input-stream;1"].createInstance(Ci.nsIStringInputStream);d.setData(b,b.length);d.available()>0&&this.macer_.updateFromStream(d);this.macer_.updateFromArray(g);this.macer_.updateFromArray(f);if(c)return this.macer_.digestRaw();return this.macer_.digestBase64()};function GTB_FirefoxAntiPhishingIntegration(b,c){this.debugZone="ap-integration";this.doc_=b.document;this.prefs_=new G_Preferences;c.registerListener("pagehide",BindToObject(this.onPageHide_,this));new G_Alarm(BindToObject(this.updateUICommands_,this,b),3E3)}a=GTB_FirefoxAntiPhishingIntegration.prototype;
a.updateUICommands_=function(b){var c=b.controllers.getControllerForCommand("safebrowsing-accept-warning");if(c){b.controllers.removeController(c);this.originalController_=c;b.controllers.appendController(this);b.controllers.appendController(c)}};a.QueryInterface=function(b){if(b.equals(Ci.nsISupports)||b.equals(Ci.nsIController))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};a.shutdown=function(){var b=this.doc_.defaultView;try{b.controllers.removeController(this)}catch(c){}};
a.onPageHide_=function(){var b=this.doc_.getElementById("safebrowsing-urlbar-icon");b=b&&b.getAttribute("level");if(b=="warn"){b=(b=this.doc_.getElementById("safebrowsing-page-canvas"))?"phishnavaway":"ignorenavaway";this.maybeSendReport_(b)}};
a.maybeSendReport_=function(b){if(this.shouldSendPing_()){var c=this.doc_&&this.doc_.defaultView;if(c=c&&c.GTB_getToolbar()){var d="",e=""+c._getCurrentWindow().document.URL;if(e.startsWith("about:neterror?e=")){d=e.substr(e.indexOf("?"));d=GTB_parseQueryString(d);d=d.e}c=c._getCurrentLocation().href;b=this.getActionReportURL()+"evts="+b+"&evtd="+encodeURIComponent(c)+"&evtp="+encodeURIComponent(d);(new G_XMLFetcher(true)).get(b,null)}}};a.getActionReportURL=function(){return"http://sb.google.com/safebrowsing/report?"};
a.shouldSendPing_=function(){var b=this.prefs_.getPref(this.getToolbarPageRankPrefName()),c=this.prefs_.getPref("browser.safebrowsing.enabled"),d=this.prefs_.getPref("browser.safebrowsing.remoteLookups");return b&&c&&!d&&GTB_IsOnline()};a.getToolbarPageRankPrefName=function(){return"google.toolbar.button_option.gtbPageRank"};a.supportsCommand=function(b){return this.originalController_.supportsCommand(b)};a.isCommandEnabled=function(b){return this.originalController_.isCommandEnabled(b)};
a.onEvent=function(b){return this.originalController_.onEvent(b)};a.doCommand=function(b){var c=this.originalController_.doCommand(b);if("safebrowsing-accept-warning"==b)this.maybeSendReport_("phishaccept");else"safebrowsing-decline-warning"==b&&this.maybeSendReport_("phishdecline");return c};function GTB_MetricConversion(b){this.debugZone="metricconversion";this.doc_=b;if(this.xpcomobj_=Components.classes["@google.com/metricconversion;1"]){this.metric_convertor_=this.xpcomobj_.createInstance(Components.interfaces.GTBIMetricConversion);this.prefs_=new G_Preferences("google.toolbar.");b=BindToObject(this.onEnabledPrefChanged_,this);this.prefs_.addObserver("button_option.gtbTranslate",b);this.prefs_.addObserver("translate.hover",b);this.enabled_=false;this.onEnabledPrefChanged_()}}
GTB_MetricConversion.prototype.getCurrWindow=function(){return this.doc_.getElementById("content").selectedBrowser.contentWindow};GTB_MetricConversion.prototype.onEnabledPrefChanged_=function(){this.enabled_=this.prefs_.getPref("button_option.gtbTranslate")&&this.prefs_.getPref("translate.hover")};
GTB_MetricConversion.prototype.getTooltipBody=function(b,c,d,e){if(!this.enabled_)return null;if(!this.xpcomobj_)return null;if(b.parentNode!=e)return null;if(b.nodeType!=b.TEXT_NODE)return null;e=b.ownerDocument.createRange();b.ownerDocument.createRange();e.selectNode(b);var f=e.toString();if(c<0||c>=f.length)return null;e="";var g=false;d=d.getSelection();if(d!=null)if(d.rangeCount==1){d=d.getRangeAt(0);if(!d.collapsed){var h=b.ownerDocument.createRange();h.setStart(b,c);h.setEnd(b,c);if(d.compareBoundaryPoints(Components.interfaces.nsIDOMRange.START_TO_START,
h)<1&&d.compareBoundaryPoints(Components.interfaces.nsIDOMRange.END_TO_END,h)>-1){g=true;e=this.metric_convertor_.convertMetric(d.toString())}}}g||(e=this.metric_convertor_.findAndMaybeConvertMetric(f,c));if(e!=""){b=this.doc_.createElement("description");c=this.doc_.createElement("image");c.setAttribute("src","chrome://google-toolbar/skin/translator.png");c.style.verticalAlign="middle";c.width="16px";c.height="16px";b.appendChild(c);b.appendChild(this.doc_.createTextNode(e));return[b]}};
goog.exportSymbol("GTB_MetricConversion.prototype.getTooltipBody",GTB_MetricConversion.prototype.getTooltipBody);function GTB_ToolbarSyncManager(b){this.debugZone="toolbar-sync-manager";this.gaiaService_=b;this.prefs_=new G_Preferences;this.timer_=Cc["@mozilla.org/timer;1"].createInstance(Ci.nsITimer);this.userSyncStatusChanging_=this.shutdownInProcess_=this.updateInProcess_=false;this.managers_=[new GTB_TBS_OptionsManager,new GTB_TBS_AutofillManager,new GTB_TBS_CBManager];this.setServerUriNames_();this.setTimeIntervals_();this.timer_.initWithCallback(this,this.GTB_TBSYNC_TIME_INTERVAL,Ci.nsITimer.TYPE_REPEATING_SLACK);
this.offlineChanges_=this.ignoreUpdate_=false;this.promotionNotification_=null;this.stringBundle_=Cc["@mozilla.org/intl/stringbundle;1"].getService(Ci.nsIStringBundleService).createBundle("chrome://google-toolbar/locale/google-toolbar.properties");this.observers_=[new G_ObserverServiceObserver("gaia-signin-change",BindToObject(this.onGaiaSignInChange_,this)),new G_ObserverServiceObserver("gaia-email-change",BindToObject(this.onGaiaEmailChange_,this)),new G_ObserverServiceObserver("quit-application",
BindToObject(this.onShutdown_,this),true),new G_ObserverServiceObserver("google-toolbar-customized",BindToObject(this.onOptionsChanged_,this)),new G_ObserverServiceObserver("GTB_WT_TOGGLE",BindToObject(this.onOptionsChanged_,this)),new G_ObserverServiceObserver("GTB_CB_ADD",BindToObject(this.onOptionsChanged_,this)),new G_ObserverServiceObserver("GTB_CB_EDIT",BindToObject(this.onOptionsChanged_,this)),new G_ObserverServiceObserver("GTB_CB_RESIZE",BindToObject(this.onOptionsChanged_,this)),new G_ObserverServiceObserver("GTB_CB_NAMECHANGE",
BindToObject(this.onOptionsChanged_,this)),new G_ObserverServiceObserver("GTB_CB_REMOVE",BindToObject(this.onOptionsChanged_,this))];new G_Alarm(BindToObject(this.restoreLocal_,this),0)}a=GTB_ToolbarSyncManager.prototype;a.uploadBackoffTimer_=null;
a.setServerUriNames_=function(){var b="https://"+this.prefs_.getPref("google.toolbar.tbsync.server","browsersync.google.com/tbproxy/toolbarsync");this.GTB_TBSYNC_REQUEST_CREATE_USER=b+"/create_user";this.GTB_TBSYNC_REQUEST_DELETE_USER=b+"/delete_user";this.GTB_TBSYNC_REQUEST_UPDATE=b+"/update";this.GTB_TBSYNC_REQUEST_SYNC=b+"/sync"};a.setTimeIntervals_=function(){this.GTB_TBSYNC_TIME_INTERVAL=this.prefs_.getPref("google.toolbar.tbsync.timeinterval",1800)*1E3};a.isUserSynced=function(){return this.gaiaService_.gaiaIsToolbarSynced()};
a.updateSettings=function(){this.ignoreUpdate_=true;var b=Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService);b.notifyObservers(null,"google-toolbar-customized",null)};a.setupLogo=function(b){GTB_localizeLogo(b)};goog.exportSymbol("GTB_ToolbarSyncManager.prototype.setupLogo",GTB_ToolbarSyncManager.prototype.setupLogo);
GTB_ToolbarSyncManager.prototype.toggleToolbarSyncStatus=function(){if(GTB_IsOnline()){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getMostRecentWindow("navigator:browser");if(this.isUserSynced())b.openDialog("chrome://google-toolbar/content/toolbar-sync-disable.xul","gtbToolbarSyncDisableDialog","modal,centerscreen,chrome,resizable=no",this);else{this.hidePromotion_();b.openDialog("chrome://google-toolbar/content/toolbar-sync-enable.xul","gtbToolbarSyncEnableDialog",
"modal,centerscreen,chrome,resizable=no",this)}}else{(b=this.isUserSynced())&&this.showError_(new GTB_ToolbarSyncManager.Error(GTB_ToolbarSyncManager.ErrorCategory.BROWSER_NOT_ONLINE));b="prop.gtb.tbsync."+(b?"disabling":"enabling")+".failed.offline";this.alertRequestFailed_(b)}};GTB_ToolbarSyncManager.prototype.onEnableAccept=function(){new G_Alarm(BindToObject(this.enableAccept_,this),0)};goog.exportSymbol("GTB_ToolbarSyncManager.prototype.onEnableAccept",GTB_ToolbarSyncManager.prototype.onEnableAccept);
GTB_ToolbarSyncManager.prototype.onDisableAccept=function(){new G_Alarm(BindToObject(this.disableAccept_,this),0)};goog.exportSymbol("GTB_ToolbarSyncManager.prototype.onDisableAccept",GTB_ToolbarSyncManager.prototype.onDisableAccept);GTB_ToolbarSyncManager.prototype.enableAccept_=function(){this.userSyncStatusChanging_=true;try{this.local2Backup_();for(var b=0;b<this.managers_.length;++b)this.managers_[b].onUserCreation()}finally{this.userSyncStatusChanging_=false}this.createUser_()};
GTB_ToolbarSyncManager.prototype.disableAccept_=function(){this.userSyncStatusChanging_=true;try{this.clearBackup_();this.deleteUser_();for(var b=0;b<this.managers_.length;++b)this.managers_[b].onUserDeletion()}finally{this.userSyncStatusChanging_=false}};GTB_ToolbarSyncManager.prototype.onLearnMoreClick=function(b){GTB_Links.showMore(b,"tbsync")};goog.exportSymbol("GTB_ToolbarSyncManager.prototype.onLearnMoreClick",GTB_ToolbarSyncManager.prototype.onLearnMoreClick);
GTB_ToolbarSyncManager.prototype.onPrivacyClick=function(b){GTB_Links.showPrivacy(b,"tbsync")};goog.exportSymbol("GTB_ToolbarSyncManager.prototype.onPrivacyClick",GTB_ToolbarSyncManager.prototype.onPrivacyClick);a=GTB_ToolbarSyncManager.prototype;a.createUser_=function(){this.promotionNotification_=null;this.stopPromotion_();if(GTB_IsOnline()){var b=this.GTB_TBSYNC_REQUEST_CREATE_USER,c=new G_XMLFetcher;c.post(b,"",BindToObject(this.userCreationRequestHandler_,this))}else this.alertRequestFailed_("prop.gtb.tbsync.enabling.failed.offline")};
a.deleteUser_=function(){if(GTB_IsOnline()){var b=this.GTB_TBSYNC_REQUEST_DELETE_USER,c=new G_XMLFetcher;c.post(b,"",BindToObject(this.userDeletionRequestHandler_,this))}else{this.showError_(new GTB_ToolbarSyncManager.Error(GTB_ToolbarSyncManager.ErrorCategory.BROWSER_NOT_ONLINE));this.alertRequestFailed_("prop.gtb.tbsync.disabling.failed.offline")}};
a.local2Backup_=function(){if(!this.prefs_.getPref("google.toolbar.tbsync.backup_saved",false)){for(var b=0;b<this.managers_.length;++b)this.managers_[b].local2Backup();this.prefs_.setPref("google.toolbar.tbsync.backup_saved",true)}};a.backup2Local_=function(b){if(this.prefs_.getPref("google.toolbar.tbsync.backup_saved",false)){for(var c=0;c<this.managers_.length;++c)this.managers_[c].backup2Local(b);this.clearBackup_();new G_Alarm(BindToObject(this.updateSettings,this),0)}};
a.clearBackup_=function(){if(this.prefs_.getPref("google.toolbar.tbsync.backup_saved",false)){this.prefs_.setPref("google.toolbar.tbsync.backup_saved",false);for(var b=0;b<this.managers_.length;++b)this.managers_[b].clearBackup()}};
a.syncImpl_=function(b){if(this.isUserSynced())try{if(this.isStatusOK_(b)){this.showError_(null);for(var c=0;c<this.managers_.length;++c)this.managers_[c].beforeSync();var d=b.responseXML,e=d.getElementsByTagName("SyncResponse")[0],f=e.getElementsByTagName("items")[0].getElementsByTagName("item"),g=f.length;if(g==0)this.updateInProcess_=false;else{for(c=0;c<g;++c)if(f[c].getElementsByTagName("componentID")[0]){var h=f[c].getElementsByTagName("componentID")[0].firstChild.nodeValue;for(b=0;b<this.managers_.length;++b)if(h==
this.managers_[b].COMP_ID){this.managers_[b].processItem(f[c]);break}}for(c=0;c<this.managers_.length;++c)this.managers_[c].finishSync();new G_Alarm(BindToObject(this.updateSettings,this),0)}}else{c=this.parseResponseError_(b);this.handleFailedSyncRequest_(c,false)}}finally{this.updateInProcess_=false}else this.updateInProcess_=false};
a.server2Local_=function(){if(!(this.updateInProcess_||this.userSyncStatusChanging_))if(GTB_IsOnline())if(this.offlineChanges_)this.local2Server_();else{this.updateInProcess_=true;try{var b=this.GTB_TBSYNC_REQUEST_SYNC+"?key="+Date.now(),c=GTB_BackoffedFetcher.createFetcherForSync(),d=G_FirefoxXMLUtils.newXML(null,null,null),e=d.createElement("SyncRequest"),f=d.createElement("components");e.appendChild(f);d.appendChild(e)}catch(g){this.updateInProcess_=false;return}c.post(b,G_FirefoxXMLUtils.getXMLString(e),
BindToObject(this.syncImpl_,this))}else this.showError_(new GTB_ToolbarSyncManager.Error(GTB_ToolbarSyncManager.ErrorCategory.BROWSER_NOT_ONLINE))};a.uploadChangesPostponed_=function(){this.uploadBackoffTimer_=null;this.local2Server_()};
a.local2Server_=function(){if(!this.uploadBackoffTimer_){this.offlineChanges_=true;if(GTB_IsOnline()){for(var b=this.GTB_TBSYNC_REQUEST_UPDATE+"?key="+Date.now(),c=G_FirefoxXMLUtils.newXML(null,null,null),d=c.createElement("UpdateRequest"),e=c.createElement("items"),f=0;f<this.managers_.length;++f)this.managers_[f].addItems(e,c);d.appendChild(e);c.appendChild(d);c=new G_XMLFetcher;c.post(b,G_FirefoxXMLUtils.getXMLString(d),BindToObject(this.updateRequestHandler_,this))}else this.showError_(new GTB_ToolbarSyncManager.Error(GTB_ToolbarSyncManager.ErrorCategory.BROWSER_NOT_ONLINE))}};
a.updateRequestHandler_=function(b){if(this.isStatusOK_(b)){if(b.cookieSet){var c=null;if(b.cookieSet.substr(0,4)=="SID="){c=b.cookieSet.substr(4);b=c.indexOf(";");if(b>=0)c=c.substr(0,b)}c&&this.gaiaService_.cacheUserInfo(c)}for(c=0;c<this.managers_.length;++c)this.managers_[c].finishUpdate();this.offlineChanges_=false}else{c=this.parseResponseError_(b);if(c.code==GTB_ToolbarSyncManager.ErrorCode.UPLOAD_QUOTA_EXCEEDED&&c.backoffPeriodInSecs)this.uploadBackoffTimer_=new G_Alarm(BindToObject(this.uploadChangesPostponed_,
this),c.backoffPeriodInSecs*1E3);else this.handleFailedSyncRequest_(c,true)}};
a.userCreationRequestHandler_=function(b){if(!this.isStatusOK_(b)){b=this.parseResponseError_(b);if(b.category==GTB_ToolbarSyncManager.ErrorCategory.AUTH_FAILURE&&b.code==GTB_ToolbarSyncManager.ErrorCode.INVALID_SID){this.alertRequestFailed_("prop.gtb.tbsync.enabling.failed");this.clearBackup_();this.gaiaService_.refreshNow();return}else if(b.category==GTB_ToolbarSyncManager.ErrorCategory.ACCOUNT_CONFLICT&&b.code==GTB_ToolbarSyncManager.ErrorCode.DUPLICATE_USER)this.alertRequestFailed_("prop.gtb.tbsync.enabling.failed");else{this.clearBackup_();
this.alertRequestFailed_("prop.gtb.tbsync.enabling.failed");this.gaiaService_.refreshNow();return}}this.showError_(null);this.local2Server_();this.gaiaService_.refreshNow()};
a.userDeletionRequestHandler_=function(b){this.gaiaService_.refreshNow();if(!this.isStatusOK_(b)){b=this.parseResponseError_(b);if(b.category==GTB_ToolbarSyncManager.ErrorCategory.AUTH_FAILURE&&b.code==GTB_ToolbarSyncManager.ErrorCode.INVALID_SID)return;else if(b.category==GTB_ToolbarSyncManager.ErrorCategory.ACCOUNT_CONFLICT&&b.code==GTB_ToolbarSyncManager.ErrorCode.DUPLICATE_USER)this.alertRequestFailed_("prop.gtb.tbsync.disabling.failed");else{this.clearBackup_();this.alertRequestFailed_("prop.gtb.tbsync.disabling.failed");
return}}this.showError_(null);this.clearBackup_()};a.isStatusOK_=function(b){return b&&b.status==200};a.alertRequestFailed_=function(b){alert(this.stringBundle_.GetStringFromName(b),this.stringBundle_.GetStringFromName("prop.gtb.tbsync.title"))};a.stopPromotion_=function(){this.promotionNotification_=null;this.prefs_.setPref("google.toolbar.tbsync.promotions",0)};a.showHelp_=function(b){this.promotionNotification_=null;GTB_Links.showMore(b,"tbsync")};
a.showPromotion_=function(){if(!this.isUserSynced()){var b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getMostRecentWindow("navigator:browser");var c=b.document.getElementById("main-window");if(c){c=c.getAttribute("chromehidden");if(!(c&&c.indexOf("toolbar")>=0))if(c=b.GTB_getToolbar()){this.prefs_.setPref("google.toolbar.tbsync.promotions",this.prefs_.getPref("google.toolbar.tbsync.promotions",3)-1);c=c._getCurrentBrowser();var d=c.ownerDocument.getElementById("content");
d=d.getNotificationBox(c);var e=this.stringBundle_.GetStringFromName("prop.gtb.tbsync.promo.text"),f={label:this.stringBundle_.GetStringFromName("prop.gtb.tbsync.promo.btnYes.label"),accessKey:this.stringBundle_.GetStringFromName("prop.gtb.tbsync.promo.btnYes.accessKey"),browser:c,callback:BindToObject(this.createUser_,this)},g={label:this.stringBundle_.GetStringFromName("prop.gtb.tbsync.promo.btnNo.label"),accessKey:this.stringBundle_.GetStringFromName("prop.gtb.tbsync.promo.btnNo.accessKey"),browser:c,
callback:BindToObject(this.stopPromotion_,this)};b={label:this.stringBundle_.GetStringFromName("prop.gtb.tbsync.promo.btnHelp.label"),accessKey:this.stringBundle_.GetStringFromName("prop.gtb.tbsync.promo.btnHelp.accessKey"),browser:c,callback:BindToObject(this.showHelp_,this,b)};this.promotionNotification_=d.appendNotification(e,"GoogleToolbarSyncMessage","chrome://google-toolbar/skin/search.png",d.PRIORITY_INFO_HIGH,[f,g,b]);new G_Alarm(BindToObject(this.hidePromotion_,this),6E4)}}}};
a.hidePromotion_=function(){if(this.promotionNotification_){try{this.promotionNotification_.close()}catch(b){}this.promotionNotification_=null}};a.onGaiaSignInChange_=function(b,c,d){if(d=="true"){b=this.prefs_.getPref("google.toolbar.tbsync.promotions",3);b>0&&new G_Alarm(BindToObject(this.showPromotion_,this),2E3)}if(d!="true"){if(this.uploadBackoffTimer_){this.uploadBackoffTimer_.cancel();this.uploadBackoffTimer_=null}this.hidePromotion_()}this.backup2Local_()};a.onGaiaEmailChange_=function(){this.update(false)};
a.showError_=function(b){var c=!this.prefs_.getPref("google.toolbar.tbsync.force_sync_menu",false)&&b==null,d=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);for(d=d.getEnumerator("navigator:browser");d.hasMoreElements();){var e=d.getNext(),f=e.document.getElementById("gtbSignings"),g=e.document.getElementById("gtbToolbarSyncRefresh");e=e.document.getElementById("gtbToolbarSyncSeparator");if(f){f.setAttribute("noaccess",!c);f.setAttribute("tooltiptext",this.getTooltipText_(b))}g&&
g.setAttribute("noaccess",!c);e&&e.setAttribute("noaccess",!c)}};a.getTooltipText_=function(b){var c=this.stringBundle_;return b?b.category==GTB_ToolbarSyncManager.ErrorCategory.BROWSER_NOT_ONLINE?c.GetStringFromName("prop.gtb.tbsync.tip.offline"):b.category==GTB_ToolbarSyncManager.ErrorCategory.NETWORK_NOT_READY?c.GetStringFromName("prop.gtb.tbsync.tip.network_not_ready"):c.GetStringFromName("prop.gtb.tbsync.tip.update_failed"):c.GetStringFromName("prop.gtb.gaia.account")};a.notify=function(){this.update(false)};
a.update=function(b){if(GTB_IsOnline()){if(!GTB_NoToolbarVisible())if(this.isUserSynced()){this.local2Backup_();this.server2Local_()}}else{var c=new GTB_ToolbarSyncManager.Error(GTB_ToolbarSyncManager.ErrorCategory.BROWSER_NOT_ONLINE);this.handleFailedSyncRequest_(c,true);if(b){b=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);b=b.getMostRecentWindow("navigator:browser");b.openDialog("chrome://google-toolbar/content/toolbar-sync-offline-alert.xul","gtbToolbarSyncOfflineAlert",
"modal,centerscreen,chrome,resizable=no",this)}}};a.onShutdown_=function(){this.shutdownInProcess_=true;this.backup2Local_()};a.onOptionsChanged_=function(){if(!this.shutdownInProcess_)if(this.ignoreUpdate_)this.ignoreUpdate_=false;else this.isUserSynced()&&!this.updateInProcess_&&!this.userSyncStatusChanging_&&new G_Alarm(BindToObject(this.local2Server_,this),0)};a.restoreLocal_=function(){this.backup2Local_(true)};a.refreshSync=function(){this.update(true)};
a.parseResponseError_=function(b){var c;c=b.status==-1||b.status==504?GTB_ToolbarSyncManager.ErrorCategory.NETWORK_NOT_READY:b.status==502&&this.isResponseFromGfe_(b)?GTB_ToolbarSyncManager.ErrorCategory.SERVER_THROTTLING:b.status==503?GTB_ToolbarSyncManager.ErrorCategory.SERVICE_UNAVAILABLE:b.status>=500?GTB_ToolbarSyncManager.ErrorCategory.SERVER_ERROR:b.status==403?GTB_ToolbarSyncManager.ErrorCategory.AUTH_FAILURE:b.status==409?GTB_ToolbarSyncManager.ErrorCategory.ACCOUNT_CONFLICT:GTB_ToolbarSyncManager.ErrorCategory.UNEXPECTED_ERR;
c=new GTB_ToolbarSyncManager.Error(c);var d=b.responseXML;if(d){var e=G_FirefoxXMLUtils.selectSingleNode(d.documentElement,"//Error/ErrorCode/text()");if(e&&e.nodeValue){c.code=GTB_ToolbarSyncManager.ErrorCategory[e.nodeValue]||GTB_ToolbarSyncManager.ErrorCode.OTHER_ERROR;if(c.code==GTB_ToolbarSyncManager.ErrorCode.THROTTLING&&b.status==503)c.category=GTB_ToolbarSyncManager.ErrorCategory.SERVER_THROTTLING;else if(c.code==GTB_ToolbarSyncManager.ErrorCode.UPLOAD_QUOTA_EXCEEDED)if(b=G_FirefoxXMLUtils.selectSingleNode(d.documentElement,
"//Error/ErrorMsg/text()"))if(b=b.nodeValue.match(/BACKOFF=(\d+)$/)){b=parseInt(b[1],10);if(!isNaN(b))c.backoffPeriodInSecs=b}}}return c};a.isResponseFromGfe_=function(b){return(b=b.getResponseHeader("Server"))&&b.startsWith("GFE/")};
a.handleFailedSyncRequest_=function(b,c){if(b.category==GTB_ToolbarSyncManager.ErrorCategory.AUTH_FAILURE&&[GTB_ToolbarSyncManager.ErrorCode.INVALID_UID,GTB_ToolbarSyncManager.ErrorCode.ACCOUNT_NOT_FOUND,GTB_ToolbarSyncManager.ErrorCode.UPLOAD_TOO_LARGE].indexOf(b.code)>=0||b.category==GTB_ToolbarSyncManager.ErrorCategory.BROWSER_NOT_ONLINE)if(this.isUserSynced()&&c)this.showError_(b);else b.code==GTB_ToolbarSyncManager.ErrorCode.INVALID_UID&&this.showError_(b)};
GTB_ToolbarSyncManager.ErrorCategory={SERVER_THROTTLING:1,SERVER_ERROR:2,SERVICE_UNAVAILABLE:3,NETWORK_NOT_READY:4,AUTH_FAILURE:5,ACCOUNT_CONFLICT:6,BROWSER_NOT_ONLINE:7,UNEXPECTED_ERR:8};GTB_ToolbarSyncManager.ErrorCode={MISSING_UID:1,MISSING_MID:2,MISSING_TOKEN:3,MISSING_KEY:4,INVALID_UID:5,INVALID_MID:6,INVALID_TOKEN:7,INVALID_KEY:8,INVALID_SID:9,INVALID_TOKEN_COUNT_EXCEEDED:10,ACCOUNT_NOT_FOUND:11,DUPLICATE_USER:12,THROTTLING:13,UPLOAD_TOO_LARGE:14,UPLOAD_QUOTA_EXCEEDED:15,OTHER_ERROR:16};
GTB_ToolbarSyncManager.Error=function(b){this.category=b;this.code=GTB_ToolbarSyncManager.ErrorCode.OTHER_ERROR;this.backoffPeriodInSecs=0};function GTB_LanguageListToJSON(b){if(!b)return"[]";b=b.split(",");return b="["+goog.array.map(b,function(c){return'"'+c+'"'}).join(",")+"]"}function GTB_LanguageListFromJSON(b){if(!b)return"";b=b.match(/\"[\w-]+\"/g);if(!b)return"";b=goog.array.map(b,function(c){return c.substring(1,c.length-1)});return b.join(",")}
var GTB_TBSYNC_OPTIONS={LinkDoctor:{type:"BOOL",isButton:false,localID:"google.toolbar.linkdoctor.enabled"},DictionaryToLang:{type:"STRING",isButton:false,localID:"google.toolbar.translate.target_lang"},GoogleHome:{type:"STRING",isButton:false,localID:"google.toolbar.google_home",server2LocalValue:function(b){return"www.google."+b},local2ServerValue:function(b){return b.replace(/www.google./,"")}},HoverDictionary:{type:"BOOL",isButton:false,localID:"google.toolbar.translate.hover"},HoverTranslateBlacklist:{type:"STRING",
isButton:false,localID:"google.toolbar.translate.hover.understand_list",server2LocalValue:GTB_LanguageListFromJSON,local2ServerValue:GTB_LanguageListToJSON},HoverTranslateHoldShift:{type:"BOOL",isButton:false,localID:"google.toolbar.translate.hover.hold_shift"},HoverTranslateLearnMoreCount:{type:"UINT",isButton:false,localID:"google.toolbar.translate.hover.learn_more_count"},PrefetchEnabled:{type:"BOOL",isButton:false,localID:"google.toolbar.dns_prefetch"},NewWindow:{type:"INT",isButton:false,localID:"google.toolbar.search_new_window_or_tab",
server2LocalValue:function(b){return b=="0"?"currentWindow":b=="1"?"newWindow":"newTab"},local2ServerValue:function(b){return b=="currentWindow"?"0":b=="newWindow"?"1":"2"}},SpellLanguage:{type:"STRING",isButton:false,localID:"google.toolbar.spell_check.lang"},SpellIgnoreCaps:{type:"BOOL",isButton:false,localID:"google.toolbar.spell_check_ignore_all_caps"},SpellIgnoreDigits:{type:"BOOL",isButton:false,localID:"google.toolbar.spell_check_ignore_digits"},SpellIgnoreDups:{type:"BOOL",isButton:false,
localID:"google.toolbar.spell_check_ignore_dups"},SuggestQueries:{type:"BOOL",isButton:false,localID:"google.toolbar.search_box_use_suggest"},StoreHist:{type:"BOOL",isButton:false,localID:"google.toolbar.search_box_save_history"},Verbosity:{type:"UINT",isButton:false,localID:"google.toolbar.button_text_level",values_:[{serverID:"0",localID:"icons"},{serverID:"1",localID:"gtb-selective-text"},{serverID:"2",localID:"text"},{serverID:"3",localID:"full"}],server2LocalValue:function(b){for(var c=0;c<this.values_.length;++c)if(b==
this.values_[c].serverID||b==this.values_[c].localID)return this.values_[c].localID;return null},local2ServerValue:function(b){for(var c=0;c<this.values_.length;++c)if(b==this.values_[c].serverID||b==this.values_[c].localID)return this.values_[c].serverID;return null}},BookmarkSortOrder:{type:"STRING",isButton:false,localID:"google.toolbar.bookmarks.sort",values_:[{serverID:"name+",localID:"alpha"},{serverID:"lastmodified-",localID:"date"}],server2LocalValue:function(b){for(var c=0;c<this.values_.length;++c)if(b==
this.values_[c].serverID||b==this.values_[c].localID)return this.values_[c].localID;return null},local2ServerValue:function(b){for(var c=0;c<this.values_.length;++c)if(b==this.values_[c].serverID||b==this.values_[c].localID)return this.values_[c].serverID;return null}},WordFindEnable:{type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbFindTerms"},UseGoogleForMailtos:{type:"BOOL",isButton:false,localID:"google.toolbar.mailto.opt"},ButtonAutoFill:{type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbAutoFill"},
ButtonPageRank:{type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbPageRank"},ButtonSpellcheck:{type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbSpellCheck"},ButtonBookmarks:{type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbBookmarks"},ButtonHighlight:{type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbHighlight"},ButtonUp:{type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbGoUp"}};
GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_enabled"]={type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbTranslate"};GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_enable_automatic_offer"]={type:"BOOL",isButton:false,localID:"google.toolbar.auto_page_translate"};GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_target_language"]={type:"STRING",isButton:false,localID:"google.toolbar.translate.target_lang"};
GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_language_whitelist"]={type:"STRING",isButton:false,localID:"google.toolbar.auto_page_translate.rules.whitelist",server2LocalValue:GTB_LanguageListFromJSON,local2ServerValue:GTB_LanguageListToJSON};GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_language_blacklist"]={type:"STRING",isButton:false,localID:"google.toolbar.auto_page_translate.rules.blacklist",server2LocalValue:GTB_LanguageListFromJSON,local2ServerValue:GTB_LanguageListToJSON};
GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_language_whitelist_candidate"]={type:"STRING",isButton:false,localID:"google.toolbar.auto_page_translate.whitelist.counter"};GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_language_blacklist_candidate"]={type:"STRING",isButton:false,localID:"google.toolbar.auto_page_translate.blacklist.counter"};GTB_TBSYNC_OPTIONS["{9F946C94-144E-4e78-9DB4-B59CB7EDC522}_enabled"]={type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbSidewiki"};
GTB_TBSYNC_OPTIONS["{9F946C94-144E-4e78-9DB4-B59CB7EDC522}_enable_minibar"]={type:"BOOL",isButton:false,localID:"google.sidewiki.minibar.enabled"};GTB_TBSYNC_OPTIONS["{9F946C94-144E-4e78-9DB4-B59CB7EDC522}_enable_language_filtering"]={type:"BOOL",isButton:false,localID:"google.sidewiki.filter.language"};GTB_TBSYNC_OPTIONS.AdvancedFeatures={type:"BOOL",isButton:false,localID:"google.toolbar.sidewiki.enabled"};
GTB_TBSYNC_OPTIONS["{AE1E9B4C-7454-404e-85AC-6980562DAF11}_enabled"]={type:"BOOL",isButton:true,localID:"google.toolbar.button_option.gtbShare"};
GTB_TBSYNC_OPTIONS["{AE1E9B4C-7454-404e-85AC-6980562DAF11}_providers_data"]={type:"STRING",localID:"google.toolbar.sharing.pinned-providers",server2LocalValue:function(b){if(typeof b=="undefined")return"";var c=function(e){return e[1]==1||e[1]==0&&e[2]>=3},d=function(e){return e[0]};b=GTB_parseJson(b);c=goog.array.filter(b,c);return d=goog.array.map(c,d).sort().join(",")},local2ServerValue:function(b){var c=b?b.split(","):[];b=Cc["@google.com/toolbar/sharing-service;1"].getService().wrappedJSObject;
b=b.getAllProviders().map(function(d){return'["'+d+'",'+(c.indexOf(d)>=0?1:0)+"]"});return b="["+b.join(",")+"]"}};function GTB_TBS_OptionsManager(){this.debugZone="toolbar-sync-manager-options";this.COMP_ID="toolbarsync/toolbaroption;4";this.prefs_=new G_Preferences;for(var b in GTB_TBSYNC_OPTIONS)GTB_TBSYNC_OPTIONS[b].backupID="google.toolbar.tbsync.backup."+GTB_TBSYNC_OPTIONS[b].localID.replace("google.toolbar.","");this.serverState_={}}
GTB_TBS_OptionsManager.getLocalValue=function(b,c){if(GTB_TBSYNC_OPTIONS[b].server2LocalValue)return GTB_TBSYNC_OPTIONS[b].server2LocalValue(c);return GTB_TBSYNC_OPTIONS[b].type=="BOOL"?c!="0":GTB_TBSYNC_OPTIONS[b].type=="UINT"?parseInt(c,10):c};GTB_TBS_OptionsManager.getServerValue=function(b,c){if(GTB_TBSYNC_OPTIONS[b].local2ServerValue)return GTB_TBSYNC_OPTIONS[b].local2ServerValue(c);return GTB_TBSYNC_OPTIONS[b].type=="BOOL"?c?"1":"0":GTB_TBSYNC_OPTIONS[b].type=="UINT"?""+c:c};a=GTB_TBS_OptionsManager.prototype;
a.buttonsFix_=function(b){var c={gtbTranslate:GTB_getPrefWithLocaleDefault(GTB_TBSYNC_OPTIONS["{FE500B2A-AAD0-4f5a-9A0E-D197406BCDC8}_enabled"].localID)};GTB_LayoutManager.updateButtonsToPrefs(c);if(b){this.prefs_.setPref(GTB_TBSYNC_OPTIONS.ButtonUp.localID,false);this.prefs_.setPref(GTB_TBSYNC_OPTIONS.ButtonUp.localID,GTB_TBSYNC_OPTIONS.ButtonUp.localValue);this.prefs_.setPref(GTB_TBSYNC_OPTIONS.HoverDictionary.localID,false);this.prefs_.setPref(GTB_TBSYNC_OPTIONS.HoverDictionary.localID,GTB_TBSYNC_OPTIONS.HoverDictionary.localValue)}};
a.local2Backup=function(){for(var b in GTB_TBSYNC_OPTIONS){var c=GTB_getPrefWithLocaleDefault(GTB_TBSYNC_OPTIONS[b].localID);if(typeof c!="undefined"){GTB_TBSYNC_OPTIONS[b].localValue=c;GTB_TBSYNC_OPTIONS[b].serverValue=GTB_TBS_OptionsManager.getServerValue(b,c);this.prefs_.setPref(GTB_TBSYNC_OPTIONS[b].backupID,c)}}};
a.backup2Local=function(){for(var b in GTB_TBSYNC_OPTIONS){var c=this.prefs_.getPref(GTB_TBSYNC_OPTIONS[b].backupID,null);if(!goog.isNull(c)){if(GTB_TBSYNC_OPTIONS[b].isButton&&this.prefs_.getPref(GTB_TBSYNC_OPTIONS[b].localID)!=c){var d={};d[GTB_TBSYNC_OPTIONS[b].localID.replace(/google.toolbar.button_option./,"")]=c;GTB_LayoutManager.updateButtonsToPrefs(d)}this.prefs_.setPref(GTB_TBSYNC_OPTIONS[b].localID,c)}}this.buttonsFix_(false)};a.clearBackup=function(){for(var b in GTB_TBSYNC_OPTIONS)this.prefs_.clearPref(GTB_TBSYNC_OPTIONS[b].backupID)};
a.beforeSync=function(){};a.processItem=function(b){var c=GTB_TBS_XML_getTextNodeValue(b.getElementsByTagName("itemID")[0]);if(GTB_TBSYNC_OPTIONS[c]){b=b.getElementsByTagName("prop");for(var d,e=false,f=b.length,g=0;g<f;++g)if(b[g].getAttribute("name")=="value")if(d=GTB_TBS_XML_getTextNodeValue(b[g])){e=true;break}if(e)GTB_TBSYNC_OPTIONS[c].newValue=d}};
a.finishSync=function(){var b={};for(var c in GTB_TBSYNC_OPTIONS)if(GTB_TBSYNC_OPTIONS[c].isButton&&GTB_TBSYNC_OPTIONS[c].serverValue!=GTB_TBSYNC_OPTIONS[c].newValue)b[GTB_TBSYNC_OPTIONS[c].localID.replace(/google.toolbar.button_option./,"")]=GTB_TBS_OptionsManager.getLocalValue(c,GTB_TBSYNC_OPTIONS[c].newValue);for(c in GTB_TBSYNC_OPTIONS){if("newValue"in GTB_TBSYNC_OPTIONS[c]&&GTB_TBSYNC_OPTIONS[c].serverValue!=GTB_TBSYNC_OPTIONS[c].newValue){GTB_TBSYNC_OPTIONS[c].localValue=GTB_TBS_OptionsManager.getLocalValue(c,
GTB_TBSYNC_OPTIONS[c].newValue);GTB_TBSYNC_OPTIONS[c].serverValue=GTB_TBSYNC_OPTIONS[c].newValue;this.prefs_.setPref(GTB_TBSYNC_OPTIONS[c].localID,GTB_TBSYNC_OPTIONS[c].localValue);delete GTB_TBSYNC_OPTIONS[c].newValue}this.serverState_[c]=GTB_TBSYNC_OPTIONS[c].serverValue}GTB_LayoutManager.updateButtonsToPrefs(b);this.buttonsFix_(true);return false};
a.addItems=function(b,c){for(var d in GTB_TBSYNC_OPTIONS){var e=c.createElement("item"),f=GTB_TBS_XML_createTextNode("componentID",this.COMP_ID,c);e.appendChild(f);f=GTB_TBS_XML_createTextNode("itemID",d,c);e.appendChild(f);f=GTB_TBS_XML_createTextNode("prop","LOCATION_APP",c);f.setAttribute("name","location");e.appendChild(f);f=GTB_TBS_XML_createTextNode("prop",GTB_TBSYNC_OPTIONS[d].type,c);f.setAttribute("name","type");e.appendChild(f);f=GTB_TBSYNC_OPTIONS[d].serverValue;var g=GTB_getPrefWithLocaleDefault(GTB_TBSYNC_OPTIONS[d].localID);
if(g!=GTB_TBSYNC_OPTIONS[d].localValue&&typeof g!="undefined")f=GTB_TBS_OptionsManager.getServerValue(d,g);if(f!=this.serverState_[d]){f=GTB_TBS_XML_createTextNode("prop",f,c);f.setAttribute("name","value");e.appendChild(f);b.appendChild(e)}}};
a.finishUpdate=function(){for(var b in GTB_TBSYNC_OPTIONS){var c=GTB_getPrefWithLocaleDefault(GTB_TBSYNC_OPTIONS[b].localID);if(c!=GTB_TBSYNC_OPTIONS[b].localValue&&typeof c!="undefined"){GTB_TBSYNC_OPTIONS[b].localValue=c;GTB_TBSYNC_OPTIONS[b].serverValue=GTB_TBS_OptionsManager.getServerValue(b,c);this.serverState_[b]=GTB_TBSYNC_OPTIONS[b].serverValue}}};a.onUserDeletion=function(){};a.onUserCreation=function(){};var GTB_TBSYNC_AUTOFILL_PREFS={address_billing_line1:"billingAddr1",address_billing_line2:"billingAddr2",address_billing_city:"billingCity",address_billing_country:"billingCountry",address_billing_state:"billingState",address_billing_zip:"billingZip",company_name:"companyName",email:"eMail",phone_fax_city_code:"faxArea",phone_fax_country_code:"faxCountry",phone_fax_number:"faxNumber",name_first:"firstName",name_last:"lastName",name_middle:"middleName",phone_home_city_code:"phoneArea",phone_home_country_code:"phoneCountry",
phone_home_number:"phoneNumber",address_home_line1:"shippingAddr1",address_home_line2:"shippingAddr2",address_home_city:"shippingCity",address_home_country:"shippingCountry",address_home_state:"shippingState",address_home_zip:"shippingZip",profile_name:"label"},GTB_TBSYNC_AUTOFILL_DEFAULT={localID:"isDefault",serverID:"default_profile"},GTB_TBSYNC_AUTOFILL_BS={localID:"billingIsShipping",serverID:"use_billing_address"};
function GTB_TBS_AutofillManager(){this.debugZone="toolbar-sync-manager-autofill";this.COMP_ID="toolbarsync/autofill;5";this.prefs_=new G_Preferences;this.profilesOnServer_=[];this.profileIDs_={};this.defaultProfile_=-1}GTB_TBS_AutofillManager.getBase_=function(b,c){return b+"profile."+c+"."};a=GTB_TBS_AutofillManager.prototype;
a.copyData_=function(b,c){var d=this.prefs_.getPref(b+"profiles",0);this.prefs_.setPref(c+"profiles",d);for(var e=0;e<d;++e){var f=GTB_TBS_AutofillManager.getBase_(b,e),g=GTB_TBS_AutofillManager.getBase_(c,e),h=this.prefs_.getPref(f+"id",e+1);this.prefs_.setPref(g+"id",h);h=this.prefs_.getPref(f+GTB_TBSYNC_AUTOFILL_BS.localID,true);this.prefs_.setPref(g+GTB_TBSYNC_AUTOFILL_BS.localID,h);h=this.prefs_.getPref(f+GTB_TBSYNC_AUTOFILL_DEFAULT.localID,false);this.prefs_.setPref(g+GTB_TBSYNC_AUTOFILL_DEFAULT.localID,
h);for(var i in GTB_TBSYNC_AUTOFILL_PREFS){h=this.prefs_.getPref(f+GTB_TBSYNC_AUTOFILL_PREFS[i],"");this.prefs_.setPref(g+GTB_TBSYNC_AUTOFILL_PREFS[i],h)}}};
a.clearData_=function(b){var c=this.prefs_.getPref(b+"profiles",0);this.prefs_.clearPref(b+"profiles");for(var d=0;d<c;++d){var e=GTB_TBS_AutofillManager.getBase_(b,d);this.prefs_.clearPref(e+"id");this.prefs_.clearPref(e+GTB_TBSYNC_AUTOFILL_BS.localID);this.prefs_.clearPref(e+GTB_TBSYNC_AUTOFILL_DEFAULT.localID);for(var f in GTB_TBSYNC_AUTOFILL_PREFS)this.prefs_.clearPref(e+GTB_TBSYNC_AUTOFILL_PREFS[f])}};a.local2Backup=function(){this.copyData_("google.toolbar.autofill.","google.toolbar.tbsync.backup.autofill.")};
a.backup2Local=function(){this.clearData_("google.toolbar.autofill.");this.copyData_("google.toolbar.tbsync.backup.autofill.","google.toolbar.autofill.")};a.clearBackup=function(){this.clearData_("google.toolbar.tbsync.backup.autofill.")};a.beforeSync=function(){this.profilesOnServer_=[];this.defaultProfile_=1};
a.processItem=function(b){var c=b.getElementsByTagName("itemID")[0],d=GTB_TBS_XML_getTextNodeValue(c);b=b.getElementsByTagName("prop");if(d=="0")this.defaultProfile_=GTB_TBS_XML_getTextNodeValue(b[0]);else{c=b.length;var e=GTB_TBS_AutofillManager.getBase_("google.toolbar.autofill.",this.profilesOnServer_.length);this.prefs_.clearPref(e+GTB_TBSYNC_AUTOFILL_BS.localID);for(var f in GTB_TBSYNC_AUTOFILL_PREFS)this.prefs_.clearPref(e+GTB_TBSYNC_AUTOFILL_PREFS[f]);this.profilesOnServer_.push(d);this.prefs_.setPref(e+
"id",parseInt(d,10));for(f=0;f<c;++f){d=b[f].getAttribute("name");var g=GTB_TBS_XML_getTextNodeValue(b[f]);if(d==GTB_TBSYNC_AUTOFILL_BS.serverID){g=g=="0";this.prefs_.setPref(e+GTB_TBSYNC_AUTOFILL_BS.localID,g)}else GTB_TBSYNC_AUTOFILL_PREFS[d]&&this.prefs_.setPref(e+GTB_TBSYNC_AUTOFILL_PREFS[d],g)}}};
a.finishSync=function(){this.prefs_.setPref("google.toolbar.autofill.profiles",this.profilesOnServer_.length);for(var b=0;b<this.profilesOnServer_.length;++b){var c=GTB_TBS_AutofillManager.getBase_("google.toolbar.autofill.",b);this.prefs_.setPref(c+GTB_TBSYNC_AUTOFILL_DEFAULT.localID,this.prefs_.getPref(c+"id")==this.defaultProfile_)}return false};
a.addItems=function(b,c){var d=this.prefs_.getPref("google.toolbar.autofill.profiles",0),e=1;this.profileIDs_={};for(var f=0;f<d;++f){var g=GTB_TBS_AutofillManager.getBase_("google.toolbar.autofill.",f);if(this.prefs_.getPref(g+GTB_TBSYNC_AUTOFILL_DEFAULT.localID,false))e=this.prefs_.getPref(g+"id",1)}var h=c.createElement("item"),i=GTB_TBS_XML_createTextNode("componentID",this.COMP_ID,c);h.appendChild(i);i=GTB_TBS_XML_createTextNode("itemID",0,c);h.appendChild(i);e=GTB_TBS_XML_createTextNode("prop",
e,c);e.setAttribute("name",GTB_TBSYNC_AUTOFILL_DEFAULT.serverID);h.appendChild(e);b.appendChild(h);for(f=0;f<d;++f){g=GTB_TBS_AutofillManager.getBase_("google.toolbar.autofill.",f);h=c.createElement("item");i=GTB_TBS_XML_createTextNode("componentID",this.COMP_ID,c);h.appendChild(i);e=this.prefs_.getPref(g+"id",1);this.profileIDs_[e]=true;i=GTB_TBS_XML_createTextNode("itemID",e,c);h.appendChild(i);for(var j in GTB_TBSYNC_AUTOFILL_PREFS){e=GTB_TBS_XML_createTextNode("prop",this.prefs_.getPref(g+GTB_TBSYNC_AUTOFILL_PREFS[j],
""),c);e.setAttribute("name",j);h.appendChild(e)}g=this.prefs_.getPref(g+GTB_TBSYNC_AUTOFILL_BS.localID,true);g=!g?"1":"0";e=GTB_TBS_XML_createTextNode("prop",g,c);e.setAttribute("name",GTB_TBSYNC_AUTOFILL_BS.serverID);h.appendChild(e);b.appendChild(h)}for(f=0;f<this.profilesOnServer_.length;++f)if(!this.profileIDs_[this.profilesOnServer_[f]]){h=c.createElement("item");i=GTB_TBS_XML_createTextNode("componentID",this.COMP_ID,c);h.appendChild(i);i=GTB_TBS_XML_createTextNode("itemID",this.profilesOnServer_[f],
c);h.appendChild(i);d=c.createElement("isRemove");h.appendChild(d);b.appendChild(h)}};a.finishUpdate=function(){this.profilesOnServer_=[];for(var b in this.profileIDs_)this.profileIDs_[b]&&this.profilesOnServer_.push(b)};a.onUserDeletion=function(){};a.onUserCreation=function(){};var GTB_TBSYNC_CB_BUILTINS={"google.country":"gtbCountrySearch","google.site":"gtbSearchSite","google.lucky":"gtbFeelingLucky","google.web_history":"gtbSearchWebhistory","google.news":"gtbSearchNews","google.images":"gtbSearchImages","google.groups":"gtbSearchGroups","google.froogle":"gtbSearchFroogle","google.maps":"gtbSearchLocal","google.video":"gtbSearchVideo","google.blog":"gtbSearchBlogs","google.books":"gtbSearchBooks","google.calendar":"gtbSearchCalendar","google.documents":"gtbSearchDocs",
"google.finance":"gtbSearchFinance","google.patents":"gtbSearchPatents","google.photos":"gtbSearchPhotos","google.scholar":"gtbSearchScholar","google.orkut":"gtbstoolbar-google-com_CTK0Y7F4MTG6NKYH03WT-xml"},GTB_TBSYNC_CB_CASE_INCOMPATIBLES=["S_toolbar.google.com_O8Y91YHB24Z6SR0SGYSK"],GTB_TBSYNC_CB_FIELDS=["optionID","localID","xmlID","xmlDoc","in_search_list","ontoolbar","order","gadget_width","gadget_height","option1","title","gadget_options"];
function GTB_TBS_CBManager(){this.debugZone="toolbar-sync-manager-cb";this.COMP_ID="toolbarsync/custombutton;5";this.prefs_=new G_Preferences;this.cb_={};this.newcb_={};this.deleteRequested_={};this.noDeleteAcknoledge_={};this.LOCAL_BUILTINS={};for(var b in GTB_TBSYNC_CB_BUILTINS)this.LOCAL_BUILTINS[GTB_TBSYNC_CB_BUILTINS[b]]=b;this.serverState_={};this.CBService_=Cc["@google.com/toolbar/custom-buttons-service;1"].getService().wrappedJSObject}
GTB_TBS_CBManager.comparator=function(b,c){return b.order-c.order};a=GTB_TBS_CBManager.prototype;a.rescueComparator=function(b,c){if(b.ontoolbar&&c.ontoolbar)return GTB_TBS_CBManager.comparator(b,c);var d=this.CBService_.getDefaultBuiltInOrder();return d.indexOf(b.localID)-d.indexOf(c.localID)};a.generateLocalID=function(b){var c="gtb";if(b in GTB_TBSYNC_CB_BUILTINS)return GTB_TBSYNC_CB_BUILTINS[b];c+=b.startsWith("U_")?"u":"s";c+=b.substr(2).replace(/\.|,/g,"-");return c};
a.generateID=function(b){if(this.LOCAL_BUILTINS[b])return this.LOCAL_BUILTINS[b];b=b.replace(/gtb/,"");var c="u"==b.charAt(0)?"U_":"S_";c+=b.substr(1);return c=c.replace(/\-/g,".")};
a.getFromToolbar_=function(){var b={},c=this.CBService_.getList().toArray(),d=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator);d=d.getMostRecentWindow("navigator:browser");if(!d)return{};d=d.document;for(var e=0;e<c.length;++e){var f=c[e],g=d.getElementById(f);(g=g&&g.parentNode)&&g.nodeName=="toolbar"&&g.id!="gtbToolbar"||(b[this.generateID(f)]=this.getButtonInfo_(f))}return b};
a.getButtonInfo_=function(b){var c=this.CBService_.getButton(b),d={};d.localID=b;var e=this.LOCAL_BUILTINS[b];if(!e){e=this.generateID(b);d.xmlID="xml_"+e;d.xmlDoc=c.getXmlDoc()}d.optionID="option_"+e;if(c.hasOption())d.option1=c.getOptionValue();d.ontoolbar=c.isVisible();d.order=this.CBService_.getList().indexOf(b);if(c.getChangedName())d.title=c.getChangedName();if(b=c.getGadgetDescription()){d.gadget_width=b.getWidth();d.gadget_height=b.getHeight();if(b.getGadgetOptions())d.gadget_options=b.getGadgetOptions()}d.in_search_list=
!!c.getURL("search");return d};a.isSimilar_=function(b,c){for(var d in b){if(!(d in c))return false;var e=b[d],f=c[d];if(e.ontoolbar&&(!f.ontoolbar||e.order!=f.order))return false;if(!this.getSharedButton_(e)&&G_FirefoxXMLUtils.getXMLString(e.xmlDoc)!=G_FirefoxXMLUtils.getXMLString(f.xmlDoc))return false}return true};a.cleanToolbar_=function(b,c){for(var d in b)if(!(d in c)){var e=b[d].localID;if(e=this.CBService_.getButton(e))e.canRemove()?this.CBService_.uninstall(b[d].localID,true):e.hide()}};
a.changeButton_=function(b){var c=this.CBService_.getButton(b.localID);if(c){if(!b.ontoolbar&&c.isVisible())c.hide();else b.ontoolbar&&!c.isVisible()&&c.show();"option1"in b&&b.option1!=c.getOptionValue()&&c.setOptionValue(b.option1);"title"in b&&b.title!=c.getName()&&c.setName(b.title);if(c.getGadgetDescription()){if("gadget_width"in b&&(!c.getGadgetDescription()||b.gadget_width!=c.getGadgetDescription().getWidth()))c.getGadgetDescription().setWidth(b.gadget_width);if("gadget_height"in b&&(!c.getGadgetDescription()||
b.gadget_height!=c.getGadgetDescription().getHeight()))c.getGadgetDescription().setHeight(b.gadget_height);if("gadget_options"in b&&(!c.getGadgetDescription()||b.gadget_options!=c.getGadgetDescription().getGadgetOptions()))c.getGadgetDescription().setGadgetOptions(b.gadget_options)}}};
a.putButtons_=function(b,c){var d={},e=[];for(var f in b){var g=b[f];e.push(g);d[g.localID]=true}var h=this.CBService_.getList().toArray();for(f=0;f<h.length;f++){var i=h[f];if(!(i in d)){g=this.getButtonInfo_(i);G_Assert(this,!!this.CBService_.getButton(g.localID),"Build in or shared button is going to be reinstalled");e.push(g)}}d=e.filter(function(n){return!n.order}).length>1;e=e.sort(d?BindToObject(this.rescueComparator,this):GTB_TBS_CBManager.comparator);this.CBService_.setNoFade(true);try{d=
[];for(f=0;f<e.length;++f){g=e[f];var j=this.CBService_.getButton(g.localID);if(!j)if(c){var k;k=g.optionID.startsWith("option_U")?GTB_CustomButtonsService.getUserDirectory():GTB_CustomButtonsService.getSharedDirectory()||GTB_CustomButtonsService.getUserDirectory();var l=g.optionID.replace(/option_[US]_/,""),m=k.clone().QueryInterface(Ci.nsILocalFile);m.appendRelativePath(l);j=new GTB_CB_ButtonWithFile(g.xmlDoc,m);g.localID=j.getID();this.CBService_.installButton(j)}else{j=new GTB_CB_Button(g.xmlDoc,
g.localID);this.CBService_.installButtonWithoutFile(j)}d.push(j.getID());this.changeButton_(g)}this.CBService_.setButtonList(d)}finally{this.CBService_.setNoFade(false)}};a.setOptions_=function(b){for(var c in b)this.changeButton_(b[c])};
a.setToolbarTo_=function(b){var c=[];for(var d in b)!b[d].xmlID&&!this.getSharedButton_(b[d])&&c.push(d);for(d=0;d<c.length;++d)delete b[c[d]];if(c=this.isSimilar_(b,this.cb_)){this.cleanToolbar_(this.cb_,b);this.setOptions_(b)}else{this.cleanToolbar_(this.cb_,{});this.putButtons_(b)}this.cb_=b;return!c};a.getCBList_=function(){var b=this.prefs_.getPref("google.toolbar.tbsync.backup.cb.list","");if(""==b)return[];return b.split(" ")};
a.local2Backup=function(){this.cb_=this.getFromToolbar_();var b=[];for(var c in this.cb_){b.push(c);for(var d="google.toolbar.tbsync.backup.cb."+c+".",e=0;e<GTB_TBSYNC_CB_FIELDS.length;++e)if(GTB_TBSYNC_CB_FIELDS[e]in this.cb_[c])"xmlDoc"==GTB_TBSYNC_CB_FIELDS[e]?this.prefs_.setPref(d+GTB_TBSYNC_CB_FIELDS[e],G_FirefoxXMLUtils.getXMLString(this.cb_[c][GTB_TBSYNC_CB_FIELDS[e]])):this.prefs_.setPref(d+GTB_TBSYNC_CB_FIELDS[e],this.cb_[c][GTB_TBSYNC_CB_FIELDS[e]])}this.prefs_.setPref("google.toolbar.tbsync.backup.cb.custombuttons.list",
this.prefs_.getPref("google.toolbar.custombuttons.list",""));this.prefs_.setPref("google.toolbar.tbsync.backup.cb.list",b.join(" "));this.CBService_.setSyncStatus(true)};
a.backup2Local=function(b){this.CBService_.setNoFade(true);try{for(var c={},d=this.getCBList_(),e=0;e<d.length;++e){var f="google.toolbar.tbsync.backup.cb."+d[e]+".";c[d[e]]={};for(var g=0;g<GTB_TBSYNC_CB_FIELDS.length;++g){var h=this.prefs_.getPref(f+GTB_TBSYNC_CB_FIELDS[g],null);if(h!=null)c[d[e]][GTB_TBSYNC_CB_FIELDS[g]]="xmlDoc"==GTB_TBSYNC_CB_FIELDS[g]?G_FirefoxXMLUtils.parseString(h):h}}this.cleanToolbar_(this.cb_,{});this.prefs_.setPref("google.toolbar.custombuttons.list",this.prefs_.getPref("google.toolbar.tbsync.backup.cb.custombuttons.list"));
b||this.CBService_.loadButtonsFromDisk(false);this.setOptions_(c);this.CBService_.setSyncStatus(false)}finally{this.CBService_.setNoFade(false)}};a.clearBackup=function(){for(var b=this.getCBList_(),c=0;c<b.length;++c)for(var d="google.toolbar.tbsync.backup.cb."+b[c]+".",e=0;e<GTB_TBSYNC_CB_FIELDS.length;++e)this.prefs_.clearPref(d+GTB_TBSYNC_CB_FIELDS[e]);this.prefs_.clearPref("google.toolbar.tbsync.backup.cb.list");this.prefs_.clearPref("google.toolbar.tbsync.backup.cb.custombuttons.list");this.CBService_.setSyncStatus(false)};
a.beforeSync=function(){this.CBService_.setSyncStatus(true);this.newcb_={}};
a.processItem=function(b){for(var c=GTB_TBS_XML_getTextNodeValue(b.getElementsByTagName("itemID")[0]),d=0;d<GTB_TBSYNC_CB_CASE_INCOMPATIBLES.length;++d)if(c.indexOf(GTB_TBSYNC_CB_CASE_INCOMPATIBLES[d])>=0){c=c.replace(".XML",".xml");break}if(this.deleteRequested_[c])this.noDeleteAcknoledge_[c]=true;else if(c.charAt(0)=="o"){b=b.getElementsByTagName("prop");var e=b.length,f=c.replace("option_","");this.newcb_[f]||(this.newcb_[f]={});this.newcb_[f].optionID=c;for(d=0;d<e;++d){c=b[d].getAttribute("name");
var g=GTB_TBS_XML_getTextNodeValue(b[d]);if(g!=""){var h=GTB_TBSYNC_CB_FIELDS.indexOf(c,4);if(-1!=h)this.newcb_[f][c]=h<6?g!="0":h<9?parseInt(g,10):g}}}else{f=c.replace("xml_","");b=b.getElementsByTagName("prop");e=b.length;for(d=0;d<e;++d)if(b[d].getAttribute("name")=="buttondata")if(h=GTB_TBS_XML_getTextNodeValue(b[d])){try{g=G_FirefoxXMLUtils.parseString(h);this.newcb_[f]||(this.newcb_[f]={});this.newcb_[f].xmlID=c;this.newcb_[f].xmlDoc=g}catch(i){}break}}};
a.finishSync=function(){this.cb_=this.getFromToolbar_();for(var b in this.newcb_){this.newcb_[b].localID=this.generateLocalID(b);this.serverState_[b]=this.newcb_[b]}this.deleteRequested_=this.noDeleteAcknoledge_;this.noDeleteAcknoledge_={};return this.setToolbarTo_(this.newcb_)};
a.addItems=function(b,c){this.newcb_=this.getFromToolbar_();for(var d in this.newcb_){var e=this.serverState_[d]||{},f=true,g=c.createElement("item"),h=GTB_TBS_XML_createTextNode("componentID",this.COMP_ID,c);g.appendChild(h);h=this.newcb_[d].optionID;for(var i=0;i<GTB_TBSYNC_CB_CASE_INCOMPATIBLES.length;++i)if(h.indexOf(GTB_TBSYNC_CB_CASE_INCOMPATIBLES[i])>=0){h=h.replace(".xml",".XML");break}h=GTB_TBS_XML_createTextNode("itemID",h,c);g.appendChild(h);for(h=4;h<6;++h)if(GTB_TBSYNC_CB_FIELDS[h]in
this.newcb_[d]){i=GTB_TBS_XML_createTextNode("prop",this.newcb_[d][GTB_TBSYNC_CB_FIELDS[h]]?"1":"0",c);i.setAttribute("name",GTB_TBSYNC_CB_FIELDS[h]);g.appendChild(i);f=f&&e[GTB_TBSYNC_CB_FIELDS[h]]==(this.newcb_[d][GTB_TBSYNC_CB_FIELDS[h]]?"1":"0");e[GTB_TBSYNC_CB_FIELDS[h]]=this.newcb_[d][GTB_TBSYNC_CB_FIELDS[h]]?"1":"0"}else{i=c.createElement("prop");i.setAttribute("name",GTB_TBSYNC_CB_FIELDS[h]);g.appendChild(i)}for(h=6;h<GTB_TBSYNC_CB_FIELDS.length;++h)if(GTB_TBSYNC_CB_FIELDS[h]in this.newcb_[d]){i=
GTB_TBS_XML_createTextNode("prop",this.newcb_[d][GTB_TBSYNC_CB_FIELDS[h]],c);i.setAttribute("name",GTB_TBSYNC_CB_FIELDS[h]);g.appendChild(i);f=f&&e[GTB_TBSYNC_CB_FIELDS[h]]==this.newcb_[d][GTB_TBSYNC_CB_FIELDS[h]];e[GTB_TBSYNC_CB_FIELDS[h]]=this.newcb_[d][GTB_TBSYNC_CB_FIELDS[h]]}else{i=c.createElement("prop");i.setAttribute("name",GTB_TBSYNC_CB_FIELDS[h]);g.appendChild(i)}f||b.appendChild(g);if(this.newcb_[d].xmlID&&d.charAt(0)=="U"){g=c.createElement("item");h=GTB_TBS_XML_createTextNode("componentID",
this.COMP_ID,c);g.appendChild(h);h=GTB_TBS_XML_createTextNode("itemID",this.newcb_[d].xmlID,c);f=f&&e.xmlID==this.newcb_[d].xmlID;e.xmlID=this.newcb_[d].xmlID;g.appendChild(h);h=c.createElement("prop");h.setAttribute("name","buttondata");i=c.createCDATASection(G_FirefoxXMLUtils.getXMLString(this.newcb_[d].xmlDoc));f=f&&e.xmlDoc==G_FirefoxXMLUtils.getXMLString(this.newcb_[d].xmlDoc);e.xmlDoc=G_FirefoxXMLUtils.getXMLString(this.newcb_[d].xmlDoc);h.appendChild(i);g.appendChild(h);f||b.appendChild(g)}this.serverState_[d]=
e}for(d in this.cb_)if(!this.newcb_[d]){this.deleteRequested_[this.cb_[d].optionID]=true;g=c.createElement("item");h=GTB_TBS_XML_createTextNode("componentID",this.COMP_ID,c);g.appendChild(h);h=GTB_TBS_XML_createTextNode("itemID",this.cb_[d].optionID,c);g.appendChild(h);e=c.createElement("isRemove");g.appendChild(e);b.appendChild(g);if(this.cb_[d].xmlID){this.deleteRequested_[this.cb_[d].xmlID]=true;g=c.createElement("item");h=GTB_TBS_XML_createTextNode("componentID",this.COMP_ID,c);g.appendChild(h);
h=GTB_TBS_XML_createTextNode("itemID",this.cb_[d].xmlID,c);g.appendChild(h);e=c.createElement("isRemove");g.appendChild(e);b.appendChild(g)}}};a.finishUpdate=function(){this.cb_=this.newcb_};a.getSharedButton_=function(b){var c=b.localID;c||(c=this.generateLocalID(b.optionID.replace("option_","")));return this.CBService_.getButton(c)};
a.onUserDeletion=function(){var b=GTB_CustomButtonsService.getUserDirectory();b.remove(true);GTB_CustomButtonsService.getUserDirectory();this.cleanToolbar_(this.cb_,{});this.putButtons_(this.cb_,true);this.serverState_={}};a.onUserCreation=function(){this.cleanToolbar_(this.cb_,{});this.putButtons_(this.cb_,false)};function GTB_TBS_XML_createTextNode(b,c,d){b=d.createElement(b);b.appendChild(d.createTextNode(c+""));return b}function GTB_TBS_XML_getTextNodeValue(b){b=b.firstChild;for(var c="";b;){if(b.nodeType==Ci.nsIDOMNode.TEXT_NODE)c+=b.nodeValue;b=b.nextSibling}return c};function GTB_UA_AdapterFactory(){}goog.exportSymbol("GTB_UA_AdapterFactory",GTB_UA_AdapterFactory);GTB_UA_AdapterFactory.prototype.QueryInterface=function(b){if(b.equals(Ci.gtbIAdapterFactory)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};goog.exportProperty(GTB_UA_AdapterFactory.prototype,"QueryInterface",GTB_UA_AdapterFactory.prototype.QueryInterface);
GTB_UA_AdapterFactory.prototype.createInstance=function(b){var c=null;if(b.equals(Ci.gtbIDocShellAdapter))c=(new GTB_UA_DocShellAdapter).QueryInterface(b);return c};goog.exportProperty(GTB_UA_AdapterFactory.prototype,"createInstance",GTB_UA_AdapterFactory.prototype.createInstance);function GTB_UA_DocShellAdapter(){}goog.exportSymbol("GTB_UA_DocShellAdapter",GTB_UA_DocShellAdapter);GTB_UA_DocShellAdapter.prototype.debugZone="GTB_UA_DocShellAdapter";GTB_UA_DocShellAdapter.prototype.QueryInterface=function(b){if(b.equals(Ci.gtbIDocShellAdapter)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};goog.exportProperty(GTB_UA_DocShellAdapter.prototype,"QueryInterface",GTB_UA_DocShellAdapter.prototype.QueryInterface);
GTB_UA_DocShellAdapter.prototype.adaptee=null;GTB_UA_DocShellAdapter.prototype.__defineGetter__("loadType",function(){return this.adaptee.loadType});GTB_UA_DocShellAdapter.prototype.__defineSetter__("loadType",function(b){this.adaptee.loadType=b});var modScope=this,GTB_ApplicationInstance=null;function GTB_Application(){this.debugZone="gtbApplication";GTB_ApplicationInstance=this;this.wrappedJSObject=modScope;this.uninstaller_=new GTB_Uninstaller;this.textReuseService_=null;this.isInitialized_=false}a=GTB_Application.prototype;a.QueryInterface=function(b){if(b.equals(Ci.nsIObserver)||b.equals(Ci.nsISupports))return this;throw Components.results.NS_ERROR_NO_INTERFACE;};a.observe=function(){};
a.init=function(){if(!this.isInitialized_){GTB_StartupProfiler.timestamp("+Application.init");this.isInitialized_=true;this.onProfileAfterChange_();GTB_StartupProfiler.timestamp("onProfileAfterChange_");this.onFirstDomWindowOpened_();GTB_StartupProfiler.timestamp("onFirstDomWindowOpened_");GTB_StartupProfiler.timestamp("-Application.init")}};a.delayedInit=function(){this.uninstaller_.delayedInit()};a.onProfileAfterChange_=function(){try{this.updateVersionNumber_()}catch(b){}};a.initService_=function(b){try{Cc[b].getService().wrappedJSObject.init()}catch(c){}};
a.onFirstDomWindowOpened_=function(){GTB_StartupProfiler.timestamp("+onFirstDomWindowOpened_");this.initService_("@google.com/toolbar/caps-manager;1");GTB_StartupProfiler.timestamp("caps-manager");this.initService_("@google.com/toolbar/gaia-service;1");GTB_StartupProfiler.timestamp("gaia-service");this.initService_("@google.com/toolbar/custom-buttons-service;1");GTB_StartupProfiler.timestamp("custom-buttons-service");this.initService_("@google.com/toolbar/search-history;1");GTB_StartupProfiler.timestamp("search-history");
this.initService_("@google.com/toolbar/bookmarks;1");GTB_StartupProfiler.timestamp("bookmarks");this.initService_("@google.com/toolbar/content-prefs;1");GTB_StartupProfiler.timestamp("content-prefs");this.initService_("@google.com/toolbar/linkdoctor;1");GTB_StartupProfiler.timestamp("linkdoctor");this.textReuseService_=new GTB_TextReuseService;GTB_StartupProfiler.timestamp("text-reuse");if(GTB_GeckoVersion.isFirefox3()){GTB_NewTabService.instance=new GTB_NewTabService;GTB_StartupProfiler.timestamp("new-tab")}this.initService_("@google.com/toolbar/sharing-service;1");
new GTB_SharingPageLoadListener(Cc["@google.com/toolbar/sharing-service;1"].getService().wrappedJSObject);GTB_StartupProfiler.timestamp("sharing");(new GTB_FFSearchBox).init();GTB_StartupProfiler.timestamp("GTB_FFSearchBox init");this.setLocaleDefaultPrefs_();GTB_StartupProfiler.timestamp("setLocaleDefaultPrefs_");GTB_StartupProfiler.timestamp("-onFirstDomWindowOpened_");this.uninstaller_.init();this.reportActiveToOmaha_()};
a.reportActiveToOmaha_=function(){try{var b=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);b.create(Ci.nsIWindowsRegKey.ROOT_KEY_CURRENT_USER,"SOFTWARE\\Google\\Update\\ClientState\\{2CCBABCB-6427-4A55-B091-49864623C43F}",Ci.nsIWindowsRegKey.ACCESS_WRITE);b.writeStringValue("dr","1");b.close()}catch(c){b&&b.close()}};
a.setLocaleDefaultPrefs_=function(){var b=new G_Preferences("google.toolbar."),c=GTB_getLangCode();if(!b.getPref("translate.updateFlag")){if(b.getPref("translate.target_lang"))"es"==b.getPref("translate.target_lang")&&"en"==c&&b.setPref("translate.target_lang",c);else{c=b.getPref("auto_page_translate.target_lang")||b.getPref("auto_translate")&&b.getPref("autotranslate_to_lang")||c;b.setPref("translate.target_lang",c)}b.setPref("translate.updateFlag",true);b.clearPref("auto_page_translate.target_lang");
b.clearPref("autotranslate_to_lang")}if(b.hasUserValue("auto_translate")){b.setPref("translate.hover",b.getPref("auto_translate"));b.clearPref("auto_translate")}};
a.updateVersionNumber_=function(){var b=GetEmResourceValue("urn:mozilla:item:{3112ca9c-de6d-4884-a869-9855de68056c}","http://www.mozilla.org/2004/em-rdf#version");if(b)if(Cc["@mozilla.org/windows-registry-key;1"]&&Ci.nsIWindowsRegKey){b=b.replace(/[WML]/g,"");try{var c=Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey),d=false,e=Ci.nsIWindowsRegKey.ROOT_KEY_LOCAL_MACHINE;try{c.open(e,"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall",Ci.nsIWindowsRegKey.ACCESS_READ);
d=c.hasChild("{2CCBABCB-6427-4A55-B091-49864623C43F}")}catch(f){}if(d){var g=c.openChild("{2CCBABCB-6427-4A55-B091-49864623C43F}",Ci.nsIWindowsRegKey.ACCESS_ALL);g.writeStringValue("DisplayVersion",b);var h=b.split(".");g.writeIntValue("VersionMajor",h[0]);g.writeIntValue("VersionMinor",h[1]);g.writeIntValue("Version",h[2]);g.close()}c.close();d=false;try{c.open(e,"SOFTWARE\\Google\\Update\\Clients",Ci.nsIWindowsRegKey.ACCESS_READ);d=c.hasChild("{2CCBABCB-6427-4A55-B091-49864623C43F}")}catch(i){}if(d){g=
c.openChild("{2CCBABCB-6427-4A55-B091-49864623C43F}",Ci.nsIWindowsRegKey.ACCESS_ALL);g.writeStringValue("pv",b);g.close()}c.close()}catch(j){}}};function GTB_ToolbarCommands(b){this.win_=b;this.debugZone="ToolbarCommands";this.onStateChangeCallback_=BindToObject(this.onStateChange,this);this.webProgressService=Cc["@google.com/toolbar/web-progress-listener;1"].getService().wrappedJSObject;this.webProgressService.addWindowListener(this.win_,this.onStateChangeCallback_,Ci.nsIWebProgress.NOTIFY_STATE_DOCUMENT)}GTB_ToolbarCommands.prototype.shutdown=function(){this.webProgressService.removeWindowListener(this.win_,this.onStateChangeCallback_)};
GTB_ToolbarCommands.prototype.onStateChange=function(b,c,d,e){try{var f=d.host,g=d.path}catch(h){return}c=g.split("?");if(!(!GTB_isGoogleDomain(f)||c.length!=2||c[0]!="/command"||c[1].indexOf("close_browser")==-1)){f=b.contentWindow.name;if(!(f!="gtbGaiaLogin"&&f!="NewAccount"&&b.ownerDocument.defaultView.name!="gtbCustomButtonsAdvancedEditor")){f=this.win_.document.getElementById("content");e.cancel(2152398850);if(f.browsers.length==1)this.win_.close();else for(e=0;e<f.browsers.length;e++)if(f.browsers[e]==
b){f.removeTab(f.mTabContainer.childNodes[e]);break}}}};var exports=this;exports.GTB_PageInfoMenu=GTB_PageInfoMenu;exports.GTB_SubmitUninstallFeedback=GTB_SubmitUninstallFeedback;exports.GTB_Uninstall_uninstall=GTB_Uninstall_uninstall;exports.GTB_About_CopyVersions=GTB_About_CopyVersions;exports.GTB_About_AddExtraVersions=GTB_About_AddExtraVersions;exports.GTB_SendDailyPing=GTB_SendDailyPing;exports.GTB_RestoreLayout=GTB_RestoreLayout;exports.GTB_NewTabPage=GTB_NewTabPage;exports.GTB_GOOGLE_HOME_DICT=GTB_GOOGLE_HOME_DICT;
exports.GTB_isGoogleToolbarVisibleInDoc=GTB_isGoogleToolbarVisibleInDoc;
